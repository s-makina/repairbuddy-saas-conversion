module.exports=[26512,a=>{"use strict";var b=a.i(57850),c=a.i(45056),d=a.i(59843),e=a.i(91601),f=a.i(25533),g=a.i(75385),h=a.i(17933),i=a.i(97867),j=a.i(4600),k=a.i(26606),l=a.i(94703),m=a.i(29054),n=a.i(56264),o=a.i(75458);function p(a){let b=Array.isArray(a.versions)?a.versions:[],c=b.find(a=>"active"===a.status)??null;return c||(b.slice().sort((a,b)=>(b.version??0)-(a.version??0))[0]??null)}function q({className:a}){return(0,b.jsx)("svg",{viewBox:"0 0 24 24",className:a,fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:(0,b.jsx)("path",{d:"M20 6L9 17l-5-5"})})}function r(){return(0,b.jsxs)(j.Card,{className:"relative overflow-hidden",children:[(0,b.jsx)("div",{className:"h-1.5 w-full bg-[var(--rb-border)]"}),(0,b.jsx)(j.CardHeader,{className:"pb-3",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)(k.Skeleton,{className:"h-5 w-40 rounded-[var(--rb-radius-sm)]"}),(0,b.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[(0,b.jsx)(k.Skeleton,{className:"h-3 w-16 rounded-[var(--rb-radius-sm)]"}),(0,b.jsx)(k.Skeleton,{className:"h-5 w-24 rounded-full"})]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)(k.Skeleton,{className:"ml-auto h-8 w-28 rounded-[var(--rb-radius-sm)]"}),(0,b.jsx)("div",{className:"mt-2 flex items-center justify-end gap-2",children:(0,b.jsx)(k.Skeleton,{className:"h-5 w-16 rounded-full"})})]})]})}),(0,b.jsxs)(j.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(k.Skeleton,{className:"h-3 w-full rounded-[var(--rb-radius-sm)]"}),(0,b.jsx)(k.Skeleton,{className:"h-3 w-4/5 rounded-[var(--rb-radius-sm)]"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(k.Skeleton,{className:"h-3 w-44 rounded-[var(--rb-radius-sm)]"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(k.Skeleton,{className:"h-4 w-4 rounded-[var(--rb-radius-sm)]"}),(0,b.jsx)(k.Skeleton,{className:"h-3 w-2/3 rounded-[var(--rb-radius-sm)]"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(k.Skeleton,{className:"h-4 w-4 rounded-[var(--rb-radius-sm)]"}),(0,b.jsx)(k.Skeleton,{className:"h-3 w-1/2 rounded-[var(--rb-radius-sm)]"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(k.Skeleton,{className:"h-4 w-4 rounded-[var(--rb-radius-sm)]"}),(0,b.jsx)(k.Skeleton,{className:"h-3 w-3/5 rounded-[var(--rb-radius-sm)]"})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3 border-t border-[var(--rb-border)] pt-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(k.Skeleton,{className:"h-3 w-24 rounded-[var(--rb-radius-sm)]"}),(0,b.jsx)("div",{className:"mt-2",children:(0,b.jsx)(k.Skeleton,{className:"h-4 w-28 rounded-[var(--rb-radius-sm)]"})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(k.Skeleton,{className:"h-3 w-20 rounded-[var(--rb-radius-sm)]"}),(0,b.jsx)("div",{className:"mt-2",children:(0,b.jsx)(k.Skeleton,{className:"h-4 w-24 rounded-[var(--rb-radius-sm)]"})})]})]}),(0,b.jsx)("div",{className:"flex items-center justify-end gap-2 pt-1",children:(0,b.jsx)(k.Skeleton,{className:"h-9 w-24 rounded-[var(--rb-radius-sm)]"})})]})]})}function s(){let a=(0,o.useAuth)(),k=(0,f.useDashboardHeader)(),[s,t]=(0,c.useState)(!0),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)([]),[y,z]=(0,c.useState)(0),[A,B]=(0,c.useState)(""),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)(!1),[G,H]=(0,c.useState)(null),[I,J]=(0,c.useState)(""),[K,L]=(0,c.useState)(""),[M,N]=(0,c.useState)(""),[O,P]=(0,c.useState)(!0),Q=a.can("admin.billing.write");async function R(){let a=I.trim();if(!a)return void H("Name is required.");F(!0),H(null);try{await (0,n.createBillingPlan)({name:a,code:K,description:M,isActive:O}),D(!1),z(a=>a+1)}catch(a){H(a instanceof Error?a.message:"Failed to create billing plan.")}finally{F(!1)}}(0,c.useEffect)(()=>(k.setHeader({breadcrumb:"Admin / Billing",title:"Billing plans",subtitle:"View billing catalog (plans, versions, prices)",actions:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[Q?(0,b.jsx)(d.default,{href:"/admin/billing/builder",children:(0,b.jsx)(i.Button,{variant:"outline",size:"sm",disabled:s,children:"New plan"})}):null,(0,b.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>z(a=>a+1),disabled:s,children:"Refresh"})]})}),()=>k.setHeader(null)),[Q,k,s]),(0,c.useEffect)(()=>{let a=!0;return async function(){try{t(!0),v(null);let b=await (0,n.getBillingCatalog)({includeInactive:!0});if(!a)return;x(Array.isArray(b.billing_plans)?b.billing_plans:[])}catch(b){if(!a)return;v(b instanceof Error?b.message:"Failed to load billing catalog."),x([])}finally{if(!a)return;t(!1)}}(),()=>{a=!1}},[y]);let S=(0,c.useMemo)(()=>{let a=A.trim().toLowerCase();return a?w.filter(b=>`${b.name} ${b.code}`.toLowerCase().includes(a)):w},[w,A]);return(0,b.jsx)(e.RequireAuth,{requiredPermission:"admin.billing.read",children:(0,b.jsxs)("div",{className:"space-y-6",children:[u?(0,b.jsx)(g.Alert,{variant:"danger",title:"Could not load billing plans",children:u}):null,(0,b.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Plans"}),(0,b.jsx)("div",{className:"mt-1 text-sm text-zinc-600",children:"Browse plans, pricing and current versions."})]}),(0,b.jsx)("div",{className:"w-full sm:w-[360px]",children:(0,b.jsx)(m.Input,{value:A,onChange:a=>B(a.target.value),placeholder:"Search by name or code…"})})]}),s?(0,b.jsx)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 xl:grid-cols-3",children:Array.from({length:6}).map((a,c)=>(0,b.jsx)(r,{},c))}):null,s||0!==S.length?null:(0,b.jsx)("div",{className:"text-sm text-zinc-500",children:"No billing plans found."}),!s&&S.length>0?(0,b.jsx)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 xl:grid-cols-3",children:S.map(a=>{let c,e,f=p(a),g=function(a){if(!a)return null;let b=Array.isArray(a.prices)?a.prices:[];return b.find(a=>a.is_default)??null??b[0]??null}(f),k=Array.from(new Set((Array.isArray(a.versions)?a.versions:[]).flatMap(a=>Array.isArray(a.prices)?a.prices:[]).map(a=>a.currency).filter(Boolean))).map(a=>String(a).toUpperCase()).sort(),l="pro"===String(a.code||"").toLowerCase(),m=(c=p(a),Array.from(new Set((Array.isArray(c?.entitlements)?c?.entitlements:[]).map(a=>a&&"object"==typeof a&&"definition"in a?a.definition?.name:void 0).filter(Boolean).map(a=>String(a)))));return(0,b.jsxs)(j.Card,{className:"relative overflow-hidden transition-all hover:-translate-y-0.5 hover:shadow-[var(--rb-shadow)] "+(l?"border-[color:color-mix(in_srgb,var(--rb-orange),white_35%)] shadow-[var(--rb-shadow)]":""),children:[(0,b.jsx)("div",{className:"h-1.5 w-full "+(l?"bg-[var(--rb-orange)]":a.is_active?"bg-[var(--rb-blue)]":"bg-[var(--rb-border)]")}),(0,b.jsx)(j.CardHeader,{className:"pb-3",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)(j.CardTitle,{className:"truncate",children:a.name}),(0,b.jsxs)("div",{className:"mt-1 flex flex-wrap items-center gap-2",children:[(0,b.jsx)("div",{className:"truncate text-xs text-zinc-500",children:a.code}),l?(0,b.jsx)(h.Badge,{variant:"warning",children:"Most popular"}):null]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,b.jsx)("div",{className:"text-2xl font-semibold tracking-tight text-[var(--rb-text)]",children:g?function(a){let b=(a.currency||"usd").toUpperCase(),c=("number"==typeof a.amountCents?a.amountCents:0)/100;try{return new Intl.NumberFormat(void 0,{style:"currency",currency:b,maximumFractionDigits:2}).format(c)}catch{return`${b} ${c.toFixed(2)}`}}({currency:g.currency,amountCents:g.amount_cents}):"—"}),(0,b.jsx)("div",{className:"pt-1 text-sm text-zinc-600",children:g&&(e=String(g.interval||"").toLowerCase())?"month"===e||"monthly"===e?"/mo":"year"===e||"yearly"===e||"annual"===e?"/yr":`/${e}`:""})]}),(0,b.jsx)("div",{className:"mt-1 flex items-center justify-end gap-2",children:(0,b.jsx)(h.Badge,{variant:a.is_active?"success":"default",children:a.is_active?"active":"inactive"})})]})]})}),(0,b.jsxs)(j.CardContent,{className:"space-y-4",children:[(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:a.description??"—"}),(0,b.jsxs)("div",{className:"space-y-2",children:[g?.trial_days?(0,b.jsxs)("div",{className:"text-xs text-zinc-500",children:[g.trial_days," day trial included"]}):null,(0,b.jsx)("ul",{className:"space-y-1",children:m.length>0?m.map(a=>(0,b.jsxs)("li",{className:"flex items-start gap-2 text-sm text-zinc-700",children:[(0,b.jsx)(q,{className:"mt-0.5 h-4 w-4 shrink-0 text-[var(--rb-blue)]"}),(0,b.jsx)("span",{className:"min-w-0",children:a})]},a)):(0,b.jsx)("li",{className:"text-sm text-zinc-500",children:"No entitlements configured."})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3 border-t border-[var(--rb-border)] pt-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-zinc-500",children:"Current version"}),(0,b.jsx)("div",{className:"mt-1 text-sm font-medium text-zinc-800",children:f?`v${f.version} (${f.status})`:"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-zinc-500",children:"Currencies"}),(0,b.jsx)("div",{className:"mt-1 text-sm font-medium text-zinc-800",children:k.length>0?k.join(", "):"—"})]})]}),(0,b.jsx)("div",{className:"flex items-center justify-end gap-2 pt-1",children:(0,b.jsx)(d.default,{href:`/admin/billing/plans/${a.id}`,children:(0,b.jsx)(i.Button,{variant:l?"secondary":"outline",size:"sm",children:"View plan"})})})]})]},a.id)})}):null,(0,b.jsxs)("div",{className:"text-sm text-zinc-500",children:["Entitlements definitions are available under"," ",(0,b.jsx)(d.default,{className:"underline",href:"/admin/billing/entitlements",children:"Billing / Entitlements"}),"."]}),(0,b.jsx)(l.Modal,{open:C,onClose:()=>{E||D(!1)},title:"Create billing plan",footer:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,b.jsx)(i.Button,{variant:"outline",onClick:()=>{E||D(!1)},disabled:E,children:"Cancel"}),(0,b.jsx)(i.Button,{variant:"primary",onClick:()=>void R(),disabled:E,children:E?"Creating…":"Create"})]}),children:(0,b.jsxs)("div",{className:"space-y-4",children:[G?(0,b.jsx)(g.Alert,{variant:"danger",title:"Cannot create plan",children:G}):null,(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Name"}),(0,b.jsx)(m.Input,{value:I,onChange:a=>J(a.target.value),placeholder:"e.g. Starter"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Code (optional)"}),(0,b.jsx)(m.Input,{value:K,onChange:a=>L(a.target.value),placeholder:"e.g. starter"}),(0,b.jsx)("div",{className:"text-xs text-zinc-500",children:"If empty, it will be generated from the name."})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Description (optional)"}),(0,b.jsx)("textarea",{className:"min-h-[90px] w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:M,onChange:a=>N(a.target.value),placeholder:"Short description shown to admins…"})]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:O,onChange:a=>P(a.target.checked)}),"Active"]}),(0,b.jsx)("div",{className:"text-xs text-zinc-500",children:"A draft version v1 will be created automatically."})]})})]})})}a.s(["default",()=>s])}];

//# sourceMappingURL=frontend_src_app_admin_billing_plans_page_tsx_a7af3a77._.js.map