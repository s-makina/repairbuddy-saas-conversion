module.exports=[62286,a=>{"use strict";var b=a.i(57850),c=a.i(45056),d=a.i(93609),e=a.i(72481),f=a.i(31261);let g=(0,f.default)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);var h=a.i(41379),i=a.i(71907),j=a.i(61185),k=a.i(6183);let l=(0,f.default)("piggy-bank",[["path",{d:"M11 17h3v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-3a3.16 3.16 0 0 0 2-2h1a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1h-1a5 5 0 0 0-2-4V3a4 4 0 0 0-3.2 1.6l-.3.4H11a6 6 0 0 0-6 6v1a5 5 0 0 0 2 4v3a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1z",key:"1piglc"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M2 8v1a2 2 0 0 0 2 2h1",key:"1env43"}]]);var m=a.i(35199);let n=(0,f.default)("repeat-2",[["path",{d:"m2 9 3-3 3 3",key:"1ltn5i"}],["path",{d:"M13 18H7a2 2 0 0 1-2-2V6",key:"1r6tfw"}],["path",{d:"m22 15-3 3-3-3",key:"4rnwn2"}],["path",{d:"M11 6h6a2 2 0 0 1 2 2v10",key:"2f72bc"}]]);var o=a.i(97867),p=a.i(17933),q=a.i(4600),r=a.i(54177),s=a.i(46036),t=a.i(54804),u=a.i(34075),v=a.i(4148);function w(a){if(!a)return"";let b=new Date(a);return Number.isNaN(b.getTime())?"":b.toLocaleDateString()}function x(){let a=(0,d.useRouter)(),f=(0,d.useParams)(),x=f.business??f.tenant,[y,z]=c.default.useState(!0),[A,B]=c.default.useState(null),[C,D]=c.default.useState([]),[E,F]=c.default.useState(""),[G,H]=c.default.useState({}),[I,J]=c.default.useState({}),[K,L]=c.default.useState("all"),[M,N]=c.default.useState("all"),[O,P]=c.default.useState("all"),[Q,R]=c.default.useState(!1),[S,T]=c.default.useState(null),[U,V]=c.default.useState(0),[W,X]=c.default.useState(!0),[Y,Z]=c.default.useState(null),[$,_]=c.default.useState(0),[aa,ab]=c.default.useState(0),[ac,ad]=c.default.useState(0),[ae,af]=c.default.useState(0),[ag,ah]=c.default.useState(0),[ai,aj]=c.default.useState(10);c.default.useEffect(()=>{let b=!0;return async function(){try{if(z(!0),B(null),"string"!=typeof x||0===x.length)throw Error("Business is missing.");let a=new URLSearchParams,c=E.trim();""!==c&&a.set("q",c),"all"!==K&&a.set("status",K),"all"!==M&&a.set("payment_status",M),"all"!==O&&a.set("priority",O),Q&&a.set("overdue","1"),a.set("page",String(ag+1)),a.set("per_page",String(ai)),S?.id&&S?.dir&&(a.set("sort",S.id),a.set("dir",S.dir));let[d,e,f]=await Promise.all([(0,u.apiFetch)(`/api/${x}/app/repairbuddy/jobs?${a.toString()}`),(0,u.apiFetch)(`/api/${x}/app/repairbuddy/job-statuses`),(0,u.apiFetch)(`/api/${x}/app/repairbuddy/payment-statuses`)]);if(!b)return;D(Array.isArray(d.jobs)?d.jobs:[]),V("number"==typeof d.meta?.total?d.meta.total:0);let g={};for(let a of Array.isArray(e.job_statuses)?e.job_statuses:[])g[a.slug]=a.label;H(g);let h={};for(let a of Array.isArray(f.payment_statuses)?f.payment_statuses:[])h[a.slug]=a.label;J(h)}catch(c){if(!b)return;if(c instanceof u.ApiError&&428===c.status&&"string"==typeof x&&x.length>0){let b=`/app/${x}/jobs`;a.replace(`/app/${x}/branches/select?next=${encodeURIComponent(b)}`);return}B(c instanceof Error?c.message:"Failed to load jobs.")}finally{if(!b)return;z(!1)}}(),()=>{b=!1}},[a,x,E,ag,ai,S,K,M,O,Q]),c.default.useEffect(()=>{let a=!0;return async function(){try{if(X(!0),Z(null),"string"!=typeof x||0===x.length)throw Error("Business is missing.");let b=new URLSearchParams,c=E.trim();""!==c&&b.set("q",c),"all"!==M&&b.set("payment_status",M),"all"!==O&&b.set("priority",O);let d=await (0,u.apiFetch)(`/api/${x}/app/repairbuddy/jobs/stats?${b.toString()}`);if(!a)return;_("number"==typeof d.open?d.open:0),ab("number"==typeof d.urgent?d.urgent:0),ad("number"==typeof d.overdue?d.overdue:0),af("number"==typeof d.payment_due?d.payment_due:0)}catch(b){if(!a)return;Z(b instanceof Error?b.message:"Failed to load stats."),_(0),ab(0),ad(0),af(0)}finally{if(!a)return;X(!1)}}(),()=>{a=!1}},[x,E,M,O]);let ak=c.default.useMemo(()=>[{id:"id",header:"ID",sortId:"id",cell:a=>(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:a.id}),className:"whitespace-nowrap"},{id:"case_tech",header:"Case/Tech",sortId:"case_number",cell:a=>{let c=Array.isArray(a.assigned_technicians)?a.assigned_technicians.map(a=>"string"==typeof a?.name?a.name:"").map(a=>a.trim()).filter(a=>a.length>0):[];return(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"truncate font-semibold text-[var(--rb-text)]",children:a.case_number}),(0,b.jsx)("div",{className:"truncate text-xs text-zinc-600",children:c.length>0?`Tech: ${c.join(", ")}`:"—"})]})},className:"min-w-[200px] max-w-[260px]"},{id:"customer",header:"Customer",cell:a=>(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"truncate text-sm font-semibold text-[var(--rb-text)]",children:a.customer?.name??"—"}),(0,b.jsx)("div",{className:"truncate text-xs text-zinc-600",children:a.customer?.email??""})]}),className:"min-w-[220px] max-w-[320px]"},{id:"devices",header:"Devices",cell:a=>{let c=Array.isArray(a.job_devices)?a.job_devices:[];if(0===c.length)return(0,b.jsx)("div",{className:"text-sm text-zinc-600",children:"—"});let d=c.map(a=>{let b="string"==typeof a?.label?a.label.trim():"",c="string"==typeof a?.serial?a.serial.trim():"";return b&&c?`${b} (${c})`:b||c}).filter(a=>a.length>0),e=d.slice(0,2),f=d.length-e.length;return(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"truncate text-sm text-zinc-700",children:e.join(", ")||"—"}),f>0?(0,b.jsxs)("div",{className:"truncate text-xs text-zinc-600",children:["+",f," more"]}):null]})},className:"min-w-[220px] max-w-[360px]"},{id:"dates",header:"Dates",cell:a=>{let c=w(a.pickup_date),d=w(a.delivery_date),e=w(a.next_service_date);return c||d||e?(0,b.jsxs)("div",{className:"text-xs text-zinc-700",children:[c?(0,b.jsxs)("div",{className:"truncate",children:[(0,b.jsx)("span",{className:"font-semibold",children:"P"}),": ",c]}):null,d?(0,b.jsxs)("div",{className:"truncate",children:[(0,b.jsx)("span",{className:"font-semibold",children:"D"}),": ",d]}):null,e?(0,b.jsxs)("div",{className:"truncate",children:[(0,b.jsx)("span",{className:"font-semibold",children:"N"}),": ",e]}):null]}):(0,b.jsx)("div",{className:"text-sm text-zinc-600",children:"—"})},className:"whitespace-nowrap min-w-[140px]"},{id:"total",header:"Total",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:(0,v.formatMoney)({amountCents:a.totals?.total_cents,currency:a.totals?.currency})}),className:"whitespace-nowrap"},{id:"balance",header:"Balance",cell:a=>{let c="number"==typeof a.totals?.total_cents?a.totals.total_cents:null,d=a.totals?.currency;if(null===c||!d)return(0,b.jsx)("div",{className:"text-sm text-zinc-600",children:"—"});let e="paid"===a.payment_status?0:c;return(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:(0,v.formatMoney)({amountCents:e,currency:d})})},className:"whitespace-nowrap"},{id:"payment",header:"Payment",sortId:"payment_status",cell:a=>{var c;return(0,b.jsx)(p.Badge,{variant:(c=a.payment_status)?"paid"===c?"success":"partial"===c?"warning":"unpaid"===c||"due"===c?"danger":"default":"default",children:a.payment_status?I[a.payment_status]??a.payment_status.replace(/_/g," "):"—"})},className:"whitespace-nowrap"},{id:"status",header:"Status",sortId:"status",cell:a=>{var c;return(0,b.jsx)(p.Badge,{variant:"delivered"===(c=a.status)||"completed"===c?"success":"ready"===c?"warning":"cancelled"===c?"danger":"in_process"===c?"info":"default",children:G[a.status]??a.status.replace(/_/g," ")})},className:"whitespace-nowrap"},{id:"priority",header:"Priority",sortId:"priority",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-600",children:a.priority?a.priority.replace(/_/g," "):"—"}),className:"whitespace-nowrap"},{id:"actions",header:(0,b.jsx)("div",{className:"text-right",children:"Actions"}),cell:c=>(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsx)(s.DropdownMenu,{align:"right",trigger:({toggle:a})=>(0,b.jsx)(o.Button,{variant:"outline",size:"sm",className:"px-2","aria-label":"Actions",onClick:b=>{b.preventDefault(),b.stopPropagation(),a()},children:(0,b.jsx)(k.MoreHorizontal,{className:"h-4 w-4"})}),children:({close:d})=>(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(s.DropdownMenuItem,{onSelect:()=>{"string"==typeof x&&0!==x.length&&(d(),a.push(`/app/${x}/jobs/${c.id}`))},children:(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)(h.Eye,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:"View"})]})}),(0,b.jsx)(s.DropdownMenuItem,{onSelect:()=>{"string"==typeof x&&0!==x.length&&(d(),a.push(`/app/${x}/jobs/${c.id}?tab=financial`))},children:(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)(l,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:"Financial"})]})}),(0,b.jsx)(s.DropdownMenuItem,{onSelect:()=>{"string"==typeof x&&0!==x.length&&(d(),a.push(`/app/${x}/jobs/${c.id}?tab=messages`))},children:(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)(j.MessageSquare,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:"Messages"})]})}),(0,b.jsx)(s.DropdownMenuSeparator,{}),(0,b.jsx)(s.DropdownMenuItem,{onSelect:()=>{},disabled:!0,children:(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)(m.Printer,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:"Print invoice"})]})}),(0,b.jsx)(s.DropdownMenuItem,{onSelect:()=>{},disabled:!0,children:(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)(g,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:"Download PDF"})]})}),(0,b.jsx)(s.DropdownMenuItem,{onSelect:()=>{},disabled:!0,children:(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)(i.Mail,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:"Email customer"})]})}),(0,b.jsx)(s.DropdownMenuSeparator,{}),(0,b.jsx)(s.DropdownMenuItem,{onSelect:()=>{},disabled:!0,children:(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)(n,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:"Duplicate job"})]})}),(0,b.jsx)(s.DropdownMenuItem,{onSelect:()=>{},disabled:!0,children:(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)(e.CreditCard,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:"Take payment"})]})})]})})}),className:"whitespace-nowrap"}],[I,a,G,x]),al=c.default.useMemo(()=>{let a=[{label:"All",value:"all"},{label:"Open",value:"open"}],b=Object.entries(G);for(let[c,d]of(b.sort((a,b)=>a[1].localeCompare(b[1])),b))a.push({label:d,value:c});return a},[G]),am=c.default.useMemo(()=>[{id:"open",label:"Open",value:$,dot:"bg-sky-500"},{id:"urgent",label:"Urgent",value:aa,dot:"bg-rose-500"},{id:"overdue",label:"Overdue",value:ac,dot:"bg-amber-500"},{id:"payment_due",label:"Needs payment",value:ae,dot:"bg-violet-500"}],[$,ac,ae,aa]),an=c.default.useMemo(()=>{let a=[{label:"All",value:"all"},{label:"Needs payment",value:"needs_payment"}],b=Object.entries(I);for(let[c,d]of(b.sort((a,b)=>a[1].localeCompare(b[1])),b))a.push({label:d,value:c});return a},[I]),ao=c.default.useMemo(()=>[{label:"All",value:"all"},{label:"Low",value:"low"},{label:"Normal",value:"normal"},{label:"High",value:"high"},{label:"Urgent",value:"urgent"}],[]),ap=c.default.useMemo(()=>[{label:"All",value:"all"},{label:"Overdue",value:"overdue"}],[]);return(0,b.jsxs)(t.ListPageShell,{title:"Jobs",description:"Track, update, and communicate on repair jobs.",actions:(0,b.jsx)(o.Button,{variant:"outline",size:"sm",onClick:()=>{"string"==typeof x&&0!==x.length&&a.push(`/app/${x}/jobs/new`)},children:"New job"}),loading:y,error:A,empty:!y&&!A&&0===C.length,emptyTitle:"No jobs found",emptyDescription:"Try adjusting your search.",children:[(0,b.jsx)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-4",children:am.map(a=>(0,b.jsxs)("div",{className:"rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-white p-4 text-left shadow-none",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsx)("div",{className:"min-w-0",children:(0,b.jsx)("div",{className:"text-xs font-medium text-zinc-600",children:a.label})}),(0,b.jsx)("div",{className:`mt-1 h-2.5 w-2.5 shrink-0 rounded-full ${a.dot}`,"aria-hidden":"true"})]}),(0,b.jsx)("div",{className:"mt-1 text-2xl font-semibold text-[var(--rb-text)]",children:W?"—":String(a.value)})]},a.id))}),Y?(0,b.jsx)("div",{className:"mt-2 text-sm text-red-600",children:Y}):null,(0,b.jsx)(q.Card,{className:"shadow-none",children:(0,b.jsx)(q.CardContent,{className:"pt-5",children:(0,b.jsx)(r.DataTable,{title:"string"==typeof x?`Jobs \xb7 ${x}`:"Jobs",data:C,loading:y,emptyMessage:"No jobs.",columns:ak,getRowId:a=>a.id,search:{placeholder:"Search by case number, title, device, or ID..."},columnVisibilityKey:"string"==typeof x?`rb:datatable:${x}:jobs`:"rb:datatable:jobs",filters:[{id:"status",label:"Status",value:K,options:al,onChange:a=>{L(String(a)),R(!1),ah(0)}},{id:"overdue",label:"Due",value:Q?"overdue":"all",options:ap,onChange:a=>{R("overdue"===String(a)),ah(0)}},{id:"payment_status",label:"Payment",value:M,options:an,onChange:a=>{N(String(a)),R(!1),ah(0)}},{id:"priority",label:"Priority",value:O,options:ao,onChange:a=>{P(String(a)),R(!1),ah(0)}}],server:{query:E,onQueryChange:a=>{F(a),ah(0)},pageIndex:ag,onPageIndexChange:ah,pageSize:ai,onPageSizeChange:a=>{aj(a),ah(0)},totalRows:U,sort:S,onSortChange:a=>{T(a),ah(0)}},onRowClick:b=>{"string"==typeof x&&0!==x.length&&a.push(`/app/${x}/jobs/${b.id}`)}})})})]})}a.s(["default",()=>x],62286)}];

//# sourceMappingURL=frontend_src_app_app_%5Btenant%5D_jobs_page_tsx_266ca8ec._.js.map