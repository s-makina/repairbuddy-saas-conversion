module.exports=[75385,a=>{"use strict";var b=a.i(57850),c=a.i(7160);function d({variant:a,className:d}){let e="h-4 w-4 shrink-0";return"success"===a?(0,b.jsx)("svg",{viewBox:"0 0 24 24",className:(0,c.cn)(e,d),fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:(0,b.jsx)("path",{d:"M20 6L9 17l-5-5"})}):"warning"===a?(0,b.jsxs)("svg",{viewBox:"0 0 24 24",className:(0,c.cn)(e,d),fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[(0,b.jsx)("path",{d:"M12 9v4"}),(0,b.jsx)("path",{d:"M12 17h.01"}),(0,b.jsx)("path",{d:"M10.3 3.6l-8.3 14.3A2 2 0 0 0 3.7 21h16.6a2 2 0 0 0 1.7-3.1L13.7 3.6a2 2 0 0 0-3.4 0z"})]}):"danger"===a?(0,b.jsxs)("svg",{viewBox:"0 0 24 24",className:(0,c.cn)(e,d),fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[(0,b.jsx)("path",{d:"M18 6L6 18"}),(0,b.jsx)("path",{d:"M6 6l12 12"})]}):(0,b.jsxs)("svg",{viewBox:"0 0 24 24",className:(0,c.cn)(e,d),fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[(0,b.jsx)("path",{d:"M12 16v-4"}),(0,b.jsx)("path",{d:"M12 8h.01"}),(0,b.jsx)("path",{d:"M12 22a10 10 0 1 0-10-10 10 10 0 0 0 10 10z"})]})}function e({className:a,variant:e="info",title:f,children:g,...h}){let i={info:{wrapper:"border-[color:color-mix(in_srgb,var(--rb-blue),white_75%)] bg-[color:color-mix(in_srgb,var(--rb-blue),white_92%)] text-[var(--rb-text)]",icon:"text-[var(--rb-blue)]",title:"text-[var(--rb-blue)]"},success:{wrapper:"border-[color:color-mix(in_srgb,#16a34a,white_75%)] bg-[color:color-mix(in_srgb,#16a34a,white_92%)] text-[var(--rb-text)]",icon:"text-[#166534]",title:"text-[#166534]"},warning:{wrapper:"border-[color:color-mix(in_srgb,var(--rb-orange),white_70%)] bg-[color:color-mix(in_srgb,var(--rb-orange),white_92%)] text-[var(--rb-text)]",icon:"text-[color:color-mix(in_srgb,var(--rb-orange),black_20%)]",title:"text-[color:color-mix(in_srgb,var(--rb-orange),black_20%)]"},danger:{wrapper:"border-[color:color-mix(in_srgb,#dc2626,white_75%)] bg-[color:color-mix(in_srgb,#dc2626,white_92%)] text-[var(--rb-text)]",icon:"text-[#991b1b]",title:"text-[#991b1b]"}}[e];return(0,b.jsx)("div",{role:"alert",className:(0,c.cn)("rounded-[var(--rb-radius-md)] border px-4 py-3",i.wrapper,a),...h,children:(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)(d,{variant:e,className:(0,c.cn)("mt-0.5",i.icon)}),(0,b.jsxs)("div",{className:"min-w-0",children:[f?(0,b.jsx)("div",{className:(0,c.cn)("text-sm font-semibold",i.title),children:f}):null,g?(0,b.jsx)("div",{className:(0,c.cn)("text-sm text-zinc-700",f?"mt-1":""),children:g}):null]})]})})}a.s(["Alert",()=>e])},17933,a=>{"use strict";var b=a.i(57850),c=a.i(7160);function d({className:a,variant:d="default",...e}){return(0,b.jsx)("span",{className:(0,c.cn)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-medium",{default:"bg-[var(--rb-surface-muted)] text-[var(--rb-text)] border-[var(--rb-border)]",info:"bg-[color:color-mix(in_srgb,var(--rb-blue),white_85%)] text-[var(--rb-blue)] border-[color:color-mix(in_srgb,var(--rb-blue),white_70%)]",success:"bg-[color:color-mix(in_srgb,#16a34a,white_85%)] text-[#166534] border-[color:color-mix(in_srgb,#16a34a,white_70%)]",warning:"bg-[color:color-mix(in_srgb,var(--rb-orange),white_85%)] text-[color:color-mix(in_srgb,var(--rb-orange),black_20%)] border-[color:color-mix(in_srgb,var(--rb-orange),white_70%)]",danger:"bg-[color:color-mix(in_srgb,#dc2626,white_85%)] text-[#991b1b] border-[color:color-mix(in_srgb,#dc2626,white_70%)]"}[d],a),...e})}a.s(["Badge",()=>d])},648,a=>{"use strict";var b=a.i(57850),c=a.i(7160);function d({title:a,description:d,actions:e,className:f}){return(0,b.jsxs)("div",{className:(0,c.cn)("flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between",f),children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl font-semibold text-[var(--rb-text)]",children:a}),d?(0,b.jsx)("p",{className:"mt-1 text-sm text-zinc-600",children:d}):null]}),e?(0,b.jsx)("div",{className:"flex items-center gap-2",children:e}):null]})}a.s(["PageHeader",()=>d])},26606,a=>{"use strict";var b=a.i(57850),c=a.i(7160),d=a.i(4600);function e({className:a,"aria-hidden":d=!0,...e}){return(0,b.jsx)("div",{"aria-hidden":d,className:(0,c.cn)("rb-skeleton",a),...e})}function f({lines:a=3,className:f}){let g=Math.max(1,Math.min(a,12));return(0,b.jsx)(d.Card,{className:(0,c.cn)("overflow-hidden",f),children:(0,b.jsxs)(d.CardContent,{className:"space-y-3 pt-5",children:[(0,b.jsx)(e,{className:"h-4 w-32 rounded-[var(--rb-radius-sm)]"}),Array.from({length:g}).map((a,d)=>(0,b.jsx)(e,{className:(0,c.cn)("h-3 rounded-[var(--rb-radius-sm)]",d===g-1?"w-3/5":"w-full")},d))]})})}function g({rows:a=6,columns:d=5,className:f}){let g=Math.max(1,Math.min(a,20)),h=Math.max(1,Math.min(d,10));return(0,b.jsxs)("div",{className:(0,c.cn)("overflow-hidden rounded-[var(--rb-radius-lg)] border border-[var(--rb-border)] bg-white shadow-[var(--rb-shadow)]",f),children:[(0,b.jsx)("div",{className:"border-b border-[var(--rb-border)] px-5 py-4",children:(0,b.jsx)("div",{className:"grid gap-3",style:{gridTemplateColumns:`repeat(${h}, minmax(0, 1fr))`},children:Array.from({length:h}).map((a,c)=>(0,b.jsx)(e,{className:"h-3 w-full rounded-[var(--rb-radius-sm)]"},c))})}),(0,b.jsx)("div",{className:"px-5 pb-5 pt-4",children:(0,b.jsx)("div",{className:"space-y-3",children:Array.from({length:g}).map((a,d)=>(0,b.jsx)("div",{className:"grid gap-3",style:{gridTemplateColumns:`repeat(${h}, minmax(0, 1fr))`},children:Array.from({length:h}).map((a,d)=>(0,b.jsx)(e,{className:(0,c.cn)("h-3 rounded-[var(--rb-radius-sm)]",0===d?"w-3/4":"w-full")},d))},d))})})]})}a.s(["CardSkeleton",()=>f,"Skeleton",()=>e,"TableSkeleton",()=>g])},4148,a=>{"use strict";function b(a){let b=a.amountCents,c=a.currency?.toUpperCase()??null;if("number"!=typeof b||!Number.isFinite(b))return a.fallback??"—";let d=b/100;if(!c||3!==c.length)return`${d.toFixed(2)}`;try{return new Intl.NumberFormat(void 0,{style:"currency",currency:c,minimumFractionDigits:2,maximumFractionDigits:2}).format(d)}catch{return`${c} ${d.toFixed(2)}`}}a.s(["formatMoney",()=>b])},45038,a=>{"use strict";var b=a.i(57850),c=a.i(34075),d=a.i(4148),e=a.i(91601),f=a.i(75385),g=a.i(17933),h=a.i(97867),i=a.i(4600),j=a.i(648),k=a.i(26606),l=a.i(45056);function m(){let[a,m]=(0,l.useState)(!0),[n,o]=(0,l.useState)(null),[p,q]=(0,l.useState)(null),[r,s]=(0,l.useState)(!0),[t,u]=(0,l.useState)(null),[v,w]=(0,l.useState)(null),[x,y]=(0,l.useState)(0);function z({label:a,value:c,badge:d,badgeVariant:e,glowClassName:f}){return(0,b.jsxs)(i.Card,{className:"relative overflow-hidden",children:[(0,b.jsx)("div",{className:"pointer-events-none absolute -right-10 -top-10 h-28 w-28 rounded-full blur-2xl opacity-70 "+f}),(0,b.jsxs)(i.CardContent,{className:"pt-5",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"text-xs font-medium tracking-wide text-zinc-500",children:a}),(0,b.jsx)("div",{className:"mt-1 truncate text-2xl font-semibold text-[var(--rb-text)]",children:c})]}),(0,b.jsx)(g.Badge,{variant:e,children:d})]}),(0,b.jsx)("div",{className:"mt-3 h-px w-full bg-[var(--rb-border)]"})]})]})}function A({label:a,glowClassName:c}){return(0,b.jsxs)(i.Card,{className:"relative overflow-hidden",children:[(0,b.jsx)("div",{className:"pointer-events-none absolute -right-10 -top-10 h-28 w-28 rounded-full blur-2xl opacity-70 "+c}),(0,b.jsxs)(i.CardContent,{className:"pt-5",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"text-xs font-medium tracking-wide text-zinc-500",children:a}),(0,b.jsx)("div",{className:"mt-1",children:(0,b.jsx)(k.Skeleton,{className:"h-8 w-28 rounded-[var(--rb-radius-sm)]"})})]}),(0,b.jsx)(k.Skeleton,{className:"h-5 w-16 rounded-full"})]}),(0,b.jsx)("div",{className:"mt-3 h-px w-full bg-[var(--rb-border)]"})]})]})}(0,l.useEffect)(()=>{let a=!0;async function b(){try{u(null),s(!0);let b=await (0,c.apiFetch)("/api/admin/dashboard/sales-last-12-months");if(!a)return;w(b)}catch(b){if(!a)return;u(b instanceof Error?b.message:"Failed to load sales history."),w(null)}finally{if(!a)return;s(!1)}}return async function(){try{o(null),m(!0);let b=await (0,c.apiFetch)("/api/admin/dashboard/kpis");if(!a)return;q(b)}catch(b){if(!a)return;o(b instanceof Error?b.message:"Failed to load dashboard KPIs."),q(null)}finally{if(!a)return;m(!1)}}(),b(),()=>{a=!1}},[x]);let B=(0,l.useMemo)(()=>{let a=new Set;for(let b of Object.keys(p?.mrr_by_currency??{}))a.add(b);for(let b of Object.keys(p?.revenue?.paid_last_30d_by_currency??{}))a.add(b);for(let b of Object.keys(p?.revenue?.paid_ytd_by_currency??{}))a.add(b);return Array.from(a).filter(Boolean).sort()},[p])[0]??null,C=B?p?.mrr_by_currency?.[B]??0:0,D=B?p?.revenue?.paid_last_30d_by_currency?.[B]??0:0,E=B?p?.revenue?.paid_ytd_by_currency?.[B]??0:0,F=a=>{let b=Object.entries(a??{}).filter(([a])=>!!a);return 0===b.length?"—":b.sort((a,b)=>a[0].localeCompare(b[0])).map(([a,b])=>(0,d.formatMoney)({amountCents:b,currency:a,fallback:"—"})).join(" · ")},G=p?.tenants?.by_status??{},H=["active","trial","past_due","suspended","closed"].filter(a=>"number"==typeof G?.[a]).map(a=>({status:a,count:G[a]})),I=(0,l.useMemo)(()=>{let a=Object.keys(v?.totals_by_currency??{}).filter(Boolean).sort();return B??a[0]??null},[B,v]),J=v?.months??[],K=I?v?.totals_by_currency?.[I]??[]:[];return(0,b.jsx)(e.RequireAuth,{requiredPermission:"admin.access",children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(j.PageHeader,{title:"Dashboard",description:"Platform overview (admin).",actions:(0,b.jsx)(h.Button,{variant:"outline",size:"sm",onClick:()=>y(a=>a+1),disabled:a,children:"Refresh"})}),n?(0,b.jsx)(f.Alert,{variant:"danger",title:"Could not load KPIs",children:n}):null,(0,b.jsx)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:a?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(A,{label:"Tenants",glowClassName:"bg-[color:color-mix(in_srgb,var(--rb-text),white_88%)]"}),(0,b.jsx)(A,{label:"Active subscriptions",glowClassName:"bg-[color:color-mix(in_srgb,var(--rb-blue),white_80%)]"}),(0,b.jsx)(A,{label:"MRR",glowClassName:"bg-[color:color-mix(in_srgb,#16a34a,white_75%)]"}),(0,b.jsx)(A,{label:"Users",glowClassName:"bg-[color:color-mix(in_srgb,var(--rb-border),white_55%)]"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(z,{label:"Tenants",value:String(p?.tenants?.total??0),badge:"tenants",badgeVariant:"default",glowClassName:"bg-[color:color-mix(in_srgb,var(--rb-text),white_88%)]"}),(0,b.jsx)(z,{label:"Active subscriptions",value:String(p?.subscriptions?.active_total??0),badge:"subs",badgeVariant:"info",glowClassName:"bg-[color:color-mix(in_srgb,var(--rb-blue),white_80%)]"}),(0,b.jsx)(z,{label:"MRR",value:B?(0,d.formatMoney)({amountCents:C,currency:B}):"—",badge:B??"—",badgeVariant:"success",glowClassName:"bg-[color:color-mix(in_srgb,#16a34a,white_75%)]"}),(0,b.jsx)(z,{label:"Users",value:String(p?.users?.total??0),badge:`${p?.users?.admins??0} admins`,badgeVariant:"default",glowClassName:"bg-[color:color-mix(in_srgb,var(--rb-border),white_55%)]"})]})}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-3",children:[(0,b.jsx)(i.Card,{children:(0,b.jsxs)(i.CardContent,{className:"pt-5",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Tenant status"}),(0,b.jsx)("div",{className:"mt-3 flex flex-wrap gap-2",children:a?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.Skeleton,{className:"h-5 w-24 rounded-full"}),(0,b.jsx)(k.Skeleton,{className:"h-5 w-20 rounded-full"}),(0,b.jsx)(k.Skeleton,{className:"h-5 w-28 rounded-full"}),(0,b.jsx)(k.Skeleton,{className:"h-5 w-24 rounded-full"})]}):(0,b.jsxs)(b.Fragment,{children:[0===H.length?(0,b.jsx)("div",{className:"text-sm text-zinc-600",children:"—"}):null,H.map(a=>(0,b.jsxs)(g.Badge,{variant:"default",children:[a.status,": ",String(a.count)]},a.status))]})})]})}),(0,b.jsx)(i.Card,{children:(0,b.jsxs)(i.CardContent,{className:"pt-5",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Revenue"}),(0,b.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,b.jsx)("div",{className:"text-sm text-zinc-600",children:"Paid (last 30d)"}),(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:a?(0,b.jsx)(k.Skeleton,{className:"h-4 w-44 rounded-[var(--rb-radius-sm)]"}):F(p?.revenue?.paid_last_30d_by_currency)})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,b.jsx)("div",{className:"text-sm text-zinc-600",children:"Paid (YTD)"}),(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:a?(0,b.jsx)(k.Skeleton,{className:"h-4 w-44 rounded-[var(--rb-radius-sm)]"}):F(p?.revenue?.paid_ytd_by_currency)})]})]})]})}),(0,b.jsx)(i.Card,{children:(0,b.jsxs)(i.CardContent,{className:"pt-5",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Billing"}),(0,b.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,b.jsx)("div",{className:"text-sm text-zinc-600",children:"MRR (all currencies)"}),(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:a?(0,b.jsx)(k.Skeleton,{className:"h-4 w-44 rounded-[var(--rb-radius-sm)]"}):F(p?.mrr_by_currency)})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,b.jsx)("div",{className:"text-sm text-zinc-600",children:"Primary currency"}),(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:a?(0,b.jsx)(k.Skeleton,{className:"h-4 w-16 rounded-[var(--rb-radius-sm)]"}):B??"—"})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,b.jsx)("div",{className:"text-sm text-zinc-600",children:"Paid (30d, primary)"}),(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:a?(0,b.jsx)(k.Skeleton,{className:"h-4 w-28 rounded-[var(--rb-radius-sm)]"}):B?(0,d.formatMoney)({amountCents:D,currency:B}):"—"})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,b.jsx)("div",{className:"text-sm text-zinc-600",children:"Paid (YTD, primary)"}),(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:a?(0,b.jsx)(k.Skeleton,{className:"h-4 w-28 rounded-[var(--rb-radius-sm)]"}):B?(0,d.formatMoney)({amountCents:E,currency:B}):"—"})]})]})]})})]}),(0,b.jsx)(i.Card,{children:(0,b.jsxs)(i.CardContent,{className:"pt-5",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-baseline justify-between gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Sales (last 12 months)"}),(0,b.jsx)("div",{className:"mt-1 text-sm text-zinc-600",children:"Paid invoices grouped by month."})]}),(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:I??"—"})]}),t?(0,b.jsx)("div",{className:"mt-4",children:(0,b.jsx)(f.Alert,{variant:"danger",title:"Could not load sales history",children:t})}):null,(0,b.jsx)("div",{className:"mt-4",children:r?(0,b.jsx)(k.Skeleton,{className:"h-40 w-full rounded-[var(--rb-radius-lg)] border border-[var(--rb-border)]"}):0===K.length?(0,b.jsx)("div",{className:"h-40 w-full rounded-[var(--rb-radius-lg)] border border-[var(--rb-border)] bg-white p-4 text-sm text-zinc-600",children:"—"}):(0,b.jsxs)("div",{children:[(0,b.jsx)(function({values:a}){let c=a.reduce((a,b)=>Math.max(a,b),0),d=c>0?c:1,e=Math.max(a.length,1),f=a.map((a,b)=>`${(8+(1===e?292:584*b/(e-1))).toFixed(2)},${(10+140*(1-a/d)).toFixed(2)}`).join(" "),g=`8,150 ${f} 592,150`;return(0,b.jsxs)("svg",{viewBox:"0 0 600 160",className:"h-40 w-full",role:"img","aria-label":"Sales chart",children:[(0,b.jsx)("defs",{children:(0,b.jsxs)("linearGradient",{id:"rb-sales-fill",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,b.jsx)("stop",{offset:"0%",stopColor:"var(--rb-blue)",stopOpacity:"0.25"}),(0,b.jsx)("stop",{offset:"100%",stopColor:"var(--rb-blue)",stopOpacity:"0"})]})}),(0,b.jsx)("rect",{x:"0",y:"0",width:600,height:160,fill:"transparent"}),(0,b.jsx)("polyline",{points:g,fill:"url(#rb-sales-fill)",stroke:"none"}),(0,b.jsx)("polyline",{points:f,fill:"none",stroke:"var(--rb-blue)",strokeWidth:"2",strokeLinejoin:"round",strokeLinecap:"round"})]})},{values:K}),(0,b.jsxs)("div",{className:"mt-2 flex flex-wrap gap-x-4 gap-y-1 text-xs text-zinc-600",children:[(0,b.jsxs)("div",{children:[J[0]?.label??"",J.length>1?" → "+(J[J.length-1]?.label??""):""]}),(0,b.jsxs)("div",{children:["Total: ",I?(0,d.formatMoney)({amountCents:K.reduce((a,b)=>a+b,0),currency:I}):"—"]}),(0,b.jsxs)("div",{children:["Last month: ",I?(0,d.formatMoney)({amountCents:K[K.length-1]??0,currency:I}):"—"]})]})]})})]})})]})})}a.s(["default",()=>m])}];

//# sourceMappingURL=frontend_src_b7a220e4._.js.map