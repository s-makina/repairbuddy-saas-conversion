module.exports=[921,a=>{"use strict";var b=a.i(57850),c=a.i(45056),d=a.i(59843),e=a.i(93609),f=a.i(91601),g=a.i(25533),h=a.i(75385),i=a.i(17933),j=a.i(97867),k=a.i(4600),l=a.i(21282),m=a.i(54177),n=a.i(29054),o=a.i(94703),p=a.i(34075),q=a.i(56264),r=a.i(75458),s=a.i(46664),t=a.i(4148);function u(){let a,u,v=(0,e.useParams)(),w=(0,g.useDashboardHeader)(),x=(0,r.useAuth)(),y=Number(v.planId),z=Number(v.versionId),[A,B]=(0,c.useState)(!0),[C,D]=(0,c.useState)(null),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)(null),[I,J]=(0,c.useState)(null),[K,L]=(0,c.useState)([]),[M,N]=(0,c.useState)([]),[O,P]=(0,c.useState)([]),[Q,R]=(0,c.useState)(0),S=x.can("admin.billing.write"),T=(0,c.useMemo)(()=>!I||"draft"!==I.status||!!I.locked_at||!!I.activated_at||!!I.retired_at,[I]);(0,c.useEffect)(()=>(w.setHeader({breadcrumb:"Admin / Billing / Plans",title:I?`${G?.name??"Plan"} v${I.version}`:"Plan version",subtitle:I?`${String(I.status||"").toUpperCase()}${"draft"===I.status&&!T?" • editable":""}`:void 0,actions:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(d.default,{href:`/admin/billing/plans/${y}`,children:(0,b.jsx)(j.Button,{variant:"outline",size:"sm",children:"Back"})}),(0,b.jsx)(j.Button,{variant:"outline",size:"sm",onClick:()=>R(a=>a+1),disabled:A,children:"Refresh"})]})}),()=>w.setHeader(null)),[w,T,A,G?.name,y,I,I?.status,I?.version]),(0,c.useEffect)(()=>{let a=!0;return async function(){if(!Number.isFinite(y)||y<=0||!Number.isFinite(z)||z<=0){D("Invalid plan/version id."),B(!1);return}try{B(!0),D(null);let b=await (0,q.getBillingCatalog)({includeInactive:!0});if(!a)return;let c=(Array.isArray(b.billing_plans)?b.billing_plans:[]).find(a=>a.id===y)??null,d=(Array.isArray(c?.versions)?c?.versions:[]).find(a=>a.id===z)??null;H(c),J(d),L(Array.isArray(b.entitlement_definitions)?b.entitlement_definitions:[]),N(Array.isArray(b.billing_intervals)?b.billing_intervals:[]);try{let b=await (0,p.apiFetch)("/api/admin/settings");if(!a)return;let c=(Array.isArray(b.currencies)?b.currencies:[]).filter(a=>!!a?.is_active).map(a=>({code:String(a.code??"").trim().toUpperCase(),name:String(a.name??"").trim(),symbol:String(a.symbol??"").trim()})).filter(a=>3===a.code.length).sort((a,b)=>a.code.localeCompare(b.code));P(c)}catch{if(!a)return;P([])}c?d||D("Version not found."):D("Plan not found.")}catch(b){if(!a)return;D(b instanceof Error?b.message:"Failed to load version."),H(null),J(null),N([]),P([])}finally{if(!a)return;B(!1)}}(),()=>{a=!1}},[y,Q,z]);let U=(0,c.useMemo)(()=>new Set(O.map(a=>a.code)),[O]);function V(a){let b=Number.parseFloat(a.trim().replace(",","."));return!Number.isFinite(b)||b<0?0:Math.round(100*b)}function W(a,b){return`${String(a).trim().toUpperCase()}|${String(b||"").trim().toLowerCase()||"month"}`}async function X(){if(I&&!aq){ar(!0),at(null),F(null);try{let a=await (0,q.validateBillingPlanVersionDraft)({versionId:I.id}),b="status"in a&&"ok"===a.status,c="errors"in a&&Array.isArray(a.errors)?a.errors.map(String):[];at({ok:b,errors:c})}catch(a){F(a instanceof Error?a.message:"Failed to validate.")}finally{ar(!1)}}}async function Y(){if(I&&!ao){ap(!0),F(null);try{let a=[];for(let b of af)ag[b.id]&&a.push({entitlement_definition_id:b.id,value_json:ai[b.id]??null});let b=await (0,q.syncBillingPlanVersionEntitlements)({versionId:I.id,entitlements:a});J(b.version)}catch(a){F(a instanceof Error?a.message:"Failed to save entitlements.")}finally{ap(!1)}}}async function Z(){if(I&&!aE){aF(!0),aH(null);try{var a;let b,c,d=aK.trim().toUpperCase();if(3!==d.length)return void aH("Currency is required.");if(U.size>0&&!U.has(d))return void aH("Currency must be one of the allowed currencies.");let e="number"==typeof aM&&Number.isFinite(aM)?aM:null,f=String(aO||"").trim().toLowerCase();if(!e&&!f)return void aH("Interval is required.");let g=""===aS.trim()?null:Number(aS),h="number"==typeof g&&Number.isFinite(g)?Math.max(0,Math.trunc(g)):null,i=(a={currency:d,interval:f||"month"},b=W(a.currency,a.interval),c=(Array.isArray(I?.prices)?I?.prices:[]).filter(a=>W(a.currency,a.interval)===b).slice(),0===c.length||!c.some(a=>!!a.is_default)),j=await (0,q.createBillingPrice)({versionId:I.id,currency:d,interval:f||"month",billingIntervalId:e,amountCents:V(aQ),trialDays:h,isDefault:!!(aU||i)});J(j.version),aB(!1)}catch(a){aH(a instanceof Error?a.message:"Failed to create price.")}finally{aF(!1)}}}async function $(){if(aI&&!aE){aF(!0),aH(null);try{let a=""===aS.trim()?null:Number(aS),b=await (0,q.updateBillingPrice)({priceId:aI.id,amountCents:V(aQ),trialDays:"number"==typeof a&&Number.isFinite(a)?a:null,isDefault:aU});J(b.version),aD(!1),aJ(null)}catch(a){aH(a instanceof Error?a.message:"Failed to update price.")}finally{aF(!1)}}}async function _(a){if(!aE){aF(!0),F(null);try{let b=await (0,q.deleteBillingPrice)({priceId:a.id});J(b.version)}catch(a){F(a instanceof Error?a.message:"Failed to delete price.")}finally{aF(!1)}}}async function aa(){if(I&&!aw){ax(!0),F(null);try{let a=await (0,q.activateBillingPlanVersion)({versionId:I.id,confirm:ay.trim()});J(a.version),av(!1),az("")}catch(a){F(a instanceof Error?a.message:"Failed to activate.")}finally{ax(!1)}}}let ab=(0,c.useMemo)(()=>Array.isArray(I?.prices)?I?.prices:[],[I]),ac=(0,c.useMemo)(()=>Array.isArray(I?.entitlements)?I?.entitlements:[],[I]),ad=(0,c.useMemo)(()=>ab.find(a=>a.is_default)??ab[0]??null,[ab]),ae=(0,c.useMemo)(()=>{let a={};for(let b of ac)a[b.entitlement_definition_id]=b;return a},[ac]),af=(0,c.useMemo)(()=>(Array.isArray(K)?K:[]).slice().sort((a,b)=>(a.id??0)-(b.id??0)),[K]);(0,c.useEffect)(()=>{if(!I)return;let a={},b={},c={},d={};for(let e of af){let f=ae[e.id]??null;a[e.id]=!!f,b[e.id]=f?f.value_json:null;let g=String(e.value_type??"json");"boolean"!==g&&"integer"!==g&&(c[e.id]=JSON.stringify(f?f.value_json??null:null,null,2),d[e.id]=null)}ah(a),aj(b),al(c),an(d)},[af,ae,I]);let[ag,ah]=(0,c.useState)({}),[ai,aj]=(0,c.useState)({}),[ak,al]=(0,c.useState)({}),[am,an]=(0,c.useState)({}),[ao,ap]=(0,c.useState)(!1),[aq,ar]=(0,c.useState)(!1),[as,at]=(0,c.useState)(null),[au,av]=(0,c.useState)(!1),[aw,ax]=(0,c.useState)(!1),[ay,az]=(0,c.useState)(""),[aA,aB]=(0,c.useState)(!1),[aC,aD]=(0,c.useState)(!1),[aE,aF]=(0,c.useState)(!1),[aG,aH]=(0,c.useState)(null),[aI,aJ]=(0,c.useState)(null),[aK,aL]=(0,c.useState)("EUR"),[aM,aN]=(0,c.useState)(null),[aO,aP]=(0,c.useState)("month"),[aQ,aR]=(0,c.useState)("0.00"),[aS,aT]=(0,c.useState)(""),[aU,aV]=(0,c.useState)(!1);return(0,b.jsx)(f.RequireAuth,{requiredPermission:"admin.billing.read",children:(0,b.jsxs)("div",{className:"space-y-6",children:[C?(0,b.jsx)(h.Alert,{variant:"danger",title:"Could not load version",children:C}):null,E?(0,b.jsx)(h.Alert,{variant:"danger",title:"Action failed",children:E}):null,I&&T?(0,b.jsx)(h.Alert,{variant:"warning",title:"Read-only",children:"This plan version is immutable."}):null,A||C||I?null:(0,b.jsx)(h.Alert,{variant:"warning",title:"Version not found",children:"The requested plan version does not exist."}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[(0,b.jsxs)("div",{className:"space-y-6 lg:col-span-2",children:[I?(0,b.jsxs)(k.Card,{className:"overflow-hidden",children:[(0,b.jsx)("div",{className:"h-1.5 w-full "+("active"===I.status?"bg-[var(--rb-blue)]":"draft"===I.status?"bg-[var(--rb-orange)]":"bg-[var(--rb-border)]")}),(0,b.jsx)(k.CardHeader,{className:"space-y-3",children:(0,b.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"text-xs font-medium uppercase tracking-wide text-zinc-500",children:"Plan version"}),(0,b.jsxs)("div",{className:"mt-1 flex flex-wrap items-center gap-2",children:[(0,b.jsxs)("div",{className:"truncate text-xl font-semibold tracking-tight text-[var(--rb-text)]",children:[G?.name??"Plan"," ",(0,b.jsxs)("span",{className:"text-zinc-600",children:["v",I.version]})]}),(0,b.jsx)(i.Badge,{variant:"active"===(a=String(I.status||"").toLowerCase())?"success":"draft"===a?"info":"default",children:String(I.status||"").toLowerCase()}),T?(0,b.jsx)(i.Badge,{variant:"default",children:"read-only"}):null]}),(0,b.jsxs)("div",{className:"mt-1 text-sm text-zinc-600",children:[G?.code?(0,b.jsx)("span",{className:"font-medium text-zinc-800",children:G.code}):null,G?.code?(0,b.jsx)("span",{className:"mx-2 text-zinc-400",children:"•"}):null,(0,b.jsxs)("span",{className:"text-zinc-600",children:["Version ID ",I.id]})]})]}),(0,b.jsxs)("div",{className:"sm:text-right",children:[(0,b.jsx)("div",{className:"text-xs text-zinc-500",children:"Starting at"}),(0,b.jsxs)("div",{className:"mt-1 flex items-baseline gap-2 sm:justify-end",children:[(0,b.jsx)("div",{className:"text-2xl font-semibold tracking-tight text-[var(--rb-text)]",children:ad?(0,t.formatMoney)({amountCents:ad.amount_cents,currency:ad.currency}):"—"}),(0,b.jsx)("div",{className:"text-sm text-zinc-600",children:ad&&(u=String(ad.interval||"").toLowerCase())?"month"===u||"monthly"===u?"/mo":"year"===u||"yearly"===u||"annual"===u?"/yr":`/${u}`:""})]}),ad?.trial_days?(0,b.jsxs)("div",{className:"mt-1 text-xs text-zinc-500",children:[ad.trial_days," day trial"]}):null]})]})}),(0,b.jsx)(k.CardContent,{children:(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[(0,b.jsxs)("div",{className:"rounded-[var(--rb-radius-lg)] border border-[var(--rb-border)] bg-[var(--rb-surface-muted)] p-4",children:[(0,b.jsx)("div",{className:"text-xs font-medium uppercase tracking-wide text-zinc-500",children:"Lifecycle"}),(0,b.jsxs)("div",{className:"mt-3 space-y-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-zinc-500",children:"Created"}),(0,b.jsx)("div",{className:"mt-1 text-sm font-medium text-zinc-800",children:(0,s.formatDateTime)(I.created_at)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-zinc-500",children:"Updated"}),(0,b.jsx)("div",{className:"mt-1 text-sm font-medium text-zinc-800",children:(0,s.formatDateTime)(I.updated_at)})]})]})]}),(0,b.jsxs)("div",{className:"rounded-[var(--rb-radius-lg)] border border-[var(--rb-border)] bg-[var(--rb-surface-muted)] p-4",children:[(0,b.jsx)("div",{className:"text-xs font-medium uppercase tracking-wide text-zinc-500",children:"Activation"}),(0,b.jsxs)("div",{className:"mt-3 space-y-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-zinc-500",children:"Activated"}),(0,b.jsx)("div",{className:"mt-1 text-sm font-medium text-zinc-800",children:(0,s.formatDate)(I.activated_at)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-zinc-500",children:"Retired"}),(0,b.jsx)("div",{className:"mt-1 text-sm font-medium text-zinc-800",children:(0,s.formatDate)(I.retired_at)})]})]})]}),(0,b.jsxs)("div",{className:"rounded-[var(--rb-radius-lg)] border border-[var(--rb-border)] bg-[var(--rb-surface-muted)] p-4",children:[(0,b.jsx)("div",{className:"text-xs font-medium uppercase tracking-wide text-zinc-500",children:"Coverage"}),(0,b.jsxs)("div",{className:"mt-3 space-y-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-zinc-500",children:"Prices"}),(0,b.jsx)("div",{className:"mt-1 text-sm font-medium text-zinc-800",children:ab.length})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-zinc-500",children:"Entitlements enabled"}),(0,b.jsx)("div",{className:"mt-1 text-sm font-medium text-zinc-800",children:ac.length})]})]})]})]})})]}):null,(0,b.jsx)(m.DataTable,{title:(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Prices"}),S&&!T?(0,b.jsx)(j.Button,{variant:"secondary",size:"sm",onClick:()=>{aH(null),aL(O[0]?.code??"EUR"),aN(null),aP("month"),aR("0.00"),aT(""),aV(!0),aB(!0)},disabled:A,children:"Add price"}):null]}),data:ab,loading:A,emptyMessage:"No prices configured for this version.",getRowId:a=>a.id,search:{placeholder:"Search prices…",getSearchText:a=>`${a.currency} ${a.interval} ${a.amount_cents} ${a.is_default?"default":""}`},columns:[{id:"currency",header:"Currency",cell:a=>(0,b.jsx)("div",{className:"text-sm font-medium text-zinc-800",children:String(a.currency).toUpperCase()}),className:"whitespace-nowrap"},{id:"interval",header:"Interval",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:a.interval}),className:"whitespace-nowrap"},{id:"amount",header:"Amount",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:(0,t.formatMoney)({amountCents:a.amount_cents,currency:a.currency})}),className:"whitespace-nowrap"},{id:"trial",header:"Trial",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:"number"==typeof a.trial_days?`${a.trial_days} days`:"—"}),className:"whitespace-nowrap"},{id:"default",header:"Default",cell:a=>a.is_default?(0,b.jsx)(i.Badge,{variant:"success",children:"default"}):(0,b.jsx)(i.Badge,{variant:"default",children:"—"}),className:"whitespace-nowrap"},{id:"actions",header:"",cell:a=>(0,b.jsx)("div",{className:"flex items-center justify-end gap-2",children:S&&!T?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(j.Button,{variant:"outline",size:"sm",onClick:()=>{aJ(a),aH(null),aR(((a.amount_cents??0)/100).toFixed(2)),aT("number"==typeof a.trial_days?String(a.trial_days):""),aV(!!a.is_default),aD(!0)},disabled:aE,children:"Edit"}),(0,b.jsx)(j.Button,{variant:"outline",size:"sm",onClick:()=>void _(a),disabled:aE,children:"Delete"})]}):null}),className:"whitespace-nowrap"}]}),(0,b.jsx)(m.DataTable,{title:"Entitlements",data:ac,loading:A,emptyMessage:"No entitlements configured for this version.",getRowId:a=>a.id,search:{placeholder:"Search entitlements…",getSearchText:a=>`${a.definition?.code??""} ${a.definition?.name??""} ${a.entitlement_definition_id}`},columns:[{id:"code",header:"Code",cell:a=>(0,b.jsx)("div",{className:"text-sm font-medium text-zinc-800",children:a.definition?.code??`#${a.entitlement_definition_id}`}),className:"whitespace-nowrap"},{id:"name",header:"Name",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:a.definition?.name??"—"})},{id:"value",header:"Value",cell:a=>(0,b.jsx)("pre",{className:"max-w-[520px] overflow-auto rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-[var(--rb-surface-muted)] p-2 text-xs text-zinc-700",children:JSON.stringify(a.value_json??null,null,2)})}]}),I?(0,b.jsxs)(k.Card,{children:[(0,b.jsxs)(k.CardHeader,{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)(k.CardTitle,{className:"truncate",children:"Edit entitlements"}),(0,b.jsx)("div",{className:"mt-1 text-sm text-zinc-600",children:"Configure entitlements for this plan version."})]}),S&&!T?(0,b.jsx)(j.Button,{variant:"primary",size:"sm",onClick:()=>void Y(),disabled:ao,children:ao?"Saving…":"Save"}):null]}),(0,b.jsx)(k.CardContent,{className:"space-y-4",children:0===af.length?(0,b.jsx)("div",{className:"text-sm text-zinc-600",children:"No entitlement definitions found on this version."}):(0,b.jsx)("div",{className:"space-y-3",children:af.map(a=>{let c=!!ag[a.id],d=String(a.value_type??"json"),e=ai[a.id],f=ak[a.id]??JSON.stringify(e??null,null,2),g=am[a.id]??null;return(0,b.jsxs)("div",{className:"rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white p-4",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-start md:justify-between",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsxs)("div",{className:"text-sm font-semibold text-zinc-900",children:[a.name," ",(0,b.jsxs)("span",{className:"text-xs font-normal text-zinc-500",children:["(",a.code,")"]})]}),(0,b.jsxs)("div",{className:"mt-1 text-xs text-zinc-500",children:["Type: ",d]}),a.description?(0,b.jsx)("div",{className:"mt-1 text-xs text-zinc-500",children:a.description}):null]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:c,onChange:b=>{let c=b.target.checked;ah(b=>({...b,[a.id]:c})),c||(aj(b=>({...b,[a.id]:null})),an(b=>({...b,[a.id]:null})))},disabled:T||!S}),"Enabled"]})]}),c?(0,b.jsx)("div",{className:"mt-4",children:"boolean"===d?(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:!!e,onChange:b=>aj(c=>({...c,[a.id]:b.target.checked})),disabled:T||!S}),"Value"]}):"integer"===d?(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Value"}),(0,b.jsx)(n.Input,{type:"number",value:null==e?"":String(e),onChange:b=>{let c=b.target.value;if(""===c.trim())return void aj(b=>({...b,[a.id]:null}));let d=Number(c);aj(b=>({...b,[a.id]:Number.isFinite(d)?Math.trunc(d):b[a.id]}))},disabled:T||!S})]}):(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Value (JSON)"}),(0,b.jsx)("textarea",{className:"min-h-[110px] w-full rounded-[var(--rb-radius-sm)] border bg-white px-3 py-2 font-mono text-xs outline-none transition "+(g?"border-[color:color-mix(in_srgb,#dc2626,white_60%)] focus-visible:ring-2 focus-visible:ring-[color:color-mix(in_srgb,#dc2626,white_65%)]":"border-[var(--rb-border)] focus-visible:ring-2 focus-visible:ring-[color:color-mix(in_srgb,var(--rb-orange),white_65%)]"),value:f,onChange:b=>{let c=b.target.value;al(b=>({...b,[a.id]:c}));try{let b=JSON.parse(c);aj(c=>({...c,[a.id]:b})),an(b=>({...b,[a.id]:null}))}catch(b){an(c=>({...c,[a.id]:b instanceof Error?b.message:"Invalid JSON"}))}},disabled:T||!S}),g?(0,b.jsx)("div",{className:"text-xs text-red-600",children:g}):null]})}):null]},a.id)})})})]}):null]}),(0,b.jsxs)("div",{className:"space-y-6 lg:sticky lg:top-6 lg:self-start",children:[I&&S&&!T?(0,b.jsxs)(k.Card,{children:[(0,b.jsxs)(k.CardHeader,{className:"space-y-1",children:[(0,b.jsx)(k.CardTitle,{className:"truncate",children:"Draft checklist"}),(0,b.jsx)("div",{className:"text-sm text-zinc-600",children:"Validate and activate this draft when you’re ready."})]}),(0,b.jsxs)(k.CardContent,{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,b.jsx)(j.Button,{variant:"outline",size:"sm",onClick:()=>void X(),disabled:aq,children:aq?"Validating…":"Validate draft"}),(0,b.jsx)(j.Button,{variant:"secondary",size:"sm",onClick:()=>av(!0),disabled:aw,children:"Activate"})]}),as?as.ok?(0,b.jsx)(h.Alert,{variant:"success",title:"Draft is valid",children:"Ready to activate."}):(0,b.jsx)(h.Alert,{variant:"danger",title:"Draft validation failed",children:(0,b.jsx)("div",{className:"space-y-1",children:as.errors.map((a,c)=>(0,b.jsx)("div",{children:a},c))})}):null]})]}):null,I?(0,b.jsxs)(k.Card,{children:[(0,b.jsxs)(k.CardHeader,{className:"space-y-1",children:[(0,b.jsx)(k.CardTitle,{className:"truncate",children:"Details"}),(0,b.jsx)("div",{className:"text-sm text-zinc-600",children:"Reference information for audits and support."})]}),(0,b.jsx)(k.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-zinc-500",children:"Plan"}),(0,b.jsx)("div",{className:"mt-1 text-sm font-medium text-zinc-800",children:G?.name??"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-zinc-500",children:"Plan ID"}),(0,b.jsx)("div",{className:"mt-1 text-sm font-medium text-zinc-800",children:G?.id??"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-zinc-500",children:"Locked"}),(0,b.jsx)("div",{className:"mt-1 text-sm font-medium text-zinc-800",children:(0,s.formatDate)(I.locked_at)})]})]})})]}):null]})]}),(0,b.jsx)(o.Modal,{open:aA,onClose:()=>{aE||aB(!1)},title:"Add price",footer:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,b.jsx)(j.Button,{variant:"outline",onClick:()=>aE?null:aB(!1),disabled:aE,children:"Cancel"}),(0,b.jsx)(j.Button,{variant:"primary",onClick:()=>void Z(),disabled:aE,children:aE?"Saving…":"Save"})]}),children:(0,b.jsxs)("div",{className:"space-y-4",children:[aG?(0,b.jsx)(h.Alert,{variant:"danger",title:"Cannot save price",children:aG}):null,(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Currency"}),(0,b.jsxs)("select",{className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:aK,onChange:a=>aL(a.target.value),disabled:aE||0===O.length,children:[0===O.length?(0,b.jsx)("option",{value:aK,children:aK}):null,O.map(a=>(0,b.jsxs)("option",{value:a.code,children:[a.code,a.name?` — ${a.name}`:""]},a.code))]}),0===O.length?(0,b.jsx)("div",{className:"text-xs text-zinc-500",children:"No allowed currencies found. Add currencies under Admin / Billing / Currencies."}):null]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Interval"}),M.length>0?(0,b.jsxs)("select",{className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:aM??"",onChange:a=>{let b=a.target.value,c=b?Number(b):null,d=M.find(a=>a.id===c)??null;aN(d?d.id:null),aP(d?String(d.code).toLowerCase():"")},disabled:aE,children:[(0,b.jsx)("option",{value:"",children:"Select interval"}),M.slice().sort((a,b)=>(a.months??0)-(b.months??0)||String(a.name).localeCompare(String(b.name))).map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.name," (",a.months," months)"]},a.id))]}):(0,b.jsxs)("select",{className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:aO,onChange:a=>aP("year"===a.target.value?"year":"month"),disabled:aE,children:[(0,b.jsx)("option",{value:"month",children:"month"}),(0,b.jsx)("option",{value:"year",children:"year"})]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Amount"}),(0,b.jsx)(n.Input,{value:aQ,onChange:a=>aR(a.target.value),disabled:aE}),(0,b.jsx)("div",{className:"text-xs text-zinc-500",children:"Example: 29.00"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Trial days (optional)"}),(0,b.jsx)(n.Input,{value:aS,onChange:a=>aT(a.target.value),disabled:aE})]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:aU,onChange:a=>aV(a.target.checked),disabled:aE}),"Default for this currency + interval"]})]})}),(0,b.jsx)(o.Modal,{open:aC,onClose:()=>{aE||aD(!1)},title:aI?`Edit price #${aI.id}`:"Edit price",footer:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,b.jsx)(j.Button,{variant:"outline",onClick:()=>aE?null:aD(!1),disabled:aE,children:"Cancel"}),(0,b.jsx)(j.Button,{variant:"primary",onClick:()=>void $(),disabled:aE||!aI,children:aE?"Saving…":"Save"})]}),children:(0,b.jsxs)("div",{className:"space-y-4",children:[aG?(0,b.jsx)(h.Alert,{variant:"danger",title:"Cannot save price",children:aG}):null,aI?(0,b.jsxs)("div",{className:"text-sm text-zinc-700",children:[String(aI.currency).toUpperCase()," / ",aI.interval," (currently ",(0,t.formatMoney)({amountCents:aI.amount_cents,currency:aI.currency}),")"]}):null,(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Amount"}),(0,b.jsx)(n.Input,{value:aQ,onChange:a=>aR(a.target.value),disabled:aE})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Trial days (optional)"}),(0,b.jsx)(n.Input,{value:aS,onChange:a=>aT(a.target.value),disabled:aE})]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:aU,onChange:a=>aV(a.target.checked),disabled:aE}),"Default for this currency + interval"]})]})}),(0,b.jsx)(l.ConfirmDialog,{open:au,title:"Activate plan version",message:(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("div",{children:"This will activate this draft and retire the currently active version (if any). This action is irreversible."}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Type ACTIVATE to confirm"}),(0,b.jsx)(n.Input,{value:ay,onChange:a=>az(a.target.value),disabled:aw})]})]}),confirmText:"Activate",confirmVariant:"secondary",busy:aw,onCancel:()=>{aw||av(!1)},onConfirm:()=>void aa()})]})})}a.s(["default",()=>u])}];

//# sourceMappingURL=ceffb_src_app_admin_billing_plans_%5BplanId%5D_versions_%5BversionId%5D_page_tsx_3ab0e14c._.js.map