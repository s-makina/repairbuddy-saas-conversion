module.exports=[10864,a=>{"use strict";var b=a.i(57850),c=a.i(45056),d=a.i(93609),e=a.i(91601),f=a.i(75458),g=a.i(97867),h=a.i(17933),i=a.i(4600),j=a.i(21282),k=a.i(98669),l=a.i(54177),m=a.i(46036),n=a.i(44814),o=a.i(94703),p=a.i(26606),q=a.i(54804),r=a.i(67388),s=a.i(34075),t=a.i(6183);function u(){let a=(0,f.useAuth)(),u=(0,d.useRouter)(),v=(0,d.useParams)(),w=v.business??v.tenant,x=(0,r.useUrlDataGridState)({defaultPageSize:12}),y=x.getParam("is_active")??"all",z="grid"===x.getParam("view")?"grid":"table",[A,B]=c.default.useState(!0),[C,D]=c.default.useState(null),[E,F]=c.default.useState(null),[G,H]=c.default.useState(!1),[I,J]=c.default.useState([]),[K,L]=c.default.useState([]),[M,N]=c.default.useState([]),[O,P]=c.default.useState([]),[Q,R]=c.default.useState(0),[S,T]=c.default.useState(!1),[U,V]=c.default.useState(null),[W,X]=c.default.useState(""),[Y,Z]=c.default.useState(null),[$,_]=c.default.useState(null),[aa,ab]=c.default.useState(null),[ac,ad]=c.default.useState(!1),[ae,af]=c.default.useState(!1),[ag,ah]=c.default.useState(!0),[ai,aj]=c.default.useState(!1),[ak,al]=c.default.useState(""),[am,an]=c.default.useState(""),[ao,ap]=c.default.useState(null),[aq,ar]=c.default.useState(0),as=a.can("devices.manage"),at=c.default.useCallback(async()=>{if("string"==typeof w&&0!==w.length)try{let a=await (0,s.apiFetch)(`/api/${w}/app/repairbuddy/devices?limit=200`);P(Array.isArray(a.devices)?a.devices:[])}catch{P([])}},[w]),au=c.default.useCallback(async()=>{try{if(B(!0),D(null),"string"!=typeof w||0===w.length)throw Error("Business is missing.");let a=new URLSearchParams;x.query.trim().length>0&&a.set("q",x.query.trim()),a.set("page",String(x.pageIndex+1)),a.set("per_page",String(x.pageSize)),"all"!==y&&a.set("is_active",y);let[b,c,d]=await Promise.all([(0,s.apiFetch)(`/api/${w}/app/repairbuddy/devices?${a.toString()}`),(0,s.apiFetch)(`/api/${w}/app/repairbuddy/device-brands?limit=200`),(0,s.apiFetch)(`/api/${w}/app/repairbuddy/device-types?limit=200`)]);J(Array.isArray(b.devices)?b.devices:[]),ar("number"==typeof b.meta?.total?b.meta.total:0),L(Array.isArray(c.device_brands)?c.device_brands:[]),N(Array.isArray(d.device_types)?d.device_types:[])}catch(a){if(a instanceof s.ApiError&&428===a.status&&"string"==typeof w&&w.length>0){let a=`/app/${w}/devices`;u.replace(`/app/${w}/branches/select?next=${encodeURIComponent(a)}`);return}D(a instanceof Error?a.message:"Failed to load devices.")}finally{B(!1)}},[x.pageIndex,x.pageSize,x.query,Q,u,y,w]);function av(a){as&&(V(a.id),X(a.model),Z(a.device_type_id),_(a.device_brand_id),ab("number"==typeof a.parent_device_id?a.parent_device_id:null),ad(!!a.disable_in_booking_form),af(!!a.is_other),ah(!!a.is_active),T(!0),D(null),F(null))}async function aw(a){if((a.preventDefault(),!G)&&"string"==typeof w&&0!==w.length){if(!as)return void D("Forbidden.");H(!0),D(null),F(null);try{let a=W.trim();if(0===a.length)return void D("Model is required.");if("number"!=typeof Y)return void D("Device type is required.");if("number"!=typeof $)return void D("Device brand is required.");let b={model:a,device_type_id:Y,device_brand_id:$,parent_device_id:aa,disable_in_booking_form:ac,is_other:ae,is_active:ag};U?(await (0,s.apiFetch)(`/api/${w}/app/repairbuddy/devices/${U}`,{method:"PATCH",body:b}),F("Device updated.")):(await (0,s.apiFetch)(`/api/${w}/app/repairbuddy/devices`,{method:"POST",body:b}),F("Device created.")),T(!1),x.onPageIndexChange(0),R(a=>a+1)}catch(a){a instanceof s.ApiError?D(a.message):D(U?"Failed to update device.":"Failed to create device.")}finally{H(!1)}}}async function ax(a){if(!G&&"string"==typeof w&&0!==w.length){var c;if(!as)return void D("Forbidden.");c={title:"Delete device",message:(0,b.jsxs)("div",{children:["Delete ",(0,b.jsx)("span",{className:"font-semibold",children:a.model}),"?"]}),action:async()=>{H(!0),D(null),F(null);try{await (0,s.apiFetch)(`/api/${w}/app/repairbuddy/devices/${a.id}`,{method:"DELETE"}),F("Device deleted."),x.onPageIndexChange(0),R(a=>a+1)}catch(a){a instanceof s.ApiError?D(a.message):D("Failed to delete device.")}finally{H(!1)}}},al(c.title),an(c.message),ap(()=>c.action),aj(!0)}}c.default.useEffect(()=>{au()},[au]),c.default.useEffect(()=>{S&&at()},[S,at]);let ay=c.default.useMemo(()=>new Map(K.map(a=>[a.id,a])),[K]),az=c.default.useMemo(()=>new Map(M.map(a=>[a.id,a])),[M]),aA=c.default.useMemo(()=>{let a=U??null;return O.filter(b=>!a||b.id!==a).slice().sort((a,b)=>a.model.localeCompare(b.model))},[U,O]),aB=c.default.useMemo(()=>[{id:"model",header:"Device",cell:a=>(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"truncate font-semibold text-[var(--rb-text)]",children:a.model}),(0,b.jsx)("div",{className:"truncate text-xs text-zinc-600",children:a.id})]}),className:"min-w-[240px]"},{id:"brand",header:"Brand",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:ay.get(a.device_brand_id)?.name??String(a.device_brand_id)}),className:"min-w-[200px]"},{id:"type",header:"Type",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:az.get(a.device_type_id)?.name??String(a.device_type_id)}),className:"min-w-[200px]"},{id:"active",header:"Active",className:"whitespace-nowrap",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:a.is_active?"Yes":"No"})},{id:"actions",header:"",headerClassName:"text-right",className:"whitespace-nowrap text-right",cell:a=>as?(0,b.jsx)(m.DropdownMenu,{align:"right",trigger:({toggle:a})=>(0,b.jsx)(g.Button,{variant:"ghost",size:"sm",onClick:a,disabled:G,className:"px-2","aria-label":"Actions",title:"Actions",children:(0,b.jsx)(t.MoreHorizontal,{className:"h-4 w-4"})}),children:({close:c})=>(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(m.DropdownMenuItem,{onSelect:()=>{c(),av(a)},disabled:G,children:"Edit"}),(0,b.jsx)(m.DropdownMenuSeparator,{}),(0,b.jsx)(m.DropdownMenuItem,{destructive:!0,onSelect:()=>{c(),ax(a)},disabled:G,children:"Delete"})]})}):null}],[ay,G,as,az]);return(0,b.jsx)(e.RequireAuth,{requiredPermission:"devices.view",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(j.ConfirmDialog,{open:ai,title:ak,message:am,busy:G,confirmText:"Delete",confirmVariant:"secondary",onCancel:()=>{G||(aj(!1),ap(null))},onConfirm:()=>{ao&&(async()=>{await ao(),aj(!1),ap(null)})()}}),(0,b.jsx)(o.Modal,{open:S,onClose:()=>{G||T(!1)},title:"Edit device",footer:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,b.jsx)(g.Button,{variant:"outline",onClick:()=>T(!1),disabled:G,children:"Cancel"}),(0,b.jsx)(g.Button,{disabled:G,type:"submit",form:"rb_device_form",children:G?"Saving...":"Save"})]}),children:(0,b.jsxs)("form",{id:"rb_device_form",className:"space-y-3",onSubmit:aw,children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",htmlFor:"device_model",children:"Model"}),(0,b.jsx)("input",{id:"device_model",className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:W,onChange:a=>X(a.target.value),required:!0,disabled:G})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",htmlFor:"device_type",children:"Device type"}),(0,b.jsx)("select",{id:"device_type",className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:Y??"",onChange:a=>{let b=a.target.value;if(!b)return void Z(null);let c=Number(b);Z(Number.isFinite(c)?c:null)},disabled:G,children:M.slice().sort((a,b)=>a.name.localeCompare(b.name)).map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",htmlFor:"device_brand",children:"Device brand"}),(0,b.jsx)("select",{id:"device_brand",className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:$??"",onChange:a=>{let b=a.target.value;if(!b)return void _(null);let c=Number(b);_(Number.isFinite(c)?c:null)},disabled:G,children:K.slice().sort((a,b)=>a.name.localeCompare(b.name)).map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))})]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",htmlFor:"device_parent",children:"Parent device (variation base)"}),(0,b.jsxs)("select",{id:"device_parent",className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:aa??"",onChange:a=>{let b=a.target.value;if(!b)return void ab(null);let c=Number(b);ab(Number.isFinite(c)?c:null)},disabled:G,children:[(0,b.jsx)("option",{value:"",children:"(none)"}),aA.map(a=>(0,b.jsx)("option",{value:a.id,children:a.model},a.id))]})]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:ac,onChange:a=>ad(a.target.checked),disabled:G}),"Disable in booking form"]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:ae,onChange:a=>af(a.target.checked),disabled:G}),"Is ",'"Other"'," device"]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:ag,onChange:a=>ah(a.target.checked),disabled:G}),"Active"]})]})}),E?(0,b.jsx)("div",{className:"text-sm text-green-700",children:E}):null,C?(0,b.jsx)("div",{className:"text-sm text-red-600",children:C}):null,(0,b.jsx)(q.ListPageShell,{title:"Devices",description:"Supported device models for your repair catalog.",actions:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(n.DataViewToggle,{value:z,onChange:a=>{x.setParam("view","table"===a?null:a)},disabled:A||G}),(0,b.jsx)(g.Button,{variant:"primary",size:"sm",onClick:()=>{as&&"string"==typeof w&&0!==w.length&&u.push(`/app/${w}/devices/new`)},disabled:!as||A||G,children:"New device"})]}),loading:A,loadingFallback:(0,b.jsx)(i.Card,{className:"shadow-none",children:(0,b.jsx)(i.CardContent,{className:"pt-5",children:(0,b.jsx)(p.TableSkeleton,{rows:8,columns:5,className:"shadow-none"})})}),error:null,empty:!A&&!C&&0===I.length,emptyTitle:"No devices",emptyDescription:"Add device models to standardize intake and quoting.",children:(0,b.jsx)(i.Card,{className:"shadow-none",children:(0,b.jsx)(i.CardContent,{className:"pt-5",children:"table"===z?(0,b.jsx)(l.DataTable,{data:I,loading:A,emptyMessage:"No devices.",columns:aB,getRowId:a=>a.id,search:{placeholder:"Search devices..."},filters:[{id:"is_active",label:"Status",value:y,options:[{label:"All",value:"all"},{label:"Active",value:"1"},{label:"Inactive",value:"0"}],onChange:a=>{let b=String(a);x.setParam("is_active","all"===b?null:b,{resetPage:!0})}}],server:{query:x.query,onQueryChange:x.onQueryChange,pageIndex:x.pageIndex,onPageIndexChange:x.onPageIndexChange,pageSize:x.pageSize,onPageSizeChange:x.onPageSizeChange,totalRows:aq}}):(0,b.jsx)(k.DataGrid,{title:"string"==typeof w?`Devices \xb7 ${w}`:"Devices",data:I,loading:A,emptyMessage:"No devices.",getItemId:a=>a.id,search:{placeholder:"Search devices..."},filters:[{id:"is_active",label:"Status",value:y,options:[{label:"All",value:"all"},{label:"Active",value:"1"},{label:"Inactive",value:"0"}],onChange:a=>{let b=String(a);x.setParam("is_active","all"===b?null:b,{resetPage:!0})}}],server:{query:x.query,onQueryChange:x.onQueryChange,pageIndex:x.pageIndex,onPageIndexChange:x.onPageIndexChange,pageSize:x.pageSize,onPageSizeChange:x.onPageSizeChange,totalRows:aq},onItemClick:as?av:void 0,renderItem:a=>{let c=ay.get(a.device_brand_id)?.name??String(a.device_brand_id),d=az.get(a.device_type_id)?.name??String(a.device_type_id);return(0,b.jsxs)(i.Card,{className:"overflow-hidden shadow-none",children:[(0,b.jsxs)("div",{className:"flex h-20 items-center justify-between gap-3 bg-[var(--rb-surface-muted)] px-4",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"truncate text-sm font-semibold text-[var(--rb-text)]",children:a.model}),(0,b.jsx)("div",{className:"truncate text-xs text-zinc-600",children:a.id})]}),as?(0,b.jsx)(m.DropdownMenu,{align:"right",trigger:({toggle:a})=>(0,b.jsx)(g.Button,{variant:"ghost",size:"sm",onClick:b=>{b.stopPropagation(),a()},disabled:G,className:"px-2","aria-label":"Actions",title:"Actions",children:(0,b.jsx)(t.MoreHorizontal,{className:"h-4 w-4"})}),children:({close:c})=>(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(m.DropdownMenuItem,{onSelect:()=>{c(),av(a)},disabled:G,children:"Edit"}),(0,b.jsx)(m.DropdownMenuSeparator,{}),(0,b.jsx)(m.DropdownMenuItem,{destructive:!0,onSelect:()=>{c(),ax(a)},disabled:G,children:"Delete"})]})}):null]}),(0,b.jsxs)(i.CardContent,{className:"pt-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"text-sm text-zinc-700",children:[(0,b.jsx)("span",{className:"font-medium text-[var(--rb-text)]",children:"Brand:"})," ",c]}),(0,b.jsxs)("div",{className:"text-sm text-zinc-700",children:[(0,b.jsx)("span",{className:"font-medium text-[var(--rb-text)]",children:"Type:"})," ",d]})]}),(0,b.jsxs)("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[(0,b.jsx)(h.Badge,{variant:a.is_active?"success":"default",children:a.is_active?"Active":"Inactive"}),a.disable_in_booking_form?(0,b.jsx)(h.Badge,{variant:"default",children:"Hidden in booking"}):null,a.is_other?(0,b.jsx)(h.Badge,{variant:"default",children:"Other"}):null]})]})]})}})})})})]})})}a.s(["default",()=>u])}];

//# sourceMappingURL=frontend_src_app_app_%5Btenant%5D_devices_page_tsx_1706cf66._.js.map