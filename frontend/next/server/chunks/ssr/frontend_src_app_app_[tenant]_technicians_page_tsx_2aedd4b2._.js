module.exports=[43292,a=>{"use strict";var b=a.i(57850),c=a.i(45056),d=a.i(93609),e=a.i(17933),f=a.i(97867),g=a.i(4600),h=a.i(54177),i=a.i(54804),j=a.i(91601),k=a.i(34075),l=a.i(94703),m=a.i(46036),n=a.i(75458),o=a.i(71513),p=a.i(4148);let q=(0,a.i(31261).default)("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);var r=a.i(6183);function s(){let a=(0,n.useAuth)(),s=(0,d.useParams)(),t=s.business??s.tenant,u=a.can("users.manage"),[v,w]=c.default.useState(""),[x,y]=c.default.useState(0),[z,A]=c.default.useState(10),[B,C]=c.default.useState(null),[D,E]=c.default.useState("all"),[F,G]=c.default.useState(!0),[H,I]=c.default.useState(null),[J,K]=c.default.useState([]),[L,M]=c.default.useState(0),[N,O]=c.default.useState(0),[P,Q]=c.default.useState(!1),[R,S]=c.default.useState(!1),[T,U]=c.default.useState(""),[V,W]=c.default.useState(""),[X,Y]=c.default.useState([]),[Z,$]=c.default.useState(""),[_,aa]=c.default.useState({}),[ab,ac]=c.default.useState(!1),[ad,ae]=c.default.useState(!1),[af,ag]=c.default.useState(null),[ah,ai]=c.default.useState(""),[aj,ak]=c.default.useState(""),al=c.default.useMemo(()=>X.slice().sort((a,b)=>`${a.code} ${a.name}`.localeCompare(`${b.code} ${b.name}`)).map(a=>({id:a.id,label:`${a.code} - ${a.name}${a.is_active?"":" (inactive)"}`,isActive:a.is_active})),[X]),am=c.default.useMemo(()=>al.filter(a=>a.isActive),[al]),an=c.default.useMemo(()=>{let a=Z.trim().toLowerCase();return a?am.filter(b=>b.label.toLowerCase().includes(a)):am},[am,Z]),ao=c.default.useMemo(()=>0!==an.length&&an.every(a=>!!_[a.id]),[an,_]),ap=c.default.useMemo(()=>an.some(a=>!!_[a.id]),[an,_]),aq=c.default.useRef(null);c.default.useEffect(()=>{aq.current&&(aq.current.indeterminate=ap&&!ao)},[ao,ap]);let ar=c.default.useMemo(()=>[{label:"All statuses",value:"all"},{label:"Pending",value:"pending"},{label:"Active",value:"active"},{label:"Inactive",value:"inactive"},{label:"Suspended",value:"suspended"}],[]),as=c.default.useMemo(()=>new Map([["pending","warning"],["active","success"],["inactive","default"],["suspended","danger"]]),[]);c.default.useEffect(()=>{let b=!0;return async function(){if(u&&P&&"string"==typeof t&&0!==t.length&&!(X.length>0))try{let c=await (0,k.apiFetch)(`/api/${t}/app/branches`);if(!b)return;let d=Array.isArray(c.branches)?c.branches:[];Y(d);let e=a.tenant?.default_branch_id??null,f=d.filter(a=>a.is_active).map(a=>a.id),g=(e&&f.includes(e)?[e]:[]).concat(f.length>0?[f[0]]:[]).filter((a,b,c)=>c.indexOf(a)===b);aa(a=>{if(Object.keys(a).length>0)return a;let b={};for(let a of g)b[a]=!0;return b})}catch(a){if(!b)return;o.notify.error(a instanceof Error?a.message:"Failed to load shops.")}}(),()=>{b=!1}},[a.tenant?.default_branch_id,X.length,u,P,t]);let at=a.tenant?.currency??"USD",au=c.default.useCallback(a=>{u&&(ag(a),ai("number"==typeof a.tech_hourly_rate_cents&&Number.isFinite(a.tech_hourly_rate_cents)?(a.tech_hourly_rate_cents/100).toFixed(2):""),ak("number"==typeof a.client_hourly_rate_cents&&Number.isFinite(a.client_hourly_rate_cents)?(a.client_hourly_rate_cents/100).toFixed(2):""),ac(!0))},[u]),av=c.default.useCallback(async()=>{if(!u||!af||"string"!=typeof t||0===t.length||ad)return;let a=a=>{let b=a.trim();if(0===b.length)return{cents:null,valid:!0};let c=Number(b);return Number.isFinite(c)?{cents:Math.round(100*c),valid:!0}:{cents:null,valid:!1}},b=a(ah),c=a(aj);if(!b.valid||!c.valid)return void o.notify.error("Enter valid numbers for hourly rates.");let d=b.cents,e=c.cents;if("number"==typeof d&&d<0)return void o.notify.error("Tech hourly rate must be 0 or greater.");if("number"==typeof e&&e<0)return void o.notify.error("Client hourly rate must be 0 or greater.");ae(!0);try{await (0,k.apiFetch)(`/api/${t}/app/technicians/${af.id}/rates`,{method:"PATCH",body:{tech_hourly_rate_cents:d,client_hourly_rate_cents:e}}),o.notify.success("Hourly rates updated."),ac(!1),ag(null),O(a=>a+1)}catch(a){a instanceof k.ApiError?o.notify.error(a.message):o.notify.error(a instanceof Error?a.message:"Failed to update hourly rates.")}finally{ae(!1)}},[u,ad,aj,ah,af,t]);async function aw(a){if(a.preventDefault(),!u||"string"!=typeof t||0===t.length||0===am.length)return;let b=Object.entries(_).filter(([,a])=>a).map(([a])=>Number(a)).filter(a=>Number.isFinite(a)&&a>0);if(0===b.length)return void o.notify.error("Select at least one shop.");S(!0);try{await (0,k.apiFetch)(`/api/${t}/app/technicians`,{method:"POST",body:{name:T,email:V,branch_ids:b}}),o.notify.success("Technician created."),Q(!1),U(""),W(""),$(""),aa({}),y(0),O(a=>a+1)}catch(a){a instanceof k.ApiError?o.notify.error(a.message):o.notify.error(a instanceof Error?a.message:"Failed to create technician.")}finally{S(!1)}}c.default.useEffect(()=>{let a=!0;return async function(){if("string"==typeof t&&0!==t.length){G(!0),I(null);try{let b=new URLSearchParams;v.trim().length>0&&b.set("q",v.trim()),D&&"all"!==D&&b.set("status",D),B?.id&&B?.dir&&(b.set("sort",B.id),b.set("dir",B.dir)),b.set("page",String(x+1)),b.set("per_page",String(z));let c=await (0,k.apiFetch)(`/api/${t}/app/technicians?${b.toString()}`);if(!a)return;let d=Array.isArray(c.users)?c.users:[];K(d.map(a=>({id:a.id,name:a.name,email:a.email,phone:a.phone??void 0,status:a.status??"active",tech_hourly_rate_cents:a.tech_hourly_rate_cents??null,client_hourly_rate_cents:a.client_hourly_rate_cents??null}))),M("number"==typeof c.meta?.total?c.meta.total:d.length),A("number"==typeof c.meta?.per_page?c.meta.per_page:z)}catch(b){if(!a)return;I(b instanceof Error?b.message:"Failed to load technicians.")}finally{if(!a)return;G(!1)}}}(),()=>{a=!1}},[x,z,v,N,B?.dir,B?.id,D,t]);let ax=c.default.useMemo(()=>[{id:"name",header:"Technician",sortId:"name",cell:a=>(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"truncate font-semibold text-[var(--rb-text)]",children:a.name}),(0,b.jsxs)("div",{className:"truncate text-xs text-zinc-600",children:["#",a.id]})]}),className:"min-w-[260px]"},{id:"email",header:"Email",sortId:"email",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:a.email}),className:"min-w-[260px]"},{id:"phone",header:"Phone",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:a.phone??"—"}),className:"min-w-[160px]"},{id:"status",header:"Status",sortId:"status",cell:a=>(0,b.jsx)(e.Badge,{variant:as.get(a.status)??"default",children:a.status}),className:"whitespace-nowrap"},{id:"tech_hourly_rate",header:"Tech hourly",cell:a=>(0,b.jsxs)("div",{className:"whitespace-nowrap text-sm font-semibold text-[var(--rb-text)]",children:[(0,p.formatMoney)({amountCents:a.tech_hourly_rate_cents??null,currency:at,fallback:"—"})," / hr"]}),className:"whitespace-nowrap"},{id:"client_hourly_rate",header:"Client hourly",cell:a=>(0,b.jsxs)("div",{className:"whitespace-nowrap text-sm font-semibold text-[var(--rb-text)]",children:[(0,p.formatMoney)({amountCents:a.client_hourly_rate_cents??null,currency:at,fallback:"—"})," / hr"]}),className:"whitespace-nowrap"},{id:"actions",header:"",cell:a=>(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsx)(m.DropdownMenu,{align:"right",trigger:({toggle:a})=>(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",disabled:!u,onClick:b=>{b.stopPropagation(),a()},"aria-label":"Actions",children:(0,b.jsx)(r.MoreHorizontal,{className:"h-4 w-4"})}),children:({close:c})=>(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(m.DropdownMenuItem,{onSelect:()=>{c(),au(a)},disabled:!u,children:(0,b.jsxs)("span",{className:"inline-flex items-center gap-2",children:[(0,b.jsx)(q,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:"Update hourly rates"})]})})})})}),className:"w-[1%] whitespace-nowrap text-right",headerClassName:"w-[1%]"}],[u,at,au,as]);return(0,b.jsx)(j.RequireAuth,{requiredPermission:"technicians.view",children:(0,b.jsxs)(i.ListPageShell,{title:"Technicians",description:"Technician roster.",actions:(0,b.jsx)(f.Button,{variant:"outline",size:"sm",disabled:!u,onClick:()=>{u&&Q(!0)},children:"Add technician"}),loading:!1,error:H,empty:!1,children:[(0,b.jsx)(l.Modal,{open:ab,title:af?`Update rates \xb7 ${af.name}`:"Update rates",onClose:()=>{ad||(ac(!1),ag(null))},footer:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,b.jsx)(f.Button,{variant:"outline",disabled:ad,onClick:()=>{ad||(ac(!1),ag(null))},children:"Cancel"}),(0,b.jsx)(f.Button,{disabled:ad||!u||!af,onClick:()=>{av()},children:ad?"Saving...":"Save"})]}),children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsxs)("label",{className:"text-sm font-medium",htmlFor:"tech_hourly_rate",children:["Tech hourly rate (",at,")"]}),(0,b.jsx)("input",{id:"tech_hourly_rate",className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:ah,onChange:a=>ai(a.target.value),placeholder:"e.g. 45.00",disabled:ad,inputMode:"decimal"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsxs)("label",{className:"text-sm font-medium",htmlFor:"client_hourly_rate",children:["Client hourly rate (",at,")"]}),(0,b.jsx)("input",{id:"client_hourly_rate",className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:aj,onChange:a=>ak(a.target.value),placeholder:"e.g. 60.00",disabled:ad,inputMode:"decimal"})]}),(0,b.jsx)("div",{className:"text-xs text-zinc-600",children:"Leave blank to clear a rate."})]})}),(0,b.jsx)(l.Modal,{open:P,title:"Add technician",onClose:()=>{R||Q(!1)},className:"max-w-3xl",footer:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,b.jsx)(f.Button,{variant:"outline",disabled:R,onClick:()=>{R||Q(!1)},children:"Cancel"}),(0,b.jsx)(f.Button,{disabled:R||!u||0===am.length||0===Object.values(_).filter(Boolean).length,onClick:()=>{let a=document.getElementById("create_technician_form");a?.requestSubmit()},children:R?"Saving...":"Create"})]}),children:(0,b.jsxs)("form",{id:"create_technician_form",onSubmit:aw,className:"max-h-[70vh] space-y-4 overflow-y-auto pr-1",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",htmlFor:"tech_name",children:"Name"}),(0,b.jsx)("input",{id:"tech_name",className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:T,onChange:a=>U(a.target.value),required:!0,disabled:R})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",htmlFor:"tech_email",children:"Email"}),(0,b.jsx)("input",{id:"tech_email",className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:V,onChange:a=>W(a.target.value),type:"email",required:!0,disabled:R})]}),(0,b.jsx)("div",{className:"space-y-1",children:(0,b.jsx)("div",{className:"text-sm text-zinc-600",children:"A one-time password will be generated and emailed to the technician."})}),(0,b.jsxs)("div",{className:"rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-[var(--rb-surface-muted)] p-4",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Shops"}),(0,b.jsx)("div",{className:"mt-1 text-xs text-zinc-600",children:"Select one or more shops this technician can access."})]}),(0,b.jsxs)("div",{className:"text-xs text-zinc-600",children:["Selected: ",Object.values(_).filter(Boolean).length]})]}),(0,b.jsxs)("div",{className:"mt-3 space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",htmlFor:"new_tech_shop_search",children:"Search"}),(0,b.jsx)("input",{id:"new_tech_shop_search",className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:Z,onChange:a=>$(a.target.value),placeholder:"Search shops...",disabled:R})]}),(0,b.jsx)("div",{className:"mt-3 max-h-[260px] overflow-y-auto pr-1",children:(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsxs)("label",{className:"flex items-center justify-between gap-3 rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2",children:[(0,b.jsx)("div",{className:"min-w-0",children:(0,b.jsx)("div",{className:"truncate text-sm font-medium text-[var(--rb-text)]",children:"Check all"})}),(0,b.jsx)("input",{ref:aq,type:"checkbox",checked:ao,onChange:a=>{let b=a.target.checked;aa(a=>{let c={...a};for(let a of an)c[a.id]=b;return c})},disabled:R})]}),an.map(a=>{let c=!!_[a.id];return(0,b.jsxs)("label",{className:"flex items-center justify-between gap-3 rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2",children:[(0,b.jsx)("div",{className:"min-w-0",children:(0,b.jsx)("div",{className:"truncate text-sm font-medium text-[var(--rb-text)]",children:a.label})}),(0,b.jsx)("input",{type:"checkbox",checked:c,onChange:b=>aa(c=>({...c,[a.id]:b.target.checked})),disabled:R})]},a.id)})]})}),0===am.length?(0,b.jsx)("div",{className:"mt-2 text-sm text-zinc-600",children:"Create a shop first before adding technicians."}):null]})]})}),(0,b.jsx)(g.Card,{className:"shadow-none",children:(0,b.jsx)(g.CardContent,{className:"pt-5",children:(0,b.jsx)(h.DataTable,{data:J,loading:F,columns:ax,getRowId:a=>String(a.id),emptyMessage:"No technicians.",search:{placeholder:"Search technicians..."},server:{query:v,onQueryChange:a=>{w(a),y(0)},pageIndex:x,onPageIndexChange:y,pageSize:z,onPageSizeChange:a=>{A(a),y(0)},totalRows:L,sort:B,onSortChange:a=>{C(a),y(0)}},filters:[{id:"status",label:"Status",value:D,options:ar,onChange:a=>{E(String(a)),y(0)}}]})})})]})})}a.s(["default",()=>s],43292)}];

//# sourceMappingURL=frontend_src_app_app_%5Btenant%5D_technicians_page_tsx_2aedd4b2._.js.map