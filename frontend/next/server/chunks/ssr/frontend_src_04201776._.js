module.exports=[94703,a=>{"use strict";var b=a.i(57850),c=a.i(45056),d=a.i(7160);function e({open:a,onClose:e,title:f,children:g,footer:h,position:i="center",variant:j="glass",className:k}){if((0,c.useEffect)(()=>{function b(b){a&&"Escape"===b.key&&e()}return document.addEventListener("keydown",b),()=>document.removeEventListener("keydown",b)},[e,a]),!a)return null;let l="solid"===j?(0,d.cn)("relative w-full max-w-lg overflow-hidden rounded-[var(--rb-radius-lg)]","border border-[var(--rb-border)]","bg-white","shadow-[var(--rb-shadow)]"):(0,d.cn)("relative w-full max-w-lg overflow-hidden rounded-[var(--rb-radius-lg)]","border border-[color:color-mix(in_srgb,var(--rb-border),white_55%)]","bg-white/75 backdrop-blur-xl","shadow-[0_18px_55px_-18px_rgba(0,0,0,0.55)]","ring-1 ring-white/25");return(0,b.jsxs)("div",{className:"top-center"===i?"fixed inset-0 z-50 flex items-start justify-center px-4 pt-8":"fixed inset-0 z-50 flex items-center justify-center px-4",children:[(0,b.jsx)("button",{type:"button",className:(0,d.cn)("absolute inset-0","bg-black/35 backdrop-blur-md","bg-[radial-gradient(900px_600px_at_20%_20%,color-mix(in_srgb,#16a34a,transparent_82%)_0%,transparent_60%),radial-gradient(900px_600px_at_80%_30%,color-mix(in_srgb,var(--rb-blue),transparent_82%)_0%,transparent_60%),radial-gradient(900px_600px_at_50%_85%,color-mix(in_srgb,var(--rb-orange),transparent_85%)_0%,transparent_65%)]"),"aria-label":"Close",onClick:e}),(0,b.jsxs)("div",{role:"dialog","aria-modal":"true",className:(0,d.cn)(l,k),children:["glass"===j?(0,b.jsx)("div",{className:"pointer-events-none absolute inset-0 bg-[radial-gradient(650px_420px_at_20%_15%,color-mix(in_srgb,#16a34a,transparent_88%)_0%,transparent_60%),radial-gradient(650px_420px_at_80%_5%,color-mix(in_srgb,var(--rb-blue),transparent_90%)_0%,transparent_60%)]"}):null,f?(0,b.jsx)("div",{className:(0,d.cn)("relative px-5 py-4","solid"===j?"border-b border-[var(--rb-border)]":"border-b border-[color:color-mix(in_srgb,var(--rb-border),white_60%)]"),children:(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:f})}):null,(0,b.jsx)("div",{className:"relative px-5 py-4",children:g}),h?(0,b.jsx)("div",{className:(0,d.cn)("relative px-5 py-4","solid"===j?"border-t border-[var(--rb-border)]":"border-t border-[color:color-mix(in_srgb,var(--rb-border),white_60%)]"),children:h}):null]})]})}a.s(["Modal",()=>e])},21282,a=>{"use strict";var b=a.i(57850),c=a.i(94703),d=a.i(97867);function e({open:a,title:e,message:f,confirmText:g="Confirm",confirmVariant:h="primary",cancelText:i="Cancel",busy:j=!1,onCancel:k,onConfirm:l}){return(0,b.jsx)(c.Modal,{open:a,onClose:()=>{j||k()},title:e,footer:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,b.jsx)(d.Button,{variant:"outline",onClick:k,disabled:j,children:i}),(0,b.jsx)(d.Button,{variant:h,onClick:l,disabled:j,children:j?"Working...":g})]}),children:(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:f})})}a.s(["ConfirmDialog",()=>e])},54804,a=>{"use strict";var b=a.i(57850),c=a.i(648),d=a.i(75385),e=a.i(4600);function f({title:a,description:f,actions:g,filters:h,loading:i,loadingFallback:j,error:k,empty:l,emptyTitle:m="Nothing here yet",emptyDescription:n="No items to display.",children:o}){return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(c.PageHeader,{title:a,description:f,actions:g}),h?(0,b.jsx)(e.Card,{className:"shadow-none",children:(0,b.jsx)(e.CardContent,{className:"pt-5",children:h})}):null,k?(0,b.jsx)(d.Alert,{variant:"danger",title:"Something went wrong",children:k}):null,i?j??(0,b.jsx)("div",{className:"text-sm text-zinc-500",children:"Loading..."}):null,i||k||!l?null:(0,b.jsx)(e.Card,{className:"shadow-none",children:(0,b.jsxs)(e.CardContent,{className:"pt-5",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:m}),(0,b.jsx)("div",{className:"mt-1 text-sm text-zinc-600",children:n})]})}),i||k||l?null:o]})}a.s(["ListPageShell",()=>f])},37672,a=>{"use strict";var b=a.i(57850),c=a.i(45056),d=a.i(93609),e=a.i(91601),f=a.i(75458),g=a.i(97867),h=a.i(4600),i=a.i(21282),j=a.i(54177),k=a.i(46036),l=a.i(94703),m=a.i(26606),n=a.i(54804),o=a.i(34075);function p(){let a=(0,f.useAuth)(),p=(0,d.useRouter)(),q=(0,d.useParams)(),r=q.business??q.tenant,[s,t]=c.default.useState(!0),[u,v]=c.default.useState(null),[w,x]=c.default.useState(null),[y,z]=c.default.useState(!1),[A,B]=c.default.useState([]),[C,D]=c.default.useState(!1),[E,F]=c.default.useState(null),[G,H]=c.default.useState(""),[I,J]=c.default.useState(""),[K,L]=c.default.useState(!1),[M,N]=c.default.useState(!1),[O,P]=c.default.useState(!1),[Q,R]=c.default.useState(!0),[S,T]=c.default.useState(!1),[U,V]=c.default.useState(""),[W,X]=c.default.useState(""),[Y,Z]=c.default.useState(null),[$,_]=c.default.useState(""),[aa,ab]=c.default.useState(0),[ac,ad]=c.default.useState(10),ae=a.can("settings.manage"),af=c.default.useCallback(async()=>{try{if(t(!0),v(null),"string"!=typeof r||0===r.length)throw Error("Business is missing.");let a=await (0,o.apiFetch)(`/api/${r}/app/repairbuddy/device-field-definitions?limit=200`);B(Array.isArray(a.device_field_definitions)?a.device_field_definitions:[])}catch(a){if(a instanceof o.ApiError&&428===a.status&&"string"==typeof r&&r.length>0){let a=`/app/${r}/device-field-definitions`;p.replace(`/app/${r}/branches/select?next=${encodeURIComponent(a)}`);return}v(a instanceof Error?a.message:"Failed to load device field definitions.")}finally{t(!1)}},[p,r]);async function ag(a){if((a.preventDefault(),!y)&&"string"==typeof r&&0!==r.length){if(!ae)return void v("Forbidden.");z(!0),v(null),x(null);try{let a=I.trim();if(0===a.length)return void v("Label is required.");let b={label:a,show_in_booking:K,show_in_invoice:M,show_in_portal:O,is_active:Q};if(E)await (0,o.apiFetch)(`/api/${r}/app/repairbuddy/device-field-definitions/${E}`,{method:"PATCH",body:b}),x("Field updated.");else{let a=G.trim();if(!/^[a-z0-9_]+$/.test(a))return void v("Key must be lowercase and contain only letters, numbers, and underscores.");await (0,o.apiFetch)(`/api/${r}/app/repairbuddy/device-field-definitions`,{method:"POST",body:{...b,key:a}}),x("Field created.")}D(!1),ab(0),await af()}catch(a){a instanceof o.ApiError?v(a.message):v(E?"Failed to update field.":"Failed to create field.")}finally{z(!1)}}}async function ah(a){if(!y&&"string"==typeof r&&0!==r.length){var c;if(!ae)return void v("Forbidden.");c={title:"Delete device field",message:(0,b.jsxs)("div",{children:["Delete ",(0,b.jsx)("span",{className:"font-semibold",children:a.label}),"?"]}),action:async()=>{z(!0),v(null),x(null);try{await (0,o.apiFetch)(`/api/${r}/app/repairbuddy/device-field-definitions/${a.id}`,{method:"DELETE"}),x("Field deleted."),ab(0),await af()}catch(a){a instanceof o.ApiError?v(a.message):v("Failed to delete field.")}finally{z(!1)}}},V(c.title),X(c.message),Z(()=>c.action),T(!0)}}c.default.useEffect(()=>{af()},[af]);let ai=c.default.useMemo(()=>{let a=$.trim().toLowerCase();return a?A.filter(b=>`${b.id} ${b.key} ${b.label}`.toLowerCase().includes(a)):A},[A,$]),aj=ai.length,ak=c.default.useMemo(()=>{let a=aa*ac,b=a+ac;return ai.slice(a,b)},[ai,aa,ac]),al=c.default.useMemo(()=>[{id:"label",header:"Field",cell:a=>(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"truncate font-semibold text-[var(--rb-text)]",children:a.label}),(0,b.jsx)("div",{className:"truncate text-xs text-zinc-600",children:a.key})]}),className:"min-w-[280px]"},{id:"booking",header:"Booking",className:"whitespace-nowrap",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:a.show_in_booking?"Yes":"No"})},{id:"invoice",header:"Invoice",className:"whitespace-nowrap",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:a.show_in_invoice?"Yes":"No"})},{id:"portal",header:"Portal",className:"whitespace-nowrap",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:a.show_in_portal?"Yes":"No"})},{id:"active",header:"Active",className:"whitespace-nowrap",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:a.is_active?"Yes":"No"})},{id:"actions",header:"",headerClassName:"text-right",className:"whitespace-nowrap text-right",cell:a=>ae?(0,b.jsx)(k.DropdownMenu,{align:"right",trigger:({toggle:a})=>(0,b.jsx)(g.Button,{variant:"ghost",size:"sm",onClick:a,disabled:y,className:"px-2",children:"Actions"}),children:({close:c})=>(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.DropdownMenuItem,{onSelect:()=>{c(),ae&&(F(a.id),H(a.key),J(a.label),L(!!a.show_in_booking),N(!!a.show_in_invoice),P(!!a.show_in_portal),R(!!a.is_active),D(!0),v(null),x(null))},disabled:y,children:"Edit"}),(0,b.jsx)(k.DropdownMenuSeparator,{}),(0,b.jsx)(k.DropdownMenuItem,{destructive:!0,onSelect:()=>{c(),ah(a)},disabled:y,children:"Delete"})]})}):null}],[y,ae]);return(0,b.jsx)(e.RequireAuth,{requiredPermission:"settings.manage",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(i.ConfirmDialog,{open:S,title:U,message:W,busy:y,confirmText:"Delete",confirmVariant:"secondary",onCancel:()=>{y||(T(!1),Z(null))},onConfirm:()=>{Y&&(async()=>{await Y(),T(!1),Z(null)})()}}),(0,b.jsx)(l.Modal,{open:C,onClose:()=>{y||D(!1)},title:E?"Edit device field":"New device field",footer:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,b.jsx)(g.Button,{variant:"outline",onClick:()=>D(!1),disabled:y,children:"Cancel"}),(0,b.jsx)(g.Button,{disabled:y,type:"submit",form:"rb_device_field_def_form",children:y?"Saving...":"Save"})]}),children:(0,b.jsxs)("form",{id:"rb_device_field_def_form",className:"space-y-3",onSubmit:ag,children:[E?(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",htmlFor:"field_key_ro",children:"Key"}),(0,b.jsx)("input",{id:"field_key_ro",className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:G,disabled:!0})]}):(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",htmlFor:"field_key",children:"Key"}),(0,b.jsx)("input",{id:"field_key",className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:G,onChange:a=>H(a.target.value),required:!0,disabled:y,placeholder:"e.g. password"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",htmlFor:"field_label",children:"Label"}),(0,b.jsx)("input",{id:"field_label",className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:I,onChange:a=>J(a.target.value),required:!0,disabled:y,placeholder:"e.g. Password"})]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:K,onChange:a=>L(a.target.checked),disabled:y}),"Show in booking"]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:M,onChange:a=>N(a.target.checked),disabled:y}),"Show in invoice"]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:O,onChange:a=>P(a.target.checked),disabled:y}),"Show in portal"]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:Q,onChange:a=>R(a.target.checked),disabled:y}),"Active"]})]})}),w?(0,b.jsx)("div",{className:"text-sm text-green-700",children:w}):null,u?(0,b.jsx)("div",{className:"text-sm text-red-600",children:u}):null,(0,b.jsx)(n.ListPageShell,{title:"Device Field Definitions",description:"Define additional device fields for intake, invoices, and portal.",actions:(0,b.jsx)(g.Button,{variant:"primary",size:"sm",onClick:function(){ae&&(F(null),H(""),J(""),L(!1),N(!1),P(!1),R(!0),D(!0),v(null),x(null))},disabled:!ae||s||y,children:"New field"}),loading:s,loadingFallback:(0,b.jsx)(h.Card,{className:"shadow-none",children:(0,b.jsx)(h.CardContent,{className:"pt-5",children:(0,b.jsx)(m.TableSkeleton,{rows:8,columns:6,className:"shadow-none"})})}),error:null,empty:!s&&!u&&0===A.length,emptyTitle:"No device fields",emptyDescription:"Create fields like Password, PIN, or Accessories.",children:(0,b.jsx)(h.Card,{className:"shadow-none",children:(0,b.jsx)(h.CardContent,{className:"pt-5",children:(0,b.jsx)(j.DataTable,{title:"string"==typeof r?`Device Fields \xb7 ${r}`:"Device Fields",data:ak,loading:s,emptyMessage:"No fields.",columns:al,getRowId:a=>a.id,search:{placeholder:"Search fields..."},server:{query:$,onQueryChange:a=>{_(a),ab(0)},pageIndex:aa,onPageIndexChange:ab,pageSize:ac,onPageSizeChange:a=>{ad(a),ab(0)},totalRows:aj}})})})})]})})}a.s(["default",()=>p])}];

//# sourceMappingURL=frontend_src_04201776._.js.map