{"version":3,"sources":["../../../../../frontend/src/components/ui/PageHeader.tsx","../../../../../frontend/src/app/app/%5Btenant%5D/branches/select/page.tsx"],"sourcesContent":["import React from \"react\";\r\nimport { cn } from \"@/lib/cn\";\r\n\r\nexport function PageHeader({\r\n  title,\r\n  description,\r\n  actions,\r\n  className,\r\n}: {\r\n  title: string;\r\n  description?: string;\r\n  actions?: React.ReactNode;\r\n  className?: string;\r\n}) {\r\n  return (\r\n    <div className={cn(\"flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between\", className)}>\r\n      <div>\r\n        <h1 className=\"text-xl font-semibold text-[var(--rb-text)]\">{title}</h1>\r\n        {description ? <p className=\"mt-1 text-sm text-zinc-600\">{description}</p> : null}\r\n      </div>\r\n      {actions ? <div className=\"flex items-center gap-2\">{actions}</div> : null}\r\n    </div>\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport React, { useEffect, useMemo, useState } from \"react\";\r\nimport { useParams, useRouter, useSearchParams } from \"next/navigation\";\r\nimport { apiFetch, ApiError } from \"@/lib/api\";\r\nimport { Button } from \"@/components/ui/Button\";\r\nimport { Card, CardContent } from \"@/components/ui/Card\";\r\nimport { PageHeader } from \"@/components/ui/PageHeader\";\r\n\r\ntype Branch = {\r\n  id: number;\r\n  tenant_id?: number;\r\n  name: string;\r\n  code: string;\r\n  is_active: boolean;\r\n};\r\n\r\nexport default function SelectBranchPage() {\r\n  const router = useRouter();\r\n  const params = useParams() as { tenant?: string; business?: string };\r\n  const tenant = params.business ?? params.tenant;\r\n  const searchParams = useSearchParams();\r\n\r\n  const next = useMemo(() => {\r\n    const n = searchParams.get(\"next\");\r\n    return n && n.startsWith(\"/\") ? n : null;\r\n  }, [searchParams]);\r\n\r\n  const [loading, setLoading] = useState(true);\r\n  const [branches, setBranches] = useState<Branch[]>([]);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [selectingId, setSelectingId] = useState<number | null>(null);\r\n\r\n  useEffect(() => {\r\n    let alive = true;\r\n\r\n    async function load() {\r\n      try {\r\n        setError(null);\r\n        setLoading(true);\r\n        const res = await apiFetch<{ branches: Branch[] }>(`/api/${tenant}/app/branches`);\r\n        if (!alive) return;\r\n        setBranches(Array.isArray(res.branches) ? res.branches : []);\r\n      } catch (e) {\r\n        if (!alive) return;\r\n        setError(e instanceof Error ? e.message : \"Failed to load branches.\");\r\n      } finally {\r\n        if (!alive) return;\r\n        setLoading(false);\r\n      }\r\n    }\r\n\r\n    if (typeof tenant === \"string\" && tenant.length > 0) {\r\n      void load();\r\n    } else {\r\n      setLoading(false);\r\n      setError(\"Tenant is missing.\");\r\n    }\r\n\r\n    return () => {\r\n      alive = false;\r\n    };\r\n  }, [tenant]);\r\n\r\n  async function onSelect(branchId: number) {\r\n    setSelectingId(branchId);\r\n    setError(null);\r\n\r\n    try {\r\n      await apiFetch(`/api/${tenant}/app/branches/active`, {\r\n        method: \"POST\",\r\n        body: { branch_id: branchId },\r\n      });\r\n\r\n      router.replace(next ?? `/app/${tenant}`);\r\n    } catch (e) {\r\n      if (e instanceof ApiError) {\r\n        setError(e.message);\r\n      } else {\r\n        setError(\"Failed to select branch.\");\r\n      }\r\n    } finally {\r\n      setSelectingId(null);\r\n    }\r\n  }\r\n\r\n  const activeBranches = useMemo(() => branches.filter((b) => b.is_active), [branches]);\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <PageHeader title=\"Choose branch\" description=\"Select the shop you want to work in.\" />\r\n\r\n      {loading ? <div className=\"text-sm text-zinc-500\">Loading branches...</div> : null}\r\n      {error ? <div className=\"text-sm text-red-600\">{error}</div> : null}\r\n\r\n      {!loading && !error && activeBranches.length === 0 ? (\r\n        <Card className=\"shadow-none\">\r\n          <CardContent className=\"pt-5\">\r\n            <div className=\"text-sm font-semibold text-[var(--rb-text)]\">No branches available</div>\r\n            <div className=\"mt-2 text-sm text-zinc-600\">Please contact your administrator.</div>\r\n          </CardContent>\r\n        </Card>\r\n      ) : null}\r\n\r\n      <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-3\">\r\n        {activeBranches.map((b) => {\r\n          const busy = selectingId === b.id;\r\n          return (\r\n            <Card key={b.id} className=\"shadow-none\">\r\n              <CardContent className=\"pt-5\">\r\n                <div className=\"text-xs font-semibold text-zinc-500 uppercase tracking-wider\">{b.code}</div>\r\n                <div className=\"mt-2 text-sm font-semibold text-[var(--rb-text)]\">{b.name}</div>\r\n                <div className=\"mt-4\">\r\n                  <Button\r\n                    variant=\"primary\"\r\n                    disabled={busy}\r\n                    onClick={() => {\r\n                      void onSelect(b.id);\r\n                    }}\r\n                  >\r\n                    {busy ? \"Selecting...\" : \"Select\"}\r\n                  </Button>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"sDACA,EAAA,EAAA,CAAA,CAAA,MAEO,SAAS,EAAW,OACzB,CAAK,aACL,CAAW,SACX,CAAO,CACP,WAAS,CAMV,EACC,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAW,CAAA,EAAA,EAAA,EAAA,AAAE,EAAC,kEAAmE,aACpF,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,uDAA+C,IAC5D,EAAc,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,sCAA8B,IAAmB,QAE9E,EAAU,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,mCAA2B,IAAiB,OAG5E,oECrBA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,KAUe,SAAS,IACtB,IAAM,EAAS,CAAA,EAAA,EAAA,SAAA,AAAS,IAClB,EAAS,CAAA,EAAA,EAAA,SAAA,AAAS,IAClB,EAAS,EAAO,QAAQ,EAAI,EAAO,MAAM,CACzC,EAAe,CAAA,EAAA,EAAA,eAAA,AAAe,IAE9B,EAAO,CAAA,EAAA,EAAA,OAAA,AAAO,EAAC,KACnB,IAAM,EAAI,EAAa,GAAG,CAAC,QAC3B,OAAO,GAAK,EAAE,UAAU,CAAC,KAAO,EAAI,IACtC,EAAG,CAAC,EAAa,EAEX,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACjC,CAAC,EAAU,EAAY,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAW,EAAE,EAC/C,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAgB,MAC5C,CAAC,EAAa,EAAe,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAgB,MAiC9D,eAAe,EAAS,CAAgB,EACtC,EAAe,GACf,EAAS,MAET,GAAI,CACF,MAAM,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,CAAC,KAAK,EAAE,EAAO,oBAAoB,CAAC,CAAE,CACnD,OAAQ,OACR,KAAM,CAAE,UAAW,CAAS,CAC9B,GAEA,EAAO,OAAO,CAAC,GAAQ,CAAC,KAAK,EAAE,EAAA,CAAQ,CACzC,CAAE,MAAO,EAAG,CACN,aAAa,EAAA,QAAQ,CACvB,CADyB,CAChB,EAAE,OAAO,EAElB,EAAS,2BAEb,QAAU,CACR,EAAe,KACjB,CACF,CAnDA,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACR,IAAI,GAAQ,EAEZ,eAAe,IACb,GAAI,CACF,EAAS,MACT,GAAW,GACX,IAAM,EAAM,MAAM,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAyB,CAAC,KAAK,EAAE,EAAO,aAAa,CAAC,EAChF,GAAI,CAAC,EAAO,OACZ,EAAY,MAAM,OAAO,CAAC,EAAI,QAAQ,EAAI,EAAI,QAAQ,CAAG,EAAE,CAC7D,CAAE,MAAO,EAAG,CACV,GAAI,CAAC,EAAO,OACZ,EAAS,aAAa,MAAQ,EAAE,OAAO,CAAG,2BAC5C,QAAU,CACR,GAAI,CAAC,EAAO,OACZ,EAAW,GACb,CACF,CASA,MAPsB,UAAlB,OAAO,GAAuB,EAAO,MAAM,CAAG,EAC3C,CAD8C,IAGnD,GAAW,GACX,EAAS,uBAGJ,KACL,GAAQ,CACV,CACF,EAAG,CAAC,EAAO,EAwBX,IAAM,EAAiB,CAAA,EAAA,EAAA,OAAA,AAAO,EAAC,IAAM,EAAS,MAAM,CAAC,AAAC,GAAM,EAAE,SAAS,EAAG,CAAC,EAAS,EAEpF,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,UAAU,CAAA,CAAC,MAAM,gBAAgB,YAAY,yCAE7C,EAAU,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,iCAAwB,wBAA4B,KAC7E,EAAQ,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,gCAAwB,IAAe,KAE9D,AAAC,GAAY,GAAmC,IAA1B,CAAV,CAAyB,MAAM,CAOxC,KANF,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,IAAI,CAAA,CAAC,UAAU,uBACd,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,WAAW,CAAA,CAAC,UAAU,iBACrB,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,uDAA8C,0BAC7D,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,sCAA6B,4CAKlD,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,oDACZ,EAAe,GAAG,CAAC,AAAC,IACnB,IAAM,EAAO,IAAgB,EAAE,EAAE,CACjC,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,IAAI,CAAA,CAAY,UAAU,uBACzB,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,WAAW,CAAA,CAAC,UAAU,iBACrB,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,wEAAgE,EAAE,IAAI,GACrF,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,4DAAoD,EAAE,IAAI,GACzE,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,gBACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CACL,QAAQ,UACR,SAAU,EACV,QAAS,KACF,EAAS,EAAE,EAAE,CACpB,WAEC,EAAO,eAAiB,iBAZtB,EAAE,EAAE,CAkBnB,OAIR"}