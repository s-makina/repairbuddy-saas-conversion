module.exports=[94703,a=>{"use strict";var b=a.i(57850),c=a.i(45056),d=a.i(7160);function e({open:a,onClose:e,title:f,children:g,footer:h,position:i="center",variant:j="glass",className:k}){if((0,c.useEffect)(()=>{function b(b){a&&"Escape"===b.key&&e()}return document.addEventListener("keydown",b),()=>document.removeEventListener("keydown",b)},[e,a]),!a)return null;let l="solid"===j?(0,d.cn)("relative w-full max-w-lg overflow-hidden rounded-[var(--rb-radius-lg)]","border border-[var(--rb-border)]","bg-white","shadow-[var(--rb-shadow)]"):(0,d.cn)("relative w-full max-w-lg overflow-hidden rounded-[var(--rb-radius-lg)]","border border-[color:color-mix(in_srgb,var(--rb-border),white_55%)]","bg-white/75 backdrop-blur-xl","shadow-[0_18px_55px_-18px_rgba(0,0,0,0.55)]","ring-1 ring-white/25");return(0,b.jsxs)("div",{className:"top-center"===i?"fixed inset-0 z-50 flex items-start justify-center px-4 pt-8":"fixed inset-0 z-50 flex items-center justify-center px-4",children:[(0,b.jsx)("button",{type:"button",className:(0,d.cn)("absolute inset-0","bg-black/35 backdrop-blur-md","bg-[radial-gradient(900px_600px_at_20%_20%,color-mix(in_srgb,#16a34a,transparent_82%)_0%,transparent_60%),radial-gradient(900px_600px_at_80%_30%,color-mix(in_srgb,var(--rb-blue),transparent_82%)_0%,transparent_60%),radial-gradient(900px_600px_at_50%_85%,color-mix(in_srgb,var(--rb-orange),transparent_85%)_0%,transparent_65%)]"),"aria-label":"Close",onClick:e}),(0,b.jsxs)("div",{role:"dialog","aria-modal":"true",className:(0,d.cn)(l,k),children:["glass"===j?(0,b.jsx)("div",{className:"pointer-events-none absolute inset-0 bg-[radial-gradient(650px_420px_at_20%_15%,color-mix(in_srgb,#16a34a,transparent_88%)_0%,transparent_60%),radial-gradient(650px_420px_at_80%_5%,color-mix(in_srgb,var(--rb-blue),transparent_90%)_0%,transparent_60%)]"}):null,f?(0,b.jsx)("div",{className:(0,d.cn)("relative px-5 py-4","solid"===j?"border-b border-[var(--rb-border)]":"border-b border-[color:color-mix(in_srgb,var(--rb-border),white_60%)]"),children:(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:f})}):null,(0,b.jsx)("div",{className:"relative px-5 py-4",children:g}),h?(0,b.jsx)("div",{className:(0,d.cn)("relative px-5 py-4","solid"===j?"border-t border-[var(--rb-border)]":"border-t border-[color:color-mix(in_srgb,var(--rb-border),white_60%)]"),children:h}):null]})]})}a.s(["Modal",()=>e])},21282,a=>{"use strict";var b=a.i(57850),c=a.i(94703),d=a.i(97867);function e({open:a,title:e,message:f,confirmText:g="Confirm",confirmVariant:h="primary",cancelText:i="Cancel",busy:j=!1,onCancel:k,onConfirm:l}){return(0,b.jsx)(c.Modal,{open:a,onClose:()=>{j||k()},title:e,footer:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,b.jsx)(d.Button,{variant:"outline",onClick:k,disabled:j,children:i}),(0,b.jsx)(d.Button,{variant:h,onClick:l,disabled:j,children:j?"Working...":g})]}),children:(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:f})})}a.s(["ConfirmDialog",()=>e])},4148,a=>{"use strict";function b(a){let b=a.amountCents,c=a.currency?.toUpperCase()??null;if("number"!=typeof b||!Number.isFinite(b))return a.fallback??"—";let d=b/100;if(!c||3!==c.length)return`${d.toFixed(2)}`;try{return new Intl.NumberFormat(void 0,{style:"currency",currency:c,minimumFractionDigits:2,maximumFractionDigits:2}).format(d)}catch{return`${c} ${d.toFixed(2)}`}}a.s(["formatMoney",()=>b])},54804,a=>{"use strict";var b=a.i(57850),c=a.i(648),d=a.i(75385),e=a.i(4600);function f({title:a,description:f,actions:g,filters:h,loading:i,loadingFallback:j,error:k,empty:l,emptyTitle:m="Nothing here yet",emptyDescription:n="No items to display.",children:o}){return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(c.PageHeader,{title:a,description:f,actions:g}),h?(0,b.jsx)(e.Card,{className:"shadow-none",children:(0,b.jsx)(e.CardContent,{className:"pt-5",children:h})}):null,k?(0,b.jsx)(d.Alert,{variant:"danger",title:"Something went wrong",children:k}):null,i?j??(0,b.jsx)("div",{className:"text-sm text-zinc-500",children:"Loading..."}):null,i||k||!l?null:(0,b.jsx)(e.Card,{className:"shadow-none",children:(0,b.jsxs)(e.CardContent,{className:"pt-5",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:m}),(0,b.jsx)("div",{className:"mt-1 text-sm text-zinc-600",children:n})]})}),i||k||l?null:o]})}a.s(["ListPageShell",()=>f])},49032,a=>{"use strict";var b=a.i(57850),c=a.i(45056),d=a.i(93609),e=a.i(91601),f=a.i(75458),g=a.i(97867),h=a.i(4600),i=a.i(21282),j=a.i(54177),k=a.i(46036),l=a.i(54804),m=a.i(34075),n=a.i(4148);function o(){let a=(0,f.useAuth)(),o=(0,d.useRouter)(),p=(0,d.useParams)(),q=p.business??p.tenant,[r,s]=c.default.useState(!0),[t,u]=c.default.useState(null),[v,w]=c.default.useState(null),[x,y]=c.default.useState(!1),[z,A]=c.default.useState([]),[B,C]=c.default.useState([]),[D,E]=c.default.useState(""),[F,G]=c.default.useState(0),[H,I]=c.default.useState(10),[J,K]=c.default.useState(null),[L,M]=c.default.useState(""),[N,O]=c.default.useState(""),[P,Q]=c.default.useState(null),[R,S]=c.default.useState(""),[T,U]=c.default.useState(""),[V,W]=c.default.useState(""),[X,Y]=c.default.useState(!1),[Z,$]=c.default.useState(!1),[_,aa]=c.default.useState(""),[ab,ac]=c.default.useState(!0),[ad,ae]=c.default.useState(!1),[af,ag]=c.default.useState(""),[ah,ai]=c.default.useState(""),[aj,ak]=c.default.useState(null),al=a.can("services.manage");function am(){K(null),M(""),O(""),Q(null),S(""),U(""),W(""),Y(!1),$(!1),aa(""),ac(!0)}async function an(a){if((a.preventDefault(),!x)&&"string"==typeof q&&0!==q.length){if(!al)return void u("Forbidden.");y(!0),u(null),w(null);try{let a=L.trim();if(0===a.length)return void u("Name is required.");let b=_.trim(),c=b.length>0?Math.round(100*Number(b)):null;if(b.length>0&&(!Number.isFinite(Number(b))||null===c))return void u("Base price is invalid.");let d={name:a,description:N.trim().length>0?N.trim():null,service_type_id:"number"==typeof P?P:null,service_code:R.trim().length>0?R.trim():null,time_required:T.trim().length>0?T.trim():null,warranty:V.trim().length>0?V.trim():null,pick_up_delivery_available:!!X,laptop_rental_available:!!Z,base_price_amount_cents:"number"==typeof c?c:null,is_active:!!ab};if(J){let a=await (0,m.apiFetch)(`/api/${q}/app/repairbuddy/services/${J}`,{method:"PATCH",body:d});w("Service updated."),A(b=>b.map(b=>b.id===J?a.service??b:b))}else{let a=await (0,m.apiFetch)(`/api/${q}/app/repairbuddy/services`,{method:"POST",body:d});w("Service created."),a.service&&A(b=>[a.service,...b])}am(),G(0)}catch(a){a instanceof m.ApiError?u(a.message):u(J?"Failed to update service.":"Failed to create service.")}finally{y(!1)}}}async function ao(a){if(!x&&"string"==typeof q&&0!==q.length){var c;if(!al)return void u("Forbidden.");c={title:"Delete service",message:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{children:["You are about to delete ",(0,b.jsx)("span",{className:"font-semibold",children:a.name}),"."]}),(0,b.jsx)("div",{className:"text-sm text-zinc-600",children:"This action cannot be undone."})]}),action:async()=>{y(!0),u(null),w(null);try{await (0,m.apiFetch)(`/api/${q}/app/repairbuddy/services/${a.id}`,{method:"DELETE"}),A(b=>b.filter(b=>b.id!==a.id)),w("Service deleted."),G(0),J===a.id&&am()}catch(a){a instanceof m.ApiError?u(a.message):u("Failed to delete service.")}finally{y(!1)}}},ag(c.title),ai(c.message),ak(()=>c.action),ae(!0)}}c.default.useEffect(()=>{let a=!0;return async function(){try{if(s(!0),u(null),w(null),"string"!=typeof q||0===q.length)throw Error("Business is missing.");let[b,c]=await Promise.all([(0,m.apiFetch)(`/api/${q}/app/repairbuddy/services`),(0,m.apiFetch)(`/api/${q}/app/repairbuddy/service-types?limit=200`)]);if(!a)return;A(Array.isArray(b?.services)?b.services:[]),C(Array.isArray(c?.service_types)?c.service_types:[])}catch(b){if(!a)return;if(b instanceof m.ApiError&&428===b.status&&"string"==typeof q&&q.length>0){let a=`/app/${q}/services`;o.replace(`/app/${q}/branches/select?next=${encodeURIComponent(a)}`);return}u(b instanceof Error?b.message:"Failed to load services.")}finally{if(!a)return;s(!1)}}(),()=>{a=!1}},[o,q]);let ap=c.default.useMemo(()=>{let a=D.trim().toLowerCase();return a?z.filter(b=>`${b.name} ${b.description??""} ${b.id}`.toLowerCase().includes(a)):z},[D,z]),aq=ap.length,ar=c.default.useMemo(()=>{let a=F*H,b=a+H;return ap.slice(a,b)},[ap,F,H]),as=c.default.useMemo(()=>[{id:"name",header:"Service",cell:a=>(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"truncate font-semibold text-[var(--rb-text)]",children:a.name}),(0,b.jsx)("div",{className:"truncate text-xs text-zinc-600",children:a.id})]}),className:"min-w-[220px]"},{id:"desc",header:"Description",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:a.description??"—"}),className:"min-w-[280px]"},{id:"price",header:"Base price",cell:a=>a.base_price?(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)] whitespace-nowrap",children:(0,n.formatMoney)({amountCents:a.base_price.amount_cents,currency:a.base_price.currency})}):(0,b.jsx)("div",{className:"text-sm text-zinc-600",children:"—"}),className:"whitespace-nowrap"},{id:"actions",header:"",cell:a=>al?(0,b.jsx)(k.DropdownMenu,{trigger:({toggle:a})=>(0,b.jsx)(g.Button,{size:"sm",variant:"outline",disabled:x,onClick:a,children:"Actions"}),children:({close:c})=>(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.DropdownMenuItem,{onSelect:()=>{c(),al&&(K(a.id),M(a.name),O(a.description??""),Q("number"==typeof a.service_type_id?a.service_type_id:null),S(a.service_code??""),U(a.time_required??""),W(a.warranty??""),Y(!!a.pick_up_delivery_available),$(!!a.laptop_rental_available),aa(a.base_price?String(a.base_price.amount_cents/100):""),ac(!!a.is_active),u(null),w(null))},children:"Edit"}),(0,b.jsx)(k.DropdownMenuSeparator,{}),(0,b.jsx)(k.DropdownMenuItem,{destructive:!0,onSelect:()=>{c(),ao(a)},children:"Delete"})]})}):null,className:"w-[1%] whitespace-nowrap"}],[x,al]);return(0,b.jsx)(e.RequireAuth,{children:(0,b.jsxs)(l.ListPageShell,{title:"Services",description:"Service catalog used for estimates and jobs.",filters:(0,b.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Search"}),(0,b.jsx)("input",{value:D,onChange:a=>{E(a.target.value),G(0)},placeholder:"Search services...",className:"h-10 w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 text-sm sm:max-w-[420px]"})]}),loading:r,error:t,empty:!r&&!t&&0===ap.length,emptyTitle:"No services",emptyDescription:"Add services to standardize pricing.",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-3",children:[(0,b.jsx)(h.Card,{className:"shadow-none lg:col-span-1",children:(0,b.jsxs)(h.CardContent,{className:"pt-5",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"truncate text-sm font-semibold text-[var(--rb-text)]",children:J?"Edit service":"New service"}),(0,b.jsx)("div",{className:"mt-1 text-sm text-zinc-600",children:"Create or update a service record."})]}),(0,b.jsx)(g.Button,{variant:"outline",size:"sm",onClick:function(){al&&(am(),u(null),w(null))},disabled:!al||x,children:"New"})]}),(0,b.jsxs)("form",{className:"mt-5 space-y-4",onSubmit:an,children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Name"}),(0,b.jsx)("input",{value:L,onChange:a=>M(a.target.value),placeholder:"e.g., Screen replacement",className:"h-10 w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 text-sm",disabled:!al||x})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Description"}),(0,b.jsx)("textarea",{value:N,onChange:a=>O(a.target.value),rows:3,className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",disabled:!al||x})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Service type"}),(0,b.jsxs)("select",{value:"number"==typeof P?String(P):"",onChange:a=>{let b=a.target.value;Q(b?Number(b):null)},className:"h-10 w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 text-sm",disabled:!al||x,children:[(0,b.jsx)("option",{value:"",children:"—"}),B.filter(a=>!!a.is_active||"number"==typeof P&&a.id===P).map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-1",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Service code"}),(0,b.jsx)("input",{value:R,onChange:a=>S(a.target.value),className:"h-10 w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 text-sm",disabled:!al||x})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Base price"}),(0,b.jsx)("input",{value:_,onChange:a=>aa(a.target.value),placeholder:"e.g., 49.99",className:"h-10 w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 text-sm",disabled:!al||x})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-1",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Time required"}),(0,b.jsx)("input",{value:T,onChange:a=>U(a.target.value),placeholder:"e.g., 30 min",className:"h-10 w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 text-sm",disabled:!al||x})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Warranty"}),(0,b.jsx)("input",{value:V,onChange:a=>W(a.target.value),placeholder:"e.g., 90 days",className:"h-10 w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 text-sm",disabled:!al||x})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Status"}),(0,b.jsxs)("label",{className:"flex h-10 items-center gap-2 rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:ab,onChange:a=>ac(a.target.checked),className:"h-4 w-4",disabled:!al||x}),"Active"]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-3",children:[(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:X,onChange:a=>Y(a.target.checked),className:"h-4 w-4",disabled:!al||x}),"Pick-up / delivery available"]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:Z,onChange:a=>$(a.target.checked),className:"h-4 w-4",disabled:!al||x}),"Laptop rental available"]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2 pt-2",children:[(0,b.jsx)(g.Button,{type:"button",variant:"outline",onClick:am,disabled:!al||x,children:"Clear"}),(0,b.jsx)(g.Button,{type:"submit",disabled:!al||x,children:J?"Save":"Create"})]})]}),v?(0,b.jsx)("div",{className:"mt-4 text-sm text-emerald-700",children:v}):null]})}),(0,b.jsx)(h.Card,{className:"shadow-none lg:col-span-2",children:(0,b.jsx)(h.CardContent,{className:"pt-5",children:(0,b.jsx)(j.DataTable,{title:"string"==typeof q?`Services \xb7 ${q}`:"Services",data:ar,loading:r,emptyMessage:"No services.",columns:as,getRowId:a=>a.id,server:{query:D,onQueryChange:a=>{E(a),G(0)},pageIndex:F,onPageIndexChange:G,pageSize:H,onPageSizeChange:a=>{I(a),G(0)},totalRows:aq}})})})]}),(0,b.jsx)(i.ConfirmDialog,{open:ad,title:af,message:ah,confirmText:"Confirm",busy:x,onCancel:()=>ae(!1),onConfirm:function(){(async()=>{aj&&(await aj(),ae(!1))})()}})]})})}a.s(["default",()=>o])}];

//# sourceMappingURL=frontend_src_fa5ac5c7._.js.map