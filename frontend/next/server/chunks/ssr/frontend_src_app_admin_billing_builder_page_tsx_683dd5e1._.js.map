{"version":3,"sources":["../../../../../frontend/src/app/admin/billing/builder/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useMemo, useState } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { RequireAuth } from \"@/components/RequireAuth\";\r\nimport { useDashboardHeader } from \"@/components/DashboardShell\";\r\nimport { Alert } from \"@/components/ui/Alert\";\r\nimport { Badge } from \"@/components/ui/Badge\";\r\nimport { Button } from \"@/components/ui/Button\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/Card\";\r\nimport { ConfirmDialog } from \"@/components/ui/ConfirmDialog\";\r\nimport { DataTable } from \"@/components/ui/DataTable\";\r\nimport { Input } from \"@/components/ui/Input\";\r\nimport { Modal } from \"@/components/ui/Modal\";\r\nimport { apiFetch } from \"@/lib/api\";\r\nimport {\r\n  activateBillingPlanVersion,\r\n  createBillingPlan,\r\n  createBillingPrice,\r\n  getBillingCatalog,\r\n  syncBillingPlanVersionEntitlements,\r\n  validateBillingPlanVersionDraft,\r\n} from \"@/lib/billing\";\r\nimport { useAuth } from \"@/lib/auth\";\r\nimport type { BillingInterval, BillingPlan, BillingPlanVersion, EntitlementDefinition, PlanEntitlement } from \"@/lib/types\";\r\n\r\ntype BuilderEntitlement = {\r\n  entitlement_definition_id: number;\r\n  value_json: unknown;\r\n};\r\n\r\ntype AdminSettingsCurrenciesPayload = {\r\n  currencies: { code: string; symbol: string | null; name: string; is_active: boolean }[];\r\n};\r\n\r\ntype AllowedCurrency = { code: string; name: string; symbol: string };\r\n\r\ntype DraftPriceRow = {\r\n  key: string;\r\n  currency: string;\r\n  interval: string;\r\n  billing_interval_id: number | null;\r\n  amount_cents: number;\r\n  trial_days: number | null;\r\n  is_default: boolean;\r\n};\r\n\r\ntype BuilderDraftStorage = {\r\n  v: 1;\r\n  step: number;\r\n  plan: { name: string; code: string; description: string; active: boolean };\r\n  prices: DraftPriceRow[];\r\n  entitlements: {\r\n    enabled: Record<number, boolean>;\r\n    value: Record<number, unknown>;\r\n    jsonText: Record<number, string>;\r\n  };\r\n};\r\n\r\nconst BUILDER_DRAFT_KEY = \"admin.billing.builder.draft.v1\";\r\n\r\nfunction formatCents(cents: number, currency: string) {\r\n  const c = Number.isFinite(cents) ? cents : 0;\r\n  const cur = (currency || \"\").toUpperCase() || \"XXX\";\r\n  return `${(c / 100).toFixed(2)} ${cur}`;\r\n}\r\n\r\nfunction BuilderStepsSidebar({\r\n  steps,\r\n  step,\r\n  maxStepAllowed,\r\n  onStepChange,\r\n}: {\r\n  steps: string[];\r\n  step: number;\r\n  maxStepAllowed: number;\r\n  onStepChange: (next: number) => void;\r\n}) {\r\n  const stepIndex = Math.max(0, Math.min(step, steps.length - 1));\r\n  const denom = Math.max(1, steps.length - 1);\r\n  const progress = stepIndex / denom;\r\n\r\n  return (\r\n    <Card className=\"shadow-none lg:sticky lg:top-6 lg:self-start\">\r\n      <CardHeader className=\"pb-3\">\r\n        <div className=\"flex items-start justify-between gap-4\">\r\n          <div className=\"min-w-0\">\r\n            <CardTitle className=\"text-base\">Builder steps</CardTitle>\r\n            <CardDescription>Follow the steps to build and create a plan.</CardDescription>\r\n          </div>\r\n          <div className=\"text-right\">\r\n            <div className=\"text-xs text-zinc-500\">\r\n              Step {stepIndex + 1} of {steps.length}\r\n            </div>\r\n            <div className=\"mt-2\">\r\n              <Badge variant={stepIndex === steps.length - 1 ? \"info\" : \"default\"}>{steps[stepIndex] ?? \"\"}</Badge>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </CardHeader>\r\n\r\n      <CardContent className=\"space-y-4\">\r\n        <div className=\"h-2 w-full overflow-hidden rounded-full bg-[var(--rb-border)]\">\r\n          <div\r\n            className=\"h-full bg-[linear-gradient(90deg,var(--rb-blue),var(--rb-orange))]\"\r\n            style={{ width: `${Math.round(progress * 100)}%` }}\r\n          />\r\n        </div>\r\n\r\n        <nav aria-label=\"Builder steps\" className=\"space-y-1\">\r\n          {steps.map((label, idx) => {\r\n            const isCurrent = idx === stepIndex;\r\n            const isCompleted = idx < stepIndex;\r\n            const isAvailable = idx <= maxStepAllowed;\r\n\r\n            return (\r\n              <button\r\n                key={label}\r\n                type=\"button\"\r\n                disabled={!isAvailable}\r\n                onClick={() => {\r\n                  if (!isAvailable) return;\r\n                  onStepChange(idx);\r\n                }}\r\n                className={\r\n                  \"w-full rounded-[var(--rb-radius-md)] border px-3 py-2 text-left transition disabled:cursor-not-allowed disabled:opacity-60 \" +\r\n                  (isCurrent\r\n                    ? \"border-[color:color-mix(in_srgb,var(--rb-blue),white_65%)] bg-[color:color-mix(in_srgb,var(--rb-blue),white_92%)]\"\r\n                    : isCompleted\r\n                      ? \"border-[color:color-mix(in_srgb,var(--rb-blue),white_75%)] bg-white hover:bg-[var(--rb-surface-muted)]\"\r\n                      : \"border-[var(--rb-border)] bg-white hover:bg-[var(--rb-surface-muted)]\")\r\n                }\r\n              >\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div\r\n                    className={\r\n                      \"flex h-7 w-7 shrink-0 items-center justify-center rounded-full border text-xs font-semibold \" +\r\n                      (isCurrent\r\n                        ? \"border-[var(--rb-blue)] bg-[var(--rb-blue)] text-white\"\r\n                        : isCompleted\r\n                          ? \"border-[var(--rb-blue)] bg-[color:color-mix(in_srgb,var(--rb-blue),white_90%)] text-[var(--rb-blue)]\"\r\n                          : \"border-[var(--rb-border)] bg-white text-zinc-600\")\r\n                    }\r\n                  >\r\n                    {isCompleted ? (\r\n                      <svg\r\n                        viewBox=\"0 0 24 24\"\r\n                        className=\"h-4 w-4\"\r\n                        fill=\"none\"\r\n                        stroke=\"currentColor\"\r\n                        strokeWidth={2}\r\n                        strokeLinecap=\"round\"\r\n                        strokeLinejoin=\"round\"\r\n                        aria-hidden=\"true\"\r\n                      >\r\n                        <path d=\"M20 6L9 17l-5-5\" />\r\n                      </svg>\r\n                    ) : (\r\n                      idx + 1\r\n                    )}\r\n                  </div>\r\n                  <div className=\"min-w-0\">\r\n                    <div className=\"text-sm font-semibold text-[var(--rb-text)]\">{label}</div>\r\n                    <div className=\"mt-0.5 text-xs text-zinc-600\">{idx === 0 ? \"Plan details.\" : idx === 1 ? \"Price points.\" : idx === 2 ? \"Entitlements.\" : \"Create & activate.\"}</div>\r\n                  </div>\r\n                </div>\r\n              </button>\r\n            );\r\n          })}\r\n        </nav>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n\r\nexport default function AdminBillingBuilderPage() {\r\n  const dashboardHeader = useDashboardHeader();\r\n  const auth = useAuth();\r\n\r\n  const [step, setStep] = useState<number>(0);\r\n\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [actionError, setActionError] = useState<string | null>(null);\r\n  const [reloadNonce, setReloadNonce] = useState(0);\r\n\r\n  const [definitions, setDefinitions] = useState<EntitlementDefinition[]>([]);\r\n\r\n  const [billingIntervals, setBillingIntervals] = useState<BillingInterval[]>([]);\r\n\r\n  const [allowedCurrencies, setAllowedCurrencies] = useState<AllowedCurrency[]>([]);\r\n\r\n  const [pricesDraft, setPricesDraft] = useState<DraftPriceRow[]>([]);\r\n\r\n  const [createdPlan, setCreatedPlan] = useState<BillingPlan | null>(null);\r\n  const [createdVersion, setCreatedVersion] = useState<BillingPlanVersion | null>(null);\r\n  const [createBusy, setCreateBusy] = useState(false);\r\n  const [createError, setCreateError] = useState<string | null>(null);\r\n\r\n  const canWrite = auth.can(\"admin.billing.write\");\r\n\r\n  const [planEditError, setPlanEditError] = useState<string | null>(null);\r\n  const [planName, setPlanName] = useState(\"\");\r\n  const [planCode, setPlanCode] = useState(\"\");\r\n  const [planDescription, setPlanDescription] = useState(\"\");\r\n  const [planActive, setPlanActive] = useState(true);\r\n\r\n  const [priceModalOpen, setPriceModalOpen] = useState(false);\r\n  const [priceBusy, setPriceBusy] = useState(false);\r\n  const [priceError, setPriceError] = useState<string | null>(null);\r\n  const [priceEditId, setPriceEditId] = useState<string | null>(null);\r\n  const [priceCurrency, setPriceCurrency] = useState(\"EUR\");\r\n  const [priceIntervalId, setPriceIntervalId] = useState<number | null>(null);\r\n  const [priceIntervalCode, setPriceIntervalCode] = useState<string>(\"month\");\r\n  const [priceAmount, setPriceAmount] = useState(\"0.00\");\r\n  const [priceTrialDays, setPriceTrialDays] = useState<string>(\"\");\r\n  const [priceIsDefault, setPriceIsDefault] = useState(false);\r\n\r\n  const [entitlementsBusy, setEntitlementsBusy] = useState(false);\r\n  const [entitlementsStatus, setEntitlementsStatus] = useState<string | null>(null);\r\n  const [entitlementEnabled, setEntitlementEnabled] = useState<Record<number, boolean>>({});\r\n  const [entitlementValue, setEntitlementValue] = useState<Record<number, unknown>>({});\r\n  const [entitlementJsonText, setEntitlementJsonText] = useState<Record<number, string>>({});\r\n  const [entitlementJsonError, setEntitlementJsonError] = useState<Record<number, string | null>>({});\r\n\r\n  const [validateBusy, setValidateBusy] = useState(false);\r\n  const [validateResult, setValidateResult] = useState<{ ok: boolean; errors: string[] } | null>(null);\r\n\r\n  const [activateOpen, setActivateOpen] = useState(false);\r\n  const [activateBusy, setActivateBusy] = useState(false);\r\n  const [activateConfirm, setActivateConfirm] = useState(\"\");\r\n\r\n  const steps = [\"Details\", \"Prices\", \"Entitlements\", \"Review\"];\r\n\r\n  useEffect(() => {\r\n    dashboardHeader.setHeader({\r\n      breadcrumb: \"Admin / Billing\",\r\n      title: \"Plan builder\",\r\n      subtitle: \"Build a plan and create it at the end\",\r\n      actions: (\r\n        <div className=\"flex items-center gap-2\">\r\n          <Link href=\"/admin/billing/plans\">\r\n            <Button variant=\"outline\" size=\"sm\">\r\n              Back to plans\r\n            </Button>\r\n          </Link>\r\n          <Button variant=\"outline\" size=\"sm\" onClick={() => setReloadNonce((v) => v + 1)} disabled={loading}>\r\n            Refresh\r\n          </Button>\r\n        </div>\r\n      ),\r\n    });\r\n\r\n    return () => dashboardHeader.setHeader(null);\r\n  }, [dashboardHeader, loading]);\r\n\r\n  useEffect(() => {\r\n    try {\r\n      const raw = typeof window !== \"undefined\" ? window.localStorage.getItem(BUILDER_DRAFT_KEY) : null;\r\n      if (!raw) return;\r\n      const parsed: unknown = JSON.parse(raw);\r\n      if (!parsed || typeof parsed !== \"object\") return;\r\n\r\n      const d = parsed as Partial<BuilderDraftStorage>;\r\n      if (d.v !== 1) return;\r\n\r\n      const plan = d.plan && typeof d.plan === \"object\" ? (d.plan as BuilderDraftStorage[\"plan\"]) : null;\r\n      if (plan) {\r\n        setPlanName(typeof plan.name === \"string\" ? plan.name : \"\");\r\n        setPlanCode(typeof plan.code === \"string\" ? plan.code : \"\");\r\n        setPlanDescription(typeof plan.description === \"string\" ? plan.description : \"\");\r\n        setPlanActive(typeof plan.active === \"boolean\" ? plan.active : true);\r\n      }\r\n\r\n      if (Array.isArray(d.prices)) {\r\n        setPricesDraft(\r\n          d.prices\r\n            .filter((p) => p && typeof p === \"object\")\r\n            .map((p) => normalizeDraftPriceRow(p as DraftPriceRow)),\r\n        );\r\n      }\r\n\r\n      const ent = d.entitlements && typeof d.entitlements === \"object\" ? (d.entitlements as BuilderDraftStorage[\"entitlements\"]) : null;\r\n      if (ent) {\r\n        setEntitlementEnabled(ent.enabled && typeof ent.enabled === \"object\" ? ent.enabled : {});\r\n        setEntitlementValue(ent.value && typeof ent.value === \"object\" ? ent.value : {});\r\n        setEntitlementJsonText(ent.jsonText && typeof ent.jsonText === \"object\" ? ent.jsonText : {});\r\n      }\r\n\r\n      if (typeof d.step === \"number\" && Number.isFinite(d.step)) {\r\n        setStep(Math.max(0, Math.min(steps.length - 1, Math.trunc(d.step))));\r\n      }\r\n    } catch {\r\n      try {\r\n        window.localStorage.removeItem(BUILDER_DRAFT_KEY);\r\n      } catch {\r\n        void 0;\r\n      }\r\n    }\r\n  }, [steps.length]);\r\n\r\n  useEffect(() => {\r\n    let alive = true;\r\n\r\n    async function load() {\r\n      try {\r\n        setLoading(true);\r\n        setError(null);\r\n        setActionError(null);\r\n        const res = await getBillingCatalog({ includeInactive: true });\r\n        if (!alive) return;\r\n\r\n        const nextDefs = Array.isArray(res.entitlement_definitions) ? res.entitlement_definitions : [];\r\n        setDefinitions(nextDefs);\r\n\r\n        const nextIntervals = Array.isArray((res as { billing_intervals?: BillingInterval[] }).billing_intervals)\r\n          ? ((res as { billing_intervals?: BillingInterval[] }).billing_intervals as BillingInterval[])\r\n          : [];\r\n        setBillingIntervals(nextIntervals);\r\n\r\n        try {\r\n          const settings = await apiFetch<AdminSettingsCurrenciesPayload>(\"/api/admin/settings\");\r\n          if (!alive) return;\r\n\r\n          const nextAllowed = (Array.isArray(settings.currencies) ? settings.currencies : [])\r\n            .filter((c) => Boolean(c?.is_active))\r\n            .map((c) => ({\r\n              code: String(c.code ?? \"\").trim().toUpperCase(),\r\n              name: String(c.name ?? \"\").trim(),\r\n              symbol: String(c.symbol ?? \"\").trim(),\r\n            }))\r\n            .filter((c) => c.code.length === 3)\r\n            .sort((a, b) => a.code.localeCompare(b.code));\r\n\r\n          setAllowedCurrencies(nextAllowed);\r\n        } catch (e) {\r\n          if (!alive) return;\r\n          setAllowedCurrencies([]);\r\n        }\r\n      } catch (e) {\r\n        if (!alive) return;\r\n        setError(e instanceof Error ? e.message : \"Failed to load billing catalog.\");\r\n        setDefinitions([]);\r\n        setBillingIntervals([]);\r\n        setAllowedCurrencies([]);\r\n      } finally {\r\n        if (!alive) return;\r\n        setLoading(false);\r\n      }\r\n    }\r\n\r\n    void load();\r\n\r\n    return () => {\r\n      alive = false;\r\n    };\r\n  }, [reloadNonce]);\r\n\r\n  const allowedCurrencyCodes = useMemo(() => {\r\n    return new Set(allowedCurrencies.map((c) => c.code));\r\n  }, [allowedCurrencies]);\r\n\r\n  const entitlements: PlanEntitlement[] = useMemo(() => [], []);\r\n  const entitlementsByDefId = useMemo(() => {\r\n    const map: Record<number, PlanEntitlement> = {};\r\n    void entitlements;\r\n    return map;\r\n  }, [entitlements]);\r\n\r\n  const allEntitlementDefinitions = useMemo(() => {\r\n    return (Array.isArray(definitions) ? definitions : []).slice().sort((a, b) => (a.id ?? 0) - (b.id ?? 0));\r\n  }, [definitions]);\r\n\r\n  useEffect(() => {\r\n    const nextEnabled: Record<number, boolean> = {};\r\n    const nextValue: Record<number, unknown> = {};\r\n    const nextJsonText: Record<number, string> = {};\r\n    const nextJsonError: Record<number, string | null> = {};\r\n\r\n    for (const def of allEntitlementDefinitions) {\r\n      const row = entitlementsByDefId[def.id] ?? null;\r\n      nextEnabled[def.id] = Boolean(row);\r\n      nextValue[def.id] = row ? row.value_json : null;\r\n\r\n      const type = String(def.value_type ?? \"json\");\r\n      if (type === \"boolean\" && row) {\r\n        nextValue[def.id] = true;\r\n      }\r\n      if (type !== \"boolean\" && type !== \"integer\") {\r\n        nextJsonText[def.id] = JSON.stringify(row ? row.value_json ?? null : null, null, 2);\r\n        nextJsonError[def.id] = null;\r\n      }\r\n    }\r\n\r\n    setEntitlementEnabled(nextEnabled);\r\n    setEntitlementValue(nextValue);\r\n    setEntitlementJsonText(nextJsonText);\r\n    setEntitlementJsonError(nextJsonError);\r\n  }, [allEntitlementDefinitions, entitlementsByDefId]);\r\n\r\n  const summary = useMemo(() => {\r\n    const enabledEnts: BuilderEntitlement[] = [];\r\n    for (const def of allEntitlementDefinitions) {\r\n      const enabled = Boolean(entitlementEnabled[def.id]);\r\n      if (!enabled) continue;\r\n      const type = String(def.value_type ?? \"json\");\r\n      enabledEnts.push({ entitlement_definition_id: def.id, value_json: type === \"boolean\" ? true : (entitlementValue[def.id] ?? null) });\r\n    }\r\n\r\n    return {\r\n      plan: {\r\n        name: planName.trim(),\r\n        code: planCode.trim() || null,\r\n        description: planDescription.trim() || null,\r\n        is_active: Boolean(planActive),\r\n      },\r\n      prices: pricesDraft.map((p) => ({\r\n        currency: String(p.currency).toUpperCase(),\r\n        interval: String(p.interval).toLowerCase(),\r\n        amount_cents: p.amount_cents,\r\n        trial_days: p.trial_days,\r\n        is_default: Boolean(p.is_default),\r\n      })),\r\n      entitlements: enabledEnts,\r\n    };\r\n  }, [allEntitlementDefinitions, entitlementEnabled, entitlementValue, planActive, planCode, planDescription, planName, pricesDraft]);\r\n\r\n  const pricesValidation = useMemo(() => {\r\n    const normalized = (Array.isArray(pricesDraft) ? pricesDraft : []).map((p) => ({\r\n      ...p,\r\n      currency: String(p.currency).trim().toUpperCase(),\r\n      interval: String(p.interval || \"\").trim().toLowerCase() || \"month\",\r\n      billing_interval_id: typeof p.billing_interval_id === \"number\" && Number.isFinite(p.billing_interval_id) ? p.billing_interval_id : null,\r\n      amount_cents: Number.isFinite(p.amount_cents) ? Math.max(0, Math.trunc(p.amount_cents)) : 0,\r\n    }));\r\n\r\n    if (normalized.length === 0) {\r\n      return { ok: false, message: \"Add at least one price.\" };\r\n    }\r\n\r\n    const pairCounts: Record<string, { total: number; defaults: number }> = {};\r\n    for (const p of normalized) {\r\n      const key = `${p.currency}|${p.interval}`;\r\n      if (!pairCounts[key]) pairCounts[key] = { total: 0, defaults: 0 };\r\n      pairCounts[key].total += 1;\r\n      if (p.is_default) pairCounts[key].defaults += 1;\r\n    }\r\n\r\n    for (const [pair, info] of Object.entries(pairCounts)) {\r\n      if (info.defaults === 0) return { ok: false, message: `Set a default price for ${pair}.` };\r\n      if (info.defaults > 1) return { ok: false, message: `Only one default price allowed for ${pair}.` };\r\n    }\r\n\r\n    return { ok: true, message: null as string | null };\r\n  }, [pricesDraft]);\r\n\r\n  const maxStepAllowed = useMemo(() => {\r\n    if (planName.trim().length === 0) return 0;\r\n    if (!pricesValidation.ok) return 1;\r\n    return steps.length - 1;\r\n  }, [planName, pricesValidation.ok, steps.length]);\r\n\r\n  useEffect(() => {\r\n    setStep((s) => Math.min(s, maxStepAllowed));\r\n  }, [maxStepAllowed]);\r\n\r\n  useEffect(() => {\r\n    if (createdPlan) return;\r\n    try {\r\n      const payload: BuilderDraftStorage = {\r\n        v: 1,\r\n        step,\r\n        plan: {\r\n          name: planName,\r\n          code: planCode,\r\n          description: planDescription,\r\n          active: Boolean(planActive),\r\n        },\r\n        prices: Array.isArray(pricesDraft) ? pricesDraft : [],\r\n        entitlements: {\r\n          enabled: entitlementEnabled,\r\n          value: entitlementValue,\r\n          jsonText: entitlementJsonText,\r\n        },\r\n      };\r\n      window.localStorage.setItem(BUILDER_DRAFT_KEY, JSON.stringify(payload));\r\n    } catch {\r\n      void 0;\r\n    }\r\n  }, [createdPlan, entitlementEnabled, entitlementJsonText, entitlementValue, planActive, planCode, planDescription, planName, pricesDraft, step]);\r\n\r\n  async function goNext() {\r\n    if (step === 2 && canWrite) {\r\n      const ok = await onSaveEntitlements();\r\n      if (!ok) return;\r\n    }\r\n\r\n    setStep((s) => Math.min(s + 1, maxStepAllowed));\r\n  }\r\n\r\n  function goBack() {\r\n    setStep((s) => Math.max(s - 1, 0));\r\n  }\r\n\r\n  function resetPriceForm() {\r\n    setPriceError(null);\r\n    setPriceEditId(null);\r\n    setPriceCurrency(allowedCurrencies[0]?.code ?? \"EUR\");\r\n    setPriceIntervalId(null);\r\n    setPriceIntervalCode(\"month\");\r\n    setPriceAmount(\"0.00\");\r\n    setPriceTrialDays(\"\");\r\n    setPriceIsDefault(true);\r\n  }\r\n\r\n  function pairKey(currency: string, interval: string) {\r\n    return `${String(currency).trim().toUpperCase()}|${String(interval || \"\").trim().toLowerCase() || \"month\"}`;\r\n  }\r\n\r\n  function shouldSuggestDefault(args: { currency: string; interval: string; ignoreKey?: string | null }) {\r\n    const key = pairKey(args.currency, args.interval);\r\n    const rows = (Array.isArray(pricesDraft) ? pricesDraft : [])\r\n      .map(normalizeDraftPriceRow)\r\n      .filter((p) => (args.ignoreKey ? p.key !== args.ignoreKey : true))\r\n      .filter((p) => pairKey(p.currency, p.interval) === key);\r\n\r\n    if (rows.length === 0) return true;\r\n    const hasDefault = rows.some((p) => Boolean(p.is_default));\r\n    return !hasDefault;\r\n  }\r\n\r\n  function parseAmountCents(input: string): number {\r\n    const normalized = input.trim().replace(\",\", \".\");\r\n    const n = Number.parseFloat(normalized);\r\n    if (!Number.isFinite(n) || n < 0) return 0;\r\n    return Math.round(n * 100);\r\n  }\r\n\r\n  function normalizeDraftPriceRow(p: DraftPriceRow): DraftPriceRow {\r\n    return {\r\n      ...p,\r\n      currency: String(p.currency).trim().toUpperCase(),\r\n      interval: String(p.interval || \"\").trim().toLowerCase() || \"month\",\r\n      billing_interval_id: typeof p.billing_interval_id === \"number\" && Number.isFinite(p.billing_interval_id) ? p.billing_interval_id : null,\r\n      amount_cents: Number.isFinite(p.amount_cents) ? Math.max(0, Math.trunc(p.amount_cents)) : 0,\r\n      trial_days: typeof p.trial_days === \"number\" && Number.isFinite(p.trial_days) ? Math.max(0, Math.trunc(p.trial_days)) : null,\r\n      is_default: Boolean(p.is_default),\r\n    };\r\n  }\r\n\r\n  function enforceSingleDefault(next: DraftPriceRow[]) {\r\n    const out = next.slice();\r\n    const counts: Record<string, number> = {};\r\n    for (const p of out) {\r\n      if (!p.is_default) continue;\r\n      const key = `${p.currency}|${p.interval}`;\r\n      counts[key] = (counts[key] ?? 0) + 1;\r\n      if (counts[key] > 1) {\r\n        p.is_default = false;\r\n      }\r\n    }\r\n    return out;\r\n  }\r\n\r\n  async function onCreatePlanAtEnd(): Promise<BillingPlanVersion | null> {\r\n    if (!canWrite) return null;\r\n    if (createBusy) return null;\r\n\r\n    const nextName = planName.trim();\r\n    if (!nextName) {\r\n      setPlanEditError(\"Name is required.\");\r\n      setStep(0);\r\n      return null;\r\n    }\r\n\r\n    if (!pricesValidation.ok) {\r\n      setActionError(pricesValidation.message ?? \"Invalid prices.\");\r\n      setStep(1);\r\n      return null;\r\n    }\r\n\r\n    setCreateBusy(true);\r\n    setCreateError(null);\r\n    setActionError(null);\r\n\r\n    try {\r\n      const res = await createBillingPlan({\r\n        name: nextName,\r\n        code: planCode.trim() || undefined,\r\n        description: planDescription.trim() || undefined,\r\n        isActive: planActive,\r\n      });\r\n\r\n      const plan = res.plan;\r\n      const drafts = (Array.isArray(plan.versions) ? plan.versions : [])\r\n        .filter((v) => String(v.status).toLowerCase() === \"draft\")\r\n        .slice()\r\n        .sort((a, b) => (b.version ?? 0) - (a.version ?? 0));\r\n      const draft = (drafts[0] as BillingPlanVersion | undefined) ?? null;\r\n      if (!draft) {\r\n        throw new Error(\"Plan created but no draft version was returned.\");\r\n      }\r\n\r\n      setCreatedPlan(plan);\r\n      setCreatedVersion(draft);\r\n\r\n      let currentVersion: BillingPlanVersion = draft;\r\n\r\n      const normalizedPrices = enforceSingleDefault(pricesDraft.map(normalizeDraftPriceRow));\r\n\r\n      for (const p of normalizedPrices) {\r\n        const priceRes = await createBillingPrice({\r\n          versionId: currentVersion.id,\r\n          currency: p.currency,\r\n          interval: p.interval,\r\n          billingIntervalId: p.billing_interval_id,\r\n          amountCents: p.amount_cents,\r\n          trialDays: p.trial_days,\r\n          isDefault: p.is_default,\r\n        });\r\n        currentVersion = priceRes.version;\r\n        setCreatedVersion(priceRes.version);\r\n      }\r\n\r\n      const payload: Array<{ entitlement_definition_id: number; value_json: unknown }> = [];\r\n      for (const def of allEntitlementDefinitions) {\r\n        const enabled = Boolean(entitlementEnabled[def.id]);\r\n        if (!enabled) continue;\r\n\r\n        const type = String(def.value_type ?? \"json\");\r\n        if (type === \"boolean\") {\r\n          payload.push({ entitlement_definition_id: def.id, value_json: true });\r\n          continue;\r\n        }\r\n        if (type !== \"boolean\" && type !== \"integer\") {\r\n          const raw = entitlementJsonText[def.id] ?? \"\";\r\n          const parsed = raw.trim() === \"\" ? {} : JSON.parse(raw);\r\n          payload.push({ entitlement_definition_id: def.id, value_json: parsed });\r\n          continue;\r\n        }\r\n\r\n        const n = entitlementValue[def.id];\r\n        const intValue = typeof n === \"number\" && Number.isFinite(n) ? Math.trunc(n) : 0;\r\n        payload.push({ entitlement_definition_id: def.id, value_json: intValue });\r\n      }\r\n\r\n      const entRes = await syncBillingPlanVersionEntitlements({ versionId: currentVersion.id, entitlements: payload });\r\n      setCreatedVersion(entRes.version);\r\n      setValidateResult(null);\r\n      setReloadNonce((v) => v + 1);\r\n\r\n      try {\r\n        window.localStorage.removeItem(BUILDER_DRAFT_KEY);\r\n      } catch {\r\n        void 0;\r\n      }\r\n\r\n      return entRes.version;\r\n    } catch (e) {\r\n      setCreateError(e instanceof Error ? e.message : \"Failed to create plan.\");\r\n      return null;\r\n    } finally {\r\n      setCreateBusy(false);\r\n    }\r\n  }\r\n\r\n  async function onSavePrice() {\r\n    if (!canWrite) return;\r\n    if (priceBusy) return;\r\n\r\n    setPriceBusy(true);\r\n    setPriceError(null);\r\n    setActionError(null);\r\n\r\n    try {\r\n      const currency = priceCurrency.trim().toUpperCase();\r\n      if (currency.length !== 3) {\r\n        setPriceError(\"Currency is required.\");\r\n        return;\r\n      }\r\n\r\n      if (allowedCurrencyCodes.size > 0 && !allowedCurrencyCodes.has(currency)) {\r\n        setPriceError(\"Currency must be one of the allowed currencies.\");\r\n        return;\r\n      }\r\n\r\n      const selectedIntervalId = typeof priceIntervalId === \"number\" && Number.isFinite(priceIntervalId) ? priceIntervalId : null;\r\n      const selectedIntervalCode = String(priceIntervalCode || \"\").trim().toLowerCase();\r\n\r\n      if (!selectedIntervalId && !selectedIntervalCode) {\r\n        setPriceError(\"Interval is required.\");\r\n        return;\r\n      }\r\n\r\n      const amountCents = parseAmountCents(priceAmount);\r\n      const trialDaysRaw = priceTrialDays.trim() === \"\" ? null : Number(priceTrialDays);\r\n      const trialDays = typeof trialDaysRaw === \"number\" && Number.isFinite(trialDaysRaw) ? Math.max(0, Math.trunc(trialDaysRaw)) : null;\r\n\r\n      const suggestedDefault = shouldSuggestDefault({ currency, interval: selectedIntervalCode || \"month\", ignoreKey: priceEditId });\r\n      const base: DraftPriceRow = {\r\n        key: priceEditId ?? `${Date.now()}_${Math.random().toString(16).slice(2)}`,\r\n        currency,\r\n        interval: selectedIntervalCode || \"month\",\r\n        billing_interval_id: selectedIntervalId,\r\n        amount_cents: amountCents,\r\n        trial_days: trialDays,\r\n        is_default: Boolean(priceIsDefault || suggestedDefault),\r\n      };\r\n\r\n      setPricesDraft((prev) => {\r\n        const normalized = normalizeDraftPriceRow(base);\r\n        const next = prev.some((p) => p.key === normalized.key)\r\n          ? prev.map((p) => (p.key === normalized.key ? normalized : p))\r\n          : [...prev, normalized];\r\n\r\n        if (normalized.is_default) {\r\n          return next.map((p) => {\r\n            if (p.key === normalized.key) return p;\r\n            if (`${p.currency}|${p.interval}` === `${normalized.currency}|${normalized.interval}`) {\r\n              return { ...p, is_default: false };\r\n            }\r\n            return p;\r\n          });\r\n        }\r\n\r\n        return next;\r\n      });\r\n\r\n      setPriceModalOpen(false);\r\n    } catch (e) {\r\n      setPriceError(e instanceof Error ? e.message : \"Failed to save price.\");\r\n    } finally {\r\n      setPriceBusy(false);\r\n    }\r\n  }\r\n\r\n  function onDeletePrice(key: string) {\r\n    setPricesDraft((prev) => prev.filter((p) => p.key !== key));\r\n  }\r\n\r\n  function onEditPrice(p: DraftPriceRow) {\r\n    resetPriceForm();\r\n    setPriceEditId(p.key);\r\n    setPriceCurrency(String(p.currency).toUpperCase());\r\n    setPriceIntervalId(typeof p.billing_interval_id === \"number\" ? p.billing_interval_id : null);\r\n    setPriceIntervalCode(String(p.interval || \"\").toLowerCase() || \"month\");\r\n    setPriceAmount(((p.amount_cents ?? 0) / 100).toFixed(2));\r\n    setPriceTrialDays(typeof p.trial_days === \"number\" ? String(p.trial_days) : \"\");\r\n    setPriceIsDefault(Boolean(p.is_default));\r\n    setPriceModalOpen(true);\r\n  }\r\n\r\n  async function onSaveEntitlements(): Promise<boolean> {\r\n    if (!canWrite) return true;\r\n    if (entitlementsBusy) return false;\r\n\r\n    setEntitlementsBusy(true);\r\n    setActionError(null);\r\n    setEntitlementsStatus(null);\r\n\r\n    try {\r\n      if (!createdVersion) {\r\n        setEntitlementsStatus(\"Saved locally. These entitlements will be applied when you create the plan.\");\r\n        return true;\r\n      }\r\n\r\n      const payload: Array<{ entitlement_definition_id: number; value_json: unknown }> = [];\r\n\r\n      for (const def of allEntitlementDefinitions) {\r\n        const enabled = Boolean(entitlementEnabled[def.id]);\r\n        if (!enabled) continue;\r\n\r\n        const type = String(def.value_type ?? \"json\");\r\n        if (type === \"boolean\") {\r\n          payload.push({ entitlement_definition_id: def.id, value_json: true });\r\n          continue;\r\n        }\r\n        if (type !== \"boolean\" && type !== \"integer\") {\r\n          const raw = entitlementJsonText[def.id] ?? \"\";\r\n          try {\r\n            const parsed = raw.trim() === \"\" ? {} : JSON.parse(raw);\r\n            payload.push({ entitlement_definition_id: def.id, value_json: parsed });\r\n            setEntitlementJsonError((prev) => ({ ...prev, [def.id]: null }));\r\n          } catch {\r\n            setEntitlementJsonError((prev) => ({ ...prev, [def.id]: \"Invalid JSON.\" }));\r\n            return false;\r\n          }\r\n          continue;\r\n        }\r\n\r\n        const n = entitlementValue[def.id];\r\n        const intValue = typeof n === \"number\" && Number.isFinite(n) ? Math.trunc(n) : 0;\r\n        payload.push({ entitlement_definition_id: def.id, value_json: intValue });\r\n      }\r\n\r\n      const res = await syncBillingPlanVersionEntitlements({ versionId: createdVersion.id, entitlements: payload });\r\n      setCreatedVersion(res.version);\r\n      setEntitlementsStatus(\"Entitlements saved.\");\r\n      setValidateResult(null);\r\n      return true;\r\n    } catch (e) {\r\n      setActionError(e instanceof Error ? e.message : \"Failed to save entitlements.\");\r\n      return false;\r\n    } finally {\r\n      setEntitlementsBusy(false);\r\n    }\r\n  }\r\n\r\n  async function onValidate(version?: BillingPlanVersion | null): Promise<{ ok: boolean; errors: string[] } | null> {\r\n    const target = version ?? createdVersion;\r\n    if (!target) return null;\r\n\r\n    setValidateBusy(true);\r\n    setValidateResult(null);\r\n    setActionError(null);\r\n    try {\r\n      const res = await validateBillingPlanVersionDraft({ versionId: target.id });\r\n      const ok = \"status\" in res && res.status === \"ok\";\r\n      const errors = \"errors\" in res && Array.isArray(res.errors) ? res.errors.map(String) : [];\r\n      const next = { ok, errors };\r\n      setValidateResult(next);\r\n      return next;\r\n    } catch (e) {\r\n      setActionError(e instanceof Error ? e.message : \"Failed to validate.\");\r\n      return null;\r\n    } finally {\r\n      setValidateBusy(false);\r\n    }\r\n  }\r\n\r\n  async function onSaveAndValidate() {\r\n    if (!canWrite) return;\r\n    if (createBusy || validateBusy) return;\r\n\r\n    let version = createdVersion;\r\n    if (!version) {\r\n      version = await onCreatePlanAtEnd();\r\n    }\r\n    if (!version) return;\r\n\r\n    await onValidate(version);\r\n  }\r\n\r\n  async function onActivate() {\r\n    if (!createdVersion) return;\r\n    if (!canWrite) return;\r\n    if (activateBusy) return;\r\n    setActivateBusy(true);\r\n    setActionError(null);\r\n    try {\r\n      const res = await activateBillingPlanVersion({ versionId: createdVersion.id, confirm: activateConfirm.trim() });\r\n      setCreatedVersion(res.version);\r\n      setActivateOpen(false);\r\n      setActivateConfirm(\"\");\r\n      setReloadNonce((v) => v + 1);\r\n      setValidateResult(null);\r\n    } catch (e) {\r\n      setActionError(e instanceof Error ? e.message : \"Failed to activate.\");\r\n    } finally {\r\n      setActivateBusy(false);\r\n    }\r\n  }\r\n\r\n  const isActiveVersion = Boolean(createdVersion && String(createdVersion.status).toLowerCase() === \"active\");\r\n  const saveValidateBusy = Boolean(createBusy || validateBusy);\r\n\r\n  return (\r\n    <RequireAuth requiredPermission=\"admin.billing.read\">\r\n      <div className=\"space-y-6\">\r\n        {error ? (\r\n          <Alert variant=\"danger\" title=\"Could not load billing catalog\">\r\n            {error}\r\n          </Alert>\r\n        ) : null}\r\n\r\n        {actionError ? (\r\n          <Alert variant=\"danger\" title=\"Action failed\">\r\n            {actionError}\r\n          </Alert>\r\n        ) : null}\r\n\r\n        <div className=\"grid gap-6 lg:grid-cols-[260px_1fr]\">\r\n          <BuilderStepsSidebar steps={steps} step={step} maxStepAllowed={maxStepAllowed} onStepChange={setStep} />\r\n\r\n          <div className=\"space-y-6\">\r\n\r\n            {step === 0 ? (\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle>Plan details</CardTitle>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                  <div className=\"rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-[var(--rb-surface-muted)] p-3 text-sm text-zinc-700\">\r\n                    Configure the plan here and click Next. The plan will be created on the Review step.\r\n                  </div>\r\n\r\n                  {planEditError ? (\r\n                    <Alert variant=\"danger\" title=\"Cannot save plan\">\r\n                      {planEditError}\r\n                    </Alert>\r\n                  ) : null}\r\n\r\n                  <div className=\"space-y-1\">\r\n                    <label className=\"text-sm font-medium\">Name</label>\r\n                    <Input value={planName} onChange={(e) => setPlanName(e.target.value)} disabled={loading || createBusy} />\r\n                  </div>\r\n                  <div className=\"space-y-1\">\r\n                    <label className=\"text-sm font-medium\">Code</label>\r\n                    <Input value={planCode} onChange={(e) => setPlanCode(e.target.value)} disabled={loading || createBusy} />\r\n                    <div className=\"text-xs text-zinc-500\">Leave blank to auto-generate from name.</div>\r\n                  </div>\r\n                  <div className=\"space-y-1\">\r\n                    <label className=\"text-sm font-medium\">Description</label>\r\n                    <textarea\r\n                      className=\"min-h-[90px] w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm\"\r\n                      value={planDescription}\r\n                      onChange={(e) => setPlanDescription(e.target.value)}\r\n                      disabled={loading || createBusy}\r\n                    />\r\n                  </div>\r\n                  <label className=\"flex items-center gap-2 text-sm\">\r\n                    <input type=\"checkbox\" checked={planActive} onChange={(e) => setPlanActive(e.target.checked)} disabled={loading || createBusy} />\r\n                    Active\r\n                  </label>\r\n\r\n                  <div className=\"text-xs text-zinc-500\">\r\n                    Need to edit existing plans? Use <Link className=\"underline\" href=\"/admin/billing/plans\">Billing plans</Link>.\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            ) : null}\r\n\r\n        {step === 1 ? (\r\n          <Card>\r\n            <CardHeader className=\"flex flex-row items-start justify-between gap-4\">\r\n              <div className=\"min-w-0\">\r\n                <CardTitle>Prices</CardTitle>\r\n                <div className=\"mt-1 text-sm text-zinc-600\">Configure price points per currency + interval, including defaults.</div>\r\n              </div>\r\n              {canWrite ? (\r\n                <Button\r\n                  variant=\"secondary\"\r\n                  size=\"sm\"\r\n                  onClick={() => {\r\n                    resetPriceForm();\r\n                    setPriceModalOpen(true);\r\n                  }}\r\n                  disabled={loading || priceBusy}\r\n                >\r\n                  Add price\r\n                </Button>\r\n              ) : null}\r\n            </CardHeader>\r\n            <CardContent>\r\n              {pricesValidation.message ? <Alert variant=\"warning\" title=\"Prices\">{pricesValidation.message}</Alert> : null}\r\n              <DataTable\r\n                title=\"Price points\"\r\n                data={pricesDraft}\r\n                loading={loading}\r\n                emptyMessage=\"No prices configured.\"\r\n                getRowId={(p) => p.key}\r\n                columns={[\r\n                  {\r\n                    id: \"pair\",\r\n                    header: \"Currency / interval\",\r\n                    cell: (p) => (\r\n                      <div className=\"text-sm text-zinc-800\">\r\n                        {String(p.currency).toUpperCase()} / {String(p.interval).toLowerCase()}\r\n                      </div>\r\n                    ),\r\n                    className: \"whitespace-nowrap\",\r\n                  },\r\n                  {\r\n                    id: \"amount\",\r\n                    header: \"Amount\",\r\n                    cell: (p) => <div className=\"text-sm text-zinc-700\">{formatCents(p.amount_cents ?? 0, p.currency)}</div>,\r\n                    className: \"whitespace-nowrap\",\r\n                  },\r\n                  {\r\n                    id: \"trial\",\r\n                    header: \"Trial\",\r\n                    cell: (p) => <div className=\"text-sm text-zinc-700\">{typeof p.trial_days === \"number\" ? `${p.trial_days} days` : \"—\"}</div>,\r\n                    className: \"whitespace-nowrap\",\r\n                  },\r\n                  {\r\n                    id: \"default\",\r\n                    header: \"Default\",\r\n                    cell: (p) => (p.is_default ? <Badge variant=\"success\">default</Badge> : <Badge variant=\"default\">—</Badge>),\r\n                    className: \"whitespace-nowrap\",\r\n                  },\r\n                  {\r\n                    id: \"actions\",\r\n                    header: \"\",\r\n                    cell: (p) =>\r\n                      canWrite ? (\r\n                        <div className=\"flex items-center justify-end gap-2\">\r\n                          <Button variant=\"outline\" size=\"sm\" onClick={() => onEditPrice(p)} disabled={priceBusy}>\r\n                            Edit\r\n                          </Button>\r\n                          <Button variant=\"outline\" size=\"sm\" onClick={() => onDeletePrice(p.key)} disabled={priceBusy}>\r\n                            Delete\r\n                          </Button>\r\n                        </div>\r\n                      ) : null,\r\n                    className: \"whitespace-nowrap\",\r\n                  },\r\n                ]}\r\n              />\r\n            </CardContent>\r\n          </Card>\r\n        ) : null}\r\n\r\n        {step === 2 ? (\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle>Entitlements</CardTitle>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-3\">\r\n              <div className=\"flex items-center justify-between gap-3\">\r\n                <div className=\"text-sm text-zinc-600\">Toggle features/limits and configure values per type.</div>\r\n                {canWrite ? (\r\n                  <Button variant=\"secondary\" size=\"sm\" onClick={() => void onSaveEntitlements()} disabled={entitlementsBusy}>\r\n                    {entitlementsBusy ? \"Saving…\" : \"Save entitlements\"}\r\n                  </Button>\r\n                ) : null}\r\n              </div>\r\n\r\n              {entitlementsStatus ? <Alert variant=\"success\" title=\"Entitlements\">{entitlementsStatus}</Alert> : null}\r\n\r\n              {allEntitlementDefinitions.length === 0 ? <Alert variant=\"warning\" title=\"No entitlements\">Create entitlement definitions first.</Alert> : null}\r\n\r\n              {allEntitlementDefinitions.map((def) => {\r\n                const enabled = Boolean(entitlementEnabled[def.id]);\r\n                const value = entitlementValue[def.id];\r\n                const type = String(def.value_type ?? \"json\");\r\n                const jsonError = entitlementJsonError[def.id] ?? null;\r\n\r\n                return (\r\n                  <div\r\n                    key={def.id}\r\n                    className={`rounded-[var(--rb-radius-sm)] border p-3 ${\r\n                      enabled\r\n                        ? \"border-[color:color-mix(in_srgb,var(--rb-blue),white_55%)] bg-white\"\r\n                        : \"border-[var(--rb-border)] bg-[var(--rb-surface-muted)]\"\r\n                    }`}\r\n                  >\r\n                    <div className=\"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between\">\r\n                      <div className=\"min-w-0\">\r\n                        <div className=\"flex flex-wrap items-center gap-2\">\r\n                          <div className=\"text-sm font-semibold text-zinc-900\">{def.name}</div>\r\n                          <Badge variant={enabled ? \"success\" : \"default\"}>{enabled ? \"Enabled\" : \"Disabled\"}</Badge>\r\n                          <Badge variant=\"info\">{type}</Badge>\r\n                          {def.is_premium ? <Badge variant=\"warning\">premium</Badge> : null}\r\n                        </div>\r\n                        <div className=\"mt-1 text-xs text-zinc-500 font-mono\">{def.code}</div>\r\n                        {def.description ? <div className=\"mt-2 text-sm text-zinc-600\">{def.description}</div> : null}\r\n                      </div>\r\n\r\n                      <div className=\"flex items-center justify-between gap-3 sm:flex-col sm:items-end\">\r\n                        <label className=\"flex items-center gap-2 text-sm font-medium\">\r\n                          <input\r\n                            type=\"checkbox\"\r\n                            checked={enabled}\r\n                            disabled={!canWrite}\r\n                            onChange={(e) => {\r\n                              const checked = e.target.checked;\r\n                              setEntitlementEnabled((prev) => ({ ...prev, [def.id]: checked }));\r\n                              if (checked && type === \"boolean\") {\r\n                                setEntitlementValue((prev) => ({ ...prev, [def.id]: true }));\r\n                              }\r\n                            }}\r\n                          />\r\n                          Enable\r\n                        </label>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {enabled ? (\r\n                      <div className=\"mt-3 rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white p-3\">\r\n                        {type === \"boolean\" ? (\r\n                          <div className=\"text-sm text-zinc-700\">Feature enabled.</div>\r\n                        ) : type === \"integer\" ? (\r\n                          <div className=\"space-y-1\">\r\n                            <label className=\"text-sm font-medium\">Limit</label>\r\n                            <Input\r\n                              type=\"number\"\r\n                              value={value === null || typeof value === \"undefined\" ? \"\" : String(value)}\r\n                              disabled={!canWrite}\r\n                              onChange={(e) => {\r\n                                const raw = e.target.value;\r\n                                if (raw.trim() === \"\") {\r\n                                  setEntitlementValue((prev) => ({ ...prev, [def.id]: null }));\r\n                                  return;\r\n                                }\r\n                                const n = Number(raw);\r\n                                if (!Number.isFinite(n)) return;\r\n                                setEntitlementValue((prev) => ({ ...prev, [def.id]: Math.trunc(n) }));\r\n                              }}\r\n                            />\r\n                            <div className=\"text-xs text-zinc-500\">Use a whole number (e.g. 10, 100, 1000).</div>\r\n                          </div>\r\n                        ) : (\r\n                          <div className=\"space-y-1\">\r\n                            <label className=\"text-sm font-medium\">Value (JSON)</label>\r\n                            <textarea\r\n                              className=\"min-h-[110px] w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 font-mono text-sm\"\r\n                              value={entitlementJsonText[def.id] ?? \"\"}\r\n                              disabled={!canWrite}\r\n                              onChange={(e) => {\r\n                                setEntitlementJsonText((prev) => ({ ...prev, [def.id]: e.target.value }));\r\n                                setEntitlementJsonError((prev) => ({ ...prev, [def.id]: null }));\r\n                              }}\r\n                            />\r\n                            {jsonError ? <div className=\"text-xs text-red-600\">{jsonError}</div> : null}\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    ) : null}\r\n                  </div>\r\n                );\r\n              })}\r\n            </CardContent>\r\n          </Card>\r\n        ) : null}\r\n\r\n        {step === 3 ? (\r\n          <Card>\r\n            <CardHeader className=\"flex flex-row items-start justify-between gap-4\">\r\n              <div className=\"min-w-0\">\r\n                <CardTitle>Review</CardTitle>\r\n                <div className=\"mt-1 text-sm text-zinc-600\">Create the plan from your configuration, then validate/activate the draft.</div>\r\n              </div>\r\n              <div className=\"flex items-center gap-2\">\r\n                <Link href=\"/admin/billing/plans\">\r\n                  <Button variant=\"outline\" size=\"sm\">\r\n                    Back to plans\r\n                  </Button>\r\n                </Link>\r\n                <Button\r\n                  variant=\"secondary\"\r\n                  size=\"sm\"\r\n                  onClick={() => setActivateOpen(true)}\r\n                  disabled={!canWrite || activateBusy || isActiveVersion || !validateResult?.ok}\r\n                >\r\n                  {isActiveVersion ? \"Activated\" : \"Activate\"}\r\n                </Button>\r\n              </div>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-4\">\r\n              {createError ? <Alert variant=\"danger\" title=\"Create failed\">{createError}</Alert> : null}\r\n\r\n              <div className=\"rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white p-3\">\r\n                <div className=\"text-sm font-semibold text-zinc-900\">Next actions</div>\r\n                <div className=\"mt-2 space-y-2\">\r\n                  <div className=\"flex items-center justify-between gap-3\">\r\n                    <div className=\"text-sm text-zinc-700\">1. Save & validate</div>\r\n                    {isActiveVersion || validateResult?.ok ? (\r\n                      <Badge variant=\"success\">done</Badge>\r\n                    ) : saveValidateBusy ? (\r\n                      <Badge variant=\"info\">running</Badge>\r\n                    ) : (\r\n                      <Badge variant=\"default\">pending</Badge>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"flex items-center justify-between gap-3\">\r\n                    <div className=\"text-sm text-zinc-700\">2. Activate</div>\r\n                    {isActiveVersion ? (\r\n                      <Badge variant=\"success\">active</Badge>\r\n                    ) : validateResult?.ok ? (\r\n                      <Badge variant=\"default\">ready</Badge>\r\n                    ) : (\r\n                      <Badge variant=\"default\">locked</Badge>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {createdPlan && createdVersion ? (\r\n                <Alert variant=\"success\" title=\"Plan created\">\r\n                  Plan <span className=\"font-mono\">{createdPlan.code}</span> created. Draft version id {createdVersion.id}.\r\n                </Alert>\r\n              ) : (\r\n                <Alert variant=\"info\" title=\"Not saved yet\">Click Save & validate to persist this configuration.</Alert>\r\n              )}\r\n\r\n              {isActiveVersion ? (\r\n                <Alert variant=\"success\" title=\"Activated\">This plan version is active.</Alert>\r\n              ) : validateResult ? (\r\n                validateResult.ok ? (\r\n                  <Alert variant=\"success\" title=\"Validation passed\">This draft version is ready to activate.</Alert>\r\n                ) : (\r\n                  <Alert variant=\"warning\" title=\"Validation failed\">\r\n                    <div className=\"space-y-1\">\r\n                      {validateResult.errors.map((e, idx) => (\r\n                        <div key={idx}>{e}</div>\r\n                      ))}\r\n                    </div>\r\n                  </Alert>\r\n                )\r\n              ) : (\r\n                <Alert variant=\"info\" title=\"Not validated\">Click Save & validate to run server-side checks.</Alert>\r\n              )}\r\n\r\n              <div className=\"grid grid-cols-1 gap-4 lg:grid-cols-3\">\r\n                <Card className=\"lg:col-span-1\">\r\n                  <CardHeader>\r\n                    <CardTitle>Plan</CardTitle>\r\n                  </CardHeader>\r\n                  <CardContent className=\"space-y-3\">\r\n                    <div className=\"space-y-1\">\r\n                      <div className=\"text-xs font-medium uppercase tracking-wide text-zinc-500\">Name</div>\r\n                      <div className=\"text-sm font-semibold text-zinc-900\">{planName.trim() || \"—\"}</div>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-1\">\r\n                      <div className=\"text-xs font-medium uppercase tracking-wide text-zinc-500\">Code</div>\r\n                      <div className=\"text-sm text-zinc-700\">\r\n                        {planCode.trim() ? <span className=\"font-mono\">{planCode.trim()}</span> : <span className=\"text-zinc-500\">auto-generated</span>}\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-1\">\r\n                      <div className=\"text-xs font-medium uppercase tracking-wide text-zinc-500\">Status</div>\r\n                      <div>\r\n                        {planActive ? <Badge variant=\"success\">active</Badge> : <Badge variant=\"default\">inactive</Badge>}\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-1\">\r\n                      <div className=\"text-xs font-medium uppercase tracking-wide text-zinc-500\">Description</div>\r\n                      <div className=\"text-sm text-zinc-700 whitespace-pre-wrap\">{planDescription.trim() || \"—\"}</div>\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n\r\n                <Card className=\"lg:col-span-2\">\r\n                  <CardHeader>\r\n                    <CardTitle>Prices</CardTitle>\r\n                  </CardHeader>\r\n                  <CardContent>\r\n                    <DataTable\r\n                      title=\"Price points\"\r\n                      data={(Array.isArray(pricesDraft) ? pricesDraft : [])\r\n                        .slice()\r\n                        .map((p) => normalizeDraftPriceRow(p))\r\n                        .sort((a, b) => `${a.currency}|${a.interval}`.localeCompare(`${b.currency}|${b.interval}`))}\r\n                      loading={false}\r\n                      emptyMessage=\"No prices configured.\"\r\n                      getRowId={(p) => p.key}\r\n                      columns={[\r\n                        {\r\n                          id: \"currency\",\r\n                          header: \"Currency\",\r\n                          cell: (p) => {\r\n                            const code = String(p.currency).toUpperCase();\r\n                            const meta = allowedCurrencies.find((c) => c.code === code) ?? null;\r\n                            return (\r\n                              <div className=\"space-y-0.5\">\r\n                                <div className=\"text-sm font-medium text-zinc-900\">{code}</div>\r\n                                {meta?.name ? <div className=\"text-xs text-zinc-500\">{meta.name}</div> : null}\r\n                              </div>\r\n                            );\r\n                          },\r\n                          className: \"whitespace-nowrap\",\r\n                        },\r\n                        {\r\n                          id: \"interval\",\r\n                          header: \"Interval\",\r\n                          cell: (p) => <div className=\"text-sm text-zinc-700\">{String(p.interval).toLowerCase()}</div>,\r\n                          className: \"whitespace-nowrap\",\r\n                        },\r\n                        {\r\n                          id: \"amount\",\r\n                          header: \"Amount\",\r\n                          cell: (p) => <div className=\"text-sm text-zinc-800\">{formatCents(p.amount_cents ?? 0, p.currency)}</div>,\r\n                          className: \"whitespace-nowrap\",\r\n                        },\r\n                        {\r\n                          id: \"trial\",\r\n                          header: \"Trial\",\r\n                          cell: (p) => <div className=\"text-sm text-zinc-700\">{typeof p.trial_days === \"number\" ? `${p.trial_days} days` : \"—\"}</div>,\r\n                          className: \"whitespace-nowrap\",\r\n                        },\r\n                        {\r\n                          id: \"default\",\r\n                          header: \"Default\",\r\n                          cell: (p) => (p.is_default ? <Badge variant=\"success\">default</Badge> : <Badge variant=\"default\">—</Badge>),\r\n                          className: \"whitespace-nowrap\",\r\n                        },\r\n                      ]}\r\n                    />\r\n                  </CardContent>\r\n                </Card>\r\n              </div>\r\n\r\n              <Card>\r\n                <CardHeader>\r\n                  <CardTitle>Entitlements</CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  {allEntitlementDefinitions.filter((d) => Boolean(entitlementEnabled[d.id])).length === 0 ? (\r\n                    <div className=\"text-sm text-zinc-600\">No entitlements enabled.</div>\r\n                  ) : (\r\n                    <div className=\"space-y-2\">\r\n                      {allEntitlementDefinitions\r\n                        .filter((d) => Boolean(entitlementEnabled[d.id]))\r\n                        .map((def) => {\r\n                          const type = String(def.value_type ?? \"json\");\r\n                          const value = entitlementValue[def.id];\r\n\r\n                          let valueText = \"—\";\r\n                          if (type === \"boolean\") {\r\n                            valueText = Boolean(value) ? \"Enabled\" : \"Disabled\";\r\n                          } else if (type === \"integer\") {\r\n                            valueText = typeof value === \"number\" ? String(value) : value === null ? \"—\" : String(value);\r\n                          } else {\r\n                            const raw = (entitlementJsonText[def.id] ?? \"\").trim();\r\n                            valueText = raw ? \"Custom\" : \"—\";\r\n                          }\r\n\r\n                          return (\r\n                            <div key={def.id} className=\"flex flex-col gap-2 rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white p-3 sm:flex-row sm:items-center sm:justify-between\">\r\n                              <div className=\"min-w-0\">\r\n                                <div className=\"text-sm font-semibold text-zinc-900\">\r\n                                  {def.name} <span className=\"text-xs font-normal text-zinc-500\">({def.code})</span>\r\n                                </div>\r\n                                <div className=\"mt-0.5 text-xs text-zinc-500\">Type: {type}</div>\r\n                              </div>\r\n                              <div className=\"flex items-center gap-2\">\r\n                                {def.is_premium ? <Badge variant=\"warning\">premium</Badge> : null}\r\n                                <Badge variant=\"info\">{valueText}</Badge>\r\n                              </div>\r\n                            </div>\r\n                          );\r\n                        })}\r\n                    </div>\r\n                  )}\r\n                </CardContent>\r\n              </Card>\r\n            </CardContent>\r\n          </Card>\r\n        ) : null}\r\n\r\n        <div className=\"flex items-center justify-between\">\r\n          <Button variant=\"outline\" onClick={goBack} disabled={step === 0}>\r\n            Back\r\n          </Button>\r\n          <div className=\"flex items-center justify-between gap-4\">\r\n            <div className=\"text-sm text-zinc-500\">\r\n              Step {step + 1} of {steps.length}\r\n            </div>\r\n            <Button\r\n              variant=\"primary\"\r\n              onClick={() => {\r\n                if (step !== steps.length - 1) {\r\n                  void goNext();\r\n                  return;\r\n                }\r\n\r\n                if (!canWrite) return;\r\n\r\n                if (isActiveVersion) return;\r\n\r\n                if (!validateResult?.ok) {\r\n                  void onSaveAndValidate();\r\n                  return;\r\n                }\r\n\r\n                setActivateOpen(true);\r\n              }}\r\n              disabled={\r\n                step > maxStepAllowed ||\r\n                (step === 2 && entitlementsBusy) ||\r\n                (step === steps.length - 1 &&\r\n                  (!canWrite ||\r\n                    activateBusy ||\r\n                    isActiveVersion ||\r\n                    (!validateResult?.ok ? saveValidateBusy : false)))\r\n              }\r\n            >\r\n              {step === steps.length - 1\r\n                ? isActiveVersion\r\n                  ? \"Activated\"\r\n                  : !validateResult?.ok\r\n                    ? saveValidateBusy\r\n                      ? \"Saving & validating…\"\r\n                      : \"Save & validate\"\r\n                    : activateBusy\r\n                      ? \"Activating…\"\r\n                      : \"Activate\"\r\n                : \"Next\"}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n          </div>\r\n        </div>\r\n\r\n        <Modal\r\n          open={priceModalOpen}\r\n          onClose={() => {\r\n            if (!priceBusy) setPriceModalOpen(false);\r\n          }}\r\n          title={priceEditId ? \"Edit price\" : \"Add price\"}\r\n          footer={\r\n            <div className=\"flex items-center justify-end gap-2\">\r\n              <Button variant=\"outline\" onClick={() => (!priceBusy ? setPriceModalOpen(false) : null)} disabled={priceBusy}>\r\n                Cancel\r\n              </Button>\r\n              <Button variant=\"primary\" onClick={() => void onSavePrice()} disabled={priceBusy}>\r\n                {priceBusy ? \"Saving…\" : \"Save\"}\r\n              </Button>\r\n            </div>\r\n          }\r\n        >\r\n          <div className=\"space-y-4\">\r\n            {priceError ? (\r\n              <Alert variant=\"danger\" title=\"Cannot save price\">\r\n                {priceError}\r\n              </Alert>\r\n            ) : null}\r\n\r\n            <div className=\"space-y-1\">\r\n              <label className=\"text-sm font-medium\">Currency</label>\r\n              <select\r\n                className=\"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm\"\r\n                value={priceCurrency}\r\n                onChange={(e) => setPriceCurrency(e.target.value)}\r\n                disabled={priceBusy || Boolean(priceEditId) || allowedCurrencies.length === 0}\r\n              >\r\n                {allowedCurrencies.length === 0 ? <option value={priceCurrency}>{priceCurrency}</option> : null}\r\n                {allowedCurrencies.map((c) => (\r\n                  <option key={c.code} value={c.code}>\r\n                    {c.code}{c.name ? ` — ${c.name}` : \"\"}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n              {allowedCurrencies.length === 0 ? <div className=\"text-xs text-zinc-500\">No allowed currencies found. Add currencies under Admin / Billing / Currencies.</div> : null}\r\n            </div>\r\n\r\n            <div className=\"space-y-1\">\r\n              <label className=\"text-sm font-medium\">Interval</label>\r\n              {billingIntervals.length > 0 ? (\r\n                <select\r\n                  className=\"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm\"\r\n                  value={priceIntervalId ?? \"\"}\r\n                  onChange={(e) => {\r\n                    const raw = e.target.value;\r\n                    const id = raw ? Number(raw) : null;\r\n                    const found = billingIntervals.find((x) => x.id === id) ?? null;\r\n                    setPriceIntervalId(found ? found.id : null);\r\n                    setPriceIntervalCode(found ? String(found.code).toLowerCase() : \"\");\r\n                  }}\r\n                  disabled={priceBusy || Boolean(priceEditId)}\r\n                >\r\n                  <option value=\"\">Select interval</option>\r\n                  {billingIntervals\r\n                    .slice()\r\n                    .sort((a, b) => (a.months ?? 0) - (b.months ?? 0) || String(a.name).localeCompare(String(b.name)))\r\n                    .map((i) => (\r\n                      <option key={i.id} value={i.id}>\r\n                        {i.name} ({i.months} months)\r\n                      </option>\r\n                    ))}\r\n                </select>\r\n              ) : (\r\n                <select\r\n                  className=\"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm\"\r\n                  value={priceIntervalCode}\r\n                  onChange={(e) => setPriceIntervalCode(e.target.value === \"year\" ? \"year\" : \"month\")}\r\n                  disabled={priceBusy || Boolean(priceEditId)}\r\n                >\r\n                  <option value=\"month\">month</option>\r\n                  <option value=\"year\">year</option>\r\n                </select>\r\n              )}\r\n              {priceEditId ? <div className=\"text-xs text-zinc-500\">Currency and interval are immutable for an existing price.</div> : null}\r\n            </div>\r\n\r\n            <div className=\"space-y-1\">\r\n              <label className=\"text-sm font-medium\">Amount</label>\r\n              <Input value={priceAmount} onChange={(e) => setPriceAmount(e.target.value)} disabled={priceBusy} />\r\n            </div>\r\n\r\n            <div className=\"space-y-1\">\r\n              <label className=\"text-sm font-medium\">Trial days (optional)</label>\r\n              <Input value={priceTrialDays} onChange={(e) => setPriceTrialDays(e.target.value)} disabled={priceBusy} />\r\n            </div>\r\n\r\n            <label className=\"flex items-center gap-2 text-sm\">\r\n              <input type=\"checkbox\" checked={priceIsDefault} onChange={(e) => setPriceIsDefault(e.target.checked)} disabled={priceBusy} />\r\n              Default for this currency + interval\r\n            </label>\r\n          </div>\r\n        </Modal>\r\n\r\n        <ConfirmDialog\r\n          open={activateOpen}\r\n          title=\"Activate\"\r\n          message={\r\n            <div className=\"space-y-3\">\r\n              <div>This will activate the selected draft version and automatically retire the current active version (if any).</div>\r\n              <div className=\"space-y-1\">\r\n                <label className=\"text-sm font-medium\">Type ACTIVATE to confirm</label>\r\n                <Input value={activateConfirm} onChange={(e) => setActivateConfirm(e.target.value)} />\r\n              </div>\r\n            </div>\r\n          }\r\n          confirmText=\"Activate\"\r\n          confirmVariant=\"secondary\"\r\n          busy={activateBusy}\r\n          onCancel={() => setActivateOpen(false)}\r\n          onConfirm={() => {\r\n            void onActivate();\r\n          }}\r\n        />\r\n      </div>\r\n    </RequireAuth>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}