module.exports=[97156,a=>{"use strict";var b=a.i(57850),c=a.i(45056),d=a.i(34075),e=a.i(75458),f=a.i(91601),g=a.i(75385),h=a.i(33452),i=a.i(17933),j=a.i(97867),k=a.i(4600),l=a.i(29054),m=a.i(648);function n(){let a=(0,e.useAuth)(),n=a.user,o=a.isImpersonating,p=n?.name??"",q=n?.email??"",r=n?.phone??"",s=n?.address_line1??"",t=n?.address_line2??"",u=n?.address_city??"",v=n?.address_state??"",w=n?.address_postal_code??"",x=n?.address_country??"",[y,z]=(0,c.useState)(p),[A,B]=(0,c.useState)(r),[C,D]=(0,c.useState)(s),[E,F]=(0,c.useState)(t),[G,H]=(0,c.useState)(u),[I,J]=(0,c.useState)(v),[K,L]=(0,c.useState)(w),[M,N]=(0,c.useState)(x),[O,P]=(0,c.useState)(!1),[Q,R]=(0,c.useState)(!1),[S,T]=(0,c.useState)(!1),U=(0,c.useRef)(null),[V,W]=(0,c.useState)(null),[X,Y]=(0,c.useState)(null),[Z,$]=(0,c.useState)(!1),[_,aa]=(0,c.useState)(!1),[ab,ac]=(0,c.useState)(null),[ad,ae]=(0,c.useState)(null);(0,c.useEffect)(()=>{z(n?.name??""),B(n?.phone??""),D(n?.address_line1??""),F(n?.address_line2??""),H(n?.address_city??""),J(n?.address_state??""),L(n?.address_postal_code??""),N(n?.address_country??"")},[n?.address_city,n?.address_country,n?.address_line1,n?.address_line2,n?.address_postal_code,n?.address_state,n?.name,n?.phone]);let af=!!n?.email_verified_at,ag=(0,c.useMemo)(()=>n?n.is_admin?"Admin":n.role??"User":"—",[n]),ah=(0,c.useMemo)(()=>{let a=(n?.name??"").trim();if(a){let b=a.split(/\s+/).filter(Boolean),c=b[0]?.[0]??"",d=b.length>1?b[b.length-1]?.[0]??"":"";return`${c}${d}`.toUpperCase().slice(0,2)||"U"}let b=(n?.email??"").trim();return b?b.slice(0,2).toUpperCase():"U"},[n?.email,n?.name]),ai=n?.avatar_url??null,aj=X??ai,ak=!!y.trim()&&!O&&!o,al=y.trim()!==(p??"").trim()||(A.trim()||"")!==(r??"").trim()||(C.trim()||"")!==(s??"").trim()||(E.trim()||"")!==(t??"").trim()||(G.trim()||"")!==(u??"").trim()||(I.trim()||"")!==(v??"").trim()||(K.trim()||"")!==(w??"").trim()||M.trim().toUpperCase()!==(x??"").trim().toUpperCase();async function am(b){if(b.preventDefault(),ac(null),ae(null),!n)return void ac("Not signed in.");if(o)return void ac("Profile updates are disabled during impersonation.");if(!y.trim())return void ac("Name is required.");P(!0);try{await (0,d.apiFetch)("/api/auth/me",{method:"PATCH",body:{name:y.trim(),phone:A.trim()||null,address_line1:C.trim()||null,address_line2:E.trim()||null,address_city:G.trim()||null,address_state:I.trim()||null,address_postal_code:K.trim()||null,address_country:M.trim()?M.trim().toUpperCase().slice(0,2):null}}),await a.refresh(),ae("Profile updated.")}catch(a){a instanceof d.ApiError?ac(a.message):ac("Failed to update profile.")}finally{P(!1)}}async function an(){if(ac(null),ae(null),!n)return void ac("Not signed in.");if(o)return void ac("This action is disabled during impersonation.");if(!V)return void ac("Please choose a photo first.");$(!0);try{let b=new FormData;b.append("avatar",V),await (0,d.apiFetch)("/api/auth/me/avatar",{method:"POST",body:b}),await a.refresh(),ae("Profile photo updated."),W(null),Y(null),U.current&&(U.current.value="")}catch(a){a instanceof d.ApiError?ac(a.message):ac("Failed to update profile photo.")}finally{$(!1)}}async function ao(){if(ac(null),ae(null),!n)return void ac("Not signed in.");if(o)return void ac("This action is disabled during impersonation.");aa(!0);try{await (0,d.apiFetch)("/api/auth/me/avatar",{method:"DELETE"}),await a.refresh(),ae("Profile photo removed."),W(null),Y(null),U.current&&(U.current.value="")}catch(a){a instanceof d.ApiError?ac(a.message):ac("Failed to remove profile photo.")}finally{aa(!1)}}async function ap(){if(ac(null),ae(null),!q)return void ac("Email is missing.");if(o)return void ac("This action is disabled during impersonation.");R(!0);try{await (0,d.apiFetch)("/api/auth/password/email",{method:"POST",body:{email:q}}),ae("If that email exists, we sent a reset link.")}catch(a){a instanceof d.ApiError?ac(a.message):ac("Failed to send reset link.")}finally{R(!1)}}async function aq(){if(ac(null),ae(null),!q)return void ac("Email is missing.");if(o)return void ac("This action is disabled during impersonation.");T(!0);try{await a.resendVerificationEmail(q),ae("Verification email sent. Check your inbox.")}catch(a){a instanceof d.ApiError?ac(a.message):ac("Failed to resend verification email.")}finally{T(!1)}}return(0,c.useEffect)(()=>()=>{X&&URL.revokeObjectURL(X)},[X]),(0,b.jsx)(f.RequireAuth,{children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(m.PageHeader,{title:"Profile",description:"Manage your account."}),o?(0,b.jsx)(g.Alert,{variant:"warning",title:"Impersonation active",children:"Editing profile details is disabled while impersonating another user."}):null,ab?(0,b.jsx)(g.Alert,{variant:"danger",title:"Could not update profile",children:ab}):null,ad?(0,b.jsx)(g.Alert,{variant:"success",title:"Success",children:ad}):null,(0,b.jsxs)(k.Card,{className:"overflow-hidden",children:[(0,b.jsx)("div",{className:"h-20 w-full bg-[var(--rb-surface-muted)]"}),(0,b.jsx)(k.CardContent,{className:"-mt-10",children:(0,b.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-end sm:justify-between",children:[(0,b.jsxs)("div",{className:"flex items-end gap-4",children:[(0,b.jsx)(h.Avatar,{alt:n?.name||q||"User",fallback:ah,src:aj,size:72,className:"ring-2 ring-white shadow-sm"}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"truncate text-lg font-semibold text-[var(--rb-text)]",children:n?.name||"—"}),(0,b.jsx)("div",{className:"truncate text-sm text-zinc-600",children:q||"—"}),(0,b.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[(0,b.jsx)(i.Badge,{variant:af?"success":"warning",children:af?"Email verified":"Email unverified"}),(0,b.jsx)(i.Badge,{children:ag}),"number"==typeof n?.id?(0,b.jsxs)(i.Badge,{children:["ID #",n.id]}):null]}),(0,b.jsxs)("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[(0,b.jsx)("input",{ref:U,type:"file",accept:"image/png,image/jpeg,image/webp",className:"hidden",onChange:function(a){let b=a.target.files?.[0]??null;b&&((ac(null),ae(null),b.type.startsWith("image/"))?b.size>5242880?ac("Image must be 5MB or smaller."):(W(b),Y(URL.createObjectURL(b))):ac("Please select an image file."))},disabled:o||Z||_}),(0,b.jsx)(j.Button,{variant:"outline",size:"sm",onClick:()=>U.current?.click(),disabled:o||Z||_,children:V?"Change selected photo":"Change photo"}),V?(0,b.jsx)(j.Button,{size:"sm",onClick:()=>void an(),disabled:o||Z||_,children:Z?"Uploading...":"Upload"}):null,ai?(0,b.jsx)(j.Button,{variant:"ghost",size:"sm",onClick:()=>void ao(),disabled:o||Z||_,className:"text-zinc-600",children:_?"Removing...":"Remove"}):null]})]})]}),(0,b.jsxs)("div",{className:"flex flex-col items-start gap-1 text-xs text-zinc-600 sm:items-end",children:[(0,b.jsxs)("div",{children:["Signed in as ",q||"—"]}),(0,b.jsx)("div",{className:"text-[var(--rb-text)]",children:"Changes apply to your current session after saving."})]})]})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[(0,b.jsxs)(k.Card,{children:[(0,b.jsx)(k.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(k.CardTitle,{children:"Profile details"}),(0,b.jsx)(k.CardDescription,{children:"Update how your name appears across the app."})]}),al?(0,b.jsx)(i.Badge,{variant:"info",children:"Unsaved changes"}):null]})}),(0,b.jsx)(k.CardContent,{children:(0,b.jsxs)("form",{className:"space-y-4",onSubmit:am,children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",htmlFor:"name",children:"Display name"}),(0,b.jsx)(l.Input,{id:"name",value:y,onChange:a=>z(a.target.value),disabled:O||o,autoComplete:"name",placeholder:"Your name",required:!0})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",htmlFor:"phone",children:"Phone"}),(0,b.jsx)(l.Input,{id:"phone",value:A,onChange:a=>B(a.target.value),disabled:O||o,autoComplete:"tel",placeholder:"Optional"})]}),(0,b.jsxs)("div",{className:"space-y-1 sm:col-span-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium",htmlFor:"address_line1",children:"Address line 1"}),(0,b.jsx)(l.Input,{id:"address_line1",value:C,onChange:a=>D(a.target.value),disabled:O||o,autoComplete:"address-line1",placeholder:"Optional"})]}),(0,b.jsxs)("div",{className:"space-y-1 sm:col-span-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium",htmlFor:"address_line2",children:"Address line 2"}),(0,b.jsx)(l.Input,{id:"address_line2",value:E,onChange:a=>F(a.target.value),disabled:O||o,autoComplete:"address-line2",placeholder:"Optional"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",htmlFor:"address_city",children:"City"}),(0,b.jsx)(l.Input,{id:"address_city",value:G,onChange:a=>H(a.target.value),disabled:O||o,autoComplete:"address-level2",placeholder:"Optional"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",htmlFor:"address_state",children:"State / Region"}),(0,b.jsx)(l.Input,{id:"address_state",value:I,onChange:a=>J(a.target.value),disabled:O||o,autoComplete:"address-level1",placeholder:"Optional"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",htmlFor:"address_postal_code",children:"Postal code"}),(0,b.jsx)(l.Input,{id:"address_postal_code",value:K,onChange:a=>L(a.target.value),disabled:O||o,autoComplete:"postal-code",placeholder:"Optional"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",htmlFor:"address_country",children:"Country"}),(0,b.jsx)(l.Input,{id:"address_country",value:M,onChange:a=>N(a.target.value.toUpperCase().slice(0,2)),disabled:O||o,autoComplete:"country",placeholder:"US",maxLength:2})]})]}),(0,b.jsx)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-end",children:(0,b.jsx)(j.Button,{type:"submit",disabled:!ak||!al,children:O?"Saving...":"Save changes"})})]})})]}),(0,b.jsxs)(k.Card,{children:[(0,b.jsxs)(k.CardHeader,{children:[(0,b.jsx)(k.CardTitle,{children:"Account"}),(0,b.jsx)(k.CardDescription,{children:"Security and login-related actions."})]}),(0,b.jsxs)(k.CardContent,{children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-[var(--rb-surface-muted)] px-4 py-3",children:[(0,b.jsx)("div",{className:"text-xs font-semibold uppercase tracking-wider text-zinc-500",children:"Email"}),(0,b.jsx)("div",{className:"mt-1 truncate text-sm font-semibold text-[var(--rb-text)]",children:q||"—"}),(0,b.jsx)("div",{className:"mt-2",children:(0,b.jsx)(i.Badge,{variant:af?"success":"warning",children:af?"Verified":"Not verified"})})]}),(0,b.jsxs)("div",{className:"rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-[var(--rb-surface-muted)] px-4 py-3",children:[(0,b.jsx)("div",{className:"text-xs font-semibold uppercase tracking-wider text-zinc-500",children:"Role"}),(0,b.jsx)("div",{className:"mt-1 text-sm font-semibold text-[var(--rb-text)]",children:ag}),(0,b.jsxs)("div",{className:"mt-1 text-xs text-zinc-600",children:["User ID: ",n?.id??"—"]})]})]}),(0,b.jsx)("div",{className:"mt-4 border-t border-[var(--rb-border)] pt-4",children:(0,b.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row",children:[af?null:(0,b.jsx)(j.Button,{variant:"outline",onClick:()=>void aq(),disabled:S||o||!q,children:S?"Sending...":"Resend verification email"}),(0,b.jsx)(j.Button,{variant:"outline",onClick:()=>void ap(),disabled:Q||o||!q,children:Q?"Sending...":"Send password reset email"})]})})]})]})]})]})})}a.s(["default",()=>n])}];

//# sourceMappingURL=frontend_src_app_app_%5Btenant%5D_profile_page_tsx_9695d6b7._.js.map