module.exports=[53291,a=>{"use strict";var b=a.i(57850),c=a.i(34075),d=a.i(46664),e=a.i(91601),f=a.i(75385),g=a.i(17933),h=a.i(97867),i=a.i(4600),j=a.i(21282),k=a.i(54177),l=a.i(46036),m=a.i(29054),n=a.i(648),o=a.i(94703),p=a.i(7160);function q({status:a,className:c}){let d="h-5 w-5 shrink-0";return"success"===a?(0,b.jsx)("svg",{viewBox:"0 0 24 24",className:(0,p.cn)(d,c),fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:(0,b.jsx)("path",{d:"M20 6L9 17l-5-5"})}):"warning"===a?(0,b.jsxs)("svg",{viewBox:"0 0 24 24",className:(0,p.cn)(d,c),fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[(0,b.jsx)("path",{d:"M12 9v4"}),(0,b.jsx)("path",{d:"M12 17h.01"}),(0,b.jsx)("path",{d:"M10.3 3.6l-8.3 14.3A2 2 0 0 0 3.7 21h16.6a2 2 0 0 0 1.7-3.1L13.7 3.6a2 2 0 0 0-3.4 0z"})]}):"error"===a?(0,b.jsxs)("svg",{viewBox:"0 0 24 24",className:(0,p.cn)(d,c),fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[(0,b.jsx)("path",{d:"M18 6L6 18"}),(0,b.jsx)("path",{d:"M6 6l12 12"})]}):(0,b.jsxs)("svg",{viewBox:"0 0 24 24",className:(0,p.cn)(d,c),fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[(0,b.jsx)("path",{d:"M12 16v-4"}),(0,b.jsx)("path",{d:"M12 8h.01"}),(0,b.jsx)("path",{d:"M12 22a10 10 0 1 0-10-10 10 10 0 0 0 10 10z"})]})}function r({open:a,status:c,title:d,message:e,actionText:f="OK",onClose:g}){let i={info:{icon:"text-[var(--rb-blue)]",title:"text-[var(--rb-blue)]"},success:{icon:"text-[#166534]",title:"text-[#166534]"},warning:{icon:"text-[color:color-mix(in_srgb,var(--rb-orange),black_20%)]",title:"text-[color:color-mix(in_srgb,var(--rb-orange),black_20%)]"},error:{icon:"text-[#991b1b]",title:"text-[#991b1b]"}}[c];return(0,b.jsx)(o.Modal,{open:a,onClose:g,position:"top-center",variant:"solid",title:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(q,{status:c,className:i.icon}),(0,b.jsx)("div",{className:(0,p.cn)("text-sm font-semibold",i.title),children:d})]}),footer:(0,b.jsx)("div",{className:"flex items-center justify-end",children:(0,b.jsx)(h.Button,{variant:"outline",onClick:g,children:f})}),children:e?(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:e}):null})}var s=a.i(93609),t=a.i(45056);function u(){let a=(0,s.useRouter)(),[o,p]=(0,t.useState)(!0),[q,u]=(0,t.useState)([]),[v,w]=(0,t.useState)(null),[x,y]=(0,t.useState)(null),[z,A]=(0,t.useState)({}),[B,C]=(0,t.useState)(!1),[D,E]=(0,t.useState)(null),[F,G]=(0,t.useState)(null),[H,I]=(0,t.useState)(""),[J,K]=(0,t.useState)(!1),[L,M]=(0,t.useState)(null),[N,O]=(0,t.useState)(""),[P,Q]=(0,t.useState)(""),[R,S]=(0,t.useState)(!1),[T,U]=(0,t.useState)("info"),[V,W]=(0,t.useState)(""),[X,Y]=(0,t.useState)(null),[Z,$]=(0,t.useState)(!0),[_,aa]=(0,t.useState)(null),[ab,ac]=(0,t.useState)(null),[ad,ae]=(0,t.useState)(0),[af,ag]=(0,t.useState)(""),[ah,ai]=(0,t.useState)("all"),[aj,ak]=(0,t.useState)(0),[al,am]=(0,t.useState)(10),[an,ao]=(0,t.useState)(0),[ap,aq]=(0,t.useState)(null),ar=(0,t.useMemo)(()=>[{label:"All statuses",value:"all"},{label:"Trial",value:"trial"},{label:"Active",value:"active"},{label:"Past due",value:"past_due"},{label:"Suspended",value:"suspended"},{label:"Closed",value:"closed"}],[]),as=(0,t.useMemo)(()=>a=>"active"===a?"success":"trial"===a?"info":"past_due"===a?"warning":"suspended"===a?"danger":"default",[]);function at({label:a,value:c,badge:d,badgeVariant:e,glowClassName:f}){return(0,b.jsxs)(i.Card,{className:"relative overflow-hidden",children:[(0,b.jsx)("div",{className:"pointer-events-none absolute -right-10 -top-10 h-28 w-28 rounded-full blur-2xl opacity-70 "+f}),(0,b.jsxs)(i.CardContent,{className:"pt-5",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"text-xs font-medium tracking-wide text-zinc-500",children:a}),(0,b.jsx)("div",{className:"mt-1 truncate text-2xl font-semibold text-[var(--rb-text)]",children:c})]}),(0,b.jsx)(g.Badge,{variant:e,children:d})]}),(0,b.jsx)("div",{className:"mt-3 h-px w-full bg-[var(--rb-border)]"})]})]})}async function au(a,b,c){if(!Number.isFinite(a)||a<=0||z[a])return null;y(null),A(c=>({...c,[a]:b}));try{return await c(),ae(a=>a+1),{ok:!0}}catch(b){let a=b instanceof Error?b.message:"Action failed.";return y(a),{ok:!1,error:a}}finally{A(b=>({...b,[a]:null}))}}async function av(a){E(a),G("suspend"),I(""),C(!0)}async function aw(a){E(a),G("unsuspend"),I(""),C(!0)}async function ax(a){M(a),O(""),Q(""),K(!0)}(0,t.useEffect)(()=>{let a=!0;return async function(){try{w(null),p(!0);let b=new URLSearchParams;af.trim().length>0&&b.set("q",af.trim()),ah&&"all"!==ah&&b.set("status",ah),ap?.id&&ap?.dir&&(b.set("sort",ap.id),b.set("dir",ap.dir)),b.set("page",String(aj+1)),b.set("per_page",String(al));let d=await (0,c.apiFetch)(`/api/admin/businesses?${b.toString()}`);if(!a)return;u(Array.isArray(d.tenants)?d.tenants:[]),ao("number"==typeof d.meta?.total?d.meta.total:0),am("number"==typeof d.meta?.per_page?d.meta.per_page:al)}catch(b){if(!a)return;w(b instanceof Error?b.message:"Failed to load tenants.")}finally{if(!a)return;p(!1)}}(),()=>{a=!1}},[af,ah,aj,al,ap?.id,ap?.dir,ad]),(0,t.useEffect)(()=>{let a=!0;return async function(){try{aa(null),$(!0);let b=new URLSearchParams;af.trim().length>0&&b.set("q",af.trim()),ah&&"all"!==ah&&b.set("status",ah);let d=await (0,c.apiFetch)(`/api/admin/businesses/stats?${b.toString()}`);if(!a)return;ac(d)}catch(b){if(!a)return;aa(b instanceof Error?b.message:"Failed to load stats."),ac(null)}finally{if(!a)return;$(!1)}}(),()=>{a=!1}},[af,ah,ad]);let ay=!!D&&!!F&&z[D.id]===F,az=!!L&&"close"===z[L.id];async function aA(){if(!D||!F)return;let a=H.trim(),d="suspend"===F?"suspend":"unsuspend",e=await au(D.id,F,async()=>{await (0,c.apiFetch)(`/api/admin/businesses/${D.id}/${d}`,{method:"PATCH",body:{reason:a||void 0}})});C(!1),E(null),G(null),I(""),e&&(e?.ok?(U("success"),W("suspend"===F?"Business suspended":"Business unsuspended"),Y((0,b.jsxs)("div",{children:["“",D.name,"” was updated successfully."]})),S(!0)):e&&!e.ok&&(U("error"),W("Action failed"),Y(e.error),S(!0)))}async function aB(){if(!L)return;let a=N.trim(),d=P.trim(),e=d.length>0?Number(d):null,f=await au(L.id,"close",async()=>{await (0,c.apiFetch)(`/api/admin/businesses/${L.id}/close`,{method:"PATCH",body:{reason:a||void 0,data_retention_days:e&&Number.isFinite(e)?e:void 0}})});K(!1),M(null),O(""),Q(""),f&&(f.ok?(U("success"),W("Business closed"),Y((0,b.jsxs)("div",{children:["“",L.name,"” was closed successfully."]}))):(U("error"),W("Action failed"),Y(f.error)),S(!0))}return(0,b.jsx)(e.RequireAuth,{requiredPermission:"admin.tenants.read",children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(n.PageHeader,{title:"Businesses",description:"Manage businesses (admin).",actions:(0,b.jsx)(h.Button,{variant:"outline",size:"sm",onClick:()=>ae(a=>a+1),disabled:o,children:"Refresh"})}),v?(0,b.jsx)(f.Alert,{variant:"danger",title:"Could not load businesses",children:v}):null,x?(0,b.jsx)(f.Alert,{variant:"danger",title:"Action failed",children:x}):null,_?(0,b.jsx)(f.Alert,{variant:"danger",title:"Could not load stats",children:_}):null,(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-6",children:[(0,b.jsx)(at,{label:"Total businesses",value:Z?"—":String(ab?.total??0),badge:"all",badgeVariant:"default",glowClassName:"bg-[color:color-mix(in_srgb,var(--rb-text),white_88%)]"}),(0,b.jsx)(at,{label:"Active",value:Z?"—":String(ab?.by_status?.active??0),badge:"active",badgeVariant:"success",glowClassName:"bg-[color:color-mix(in_srgb,#16a34a,white_75%)]"}),(0,b.jsx)(at,{label:"Trial",value:Z?"—":String(ab?.by_status?.trial??0),badge:"trial",badgeVariant:"info",glowClassName:"bg-[color:color-mix(in_srgb,var(--rb-blue),white_80%)]"}),(0,b.jsx)(at,{label:"Past due",value:Z?"—":String(ab?.by_status?.past_due??0),badge:"past due",badgeVariant:"warning",glowClassName:"bg-[color:color-mix(in_srgb,var(--rb-orange),white_78%)]"}),(0,b.jsx)(at,{label:"Suspended",value:Z?"—":String(ab?.by_status?.suspended??0),badge:"suspended",badgeVariant:"danger",glowClassName:"bg-[color:color-mix(in_srgb,#dc2626,white_78%)]"}),(0,b.jsx)(at,{label:"Closed",value:Z?"—":String(ab?.by_status?.closed??0),badge:"closed",badgeVariant:"default",glowClassName:"bg-[color:color-mix(in_srgb,var(--rb-border),white_55%)]"})]}),(0,b.jsx)(i.Card,{children:(0,b.jsx)(i.CardContent,{className:"pt-5",children:(0,b.jsx)(k.DataTable,{title:"Businesses",data:q,loading:o,emptyMessage:"No businesses found.",getRowId:a=>a.id,onRowClick:b=>{a.push(`/admin/businesses/${b.id}`)},search:{placeholder:"Search name, slug, or email..."},server:{query:af,onQueryChange:a=>{ag(a),ak(0)},pageIndex:aj,onPageIndexChange:ak,pageSize:al,onPageSizeChange:a=>{am(a),ak(0)},totalRows:an,sort:ap,onSortChange:a=>{aq(a),ak(0)}},exportConfig:{url:"/api/admin/businesses/export",formats:["csv","xlsx","pdf"],filename:({format:a})=>`tenants_export.${a}`},columnVisibilityKey:"rb:datatable:admin:tenants",filters:[{id:"status",label:"Status",value:ah,options:ar,onChange:a=>{ai(String(a)),ak(0)}}],columns:[{id:"id",header:"ID",sortId:"id",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:a.id}),className:"whitespace-nowrap"},{id:"name",header:"Name",sortId:"name",cell:a=>(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"truncate font-semibold text-[var(--rb-text)]",children:a.name}),a.contact_email?(0,b.jsx)("div",{className:"truncate text-xs text-zinc-600",children:a.contact_email}):null]}),className:"max-w-[420px]"},{id:"slug",header:"Slug",sortId:"slug",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:a.slug}),className:"whitespace-nowrap"},{id:"status",header:"Status",sortId:"status",cell:a=>(0,b.jsx)(g.Badge,{variant:as(a.status),children:a.status}),className:"whitespace-nowrap"},{id:"contact_email",header:"Contact Email",sortId:"contact_email",hiddenByDefault:!0,cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:a.contact_email??""}),className:"whitespace-nowrap"},{id:"created_at",header:"Created",sortId:"created_at",hiddenByDefault:!0,cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:(0,d.formatDateTime)(a.created_at??null)}),className:"whitespace-nowrap"},{id:"actions",header:"",cell:c=>{let d=z[c.id],e="closed"!==c.status,f="suspended"===c.status,g="closed"!==c.status;return(0,b.jsx)("div",{className:"flex items-center justify-end",children:(0,b.jsx)(l.DropdownMenu,{align:"right",trigger:({toggle:a})=>(0,b.jsx)(h.Button,{variant:"ghost",size:"sm","aria-label":"Actions",title:"Actions",className:"px-2",onClick:b=>{b.stopPropagation(),a()},children:(0,b.jsxs)("svg",{viewBox:"0 0 24 24",className:"h-4 w-4",fill:"none",stroke:"currentColor",strokeWidth:"2","aria-hidden":"true",children:[(0,b.jsx)("circle",{cx:"12",cy:"5",r:"1.5"}),(0,b.jsx)("circle",{cx:"12",cy:"12",r:"1.5"}),(0,b.jsx)("circle",{cx:"12",cy:"19",r:"1.5"})]})}),children:({close:h})=>(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.DropdownMenuItem,{onSelect:()=>{h(),a.push(`/admin/businesses/${c.id}`)},children:"View"}),(0,b.jsx)(l.DropdownMenuSeparator,{}),(0,b.jsx)(l.DropdownMenuItem,{onSelect:()=>{h(),av(c)},disabled:!!d||!e,children:"suspend"===d?"…":"Suspend"}),(0,b.jsx)(l.DropdownMenuItem,{onSelect:()=>{h(),aw(c)},disabled:!!d||!f,children:"unsuspend"===d?"…":"Unsuspend"}),(0,b.jsx)(l.DropdownMenuItem,{onSelect:()=>{h(),ax(c)},disabled:!!d||!g,destructive:!0,children:"close"===d?"…":"Close"})]})})})},className:"whitespace-nowrap text-right",headerClassName:"text-right"}]})})}),(0,b.jsx)(j.ConfirmDialog,{open:B,title:"suspend"===F?"Suspend business":"Unsuspend business",message:(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("div",{children:"suspend"===F?"This will suspend the business and prevent normal access.":"This will restore access for the business."}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("div",{className:"text-xs font-medium text-zinc-600",children:"Reason (optional)"}),(0,b.jsx)(m.Input,{value:H,onChange:a=>I(a.target.value),placeholder:"e.g. Non-payment, abuse, user request"})]})]}),confirmText:"suspend"===F?"Suspend":"Unsuspend",confirmVariant:"secondary",busy:ay,onCancel:()=>{C(!1),E(null),G(null),I("")},onConfirm:()=>void aA()}),(0,b.jsx)(j.ConfirmDialog,{open:J,title:"Close business",message:(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("div",{children:"This is a destructive action. The business will be closed."}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("div",{className:"text-xs font-medium text-zinc-600",children:"Reason (optional)"}),(0,b.jsx)(m.Input,{value:N,onChange:a=>O(a.target.value),placeholder:"e.g. customer request, duplicate tenant"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("div",{className:"text-xs font-medium text-zinc-600",children:"Data retention days override (optional)"}),(0,b.jsx)(m.Input,{type:"number",inputMode:"numeric",value:P,onChange:a=>Q(a.target.value),placeholder:"e.g. 30"})]})]}),confirmText:"Close",confirmVariant:"secondary",busy:az,onCancel:()=>{K(!1),M(null),O(""),Q("")},onConfirm:()=>void aB()}),(0,b.jsx)(r,{open:R,status:T,title:V,message:X,onClose:()=>{S(!1),Y(null),W(""),U("info")}})]})})}a.s(["default",()=>u],53291)}];

//# sourceMappingURL=frontend_src_app_admin_tenants_page_tsx_05d2ca28._.js.map