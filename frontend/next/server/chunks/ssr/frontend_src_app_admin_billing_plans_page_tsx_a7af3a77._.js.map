{"version":3,"sources":["../../../../../frontend/src/app/admin/billing/plans/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useMemo, useState } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { RequireAuth } from \"@/components/RequireAuth\";\r\nimport { useDashboardHeader } from \"@/components/DashboardShell\";\r\nimport { Alert } from \"@/components/ui/Alert\";\r\nimport { Badge } from \"@/components/ui/Badge\";\r\nimport { Button } from \"@/components/ui/Button\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/Card\";\r\nimport { Skeleton } from \"@/components/ui/Skeleton\";\r\nimport { Modal } from \"@/components/ui/Modal\";\r\nimport { Input } from \"@/components/ui/Input\";\r\nimport { createBillingPlan, getBillingCatalog } from \"@/lib/billing\";\r\nimport { useAuth } from \"@/lib/auth\";\r\nimport type { BillingPlan, BillingPlanVersion, BillingPrice } from \"@/lib/types\";\r\n\r\nfunction formatCents(args: { currency?: string | null; amountCents?: number | null }) {\r\n  const currency = (args.currency || \"usd\").toUpperCase();\r\n  const amountCents = typeof args.amountCents === \"number\" ? args.amountCents : 0;\r\n  const amount = amountCents / 100;\r\n\r\n  try {\r\n    return new Intl.NumberFormat(undefined, {\r\n      style: \"currency\",\r\n      currency,\r\n      maximumFractionDigits: 2,\r\n    }).format(amount);\r\n  } catch {\r\n    return `${currency} ${amount.toFixed(2)}`;\r\n  }\r\n}\r\n\r\nfunction intervalLabel(interval?: string | null) {\r\n  const v = String(interval || \"\").toLowerCase();\r\n  if (!v) return \"\";\r\n  if (v === \"month\" || v === \"monthly\") return \"/mo\";\r\n  if (v === \"year\" || v === \"yearly\" || v === \"annual\") return \"/yr\";\r\n  return `/${v}`;\r\n}\r\n\r\nfunction pickDisplayVersion(plan: BillingPlan): BillingPlanVersion | null {\r\n  const versions = Array.isArray(plan.versions) ? plan.versions : [];\r\n  const active = versions.find((v) => v.status === \"active\") ?? null;\r\n  if (active) return active;\r\n  const latest = versions.slice().sort((a, b) => (b.version ?? 0) - (a.version ?? 0))[0] ?? null;\r\n  return latest;\r\n}\r\n\r\nfunction pickDisplayPrice(version: BillingPlanVersion | null): BillingPrice | null {\r\n  if (!version) return null;\r\n  const prices = Array.isArray(version.prices) ? version.prices : [];\r\n  const preferred = prices.find((p) => p.is_default) ?? null;\r\n  return preferred ?? prices[0] ?? null;\r\n}\r\n\r\nfunction CheckIcon({ className }: { className?: string }) {\r\n  return (\r\n    <svg viewBox=\"0 0 24 24\" className={className} fill=\"none\" stroke=\"currentColor\" strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\" aria-hidden=\"true\">\r\n      <path d=\"M20 6L9 17l-5-5\" />\r\n    </svg>\r\n  );\r\n}\r\n\r\nfunction planEntitlementList(plan: BillingPlan): string[] {\r\n  const version = pickDisplayVersion(plan);\r\n  const entitlements = Array.isArray(version?.entitlements) ? version?.entitlements : [];\r\n  const names = entitlements\r\n    .map((e) => (e && typeof e === \"object\" && \"definition\" in e ? (e as { definition?: { name?: unknown } }).definition?.name : undefined))\r\n    .filter(Boolean)\r\n    .map((n) => String(n));\r\n  return Array.from(new Set(names));\r\n}\r\n\r\nfunction BillingPlanCardSkeleton() {\r\n  return (\r\n    <Card className=\"relative overflow-hidden\">\r\n      <div className=\"h-1.5 w-full bg-[var(--rb-border)]\" />\r\n\r\n      <CardHeader className=\"pb-3\">\r\n        <div className=\"flex items-start justify-between gap-3\">\r\n          <div className=\"min-w-0\">\r\n            <Skeleton className=\"h-5 w-40 rounded-[var(--rb-radius-sm)]\" />\r\n            <div className=\"mt-2 flex flex-wrap items-center gap-2\">\r\n              <Skeleton className=\"h-3 w-16 rounded-[var(--rb-radius-sm)]\" />\r\n              <Skeleton className=\"h-5 w-24 rounded-full\" />\r\n            </div>\r\n          </div>\r\n          <div className=\"text-right\">\r\n            <Skeleton className=\"ml-auto h-8 w-28 rounded-[var(--rb-radius-sm)]\" />\r\n            <div className=\"mt-2 flex items-center justify-end gap-2\">\r\n              <Skeleton className=\"h-5 w-16 rounded-full\" />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </CardHeader>\r\n\r\n      <CardContent className=\"space-y-4\">\r\n        <div className=\"space-y-2\">\r\n          <Skeleton className=\"h-3 w-full rounded-[var(--rb-radius-sm)]\" />\r\n          <Skeleton className=\"h-3 w-4/5 rounded-[var(--rb-radius-sm)]\" />\r\n        </div>\r\n\r\n        <div className=\"space-y-2\">\r\n          <Skeleton className=\"h-3 w-44 rounded-[var(--rb-radius-sm)]\" />\r\n          <div className=\"space-y-2\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <Skeleton className=\"h-4 w-4 rounded-[var(--rb-radius-sm)]\" />\r\n              <Skeleton className=\"h-3 w-2/3 rounded-[var(--rb-radius-sm)]\" />\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <Skeleton className=\"h-4 w-4 rounded-[var(--rb-radius-sm)]\" />\r\n              <Skeleton className=\"h-3 w-1/2 rounded-[var(--rb-radius-sm)]\" />\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <Skeleton className=\"h-4 w-4 rounded-[var(--rb-radius-sm)]\" />\r\n              <Skeleton className=\"h-3 w-3/5 rounded-[var(--rb-radius-sm)]\" />\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"grid grid-cols-2 gap-3 border-t border-[var(--rb-border)] pt-4\">\r\n          <div>\r\n            <Skeleton className=\"h-3 w-24 rounded-[var(--rb-radius-sm)]\" />\r\n            <div className=\"mt-2\">\r\n              <Skeleton className=\"h-4 w-28 rounded-[var(--rb-radius-sm)]\" />\r\n            </div>\r\n          </div>\r\n          <div>\r\n            <Skeleton className=\"h-3 w-20 rounded-[var(--rb-radius-sm)]\" />\r\n            <div className=\"mt-2\">\r\n              <Skeleton className=\"h-4 w-24 rounded-[var(--rb-radius-sm)]\" />\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"flex items-center justify-end gap-2 pt-1\">\r\n          <Skeleton className=\"h-9 w-24 rounded-[var(--rb-radius-sm)]\" />\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n\r\nexport default function AdminBillingPlansPage() {\r\n  const auth = useAuth();\r\n  const dashboardHeader = useDashboardHeader();\r\n\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [plans, setPlans] = useState<BillingPlan[]>([]);\r\n  const [reloadNonce, setReloadNonce] = useState(0);\r\n  const [query, setQuery] = useState(\"\");\r\n\r\n  const [createOpen, setCreateOpen] = useState(false);\r\n  const [createBusy, setCreateBusy] = useState(false);\r\n  const [createError, setCreateError] = useState<string | null>(null);\r\n  const [name, setName] = useState(\"\");\r\n  const [code, setCode] = useState(\"\");\r\n  const [description, setDescription] = useState(\"\");\r\n  const [isActive, setIsActive] = useState(true);\r\n\r\n  const canWrite = auth.can(\"admin.billing.write\");\r\n\r\n  function resetCreateForm() {\r\n    setCreateError(null);\r\n    setName(\"\");\r\n    setCode(\"\");\r\n    setDescription(\"\");\r\n    setIsActive(true);\r\n  }\r\n\r\n  useEffect(() => {\r\n    dashboardHeader.setHeader({\r\n      breadcrumb: \"Admin / Billing\",\r\n      title: \"Billing plans\",\r\n      subtitle: \"View billing catalog (plans, versions, prices)\",\r\n      actions: (\r\n        <div className=\"flex items-center gap-2\">\r\n          {canWrite ? (\r\n            <Link href=\"/admin/billing/builder\">\r\n            <Button variant=\"outline\" size=\"sm\" disabled={loading}>\r\n              New plan\r\n            </Button>\r\n          </Link>\r\n          ) : null}\r\n          <Button\r\n            variant=\"outline\"\r\n            size=\"sm\"\r\n            onClick={() => setReloadNonce((v) => v + 1)}\r\n            disabled={loading}\r\n          >\r\n            Refresh\r\n          </Button>\r\n        </div>\r\n      ),\r\n    });\r\n\r\n    return () => dashboardHeader.setHeader(null);\r\n  }, [canWrite, dashboardHeader, loading]);\r\n\r\n  async function onCreate() {\r\n    const nextName = name.trim();\r\n    if (!nextName) {\r\n      setCreateError(\"Name is required.\");\r\n      return;\r\n    }\r\n\r\n    setCreateBusy(true);\r\n    setCreateError(null);\r\n\r\n    try {\r\n      await createBillingPlan({\r\n        name: nextName,\r\n        code,\r\n        description,\r\n        isActive,\r\n      });\r\n\r\n      setCreateOpen(false);\r\n      setReloadNonce((v) => v + 1);\r\n    } catch (e) {\r\n      setCreateError(e instanceof Error ? e.message : \"Failed to create billing plan.\");\r\n    } finally {\r\n      setCreateBusy(false);\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    let alive = true;\r\n\r\n    async function load() {\r\n      try {\r\n        setLoading(true);\r\n        setError(null);\r\n\r\n        const res = await getBillingCatalog({ includeInactive: true });\r\n        if (!alive) return;\r\n\r\n        setPlans(Array.isArray(res.billing_plans) ? res.billing_plans : []);\r\n      } catch (e) {\r\n        if (!alive) return;\r\n        setError(e instanceof Error ? e.message : \"Failed to load billing catalog.\");\r\n        setPlans([]);\r\n      } finally {\r\n        if (!alive) return;\r\n        setLoading(false);\r\n      }\r\n    }\r\n\r\n    void load();\r\n\r\n    return () => {\r\n      alive = false;\r\n    };\r\n  }, [reloadNonce]);\r\n\r\n  const filteredPlans = useMemo(() => {\r\n    const q = query.trim().toLowerCase();\r\n    if (!q) return plans;\r\n    return plans.filter((p) => `${p.name} ${p.code}`.toLowerCase().includes(q));\r\n  }, [plans, query]);\r\n\r\n  return (\r\n    <RequireAuth requiredPermission=\"admin.billing.read\">\r\n      <div className=\"space-y-6\">\r\n        {error ? (\r\n          <Alert variant=\"danger\" title=\"Could not load billing plans\">\r\n            {error}\r\n          </Alert>\r\n        ) : null}\r\n\r\n        <div className=\"flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between\">\r\n          <div className=\"min-w-0\">\r\n            <div className=\"text-sm font-semibold text-[var(--rb-text)]\">Plans</div>\r\n            <div className=\"mt-1 text-sm text-zinc-600\">Browse plans, pricing and current versions.</div>\r\n          </div>\r\n          <div className=\"w-full sm:w-[360px]\">\r\n            <Input value={query} onChange={(e) => setQuery(e.target.value)} placeholder=\"Search by name or code…\" />\r\n          </div>\r\n        </div>\r\n\r\n        {loading ? (\r\n          <div className=\"grid grid-cols-1 gap-4 sm:grid-cols-2 xl:grid-cols-3\">\r\n            {Array.from({ length: 6 }).map((_, idx) => (\r\n              <BillingPlanCardSkeleton key={idx} />\r\n            ))}\r\n          </div>\r\n        ) : null}\r\n\r\n        {!loading && filteredPlans.length === 0 ? <div className=\"text-sm text-zinc-500\">No billing plans found.</div> : null}\r\n\r\n        {!loading && filteredPlans.length > 0 ? (\r\n          <div className=\"grid grid-cols-1 gap-4 sm:grid-cols-2 xl:grid-cols-3\">\r\n            {filteredPlans.map((p) => {\r\n              const version = pickDisplayVersion(p);\r\n              const price = pickDisplayPrice(version);\r\n              const versions = Array.isArray(p.versions) ? p.versions : [];\r\n              const allPrices = versions.flatMap((v) => (Array.isArray(v.prices) ? v.prices : []));\r\n              const currencies = Array.from(new Set(allPrices.map((x) => x.currency).filter(Boolean)))\r\n                .map((c) => String(c).toUpperCase())\r\n                .sort();\r\n              const isFeatured = String(p.code || \"\").toLowerCase() === \"pro\";\r\n              const features = planEntitlementList(p);\r\n\r\n              return (\r\n                <Card\r\n                  key={p.id}\r\n                  className={\r\n                    \"relative overflow-hidden transition-all hover:-translate-y-0.5 hover:shadow-[var(--rb-shadow)] \" +\r\n                    (isFeatured ? \"border-[color:color-mix(in_srgb,var(--rb-orange),white_35%)] shadow-[var(--rb-shadow)]\" : \"\")\r\n                  }\r\n                >\r\n                  <div\r\n                    className={\r\n                      \"h-1.5 w-full \" +\r\n                      (isFeatured ? \"bg-[var(--rb-orange)]\" : p.is_active ? \"bg-[var(--rb-blue)]\" : \"bg-[var(--rb-border)]\")\r\n                    }\r\n                  />\r\n\r\n                  <CardHeader className=\"pb-3\">\r\n                    <div className=\"flex items-start justify-between gap-3\">\r\n                      <div className=\"min-w-0\">\r\n                        <CardTitle className=\"truncate\">{p.name}</CardTitle>\r\n                        <div className=\"mt-1 flex flex-wrap items-center gap-2\">\r\n                          <div className=\"truncate text-xs text-zinc-500\">{p.code}</div>\r\n                          {isFeatured ? <Badge variant=\"warning\">Most popular</Badge> : null}\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"text-right\">\r\n                        <div className=\"flex items-center justify-end gap-2\">\r\n                          <div className=\"text-2xl font-semibold tracking-tight text-[var(--rb-text)]\">\r\n                            {price ? formatCents({ currency: price.currency, amountCents: price.amount_cents }) : \"—\"}\r\n                          </div>\r\n                          <div className=\"pt-1 text-sm text-zinc-600\">{price ? intervalLabel(price.interval) : \"\"}</div>\r\n                        </div>\r\n                        <div className=\"mt-1 flex items-center justify-end gap-2\">\r\n                          <Badge variant={p.is_active ? \"success\" : \"default\"}>{p.is_active ? \"active\" : \"inactive\"}</Badge>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </CardHeader>\r\n\r\n                  <CardContent className=\"space-y-4\">\r\n                    <div className=\"text-sm text-zinc-700\">{p.description ?? \"—\"}</div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                      {price?.trial_days ? <div className=\"text-xs text-zinc-500\">{price.trial_days} day trial included</div> : null}\r\n                      <ul className=\"space-y-1\">\r\n                        {features.length > 0 ? (\r\n                          features.map((f) => (\r\n                            <li key={f} className=\"flex items-start gap-2 text-sm text-zinc-700\">\r\n                              <CheckIcon className=\"mt-0.5 h-4 w-4 shrink-0 text-[var(--rb-blue)]\" />\r\n                              <span className=\"min-w-0\">{f}</span>\r\n                            </li>\r\n                          ))\r\n                        ) : (\r\n                          <li className=\"text-sm text-zinc-500\">No entitlements configured.</li>\r\n                        )}\r\n                      </ul>\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-2 gap-3 border-t border-[var(--rb-border)] pt-4\">\r\n                      <div>\r\n                        <div className=\"text-xs text-zinc-500\">Current version</div>\r\n                        <div className=\"mt-1 text-sm font-medium text-zinc-800\">{version ? `v${version.version} (${version.status})` : \"—\"}</div>\r\n                      </div>\r\n                      <div>\r\n                        <div className=\"text-xs text-zinc-500\">Currencies</div>\r\n                        <div className=\"mt-1 text-sm font-medium text-zinc-800\">{currencies.length > 0 ? currencies.join(\", \") : \"—\"}</div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center justify-end gap-2 pt-1\">\r\n                      <Link href={`/admin/billing/plans/${p.id}`}>\r\n                        <Button variant={isFeatured ? \"secondary\" : \"outline\"} size=\"sm\">\r\n                          View plan\r\n                        </Button>\r\n                      </Link>\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n              );\r\n            })}\r\n          </div>\r\n        ) : null}\r\n\r\n        <div className=\"text-sm text-zinc-500\">\r\n          Entitlements definitions are available under{\" \"}\r\n          <Link className=\"underline\" href=\"/admin/billing/entitlements\">\r\n            Billing / Entitlements\r\n          </Link>\r\n          .\r\n        </div>\r\n\r\n        <Modal\r\n          open={createOpen}\r\n          onClose={() => {\r\n            if (!createBusy) setCreateOpen(false);\r\n          }}\r\n          title=\"Create billing plan\"\r\n          footer={\r\n            <div className=\"flex items-center justify-end gap-2\">\r\n              <Button\r\n                variant=\"outline\"\r\n                onClick={() => {\r\n                  if (!createBusy) setCreateOpen(false);\r\n                }}\r\n                disabled={createBusy}\r\n              >\r\n                Cancel\r\n              </Button>\r\n              <Button variant=\"primary\" onClick={() => void onCreate()} disabled={createBusy}>\r\n                {createBusy ? \"Creating…\" : \"Create\"}\r\n              </Button>\r\n            </div>\r\n          }\r\n        >\r\n          <div className=\"space-y-4\">\r\n            {createError ? (\r\n              <Alert variant=\"danger\" title=\"Cannot create plan\">\r\n                {createError}\r\n              </Alert>\r\n            ) : null}\r\n\r\n            <div className=\"space-y-1\">\r\n              <label className=\"text-sm font-medium\">Name</label>\r\n              <Input value={name} onChange={(e) => setName(e.target.value)} placeholder=\"e.g. Starter\" />\r\n            </div>\r\n\r\n            <div className=\"space-y-1\">\r\n              <label className=\"text-sm font-medium\">Code (optional)</label>\r\n              <Input value={code} onChange={(e) => setCode(e.target.value)} placeholder=\"e.g. starter\" />\r\n              <div className=\"text-xs text-zinc-500\">If empty, it will be generated from the name.</div>\r\n            </div>\r\n\r\n            <div className=\"space-y-1\">\r\n              <label className=\"text-sm font-medium\">Description (optional)</label>\r\n              <textarea\r\n                className=\"min-h-[90px] w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm\"\r\n                value={description}\r\n                onChange={(e) => setDescription(e.target.value)}\r\n                placeholder=\"Short description shown to admins…\"\r\n              />\r\n            </div>\r\n\r\n            <label className=\"flex items-center gap-2 text-sm\">\r\n              <input type=\"checkbox\" checked={isActive} onChange={(e) => setIsActive(e.target.checked)} />\r\n              Active\r\n            </label>\r\n\r\n            <div className=\"text-xs text-zinc-500\">A draft version v1 will be created automatically.</div>\r\n          </div>\r\n        </Modal>\r\n      </div>\r\n    </RequireAuth>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}