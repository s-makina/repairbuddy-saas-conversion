{"version":3,"sources":["../../../../../frontend/src/app/app/%5Btenant%5D/estimates/new/page.tsx","../../../../../frontend/src/components/repairbuddy/EstimateWizard.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React from \"react\";\r\nimport { useParams } from \"next/navigation\";\r\nimport { RequireAuth } from \"@/components/RequireAuth\";\r\nimport { EstimateWizard } from \"@/components/repairbuddy/EstimateWizard\";\r\n\r\nexport default function NewEstimatePage() {\r\n  const params = useParams() as { tenant?: string; business?: string };\r\n  const tenantSlug = params.business ?? params.tenant;\r\n  if (typeof tenantSlug !== \"string\" || tenantSlug.trim().length === 0) {\r\n    return (\r\n      <RequireAuth requiredPermission=\"estimates.manage\">\r\n        <div className=\"text-sm text-zinc-600\">Tenant is missing.</div>\r\n      </RequireAuth>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <RequireAuth requiredPermission=\"estimates.manage\">\r\n      <EstimateWizard tenantSlug={tenantSlug} />\r\n    </RequireAuth>\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport React, { useEffect, useMemo, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport Select from \"react-select\";\r\nimport AsyncSelect from \"react-select/async\";\r\nimport { useAuth } from \"@/lib/auth\";\r\nimport { PageHeader } from \"@/components/ui/PageHeader\";\r\nimport { Button } from \"@/components/ui/Button\";\r\nimport { Input } from \"@/components/ui/Input\";\r\nimport { FormRow } from \"@/components/ui/FormRow\";\r\nimport { Modal } from \"@/components/ui/Modal\";\r\nimport { apiFetch, ApiError } from \"@/lib/api\";\r\nimport { notify } from \"@/lib/notify\";\r\nimport { WizardShell } from \"@/components/repairbuddy/wizard/WizardShell\";\r\nimport { DevicesAdminEditor } from \"@/components/repairbuddy/wizard/DevicesAdminEditor\";\r\nimport { CustomerCreateModal } from \"@/components/repairbuddy/wizard/CustomerCreateModal\";\r\nimport { ItemsStep } from \"@/components/repairbuddy/wizard/ItemsStep\";\r\nimport { getRepairBuddySettings } from \"@/lib/repairbuddy-settings\";\r\n\r\ntype ApiDevice = {\r\n  id: number;\r\n  model: string;\r\n};\r\n\r\ntype ApiClient = {\r\n  id: number;\r\n  name: string;\r\n  email: string | null;\r\n  phone: string | null;\r\n  company: string | null;\r\n};\r\n\r\ntype CustomerOption = {\r\n  value: number;\r\n  label: string;\r\n};\r\n\r\ntype DeviceOption = {\r\n  value: number;\r\n  label: string;\r\n};\r\n\r\ntype NewEstimateDeviceDraft = {\r\n  device_id: number | null;\r\n  option: DeviceOption | null;\r\n  serial: string;\r\n  pin: string;\r\n  notes: string;\r\n  extra_fields: Array<{ key: string; label: string; value_text: string }>;\r\n};\r\n\r\ntype ApiTechnician = {\r\n  id: number;\r\n  name: string;\r\n  email: string;\r\n};\r\n\r\ntype TechnicianOption = {\r\n  value: number;\r\n  label: string;\r\n};\r\n\r\ntype PartDraft = {\r\n  id: number;\r\n  name: string;\r\n  code: string;\r\n  capacity: string;\r\n};\r\n\r\ntype PartOption = {\r\n  value: number;\r\n  label: string;\r\n  code: string;\r\n  capacity: string;\r\n};\r\n\r\ntype EstimatePartLineDraft = {\r\n  id: string;\r\n  part_id: number;\r\n  part: PartDraft;\r\n  device_id: number | null;\r\n  qty: string;\r\n  price: string;\r\n};\r\n\r\ntype ApiPart = {\r\n  id: number;\r\n  name: string;\r\n  manufacturing_code: string | null;\r\n  capacity: string | null;\r\n};\r\n\r\ntype ServiceDraft = {\r\n  id: number;\r\n  name: string;\r\n};\r\n\r\ntype ServiceOption = {\r\n  value: number;\r\n  label: string;\r\n};\r\n\r\ntype EstimateServiceLineDraft = {\r\n  id: string;\r\n  service_id: number;\r\n  service: ServiceDraft;\r\n  device_id: number | null;\r\n  qty: string;\r\n  price: string;\r\n};\r\n\r\ntype EstimateOtherItemLineDraft = {\r\n  id: string;\r\n  name: string;\r\n  qty: string;\r\n  price: string;\r\n};\r\n\r\ntype ApiService = {\r\n  id: number;\r\n  name: string;\r\n  base_price: { currency: string; amount_cents: number } | null;\r\n};\r\n\r\ntype DeviceContextOption = {\r\n  value: number;\r\n  label: string;\r\n};\r\n\r\ntype ApiEstimate = {\r\n  id: number;\r\n};\r\n\r\nfunction makeId(prefix: string) {\r\n  if (typeof crypto !== \"undefined\" && \"randomUUID\" in crypto) {\r\n    return `${prefix}-${crypto.randomUUID()}`;\r\n  }\r\n  return `${prefix}-${Date.now()}-${Math.random().toString(16).slice(2)}`;\r\n}\r\n\r\nexport function EstimateWizard({ tenantSlug }: { tenantSlug: string }) {\r\n  const auth = useAuth();\r\n  const router = useRouter();\r\n\r\n  const defaultCaseNumber = useMemo(() => {\r\n    const now = new Date();\r\n    const yyyy = String(now.getFullYear());\r\n    const mm = String(now.getMonth() + 1).padStart(2, \"0\");\r\n    const dd = String(now.getDate()).padStart(2, \"0\");\r\n    const hh = String(now.getHours()).padStart(2, \"0\");\r\n    const min = String(now.getMinutes()).padStart(2, \"0\");\r\n    const ss = String(now.getSeconds()).padStart(2, \"0\");\r\n    return `RB-${yyyy}${mm}${dd}-${hh}${min}${ss}`;\r\n  }, []);\r\n\r\n  const [loadingLookups, setLoadingLookups] = useState(true);\r\n  const [busy, setBusy] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const [step, setStep] = useState<1 | 2 | 3>(1);\r\n\r\n  const [title, setTitle] = useState(\"\");\r\n  const [caseNumber, setCaseNumber] = useState<string>(defaultCaseNumber);\r\n  const [pickupDate, setPickupDate] = useState<string>(\"\");\r\n  const [deliveryDate, setDeliveryDate] = useState<string>(\"\");\r\n  const [caseDetail, setCaseDetail] = useState<string>(\"\");\r\n\r\n  const [customerId, setCustomerId] = useState<number | null>(null);\r\n  const [customerOption, setCustomerOption] = useState<CustomerOption | null>(null);\r\n\r\n  const [customerMode, setCustomerMode] = useState<\"existing\" | \"new\">(\"existing\");\r\n  const [customerCreateName, setCustomerCreateName] = useState(\"\");\r\n  const [customerCreateEmail, setCustomerCreateEmail] = useState(\"\");\r\n  const [customerCreatePhone, setCustomerCreatePhone] = useState(\"\");\r\n  const [customerCreateCompany, setCustomerCreateCompany] = useState(\"\");\r\n\r\n  const [customerCreateOpen, setCustomerCreateOpen] = useState(false);\r\n  const [customerCreateError, setCustomerCreateError] = useState<string | null>(null);\r\n\r\n  const [assignedTechnicianId, setAssignedTechnicianId] = useState<number | null>(null);\r\n\r\n  const [estimateDevicesAdmin, setEstimateDevicesAdmin] = useState<NewEstimateDeviceDraft[]>([\r\n    {\r\n      device_id: null,\r\n      option: null,\r\n      serial: \"\",\r\n      pin: \"\",\r\n      notes: \"\",\r\n      extra_fields: [],\r\n    },\r\n  ]);\r\n\r\n  const [customers, setCustomers] = useState<ApiClient[]>([]);\r\n  const [devicesCatalog, setDevicesCatalog] = useState<ApiDevice[]>([]);\r\n  const [technicians, setTechnicians] = useState<ApiTechnician[]>([]);\r\n\r\n  const [pinEnabled, setPinEnabled] = useState(false);\r\n  const [pinLabel, setPinLabel] = useState(\"Pin\");\r\n\r\n  const [partsCatalog, setPartsCatalog] = useState<PartDraft[]>([]);\r\n  const [servicesCatalog, setServicesCatalog] = useState<ServiceDraft[]>([]);\r\n\r\n  const [estimateServices, setEstimateServices] = useState<EstimateServiceLineDraft[]>([]);\r\n  const [estimateParts, setEstimateParts] = useState<EstimatePartLineDraft[]>([]);\r\n  const [estimateOtherItems, setEstimateOtherItems] = useState<EstimateOtherItemLineDraft[]>([]);\r\n\r\n  const [servicePickerModalOpen, setServicePickerModalOpen] = useState(false);\r\n  const [servicePickerError, setServicePickerError] = useState<string | null>(null);\r\n  const [servicePickerService, setServicePickerService] = useState<ServiceOption | null>(null);\r\n  const [servicePickerDevice, setServicePickerDevice] = useState<DeviceContextOption | null>(null);\r\n  const [servicePickerQty, setServicePickerQty] = useState(\"1\");\r\n  const [servicePickerPrice, setServicePickerPrice] = useState(\"\");\r\n\r\n  const [partPickerModalOpen, setPartPickerModalOpen] = useState(false);\r\n  const [partPickerError, setPartPickerError] = useState<string | null>(null);\r\n  const [partPickerPart, setPartPickerPart] = useState<PartOption | null>(null);\r\n  const [partPickerDevice, setPartPickerDevice] = useState<DeviceContextOption | null>(null);\r\n  const [partPickerQty, setPartPickerQty] = useState(\"1\");\r\n  const [partPickerPrice, setPartPickerPrice] = useState(\"\");\r\n\r\n  const isStep1 = step === 1;\r\n  const isStep2 = step === 2;\r\n  const isStep3 = step === 3;\r\n  const stepIndex = step === 1 ? 0 : step === 2 ? 1 : 2;\r\n  const progress = stepIndex / 2;\r\n\r\n  const disabled = busy || loadingLookups;\r\n\r\n  const clientOptions = useMemo(() => {\r\n    return customers\r\n      .slice()\r\n      .sort((a, b) => `${a.name}`.localeCompare(`${b.name}`))\r\n      .map((c) => ({\r\n        value: c.id,\r\n        label: c.email ? `${c.name} (${c.email})` : c.name,\r\n      }));\r\n  }, [customers]);\r\n\r\n  const technicianOptions = useMemo(() => {\r\n    return technicians\r\n      .slice()\r\n      .sort((a, b) => `${a.name}`.localeCompare(`${b.name}`))\r\n      .map((t) => ({ value: t.id, label: `${t.name} (${t.email})` }));\r\n  }, [technicians]);\r\n\r\n  const selectedTechnicianOption = useMemo(() => {\r\n    if (typeof assignedTechnicianId !== \"number\") return null;\r\n    const found = technicianOptions.find((o) => o.value === assignedTechnicianId);\r\n    return found ?? null;\r\n  }, [assignedTechnicianId, technicianOptions]);\r\n\r\n  const deviceOptions = useMemo(() => {\r\n    return devicesCatalog\r\n      .slice()\r\n      .sort((a, b) => `${a.model}`.localeCompare(`${b.model}`))\r\n      .map((d) => ({ value: d.id, label: d.model }));\r\n  }, [devicesCatalog]);\r\n\r\n  const selectedDeviceOptions = useMemo(() => {\r\n    const ids = estimateDevicesAdmin\r\n      .map((d) => (typeof d.device_id === \"number\" ? d.device_id : null))\r\n      .filter((x): x is number => typeof x === \"number\");\r\n\r\n    return ids\r\n      .map((id) => deviceOptions.find((o) => o.value === id) ?? { value: id, label: `Device #${id}` })\r\n      .filter(Boolean);\r\n  }, [deviceOptions, estimateDevicesAdmin]);\r\n\r\n  const deviceContextOptions = useMemo(() => {\r\n    return selectedDeviceOptions.map((d) => ({ value: d.value, label: d.label }));\r\n  }, [selectedDeviceOptions]);\r\n\r\n  const serviceOptions = useMemo(() => {\r\n    return servicesCatalog\r\n      .slice()\r\n      .sort((a, b) => `${a.name}`.localeCompare(`${b.name}`))\r\n      .map((s) => ({ value: s.id, label: s.name }));\r\n  }, [servicesCatalog]);\r\n\r\n  const partOptions = useMemo(() => {\r\n    return partsCatalog\r\n      .slice()\r\n      .sort((a, b) => `${a.name}`.localeCompare(`${b.name}`))\r\n      .map((p) => ({ value: p.id, label: p.name, code: p.code, capacity: p.capacity }));\r\n  }, [partsCatalog]);\r\n\r\n  const estimatedTotal = useMemo(() => {\r\n    const sumLines = (lines: Array<{ qty: string; price: string }>) => {\r\n      return lines.reduce((acc, l) => {\r\n        const q = Number(l.qty);\r\n        const p = Number(l.price);\r\n        if (!Number.isFinite(q) || !Number.isFinite(p)) return acc;\r\n        return acc + q * p;\r\n      }, 0);\r\n    };\r\n\r\n    return sumLines(estimateServices) + sumLines(estimateParts) + sumLines(estimateOtherItems);\r\n  }, [estimateOtherItems, estimateParts, estimateServices]);\r\n\r\n  const selectedCustomer = useMemo(() => {\r\n    if (typeof customerId !== \"number\") return null;\r\n    return customers.find((c) => c.id === customerId) ?? null;\r\n  }, [customers, customerId]);\r\n\r\n  const canSendEmail = useMemo(() => {\r\n    if (customerMode === \"new\") {\r\n      return customerCreateEmail.trim().length > 0;\r\n    }\r\n    const email = selectedCustomer?.email ?? \"\";\r\n    return email.trim().length > 0;\r\n  }, [customerCreateEmail, customerMode, selectedCustomer?.email]);\r\n\r\n  useEffect(() => {\r\n    let alive = true;\r\n\r\n    async function loadLookups() {\r\n      if (typeof tenantSlug !== \"string\" || tenantSlug.length === 0) return;\r\n\r\n      try {\r\n        setLoadingLookups(true);\r\n\r\n        const [clientsRes, devicesRes, techniciansRes, partsRes, servicesRes, settingsRes] = await Promise.all([\r\n          apiFetch<{ clients: ApiClient[] }>(`/api/${tenantSlug}/app/clients?limit=200`),\r\n          apiFetch<{ devices: ApiDevice[] }>(`/api/${tenantSlug}/app/repairbuddy/devices?limit=10`),\r\n          apiFetch<{ users: ApiTechnician[] }>(`/api/${tenantSlug}/app/technicians?per_page=100&sort=name&dir=asc`),\r\n          apiFetch<{ parts: ApiPart[] }>(`/api/${tenantSlug}/app/repairbuddy/parts?limit=200`),\r\n          apiFetch<{ services: ApiService[] }>(`/api/${tenantSlug}/app/repairbuddy/services?limit=200`),\r\n          getRepairBuddySettings(String(tenantSlug)),\r\n        ]);\r\n\r\n        if (!alive) return;\r\n\r\n        setCustomers(Array.isArray(clientsRes.clients) ? clientsRes.clients : []);\r\n        setDevicesCatalog(Array.isArray(devicesRes.devices) ? devicesRes.devices : []);\r\n        setTechnicians(Array.isArray(techniciansRes.users) ? techniciansRes.users : []);\r\n\r\n        setPinEnabled(Boolean(settingsRes.settings?.devicesBrands?.enablePinCodeField));\r\n        const rawLabels = settingsRes.settings?.devicesBrands?.labels;\r\n        const nextPinLabel =\r\n          rawLabels && typeof rawLabels === \"object\" && typeof (rawLabels as { pin?: unknown }).pin === \"string\"\r\n            ? String((rawLabels as { pin?: unknown }).pin).trim()\r\n            : \"\";\r\n        setPinLabel(nextPinLabel !== \"\" ? nextPinLabel : \"Pin\");\r\n\r\n        const partsList = Array.isArray(partsRes.parts) ? partsRes.parts : [];\r\n        setPartsCatalog(\r\n          partsList.map((p) => ({\r\n            id: p.id,\r\n            name: p.name,\r\n            code: p.manufacturing_code ?? \"\",\r\n            capacity: p.capacity ?? \"\",\r\n          })),\r\n        );\r\n\r\n        const servicesList = Array.isArray(servicesRes.services) ? servicesRes.services : [];\r\n        setServicesCatalog(servicesList.map((s) => ({ id: s.id, name: s.name })));\r\n\r\n        setError(null);\r\n      } catch (e) {\r\n        if (!alive) return;\r\n\r\n        if (e instanceof ApiError && e.status === 428 && typeof tenantSlug === \"string\" && tenantSlug.trim().length > 0) {\r\n          const next = `/app/${tenantSlug}/estimates/new`;\r\n          router.replace(`/app/${tenantSlug}/branches/select?next=${encodeURIComponent(next)}`);\r\n          return;\r\n        }\r\n\r\n        setError(e instanceof Error ? e.message : \"Failed to load form data.\");\r\n        setCustomers([]);\r\n        setDevicesCatalog([]);\r\n        setTechnicians([]);\r\n        setPinEnabled(false);\r\n        setPinLabel(\"Pin\");\r\n      } finally {\r\n        if (!alive) return;\r\n        setLoadingLookups(false);\r\n      }\r\n    }\r\n\r\n    void loadLookups();\r\n\r\n    return () => {\r\n      alive = false;\r\n    };\r\n  }, [router, tenantSlug]);\r\n\r\n  const loadCustomerOptions = async (inputValue: string): Promise<CustomerOption[]> => {\r\n    if (typeof tenantSlug !== \"string\" || tenantSlug.length === 0) return [];\r\n\r\n    try {\r\n      const qs = new URLSearchParams();\r\n      qs.set(\"limit\", \"50\");\r\n      const q = inputValue.trim();\r\n      if (q) qs.set(\"query\", q);\r\n\r\n      const res = await apiFetch<{ clients: ApiClient[] }>(`/api/${tenantSlug}/app/clients?${qs.toString()}`);\r\n      const list = Array.isArray(res.clients) ? res.clients : [];\r\n      return list.map((c) => ({\r\n        value: c.id,\r\n        label: c.email ? `${c.name} (${c.email})` : c.name,\r\n      }));\r\n    } catch {\r\n      return [];\r\n    }\r\n  };\r\n\r\n  const loadDeviceOptions = async (inputValue: string): Promise<DeviceOption[]> => {\r\n    if (typeof tenantSlug !== \"string\" || tenantSlug.length === 0) return [];\r\n\r\n    try {\r\n      const qs = new URLSearchParams();\r\n      qs.set(\"limit\", inputValue.trim() ? \"50\" : \"10\");\r\n      const q = inputValue.trim();\r\n      if (q) qs.set(\"q\", q);\r\n\r\n      const res = await apiFetch<{ devices: ApiDevice[] }>(`/api/${tenantSlug}/app/repairbuddy/devices?${qs.toString()}`);\r\n      const list = Array.isArray(res.devices) ? res.devices : [];\r\n      return list.map((d) => ({ value: d.id, label: d.model }));\r\n    } catch {\r\n      return [];\r\n    }\r\n  };\r\n\r\n  async function submitEstimate(mode: \"save\" | \"save_send\") {\r\n    if (typeof tenantSlug !== \"string\" || tenantSlug.length === 0) return;\r\n    if (busy) return;\r\n\r\n    setError(null);\r\n    setBusy(true);\r\n\r\n    try {\r\n      const trimmedTitle = title.trim();\r\n      if (trimmedTitle === \"\") {\r\n        setError(\"Title is required.\");\r\n        return;\r\n      }\r\n\r\n      const shouldCreateCustomer = customerMode === \"new\";\r\n      if (shouldCreateCustomer) {\r\n        if (customerCreateName.trim() === \"\") {\r\n          setError(\"Customer name is required.\");\r\n          return;\r\n        }\r\n        if (customerCreateEmail.trim() === \"\") {\r\n          setError(\"Customer email is required.\");\r\n          return;\r\n        }\r\n      }\r\n\r\n      if (!shouldCreateCustomer && typeof customerId !== \"number\") {\r\n        setError(\"Select a customer.\");\r\n        return;\r\n      }\r\n\r\n      const payload: Record<string, unknown> = {\r\n        case_number: caseNumber.trim() !== \"\" ? caseNumber.trim() : null,\r\n        title: trimmedTitle,\r\n        status: \"pending\",\r\n        customer_id: !shouldCreateCustomer && typeof customerId === \"number\" ? customerId : null,\r\n        pickup_date: pickupDate.trim() !== \"\" ? pickupDate.trim() : null,\r\n        delivery_date: deliveryDate.trim() !== \"\" ? deliveryDate.trim() : null,\r\n        case_detail: caseDetail.trim() !== \"\" ? caseDetail.trim() : null,\r\n        assigned_technician_id: typeof assignedTechnicianId === \"number\" ? assignedTechnicianId : null,\r\n        devices:\r\n          estimateDevicesAdmin.length > 0\r\n            ? estimateDevicesAdmin\r\n                .filter((d) => typeof d.device_id === \"number\")\r\n                .map((d) => ({\r\n                  device_id: d.device_id as number,\r\n                  serial: d.serial.trim() !== \"\" ? d.serial.trim() : null,\r\n                  pin: pinEnabled && d.pin.trim() !== \"\" ? d.pin.trim() : null,\r\n                  notes: d.notes.trim() !== \"\" ? d.notes.trim() : null,\r\n                }))\r\n            : [],\r\n      };\r\n\r\n      if (shouldCreateCustomer) {\r\n        payload.customer_create = {\r\n          name: customerCreateName.trim(),\r\n          email: customerCreateEmail.trim(),\r\n          ...(customerCreatePhone.trim() !== \"\" ? { phone: customerCreatePhone.trim() } : {}),\r\n          ...(customerCreateCompany.trim() !== \"\" ? { company: customerCreateCompany.trim() } : {}),\r\n        };\r\n      }\r\n\r\n      const res = await apiFetch<{ estimate: ApiEstimate }>(`/api/${tenantSlug}/app/repairbuddy/estimates`, {\r\n        method: \"POST\",\r\n        body: payload,\r\n      });\r\n\r\n      const estimateId = res?.estimate?.id;\r\n      if (typeof estimateId !== \"number\") {\r\n        throw new Error(\"Estimate creation failed.\");\r\n      }\r\n\r\n      try {\r\n        for (const line of estimateServices) {\r\n          const qtyNum = Math.round(Number(line.qty));\r\n          const qty = Number.isFinite(qtyNum) && qtyNum > 0 ? qtyNum : 1;\r\n\r\n          const rawPrice = line.price.trim();\r\n          const priceNum = rawPrice.length > 0 ? Number(rawPrice) : NaN;\r\n          const unitPriceAmountCents = Number.isFinite(priceNum) ? Math.round(priceNum * 100) : undefined;\r\n\r\n          await apiFetch(`/api/${tenantSlug}/app/repairbuddy/estimates/${estimateId}/items`, {\r\n            method: \"POST\",\r\n            body: {\r\n              item_type: \"service\",\r\n              ref_id: line.service_id,\r\n              qty,\r\n              ...(typeof unitPriceAmountCents === \"number\" ? { unit_price_amount_cents: unitPriceAmountCents } : {}),\r\n              meta: {\r\n                ...(typeof line.device_id === \"number\" ? { device_id: line.device_id } : {}),\r\n              },\r\n            },\r\n          });\r\n        }\r\n\r\n        for (const line of estimateOtherItems) {\r\n          const name = line.name.trim();\r\n          if (name === \"\") continue;\r\n\r\n          const qtyNum = Math.round(Number(line.qty));\r\n          const qty = Number.isFinite(qtyNum) && qtyNum > 0 ? qtyNum : 1;\r\n\r\n          const rawPrice = line.price.trim();\r\n          const priceNum = rawPrice.length > 0 ? Number(rawPrice) : NaN;\r\n          const unitPriceAmountCents = Number.isFinite(priceNum) ? Math.round(priceNum * 100) : undefined;\r\n          if (typeof unitPriceAmountCents !== \"number\") continue;\r\n\r\n          await apiFetch(`/api/${tenantSlug}/app/repairbuddy/estimates/${estimateId}/items`, {\r\n            method: \"POST\",\r\n            body: {\r\n              item_type: unitPriceAmountCents < 0 ? \"discount\" : \"fee\",\r\n              name,\r\n              qty,\r\n              unit_price_amount_cents: unitPriceAmountCents,\r\n            },\r\n          });\r\n        }\r\n\r\n        for (const line of estimateParts) {\r\n          const qtyNum = Math.round(Number(line.qty));\r\n          const qty = Number.isFinite(qtyNum) && qtyNum > 0 ? qtyNum : 1;\r\n\r\n          const rawPrice = line.price.trim();\r\n          const priceNum = rawPrice.length > 0 ? Number(rawPrice) : NaN;\r\n          const unitPriceAmountCents = Number.isFinite(priceNum) ? Math.round(priceNum * 100) : undefined;\r\n\r\n          await apiFetch(`/api/${tenantSlug}/app/repairbuddy/estimates/${estimateId}/items`, {\r\n            method: \"POST\",\r\n            body: {\r\n              item_type: \"part\",\r\n              ref_id: line.part_id,\r\n              qty,\r\n              ...(typeof unitPriceAmountCents === \"number\" ? { unit_price_amount_cents: unitPriceAmountCents } : {}),\r\n              meta: {\r\n                ...(typeof line.device_id === \"number\" ? { device_id: line.device_id } : {}),\r\n              },\r\n            },\r\n          });\r\n        }\r\n      } catch (err) {\r\n        notify.error(err instanceof ApiError ? err.message : \"Estimate created, but failed to attach items.\");\r\n      }\r\n\r\n      if (mode === \"save_send\") {\r\n        try {\r\n          await apiFetch(`/api/${tenantSlug}/app/repairbuddy/estimates/${estimateId}/send`, {\r\n            method: \"POST\",\r\n          });\r\n          notify.success(\"Estimate sent.\");\r\n        } catch (err) {\r\n          notify.error(err instanceof ApiError ? err.message : \"Estimate saved, but sending failed.\");\r\n        }\r\n      }\r\n\r\n      notify.success(\"Estimate created.\");\r\n      router.replace(`/app/${tenantSlug}/estimates/${estimateId}`);\r\n    } catch (e) {\r\n      if (e instanceof ApiError) {\r\n        setError(e.message);\r\n      } else {\r\n        setError(e instanceof Error ? e.message : \"Failed to create estimate.\");\r\n      }\r\n    } finally {\r\n      setBusy(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <PageHeader title=\"New estimate\" description=\"Complete the steps to create the estimate.\" />\r\n\r\n      {error ? <div className=\"text-sm text-red-600\">{error}</div> : null}\r\n\r\n      <CustomerCreateModal\r\n        open={customerCreateOpen}\r\n        title=\"Add customer\"\r\n        disabled={disabled}\r\n        error={customerCreateError}\r\n        setError={setCustomerCreateError}\r\n        name={customerCreateName}\r\n        setName={setCustomerCreateName}\r\n        email={customerCreateEmail}\r\n        setEmail={setCustomerCreateEmail}\r\n        emailInputType=\"email\"\r\n        phone={customerCreatePhone}\r\n        setPhone={setCustomerCreatePhone}\r\n        company={customerCreateCompany}\r\n        setCompany={setCustomerCreateCompany}\r\n        onClose={() => setCustomerCreateOpen(false)}\r\n        onSave={({ name, email }) => {\r\n          setCustomerMode(\"new\");\r\n          setCustomerId(null);\r\n          setCustomerOption({ value: -1, label: `${name} (${email})` });\r\n          setCustomerCreateOpen(false);\r\n        }}\r\n      />\r\n\r\n      <Modal\r\n        open={servicePickerModalOpen}\r\n        title=\"Add service\"\r\n        onClose={() => {\r\n          setServicePickerError(null);\r\n          setServicePickerModalOpen(false);\r\n        }}\r\n        footer={\r\n          <div className=\"flex items-center justify-end gap-2\">\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={() => {\r\n                setServicePickerError(null);\r\n                setServicePickerModalOpen(false);\r\n              }}\r\n            >\r\n              Cancel\r\n            </Button>\r\n            <Button\r\n              type=\"button\"\r\n              onClick={() => {\r\n                if (!servicePickerService) {\r\n                  setServicePickerError(\"Please select a service.\");\r\n                  return;\r\n                }\r\n                if (!servicePickerDevice) {\r\n                  setServicePickerError(\"Please select a device.\");\r\n                  return;\r\n                }\r\n\r\n                const qtyNum = Math.round(Number(servicePickerQty));\r\n                const qty = Number.isFinite(qtyNum) && qtyNum > 0 ? String(qtyNum) : \"1\";\r\n\r\n                setEstimateServices((prev) => [\r\n                  ...prev,\r\n                  {\r\n                    id: makeId(\"svc\"),\r\n                    service_id: servicePickerService.value,\r\n                    service: { id: servicePickerService.value, name: servicePickerService.label },\r\n                    device_id: servicePickerDevice.value,\r\n                    qty,\r\n                    price: servicePickerPrice,\r\n                  },\r\n                ]);\r\n\r\n                setServicePickerService(null);\r\n                setServicePickerQty(\"1\");\r\n                setServicePickerPrice(\"\");\r\n                setServicePickerError(null);\r\n                setServicePickerModalOpen(false);\r\n              }}\r\n            >\r\n              Add\r\n            </Button>\r\n          </div>\r\n        }\r\n      >\r\n        <div className=\"space-y-4\">\r\n          {servicePickerError ? <div className=\"text-sm text-red-600\">{servicePickerError}</div> : null}\r\n\r\n          <div className=\"grid grid-cols-1 gap-3 md:grid-cols-2\">\r\n            <div className=\"md:col-span-2\">\r\n              <div className=\"mb-1 text-xs text-zinc-600\">Service</div>\r\n              <Select\r\n                instanceId=\"estimate_service_select\"\r\n                inputId=\"estimate_service_select\"\r\n                isSearchable\r\n                isClearable\r\n                options={serviceOptions}\r\n                value={servicePickerService}\r\n                onChange={(opt) => setServicePickerService((opt as ServiceOption | null) ?? null)}\r\n                isDisabled={disabled}\r\n                placeholder={serviceOptions.length > 0 ? \"Search services...\" : \"No services yet\"}\r\n                classNamePrefix=\"rb-select\"\r\n                styles={{\r\n                  control: (base) => ({\r\n                    ...base,\r\n                    borderRadius: \"var(--rb-radius-sm)\",\r\n                    borderColor: \"#d4d4d8\",\r\n                    minHeight: 40,\r\n                    boxShadow: \"none\",\r\n                  }),\r\n                  menu: (base) => ({\r\n                    ...base,\r\n                    zIndex: 50,\r\n                  }),\r\n                }}\r\n              />\r\n            </div>\r\n\r\n            <div className=\"md:col-span-2\">\r\n              <div className=\"mb-1 text-xs text-zinc-600\">Device</div>\r\n              <Select\r\n                instanceId=\"estimate_service_device_select\"\r\n                inputId=\"estimate_service_device_select\"\r\n                isSearchable\r\n                isClearable\r\n                options={deviceContextOptions}\r\n                value={servicePickerDevice}\r\n                onChange={(opt) => setServicePickerDevice((opt as DeviceContextOption | null) ?? null)}\r\n                isDisabled={disabled || deviceContextOptions.length === 0}\r\n                placeholder={deviceContextOptions.length > 0 ? \"Select device...\" : \"No devices selected\"}\r\n                classNamePrefix=\"rb-select\"\r\n                styles={{\r\n                  control: (base) => ({\r\n                    ...base,\r\n                    borderRadius: \"var(--rb-radius-sm)\",\r\n                    borderColor: \"#d4d4d8\",\r\n                    minHeight: 40,\r\n                    boxShadow: \"none\",\r\n                  }),\r\n                  menu: (base) => ({\r\n                    ...base,\r\n                    zIndex: 50,\r\n                  }),\r\n                }}\r\n              />\r\n            </div>\r\n\r\n            <div>\r\n              <div className=\"mb-1 text-xs text-zinc-600\">Qty</div>\r\n              <Input value={servicePickerQty} onChange={(e) => setServicePickerQty(e.target.value)} disabled={disabled} />\r\n            </div>\r\n            <div>\r\n              <div className=\"mb-1 text-xs text-zinc-600\">Price</div>\r\n              <Input value={servicePickerPrice} onChange={(e) => setServicePickerPrice(e.target.value)} disabled={disabled} placeholder=\"Optional\" />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </Modal>\r\n\r\n      <Modal\r\n        open={partPickerModalOpen}\r\n        title=\"Add part\"\r\n        onClose={() => {\r\n          setPartPickerError(null);\r\n          setPartPickerModalOpen(false);\r\n        }}\r\n        footer={\r\n          <div className=\"flex items-center justify-end gap-2\">\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={() => {\r\n                setPartPickerError(null);\r\n                setPartPickerModalOpen(false);\r\n              }}\r\n            >\r\n              Cancel\r\n            </Button>\r\n            <Button\r\n              type=\"button\"\r\n              onClick={() => {\r\n                if (!partPickerPart) {\r\n                  setPartPickerError(\"Please select a part.\");\r\n                  return;\r\n                }\r\n                if (!partPickerDevice) {\r\n                  setPartPickerError(\"Please select a device.\");\r\n                  return;\r\n                }\r\n\r\n                const qtyNum = Math.round(Number(partPickerQty));\r\n                const qty = Number.isFinite(qtyNum) && qtyNum > 0 ? String(qtyNum) : \"1\";\r\n\r\n                setEstimateParts((prev) => [\r\n                  ...prev,\r\n                  {\r\n                    id: makeId(\"part\"),\r\n                    part_id: partPickerPart.value,\r\n                    part: {\r\n                      id: partPickerPart.value,\r\n                      name: partPickerPart.label,\r\n                      code: partPickerPart.code,\r\n                      capacity: partPickerPart.capacity,\r\n                    },\r\n                    device_id: partPickerDevice.value,\r\n                    qty,\r\n                    price: partPickerPrice,\r\n                  },\r\n                ]);\r\n\r\n                setPartPickerPart(null);\r\n                setPartPickerQty(\"1\");\r\n                setPartPickerPrice(\"\");\r\n                setPartPickerError(null);\r\n                setPartPickerModalOpen(false);\r\n              }}\r\n            >\r\n              Add\r\n            </Button>\r\n          </div>\r\n        }\r\n      >\r\n        <div className=\"space-y-4\">\r\n          {partPickerError ? <div className=\"text-sm text-red-600\">{partPickerError}</div> : null}\r\n\r\n          <div className=\"grid grid-cols-1 gap-3 md:grid-cols-2\">\r\n            <div className=\"md:col-span-2\">\r\n              <div className=\"mb-1 text-xs text-zinc-600\">Select part</div>\r\n              <Select\r\n                instanceId=\"estimate_part_select\"\r\n                inputId=\"estimate_part_select\"\r\n                isSearchable\r\n                isClearable\r\n                options={partOptions}\r\n                value={partPickerPart}\r\n                onChange={(opt) => setPartPickerPart((opt as PartOption | null) ?? null)}\r\n                isDisabled={disabled}\r\n                placeholder={partOptions.length > 0 ? \"Search parts...\" : \"No parts yet\"}\r\n                classNamePrefix=\"rb-select\"\r\n                styles={{\r\n                  control: (base) => ({\r\n                    ...base,\r\n                    borderRadius: \"var(--rb-radius-sm)\",\r\n                    borderColor: \"#d4d4d8\",\r\n                    minHeight: 40,\r\n                    boxShadow: \"none\",\r\n                  }),\r\n                  menu: (base) => ({\r\n                    ...base,\r\n                    zIndex: 50,\r\n                  }),\r\n                }}\r\n              />\r\n            </div>\r\n\r\n            <div className=\"md:col-span-2\">\r\n              <div className=\"mb-1 text-xs text-zinc-600\">Device</div>\r\n              <Select\r\n                instanceId=\"estimate_part_device\"\r\n                isSearchable\r\n                isClearable\r\n                options={deviceContextOptions}\r\n                value={partPickerDevice}\r\n                onChange={(opt) => setPartPickerDevice((opt as DeviceContextOption | null) ?? null)}\r\n                isDisabled={disabled || deviceContextOptions.length === 0}\r\n                placeholder={deviceContextOptions.length > 0 ? \"Select device...\" : \"No devices selected\"}\r\n                classNamePrefix=\"rb-select\"\r\n                styles={{\r\n                  control: (base) => ({\r\n                    ...base,\r\n                    borderRadius: \"var(--rb-radius-sm)\",\r\n                    borderColor: \"#d4d4d8\",\r\n                    minHeight: 40,\r\n                    boxShadow: \"none\",\r\n                  }),\r\n                  menu: (base) => ({\r\n                    ...base,\r\n                    zIndex: 50,\r\n                  }),\r\n                }}\r\n              />\r\n            </div>\r\n\r\n            <div>\r\n              <div className=\"mb-1 text-xs text-zinc-600\">Qty</div>\r\n              <Input value={partPickerQty} onChange={(e) => setPartPickerQty(e.target.value)} disabled={disabled} />\r\n            </div>\r\n            <div>\r\n              <div className=\"mb-1 text-xs text-zinc-600\">Price</div>\r\n              <Input value={partPickerPrice} onChange={(e) => setPartPickerPrice(e.target.value)} disabled={disabled} placeholder=\"Optional\" />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </Modal>\r\n\r\n      <form\r\n        className=\"space-y-6\"\r\n        onSubmit={(e) => {\r\n          e.preventDefault();\r\n        }}\r\n      >\r\n        <WizardShell\r\n          steps={[\r\n            {\r\n              id: 1,\r\n              navTitle: \"Customer & devices\",\r\n              navDescription: \"Case, dates, customer, technician, description, devices.\",\r\n              pageTitle: \"Customer & devices\",\r\n              pageDescription: \"Enter the customer, technician, description and devices.\",\r\n              footerTitle: \"Customer & devices\",\r\n            },\r\n            {\r\n              id: 2,\r\n              navTitle: \"Items and services\",\r\n              navDescription: \"Add services, parts and other items.\",\r\n              pageTitle: \"Items and services\",\r\n              pageDescription: \"Attach services, parts and other items.\",\r\n              footerTitle: \"Items and services\",\r\n            },\r\n            {\r\n              id: 3,\r\n              navTitle: \"Review & send\",\r\n              navDescription: \"Review and optionally send the estimate.\",\r\n              pageTitle: \"Review & send\",\r\n              pageDescription: \"Review the estimate and optionally send it to the customer.\",\r\n              footerTitle: \"Review & send\",\r\n            },\r\n          ]}\r\n          step={step}\r\n          disabled={disabled}\r\n          sidebarTitle=\"Estimate steps\"\r\n          sidebarDescription=\"Complete the steps to create the estimate.\"\r\n          sidebarAriaLabel=\"Estimate steps\"\r\n          onStepChange={(next) => {\r\n            setError(null);\r\n            setStep(next as 1 | 2 | 3);\r\n          }}\r\n          footerRight={\r\n            <div className=\"flex items-center gap-2\">\r\n              <Button\r\n                id=\"rb_estimate_save\"\r\n                variant=\"outline\"\r\n                disabled={disabled}\r\n                type=\"button\"\r\n                onClick={() => void submitEstimate(\"save\")}\r\n              >\r\n                {busy ? \"Saving...\" : \"Save\"}\r\n              </Button>\r\n              <Button\r\n                id=\"rb_estimate_save_send\"\r\n                variant=\"primary\"\r\n                disabled={disabled || !auth.can(\"estimates.manage\") || !canSendEmail}\r\n                type=\"button\"\r\n                onClick={() => void submitEstimate(\"save_send\")}\r\n              >\r\n                {busy ? \"Saving...\" : \"Save & Send\"}\r\n              </Button>\r\n            </div>\r\n          }\r\n        >\r\n              {isStep1 ? (\r\n                <div className=\"space-y-5\">\r\n                  <FormRow label=\"Title\" fieldId=\"estimate_title\" required>\r\n                    <Input id=\"estimate_title\" value={title} onChange={(e) => setTitle(e.target.value)} disabled={disabled} />\r\n                  </FormRow>\r\n\r\n                  <FormRow label=\"Case number\" fieldId=\"estimate_case_number\">\r\n                    <Input id=\"estimate_case_number\" value={caseNumber} onChange={(e) => setCaseNumber(e.target.value)} disabled={disabled} />\r\n                  </FormRow>\r\n\r\n                  <FormRow label=\"Dates\" fieldId=\"estimate_dates\">\r\n                    <div className=\"grid grid-cols-1 gap-3 md:grid-cols-2\">\r\n                      <div>\r\n                        <div className=\"mb-1 text-xs text-zinc-600\">Pickup date</div>\r\n                        <Input id=\"estimate_pickup_date\" type=\"date\" value={pickupDate} onChange={(e) => setPickupDate(e.target.value)} disabled={disabled} />\r\n                      </div>\r\n                      <div>\r\n                        <div className=\"mb-1 text-xs text-zinc-600\">Delivery date</div>\r\n                        <Input id=\"estimate_delivery_date\" type=\"date\" value={deliveryDate} onChange={(e) => setDeliveryDate(e.target.value)} disabled={disabled} />\r\n                      </div>\r\n                    </div>\r\n                  </FormRow>\r\n\r\n                  <FormRow label=\"Customer\" fieldId=\"estimate_customer\">\r\n                    <div className=\"space-y-2\">\r\n                      <div className=\"flex items-start gap-2\">\r\n                        <div className=\"min-w-0 flex-1\">\r\n                          <AsyncSelect\r\n                            inputId=\"estimate_customer\"\r\n                            instanceId=\"estimate_customer\"\r\n                            cacheOptions\r\n                            defaultOptions={clientOptions}\r\n                            loadOptions={loadCustomerOptions}\r\n                            isClearable\r\n                            isSearchable\r\n                            value={customerOption}\r\n                            onChange={(opt) => {\r\n                              const next = (opt as CustomerOption | null) ?? null;\r\n                              setCustomerMode(\"existing\");\r\n                              setCustomerOption(next);\r\n                              setCustomerId(typeof next?.value === \"number\" && next.value > 0 ? next.value : null);\r\n                            }}\r\n                            isDisabled={disabled}\r\n                            placeholder=\"Search customers...\"\r\n                            classNamePrefix=\"rb-select\"\r\n                            styles={{\r\n                              control: (base) => ({\r\n                                ...base,\r\n                                borderRadius: \"var(--rb-radius-sm)\",\r\n                                borderColor: \"#d4d4d8\",\r\n                                minHeight: 40,\r\n                                boxShadow: \"none\",\r\n                              }),\r\n                              menu: (base) => ({\r\n                                ...base,\r\n                                zIndex: 50,\r\n                              }),\r\n                            }}\r\n                          />\r\n                        </div>\r\n\r\n                        <Button\r\n                          type=\"button\"\r\n                          variant=\"primary\"\r\n                          size=\"md\"\r\n                          className=\"w-10 px-0\"\r\n                          disabled={disabled}\r\n                          onClick={() => {\r\n                            setCustomerCreateError(null);\r\n                            setCustomerCreateOpen(true);\r\n                          }}\r\n                        >\r\n                          +\r\n                        </Button>\r\n                      </div>\r\n\r\n                      {customerMode === \"new\" ? <div className=\"text-xs text-zinc-600\">This estimate will create a new customer.</div> : null}\r\n                    </div>\r\n                  </FormRow>\r\n\r\n                  <FormRow label=\"Technician\" fieldId=\"estimate_technician\">\r\n                    <Select\r\n                      inputId=\"estimate_technician\"\r\n                      instanceId=\"estimate_technician\"\r\n                      isSearchable\r\n                      isClearable\r\n                      options={technicianOptions}\r\n                      value={selectedTechnicianOption}\r\n                      onChange={(opt) => {\r\n                        const next = (opt as TechnicianOption | null) ?? null;\r\n                        setAssignedTechnicianId(typeof next?.value === \"number\" && next.value > 0 ? next.value : null);\r\n                      }}\r\n                      isDisabled={disabled || technicianOptions.length === 0}\r\n                      placeholder={technicianOptions.length > 0 ? \"Select technician...\" : \"No technicians available\"}\r\n                      classNamePrefix=\"rb-select\"\r\n                      styles={{\r\n                        control: (base) => ({\r\n                          ...base,\r\n                          borderRadius: \"var(--rb-radius-sm)\",\r\n                          borderColor: \"#d4d4d8\",\r\n                          minHeight: 40,\r\n                          boxShadow: \"none\",\r\n                        }),\r\n                        menu: (base) => ({\r\n                          ...base,\r\n                          zIndex: 50,\r\n                        }),\r\n                      }}\r\n                    />\r\n                  </FormRow>\r\n\r\n                  <FormRow label=\"Estimate description\" fieldId=\"estimate_case_detail\">\r\n                    <textarea\r\n                      id=\"estimate_case_detail\"\r\n                      value={caseDetail}\r\n                      onChange={(e) => setCaseDetail(e.target.value)}\r\n                      disabled={disabled}\r\n                      rows={4}\r\n                      placeholder=\"Enter estimate description.\"\r\n                      className=\"w-full rounded-[var(--rb-radius-sm)] border border-zinc-300 bg-white px-3 py-2 text-sm text-[var(--rb-text)]\"\r\n                    />\r\n                  </FormRow>\r\n\r\n                  <FormRow label=\"Add devices to this estimate\" fieldId=\"estimate_devices_admin\">\r\n                    <DevicesAdminEditor\r\n                      value={estimateDevicesAdmin}\r\n                      onChange={(next) => setEstimateDevicesAdmin(next)}\r\n                      deviceOptions={deviceOptions}\r\n                      loadDeviceOptions={loadDeviceOptions}\r\n                      disabled={disabled}\r\n                      idPrefix=\"estimate\"\r\n                      showPin={pinEnabled}\r\n                      serialLabel=\"Serial / IMEI\"\r\n                      pinLabel={pinLabel}\r\n                      notesLabel=\"Notes\"\r\n                      addButtonLabel=\"Add device\"\r\n                      createEmptyRow={() => ({\r\n                        device_id: null,\r\n                        option: null,\r\n                        serial: \"\",\r\n                        pin: \"\",\r\n                        notes: \"\",\r\n                        extra_fields: [],\r\n                      })}\r\n                    />\r\n                  </FormRow>\r\n                </div>\r\n              ) : isStep2 ? (\r\n                <ItemsStep\r\n                  deviceContextOptions={deviceContextOptions}\r\n                  disabled={disabled}\r\n                  services={estimateServices}\r\n                  setServices={setEstimateServices}\r\n                  parts={estimateParts}\r\n                  setParts={setEstimateParts}\r\n                  otherItems={estimateOtherItems}\r\n                  setOtherItems={setEstimateOtherItems}\r\n                  onAddService={() => {\r\n                    setServicePickerError(null);\r\n                    if (!servicePickerDevice && deviceContextOptions.length > 0) {\r\n                      setServicePickerDevice(deviceContextOptions[0]);\r\n                    }\r\n                    setServicePickerModalOpen(true);\r\n                  }}\r\n                  serviceAddDisabled={disabled || deviceContextOptions.length === 0}\r\n                  serviceAddLabel=\"Add service\"\r\n                  onAddPart={() => {\r\n                    setPartPickerError(null);\r\n                    if (!partPickerDevice && deviceContextOptions.length > 0) {\r\n                      setPartPickerDevice(deviceContextOptions[0]);\r\n                    }\r\n                    setPartPickerModalOpen(true);\r\n                  }}\r\n                  partAddDisabled={disabled || deviceContextOptions.length === 0}\r\n                  partAddLabel=\"Add part\"\r\n                  otherItemsTitle=\"Other items\"\r\n                  otherItemsDescription=\"Add custom line items like fees or discounts.\"\r\n                  otherItemsAddLabel=\"Add other item\"\r\n                  createOtherItem={() => ({\r\n                    id: makeId(\"oi\"),\r\n                    name: \"\",\r\n                    qty: \"1\",\r\n                    price: \"\",\r\n                  })}\r\n                  otherItemNamePlaceholder=\"e.g. Rent, Used cable\"\r\n                  otherItemPricePlaceholder=\"e.g. 10.00 (use -10.00 for discount)\"\r\n                />\r\n              ) : (\r\n                <div className=\"space-y-5\">\r\n                  <div className=\"rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-white px-4 py-3\">\r\n                    <div className=\"text-sm font-semibold text-[var(--rb-text)]\">Review</div>\r\n                    <div className=\"mt-2 grid gap-4 sm:grid-cols-2\">\r\n                      <div>\r\n                        <div className=\"text-xs font-semibold uppercase tracking-wider text-zinc-500\">Customer</div>\r\n                        <div className=\"mt-1 text-sm text-zinc-700\">\r\n                          {customerMode === \"new\" ? customerCreateName.trim() || \"—\" : selectedCustomer?.name ?? customerOption?.label ?? \"—\"}\r\n                        </div>\r\n                        <div className=\"mt-1 text-xs text-zinc-500\">\r\n                          {customerMode === \"new\" ? customerCreateEmail.trim() : selectedCustomer?.email ?? \"\"}\r\n                        </div>\r\n                      </div>\r\n                      <div>\r\n                        <div className=\"text-xs font-semibold uppercase tracking-wider text-zinc-500\">Estimated total</div>\r\n                        <div className=\"mt-1 text-sm font-semibold text-[var(--rb-text)]\">{Number.isFinite(estimatedTotal) ? estimatedTotal.toFixed(2) : \"0.00\"}</div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-white px-4 py-3\">\r\n                    <div className=\"text-sm font-semibold text-[var(--rb-text)]\">Devices</div>\r\n                    <div className=\"mt-2 space-y-1 text-sm text-zinc-700\">\r\n                      {selectedDeviceOptions.length === 0 ? <div className=\"text-sm text-zinc-600\">None</div> : null}\r\n                      {selectedDeviceOptions.map((d) => (\r\n                        <div key={d.value}>{d.label}</div>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-white px-4 py-3\">\r\n                    <div className=\"text-sm font-semibold text-[var(--rb-text)]\">Items</div>\r\n                    <div className=\"mt-2 space-y-2\">\r\n                      {estimateServices.length === 0 && estimateParts.length === 0 && estimateOtherItems.length === 0 ? (\r\n                        <div className=\"text-sm text-zinc-600\">None</div>\r\n                      ) : null}\r\n\r\n                      {estimateServices.map((l) => (\r\n                        <div key={l.id} className=\"flex items-center justify-between gap-3 text-sm\">\r\n                          <div className=\"min-w-0 truncate text-zinc-700\">\r\n                            {l.qty} × {l.service.name}\r\n                          </div>\r\n                          <div className=\"whitespace-nowrap font-semibold text-[var(--rb-text)]\">{l.price || \"—\"}</div>\r\n                        </div>\r\n                      ))}\r\n\r\n                      {estimateParts.map((l) => (\r\n                        <div key={l.id} className=\"flex items-center justify-between gap-3 text-sm\">\r\n                          <div className=\"min-w-0 truncate text-zinc-700\">\r\n                            {l.qty} × {l.part.name}\r\n                          </div>\r\n                          <div className=\"whitespace-nowrap font-semibold text-[var(--rb-text)]\">{l.price || \"—\"}</div>\r\n                        </div>\r\n                      ))}\r\n\r\n                      {estimateOtherItems.map((l) => (\r\n                        <div key={l.id} className=\"flex items-center justify-between gap-3 text-sm\">\r\n                          <div className=\"min-w-0 truncate text-zinc-700\">\r\n                            {l.qty} × {l.name}\r\n                          </div>\r\n                          <div className=\"whitespace-nowrap font-semibold text-[var(--rb-text)]\">{l.price || \"—\"}</div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )}\r\n        </WizardShell>\r\n      </form>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"wDAGA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OCFA,EAAA,EAAA,CAAA,CAAA,OAEA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,KACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAoHA,SAAS,EAAO,CAAc,QAC5B,AAAsB,IAAlB,OAAO,QAA0B,eAAgB,OAC5C,CADoD,AACpD,EAAG,EAAO,CAAC,EAAE,OAAO,UAAU,GAAA,CAAI,CAEpC,CAAA,EAAG,EAAO,CAAC,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,KAAK,CAAC,GAAA,CAAI,AACzE,CAEO,SAAS,EAAe,YAAE,CAAU,CAA0B,EACnE,IAAM,EAAO,CAAA,EAAA,EAAA,OAAA,AAAO,IACd,EAAS,CAAA,EAAA,EAAA,SAAA,AAAS,IAElB,EAAoB,CAAA,EAAA,EAAA,OAAA,AAAO,EAAC,KAChC,IAAM,EAAM,IAAI,KACV,EAAO,OAAO,EAAI,WAAW,IAC7B,EAAK,OAAO,EAAI,QAAQ,GAAK,GAAG,QAAQ,CAAC,EAAG,KAC5C,EAAK,OAAO,EAAI,OAAO,IAAI,QAAQ,CAAC,EAAG,KACvC,EAAK,OAAO,EAAI,QAAQ,IAAI,QAAQ,CAAC,EAAG,KACxC,EAAM,OAAO,EAAI,UAAU,IAAI,QAAQ,CAAC,EAAG,KAC3C,EAAK,OAAO,EAAI,UAAU,IAAI,QAAQ,CAAC,EAAG,KAChD,MAAO,CAAC,GAAG,EAAE,EAAA,EAAO,EAAA,EAAK,EAAG,CAAC,EAAE,EAAA,EAAK,EAAA,EAAM,EAAA,CAAI,AAChD,EAAG,EAAE,EAEC,CAAC,EAAgB,EAAkB,CAAG,CAAA,EAAA,EAAA,QAAQ,AAAR,GAAS,GAC/C,CAAC,EAAM,EAAQ,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GAC3B,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAgB,MAE5C,CAAC,EAAM,EAAQ,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAY,GAEtC,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IAC7B,CAAC,EAAY,EAAc,CAAG,CAAA,EAAA,EAAA,QAAQ,AAAR,EAAiB,GAC/C,CAAC,EAAY,EAAc,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAS,IAC/C,CAAC,EAAc,EAAgB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAS,IACnD,CAAC,EAAY,EAAc,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAS,IAE/C,CAAC,EAAY,EAAc,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAgB,MACtD,CAAC,EAAgB,EAAkB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAwB,MAEtE,CAAC,EAAc,EAAgB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAqB,YAC/D,CAAC,EAAoB,EAAsB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IACvD,CAAC,EAAqB,EAAuB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IACzD,CAAC,EAAqB,EAAuB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IACzD,CAAC,EAAuB,GAAyB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IAE7D,CAAC,GAAoB,GAAsB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACvD,CAAC,GAAqB,GAAuB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAgB,MAExE,CAAC,GAAsB,GAAwB,CAAG,CAAA,EAAA,EAAA,QAAQ,AAAR,EAAwB,MAE1E,CAAC,GAAsB,GAAwB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAA2B,CACzF,CACE,UAAW,KACX,OAAQ,KACR,OAAQ,GACR,IAAK,GACL,MAAO,GACP,aAAc,EAChB,AADkB,EAEnB,EAEK,CAAC,GAAW,GAAa,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAc,EAAE,EACpD,CAAC,GAAgB,GAAkB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAc,EAAE,EAC9D,CAAC,GAAa,GAAe,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAkB,EAAE,EAE5D,CAAC,GAAY,GAAc,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACvC,CAAC,GAAU,GAAY,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,OAEnC,CAAC,GAAc,GAAgB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAc,EAAE,EAC1D,CAAC,GAAiB,GAAmB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAiB,EAAE,EAEnE,CAAC,GAAkB,GAAoB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAA6B,EAAE,EACjF,CAAC,GAAe,GAAiB,CAAG,CAAA,EAAA,EAAA,QAAQ,AAAR,EAAkC,EAAE,EACxE,CAAC,GAAoB,GAAsB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAA+B,EAAE,EAEvF,CAAC,GAAwB,GAA0B,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GAC/D,CAAC,GAAoB,GAAsB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAgB,MACtE,CAAC,GAAsB,GAAwB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAuB,MACjF,CAAC,GAAqB,GAAuB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAA6B,MACrF,CAAC,GAAkB,GAAoB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,KACnD,CAAC,GAAoB,GAAsB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IAEvD,CAAC,GAAqB,GAAuB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACzD,CAAC,GAAiB,GAAmB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAgB,MAChE,CAAC,GAAgB,GAAkB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAoB,MAClE,CAAC,GAAkB,GAAoB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAA6B,MAC/E,CAAC,GAAe,GAAiB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,KAC7C,CAAC,GAAiB,GAAmB,CAAG,CAAA,EAAA,EAAA,QAAQ,AAAR,EAAS,IAEjD,GAAmB,IAAT,EACV,GAAmB,IAAT,EAKV,GAAW,GAAQ,EAEnB,GAAgB,CAAA,EAAA,EAAA,OAAA,AAAO,EAAC,IACrB,GACJ,KAAK,GACL,IAAI,CAAC,CAAC,EAAG,IAAM,CAAA,EAAG,EAAE,IAAI,CAAA,CAAE,CAAC,aAAa,CAAC,CAAA,EAAG,EAAE,IAAI,CAAA,CAAE,GACpD,GAAG,CAAC,AAAC,IAAM,AAAC,CACX,MAAO,EAAE,EAAE,CACX,MAAO,EAAE,KAAK,CAAG,CAAA,EAAG,EAAE,IAAI,CAAC,EAAE,EAAE,EAAE,KAAK,CAAC,CAAC,CAAC,CAAG,EAAE,IAAI,CACpD,CAAC,EACF,CAAC,GAAU,EAER,GAAoB,CAAA,EAAA,EAAA,OAAA,AAAO,EAAC,IACzB,GACJ,KAAK,GACL,IAAI,CAAC,CAAC,EAAG,IAAM,CAAA,EAAG,EAAE,IAAI,CAAA,CAAE,CAAC,aAAa,CAAC,CAAA,EAAG,EAAE,IAAI,CAAA,CAAE,GACpD,GAAG,CAAC,AAAC,IAAM,AAAC,CAAE,MAAO,EAAE,EAAE,CAAE,MAAO,CAAA,EAAG,EAAE,IAAI,CAAC,EAAE,EAAE,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,EAC9D,CAAC,GAAY,EAEV,GAA2B,CAAA,EAAA,EAAA,OAAA,AAAO,EAAC,IACvC,AAAoC,UAAhC,AAA0C,OAAnC,GAA0C,KACvC,AACP,GADyB,IAAI,CAAE,AAAD,GAAO,EAAE,KAAK,GAAK,KACxC,KACf,CAAC,GAAsB,GAAkB,EAEtC,GAAgB,CAAA,EAAA,EAAA,OAAA,AAAO,EAAC,IACrB,GACJ,KAAK,GACL,IAAI,CAAC,CAAC,EAAG,IAAM,CAAA,EAAG,EAAE,KAAK,CAAA,CAAE,CAAC,aAAa,CAAC,CAAA,EAAG,EAAE,KAAK,CAAA,CAAE,GACtD,GAAG,CAAC,AAAC,IAAM,AAAC,CAAE,MAAO,EAAE,EAAE,CAAE,MAAO,EAAE,KAAK,CAAC,CAAC,EAC7C,CAAC,GAAe,EAEb,GAAwB,CAAA,EAAA,EAAA,OAAA,AAAO,EAAC,IACxB,AAIL,GAHJ,GAAG,CAAC,AAAC,GAA8B,UAAvB,OAAO,EAAE,SAAS,CAAgB,EAAE,SAAS,CAAG,MAC5D,MAAM,CAAC,AAAC,GAAgC,UAAb,OAAO,GAGlC,GAAG,CAAC,AAAC,GAAO,GAAc,IAAI,CAAC,AAAC,GAAM,EAAE,KAAK,GAAK,IAAO,CAAE,MAAO,EAAI,MAAO,CAAC,QAAQ,EAAE,EAAA,CAAI,AAAC,GAC7F,MAAM,CAAC,SACT,CAAC,GAAe,GAAqB,EAElC,GAAuB,CAAA,EAAA,EAAA,OAAA,AAAO,EAAC,IAC5B,GAAsB,GAAG,CAAC,AAAC,IAAM,AAAC,CAAE,MAAO,EAAE,KAAK,CAAE,MAAO,EAAE,KAAK,CAAC,CAAC,EAC1E,CAAC,GAAsB,EAEpB,GAAiB,CAAA,EAAA,EAAA,OAAA,AAAO,EAAC,IACtB,GACJ,KAAK,GACL,IAAI,CAAC,CAAC,EAAG,IAAM,CAAA,EAAG,EAAE,IAAI,CAAA,CAAE,CAAC,aAAa,CAAC,CAAA,EAAG,EAAE,IAAI,CAAA,CAAE,GACpD,GAAG,CAAC,AAAC,IAAM,AAAC,CAAE,MAAO,EAAE,EAAE,CAAE,MAAO,EAAE,IAAI,CAAC,CAAC,EAC5C,CAAC,GAAgB,EAEd,GAAc,CAAA,EAAA,EAAA,OAAA,AAAO,EAAC,IACnB,GACJ,KAAK,GACL,IAAI,CAAC,CAAC,EAAG,IAAM,CAAA,EAAG,EAAE,IAAI,CAAA,CAAE,CAAC,aAAa,CAAC,CAAA,EAAG,EAAE,IAAI,CAAA,CAAE,GACpD,GAAG,CAAC,AAAC,IAAM,AAAC,CAAE,MAAO,EAAE,EAAE,CAAE,MAAO,EAAE,IAAI,CAAE,KAAM,EAAE,IAAI,CAAE,SAAU,EAAE,QAAQ,CAAC,CAAC,EAChF,CAAC,GAAa,EAEX,GAAiB,CAAA,EAAA,EAAA,OAAA,AAAO,EAAC,KAC7B,IAAM,EAAW,AAAC,GACT,EAAM,MAAM,CAAC,CAAC,EAAK,KACxB,IAAM,EAAI,OAAO,EAAE,GAAG,EAChB,EAAI,OAAO,EAAE,KAAK,SACxB,AAAI,AAAC,OAAO,QAAQ,CAAC,IAAO,EAAD,KAAQ,QAAQ,CAAC,GACrC,CADyC,CACnC,EAAI,EADsC,CAEzD,EAAG,GAGL,OAAO,EAAS,IAAoB,EAAS,IAAiB,EAAS,GACzE,EAAG,CAAC,GAAoB,GAAe,GAAiB,EAElD,GAAmB,CAAA,EAAA,EAAA,OAAA,AAAO,EAAC,IAC/B,AAA0B,UAAtB,AAAgC,OAAzB,EAAgC,KACpC,GAAU,IAAI,CAAC,AAAC,GAAM,EAAE,EAAE,GAAK,IAAe,KACpD,CAAC,GAAW,EAAW,EAEpB,GAAe,CAAA,EAAA,EAAA,OAAA,AAAO,EAAC,IAC3B,AAAqB,OAAO,CAAxB,EACK,EAAoB,IAAI,GAAG,MAAM,CAAG,EAGtC,CADO,IAAkB,OAAS,EAAA,EAC5B,IAAI,GAAG,MAAM,CAAG,EAC5B,CAAC,EAAqB,EAAc,IAAkB,MAAM,EAE/D,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACR,IAAI,GAAQ,EAoEZ,OAlEA,AAgEK,eAhEU,EACb,GAA0B,UAAtB,OAAO,GAAiD,GAAG,CAAzB,EAAW,MAAM,CAEvD,GAAI,CACF,GAAkB,GAElB,GAAM,CAAC,EAAY,EAAY,EAAgB,EAAU,EAAa,EAAY,CAAG,MAAM,QAAQ,GAAG,CAAC,CACrG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAA2B,CAAC,KAAK,EAAE,EAAW,sBAAsB,CAAC,EAC7E,CAAA,EAAA,EAAA,QAAA,AAAQ,EAA2B,CAAC,KAAK,EAAE,EAAW,iCAAiC,CAAC,EACxF,CAAA,EAAA,EAAA,QAAA,AAAQ,EAA6B,CAAC,KAAK,EAAE,EAAW,+CAA+C,CAAC,EACxG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAuB,CAAC,KAAK,EAAE,EAAW,gCAAgC,CAAC,EACnF,CAAA,EAAA,EAAA,QAAA,AAAQ,EAA6B,CAAC,KAAK,EAAE,EAAW,mCAAmC,CAAC,EAC5F,CAAA,EAAA,EAAA,sBAAA,AAAsB,EAAC,OAAO,IAC/B,EAED,GAAI,CAAC,EAAO,OAEZ,GAAa,MAAM,OAAO,CAAC,EAAW,OAAO,EAAI,EAAW,OAAO,CAAG,EAAE,EACxE,GAAkB,MAAM,OAAO,CAAC,EAAW,OAAO,EAAI,EAAW,OAAO,CAAG,EAAE,EAC7E,GAAe,MAAM,OAAO,CAAC,EAAe,KAAK,EAAI,EAAe,KAAK,CAAG,EAAE,EAE9E,IAAc,CAAQ,EAAY,QAAQ,EAAE,eAAe,oBAC3D,IAAM,EAAY,EAAY,QAAQ,EAAE,eAAe,OACjD,EACJ,GAAkC,UAArB,OAAO,GAA0E,UAAhD,OAAQ,EAAgC,GAAG,CACrF,OAAQ,EAAgC,GAAG,EAAE,IAAI,GACjD,GACN,GAA6B,KAAjB,EAAsB,EAAe,OAEjD,IAAM,EAAY,MAAM,OAAO,CAAC,EAAS,KAAK,EAAI,EAAS,KAAK,CAAG,EAAE,CACrE,GACE,EAAU,GAAG,CAAC,AAAC,IAAM,AAAC,CACpB,GAAI,EAAE,EAAE,CACR,KAAM,EAAE,IAAI,CACZ,KAAM,EAAE,kBAAkB,EAAI,GAC9B,SAAU,EAAE,QAAQ,EAAI,GAC1B,CAAC,GAGH,IAAM,EAAe,MAAM,OAAO,CAAC,EAAY,QAAQ,EAAI,EAAY,QAAQ,CAAG,EAAE,CACpF,GAAmB,EAAa,GAAG,CAAC,AAAC,IAAM,AAAC,CAAE,GAAI,EAAE,EAAE,CAAE,KAAM,EAAE,IAAI,CAAC,CAAC,GAEtE,EAAS,KACX,CAAE,MAAO,EAAG,CACV,GAAI,CAAC,EAAO,OAEZ,GAAI,aAAa,EAAA,QAAQ,EAAiB,MAAb,EAAE,MAAM,EAAY,AAAsB,iBAAf,GAA2B,EAAW,IAAI,GAAG,MAAM,CAAG,EAAG,CAC/G,IAAM,EAAO,CAAC,KAAK,EAAE,EAAW,cAAc,CAAC,CAC/C,EAAO,OAAO,CAAC,CAAC,KAAK,EAAE,EAAW,sBAAsB,EAAE,mBAAmB,GAAA,CAAO,EACpF,MACF,CAEA,EAAS,aAAa,MAAQ,EAAE,OAAO,CAAG,6BAC1C,GAAa,EAAE,EACf,GAAkB,EAAE,EACpB,GAAe,EAAE,EACjB,IAAc,GACd,GAAY,MACd,QAAU,CACR,GAAI,CAAC,EAAO,OACZ,GAAkB,EACpB,CACF,IAIO,KACL,GAAQ,CACV,CACF,EAAG,CAAC,EAAQ,EAAW,EAEvB,IAAM,GAAsB,MAAO,IACjC,GAA0B,UAAtB,OAAO,GAAiD,IAAtB,EAAW,MAAM,CAAQ,MAAO,EAAE,CAExE,GAAI,CACF,IAAM,EAAK,IAAI,gBACf,EAAG,GAAG,CAAC,QAAS,MAChB,IAAM,EAAI,EAAW,IAAI,GACrB,GAAG,EAAG,GAAG,CAAC,QAAS,GAEvB,IAAM,EAAM,MAAM,CAAA,EAAA,EAAA,QAAA,AAAQ,EAA2B,CAAC,KAAK,EAAE,EAAW,aAAa,EAAE,EAAG,QAAQ,GAAA,CAAI,EAEtG,MAAO,CADM,MAAM,OAAO,CAAC,EAAI,OAAO,EAAI,EAAI,OAAO,CAAG,EAAA,AAAE,EAC9C,GAAG,CAAC,AAAC,IAAM,AAAC,CACtB,MAAO,EAAE,EAAE,CACX,MAAO,EAAE,KAAK,CAAG,CAAA,EAAG,EAAE,IAAI,CAAC,EAAE,EAAE,EAAE,KAAK,CAAC,CAAC,CAAC,CAAG,EAAE,IAAI,CACpD,CAAC,CACH,CAAE,KAAM,CACN,MAAO,EAAE,AACX,CACF,EAEM,GAAoB,MAAO,IAC/B,GAAI,AAAsB,iBAAf,GAAiD,IAAtB,EAAW,MAAM,CAAQ,MAAO,EAAE,CAExE,GAAI,CACF,IAAM,EAAK,IAAI,gBACf,EAAG,GAAG,CAAC,QAAS,EAAW,IAAI,GAAK,KAAO,MAC3C,IAAM,EAAI,EAAW,IAAI,GACrB,GAAG,EAAG,GAAG,CAAC,IAAK,GAEnB,IAAM,EAAM,MAAM,CAAA,EAAA,EAAA,QAAA,AAAQ,EAA2B,CAAC,KAAK,EAAE,EAAW,yBAAyB,EAAE,EAAG,QAAQ,GAAA,CAAI,EAElH,MAAO,CADM,MAAM,OAAO,CAAC,EAAI,OAAO,EAAI,EAAI,OAAO,CAAG,EAAA,AAAE,EAC9C,GAAG,CAAE,AAAD,IAAO,AAAC,CAAE,MAAO,EAAE,EAAE,CAAE,MAAO,EAAE,KAAK,CAAC,CAAC,CACzD,CAAE,KAAM,CACN,MAAO,EAAE,AACX,CACF,EAEA,eAAe,GAAe,CAA0B,EACtD,GAA0B,UAAtB,OAAO,GAAiD,GAAG,CAAzB,EAAW,MAAM,GACnD,GAEJ,EAAS,CAFC,KAGV,GAAQ,GAER,GAAI,CACF,IAAM,EAAe,EAAM,IAAI,GAC/B,GAAqB,KAAjB,EAAqB,YACvB,EAAS,sBAIX,IAAM,EAAwC,QAAjB,EAC7B,GAAI,EAAsB,CACxB,GAAkC,KAA9B,EAAmB,IAAI,GAAW,YACpC,EAAS,8BAGX,GAAI,AAA+B,OAAX,IAAI,GAAW,YACrC,EAAS,8BAGb,CAEA,GAAI,CAAC,GAA8C,UAAtB,OAAO,EAAyB,YAC3D,EAAS,sBAIX,IAAM,EAAmC,CACvC,YAAmC,KAAtB,EAAW,IAAI,GAAY,EAAW,IAAI,GAAK,KAC5D,MAAO,EACP,OAAQ,UACR,YAAa,AAAC,GAA8C,UAAtB,OAAO,EAAuC,KAAb,EACvE,YAAmC,KAAtB,EAAW,IAAI,GAAY,EAAW,IAAI,GAAK,KAC5D,cAAe,AAAwB,OAAX,IAAI,GAAY,EAAa,IAAI,GAAK,KAClE,YAAmC,KAAtB,EAAW,IAAI,GAAY,EAAW,IAAI,GAAK,KAC5D,uBAAwD,UAAhC,OAAO,GAAoC,GAAuB,KAC1F,QACE,GAAqB,MAAM,CAAG,EAC1B,GACG,MAAM,CAAC,AAAC,GAA6B,UAAvB,OAAO,EAAE,SAAS,EAChC,GAAG,CAAC,AAAC,IAAO,AAAD,CACV,UAAW,EAAE,SAAS,CACtB,OAA4B,KAApB,EAAE,MAAM,CAAC,IAAI,GAAY,EAAE,MAAM,CAAC,IAAI,GAAK,KACnD,IAAK,IAA+B,KAAjB,EAAE,GAAG,CAAC,IAAI,GAAY,EAAE,GAAG,CAAC,IAAI,GAAK,KACxD,MAA0B,KAAnB,EAAE,KAAK,CAAC,IAAI,GAAY,EAAE,KAAK,CAAC,IAAI,GAAK,KAClD,CAAC,EACH,EAAE,AACV,EAEI,IACF,EAAQ,eAAe,CADC,AACE,CACxB,KAAM,EAAmB,IAAI,GAC7B,MAAO,EAAoB,IAAI,GAC/B,GAAmC,KAA/B,EAAoB,IAAI,GAAY,CAAE,MAAO,EAAoB,IAAI,EAAG,EAAI,CAAC,CAAC,CAClF,GAAqC,KAAjC,EAAsB,IAAI,GAAY,CAAE,QAAS,EAAsB,IAAI,EAAG,EAAI,CAAC,CAAC,CAC1F,EAGF,IAAM,EAAM,MAAM,CAAA,EAAA,EAAA,QAAA,AAAQ,EAA4B,CAAC,KAAK,EAAE,EAAW,0BAA0B,CAAC,CAAE,CACpG,OAAQ,OACR,KAAM,CACR,GAEM,EAAa,GAAK,UAAU,GAClC,GAA0B,UAAtB,AAAgC,OAAzB,EACT,MAAM,AAAI,MAAM,6BAGlB,GAAI,CACF,IAAK,IAAM,KAAQ,GAAkB,CACnC,IAAM,EAAS,KAAK,KAAK,CAAC,OAAO,EAAK,GAAG,GACnC,EAAM,OAAO,QAAQ,CAAC,IAAW,EAAS,EAAI,EAAS,EAEvD,EAAW,EAAK,KAAK,CAAC,IAAI,GAC1B,EAAW,EAAS,MAAM,CAAG,EAAI,OAAO,GAAY,IACpD,EAAuB,OAAO,QAAQ,CAAC,GAAY,KAAK,KAAK,CAAY,IAAX,QAAkB,CAEtF,OAAM,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,CAAC,KAAK,EAAE,EAAW,2BAA2B,EAAE,EAAW,MAAM,CAAC,CAAE,CACjF,OAAQ,OACR,KAAM,CACJ,UAAW,UACX,OAAQ,EAAK,UAAU,KACvB,EACA,GAAoC,UAAhC,OAAO,EAAoC,CAAE,wBAAyB,CAAqB,EAAI,CAAC,CAAC,CACrG,KAAM,CACJ,GAA8B,UAA1B,OAAO,EAAK,SAAS,CAAgB,CAAE,UAAW,EAAK,SAAS,AAAC,EAAI,CAAC,CAAC,AAC7E,CACF,CACF,EACF,CAEA,IAAK,IAAM,KAAQ,GAAoB,CACrC,IAAM,EAAO,EAAK,IAAI,CAAC,IAAI,GAC3B,GAAa,KAAT,EAAa,SAEjB,IAAM,EAAS,KAAK,KAAK,CAAC,OAAO,EAAK,GAAG,GACnC,EAAM,OAAO,QAAQ,CAAC,IAAW,EAAS,EAAI,EAAS,EAEvD,EAAW,EAAK,KAAK,CAAC,IAAI,GAC1B,EAAW,EAAS,MAAM,CAAG,EAAI,OAAO,GAAY,IACpD,EAAuB,OAAO,QAAQ,CAAC,GAAY,KAAK,KAAK,CAAY,IAAX,QAAkB,EAClD,UAAhC,AAA0C,OAAnC,GAEX,MAAM,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,CAAC,KAAK,EAAE,EAAW,2BAA2B,EAAE,EAAW,MAAM,CAAC,CAAE,CACjF,OAAQ,OACR,KAAM,CACJ,UAAW,EAAuB,EAAI,WAAa,WACnD,MACA,EACA,wBAAyB,CAC3B,CACF,EACF,CAEA,IAAK,IAAM,KAAQ,GAAe,CAChC,IAAM,EAAS,KAAK,KAAK,CAAC,OAAO,EAAK,GAAG,GACnC,EAAM,OAAO,QAAQ,CAAC,IAAW,EAAS,EAAI,EAAS,EAEvD,EAAW,EAAK,KAAK,CAAC,IAAI,GAC1B,EAAW,EAAS,MAAM,CAAG,EAAI,OAAO,GAAY,IACpD,EAAuB,OAAO,QAAQ,CAAC,GAAY,KAAK,KAAK,CAAY,IAAX,GAAkB,MAEtF,OAAM,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,CAAC,KAAK,EAAE,EAAW,2BAA2B,EAAE,EAAW,MAAM,CAAC,CAAE,CACjF,OAAQ,OACR,KAAM,CACJ,UAAW,OACX,OAAQ,EAAK,OAAO,KACpB,EACA,GAAoC,UAAhC,OAAO,EAAoC,CAAE,wBAAyB,CAAqB,EAAI,CAAC,CAAC,CACrG,KAAM,CACJ,GAAI,AAA0B,iBAAnB,EAAK,SAAS,CAAgB,CAAE,UAAW,EAAK,SAAS,AAAC,EAAI,CAAC,CAAC,AAC7E,CACF,CACF,EACF,CACF,CAAE,MAAO,EAAK,CACZ,EAAA,MAAM,CAAC,KAAK,CAAC,aAAe,EAAA,QAAQ,CAAG,EAAI,OAAO,CAAG,gDACvD,CAEA,GAAa,aAAa,CAAtB,EACF,GAAI,CACF,MAAM,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,CAAC,KAAK,EAAE,EAAW,2BAA2B,EAAE,EAAW,KAAK,CAAC,CAAE,CAChF,OAAQ,MACV,GACA,EAAA,MAAM,CAAC,OAAO,CAAC,iBACjB,CAAE,MAAO,EAAK,CACZ,EAAA,MAAM,CAAC,KAAK,CAAC,aAAe,EAAA,QAAQ,CAAG,EAAI,OAAO,CAAG,sCACvD,CAGF,EAAA,MAAM,CAAC,OAAO,CAAC,qBACf,EAAO,OAAO,CAAC,CAAC,KAAK,EAAE,EAAW,WAAW,EAAE,EAAA,CAAY,CAC7D,CAAE,MAAO,EAAG,CACN,aAAa,EAAA,QAAQ,CACvB,CADyB,CAChB,EAAE,OAAO,EAElB,EAAS,aAAa,MAAQ,EAAE,OAAO,CAAG,6BAE9C,QAAU,CACR,GAAQ,EACV,EACF,CAEA,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,UAAU,CAAA,CAAC,MAAM,eAAe,YAAY,+CAE5C,EAAQ,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,gCAAwB,IAAe,KAE/D,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,mBAAmB,CAAA,CAClB,KAAM,GACN,MAAM,eACN,SAAU,GACV,MAAO,GACP,SAAU,GACV,KAAM,EACN,QAAS,EACT,MAAO,EACP,SAAU,EACV,eAAe,QACf,MAAO,EACP,SAAU,EACV,QAAS,EACT,WAAY,GACZ,QAAS,IAAM,IAAsB,GACrC,OAAQ,CAAC,CAAE,MAAI,OAAE,CAAK,CAAE,IACtB,EAAgB,OAChB,EAAc,MACd,EAAkB,CAAE,MAAO,CAAC,EAAG,MAAO,CAAA,EAAG,EAAK,EAAE,EAAE,EAAM,CAAC,CAAC,AAAC,GAC3D,GAAsB,GACxB,IAGF,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CACJ,KAAM,GACN,MAAM,cACN,QAAS,KACP,GAAsB,MACtB,IAA0B,EAC5B,EACA,OACE,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,gDACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CACL,KAAK,SACL,QAAQ,UACR,QAAS,KACP,GAAsB,MACtB,IAA0B,EAC5B,WACD,WAGD,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CACL,KAAK,SACL,QAAS,KACP,GAAI,CAAC,GAAsB,YACzB,GAAsB,4BAGxB,GAAI,CAAC,GAAqB,YACxB,GAAsB,2BAIxB,IAAM,EAAS,KAAK,KAAK,CAAC,OAAO,KAC3B,EAAM,OAAO,QAAQ,CAAC,IAAW,EAAS,EAAI,OAAO,GAAU,IAErE,GAAoB,AAAC,GAAS,IACzB,EACH,CACE,GAAI,EAAO,OACX,WAAY,GAAqB,KAAK,CACtC,QAAS,CAAE,GAAI,GAAqB,KAAK,CAAE,KAAM,GAAqB,KAAK,AAAC,EAC5E,UAAW,GAAoB,KAAK,KACpC,EACA,MAAO,EACT,EACD,EAED,GAAwB,MACxB,GAAoB,KACpB,GAAsB,IACtB,GAAsB,MACtB,IAA0B,EAC5B,WACD,oBAML,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACZ,GAAqB,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,gCAAwB,KAA4B,KAEzF,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,kDACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,0BACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,sCAA6B,YAC5C,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAM,CAAA,CACL,WAAW,0BACX,QAAQ,0BACR,YAAY,CAAA,CAAA,EACZ,WAAW,CAAA,CAAA,EACX,QAAS,GACT,MAAO,GACP,SAAU,AAAC,GAAQ,GAAyB,GAAgC,MAC5E,WAAY,GACZ,YAAa,GAAe,MAAM,CAAG,EAAI,qBAAuB,kBAChE,gBAAgB,YAChB,OAAQ,CACN,QAAS,AAAC,IAAU,CAClB,EADiB,CACd,CAAI,CACP,aAAc,sBACd,YAAa,UACb,UAAW,GACX,UAAW,OACb,CAAC,CACD,KAAM,AAAC,IAAU,CACf,EADc,CACX,CAAI,CACP,OAAQ,GACV,CAAC,AACH,OAIJ,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,0BACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,sCAA6B,WAC5C,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAM,CAAA,CACL,WAAW,iCACX,QAAQ,iCACR,YAAY,CAAA,CAAA,EACZ,WAAW,CAAA,CAAA,EACX,QAAS,GACT,MAAO,GACP,SAAU,AAAC,GAAQ,GAAwB,GAAsC,MACjF,WAAY,IAAY,AAAgC,OAAX,MAAM,CACnD,YAAa,GAAqB,MAAM,CAAG,EAAI,mBAAqB,sBACpE,gBAAgB,YAChB,OAAQ,CACN,QAAS,AAAC,IAAU,CAClB,EADiB,CACd,CAAI,CACP,aAAc,sBACd,YAAa,UACb,UAAW,GACX,UAAW,OACb,CAAC,CACD,KAAM,AAAC,IAAU,CACf,EADc,CACX,CAAI,CACP,OAAQ,GACV,CAAC,AACH,OAIJ,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,sCAA6B,QAC5C,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CAAC,MAAO,GAAkB,SAAU,AAAC,GAAM,GAAoB,EAAE,MAAM,CAAC,KAAK,EAAG,SAAU,QAElG,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,sCAA6B,UAC5C,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CAAC,MAAO,GAAoB,SAAU,AAAC,GAAM,GAAsB,EAAE,MAAM,CAAC,KAAK,EAAG,SAAU,GAAU,YAAY,wBAMlI,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CACJ,KAAM,GACN,MAAM,WACN,QAAS,KACP,GAAmB,MACnB,IAAuB,EACzB,EACA,OACE,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,gDACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CACL,KAAK,SACL,QAAQ,UACR,QAAS,KACP,GAAmB,MACnB,IAAuB,EACzB,WACD,WAGD,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CACL,KAAK,SACL,QAAS,KACP,GAAI,CAAC,GAAgB,YACnB,GAAmB,yBAGrB,GAAI,CAAC,GAAkB,YACrB,GAAmB,2BAIrB,IAAM,EAAS,KAAK,KAAK,CAAC,OAAO,KAC3B,EAAM,OAAO,QAAQ,CAAC,IAAW,EAAS,EAAI,OAAO,GAAU,IAErE,GAAiB,AAAC,GAAS,IACtB,EACH,CACE,GAAI,EAAO,QACX,QAAS,GAAe,KAAK,CAC7B,KAAM,CACJ,GAAI,GAAe,KAAK,CACxB,KAAM,GAAe,KAAK,CAC1B,KAAM,GAAe,IAAI,CACzB,SAAU,GAAe,QAC3B,AADmC,EAEnC,UAAW,GAAiB,KAAK,KACjC,EACA,MAAO,EACT,EACD,EAED,GAAkB,MAClB,GAAiB,KACjB,GAAmB,IACnB,GAAmB,MACnB,IAAuB,EACzB,WACD,oBAML,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACZ,GAAkB,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,gCAAwB,KAAyB,KAEnF,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,kDACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,0BACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,sCAA6B,gBAC5C,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAM,CAAA,CACL,WAAW,uBACX,QAAQ,uBACR,YAAY,CAAA,CAAA,EACZ,WAAW,CAAA,CAAA,EACX,QAAS,GACT,MAAO,GACP,SAAU,AAAC,GAAQ,GAAmB,GAA6B,MACnE,WAAY,GACZ,YAAa,GAAY,MAAM,CAAG,EAAI,kBAAoB,eAC1D,gBAAgB,YAChB,OAAQ,CACN,QAAS,AAAC,IAAU,CAClB,EADiB,CACd,CAAI,CACP,aAAc,sBACd,YAAa,UACb,UAAW,GACX,UAAW,OACb,CAAC,CACD,KAAM,AAAC,GAAU,EACf,EADc,CACX,CAAI,CACP,OAAQ,EACV,CAAC,CACH,OAIJ,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,0BACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,sCAA6B,WAC5C,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAM,CAAA,CACL,WAAW,uBACX,YAAY,CAAA,CAAA,EACZ,WAAW,CAAA,CAAA,EACX,QAAS,GACT,MAAO,GACP,SAAU,AAAC,GAAQ,GAAqB,GAAsC,MAC9E,WAAY,IAA4C,IAAhC,GAAqB,MAAM,CACnD,YAAa,GAAqB,MAAM,CAAG,EAAI,mBAAqB,sBACpE,gBAAgB,YAChB,OAAQ,CACN,QAAS,AAAC,IAAU,CAClB,EADiB,CACd,CAAI,CACP,aAAc,sBACd,YAAa,UACb,UAAW,GACX,UAAW,OACb,CAAC,CACD,KAAM,AAAC,IAAU,CACf,EADc,CACX,CAAI,CACP,OAAQ,GACV,CAAC,AACH,OAIJ,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,sCAA6B,QAC5C,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CAAC,MAAO,GAAe,SAAU,AAAC,GAAM,GAAiB,EAAE,MAAM,CAAC,KAAK,EAAG,SAAU,QAE5F,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,sCAA6B,UAC5C,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CAAC,MAAO,GAAiB,SAAU,AAAC,GAAM,GAAmB,EAAE,MAAM,CAAC,KAAK,EAAG,SAAU,GAAU,YAAY,wBAM5H,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CACC,UAAU,YACV,SAAU,AAAC,IACT,EAAE,cAAc,EAClB,WAEA,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CACV,MAAO,CACL,CACE,GAAI,EACJ,SAAU,qBACV,eAAgB,2DAChB,UAAW,qBACX,gBAAiB,2DACjB,YAAa,oBACf,EACA,CACE,GAAI,EACJ,SAAU,qBACV,eAAgB,uCAChB,UAAW,qBACX,gBAAiB,0CACjB,YAAa,oBACf,EACA,CACE,GAAI,EACJ,SAAU,gBACV,eAAgB,2CAChB,UAAW,gBACX,gBAAiB,8DACjB,YAAa,eACf,EACD,CACD,KAAM,EACN,SAAU,GACV,aAAa,iBACb,mBAAmB,6CACnB,iBAAiB,iBACjB,aAAe,AAAD,IACZ,EAAS,MACT,EAAQ,EACV,EACA,YACE,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,oCACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CACL,GAAG,mBACH,QAAQ,UACR,SAAU,GACV,KAAK,SACL,QAAS,IAAM,KAAK,GAAe,iBAElC,EAAO,YAAc,SAExB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CACL,GAAG,wBACH,QAAQ,UACR,SAAU,IAAY,CAAC,EAAK,GAAG,CAAC,qBAAuB,CAAC,GACxD,KAAK,SACL,QAAS,IAAM,KAAK,GAAe,sBAElC,EAAO,YAAc,4BAKvB,GACC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAO,CAAA,CAAC,MAAM,QAAQ,QAAQ,iBAAiB,QAAQ,CAAA,CAAA,WACtD,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CAAC,GAAG,iBAAiB,MAAO,EAAO,SAAU,AAAC,GAAM,EAAS,EAAE,MAAM,CAAC,KAAK,EAAG,SAAU,OAGhG,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAO,CAAA,CAAC,MAAM,cAAc,QAAQ,gCACnC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CAAC,GAAG,uBAAuB,MAAO,EAAY,SAAW,AAAD,GAAO,EAAc,EAAE,MAAM,CAAC,KAAK,EAAG,SAAU,OAGhH,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAO,CAAA,CAAC,MAAM,QAAQ,QAAQ,0BAC7B,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,kDACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,sCAA6B,gBAC5C,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CAAC,GAAG,uBAAuB,KAAK,OAAO,MAAO,EAAY,SAAU,AAAC,GAAM,EAAc,EAAE,MAAM,CAAC,KAAK,EAAG,SAAU,QAE5H,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,sCAA6B,kBAC5C,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CAAC,GAAG,yBAAyB,KAAK,OAAO,MAAO,EAAc,SAAU,AAAC,GAAM,EAAgB,EAAE,MAAM,CAAC,KAAK,EAAG,SAAU,aAKtI,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAO,CAAA,CAAC,MAAM,WAAW,QAAQ,6BAChC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,mCACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,0BACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAW,CAAA,CACV,QAAQ,oBACR,WAAW,oBACX,YAAY,CAAA,CAAA,EACZ,eAAgB,GAChB,YAAa,GACb,WAAW,CAAA,CAAA,EACX,YAAY,CAAA,CAAA,EACZ,MAAO,EACP,SAAU,AAAC,IACT,IAAM,EAAQ,GAAiC,KAC/C,EAAgB,YAChB,EAAkB,GAClB,EAAqC,UAAvB,OAAO,GAAM,OAAsB,EAAK,KAAK,CAAG,EAAI,EAAK,KAAK,CAAG,KACjF,EACA,WAAY,GACZ,YAAY,sBACZ,gBAAgB,YAChB,OAAQ,CACN,QAAS,AAAC,IAAU,CAClB,EADiB,CACd,CAAI,CACP,aAAc,sBACd,YAAa,UACb,UAAW,GACX,UAAW,OACb,CAAC,CACD,KAAM,AAAC,GAAU,EACf,EADc,CACX,CAAI,CACP,OAAQ,GACV,CAAC,AACH,MAIJ,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CACL,KAAK,SACL,QAAQ,UACR,KAAK,KACL,UAAU,YACV,SAAU,GACV,QAAS,KACP,GAAuB,MACvB,GAAsB,GACxB,WACD,SAKe,QAAjB,EAAyB,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,iCAAwB,8CAAkD,UAIvH,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAO,CAAA,CAAC,MAAM,aAAa,QAAQ,+BAClC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAM,CAAA,CACL,QAAQ,sBACR,WAAW,sBACX,YAAY,CAAA,CAAA,EACZ,WAAW,CAAA,CAAA,EACX,QAAS,GACT,MAAO,GACP,SAAU,AAAC,IACT,IAAM,EAAQ,GAAmC,KACjD,GAA+C,UAAvB,OAAO,GAAM,OAAsB,EAAK,KAAK,CAAG,EAAI,EAAK,KAAK,CAAG,KAC3F,EACA,WAAY,IAAyC,IAA7B,GAAkB,MAAM,CAChD,YAAa,GAAkB,MAAM,CAAG,EAAI,uBAAyB,2BACrE,gBAAgB,YAChB,OAAQ,CACN,QAAS,AAAC,IAAU,CAClB,EADiB,CACd,CAAI,CACP,aAAc,sBACd,YAAa,UACb,UAAW,GACX,UAAW,OACb,CAAC,CACD,KAAM,AAAC,IAAU,CACf,EADc,CACX,CAAI,CACP,OAAQ,GACV,CAAC,AACH,MAIJ,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAO,CAAA,CAAC,MAAM,uBAAuB,QAAQ,gCAC5C,CAAA,EAAA,EAAA,GAAA,EAAC,WAAA,CACC,GAAG,uBACH,MAAO,EACP,SAAU,AAAC,GAAM,EAAc,EAAE,MAAM,CAAC,KAAK,EAC7C,SAAU,GACV,KAAM,EACN,YAAY,8BACZ,UAAU,mHAId,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAO,CAAA,CAAC,MAAM,+BAA+B,QAAQ,kCACpD,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,kBAAkB,CAAA,CACjB,MAAO,GACP,SAAU,AAAC,GAAS,GAAwB,GAC5C,cAAe,GACf,kBAAmB,GACnB,SAAU,GACV,SAAS,WACT,QAAS,GACT,YAAY,gBACZ,SAAU,GACV,WAAW,QACX,eAAe,aACf,eAAgB,IAAM,CAAC,CACrB,UAAW,KACX,OAAQ,KACR,OAAQ,GACR,IAAK,GACL,MAAO,GACP,aAAc,EAAE,CAClB,CAAC,QAIL,GACF,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,CACR,qBAAsB,GACtB,SAAU,GACV,SAAU,GACV,YAAa,GACb,MAAO,GACP,SAAU,GACV,WAAY,GACZ,cAAe,GACf,aAAc,KACZ,GAAsB,MAClB,CAAC,IAAuB,GAAqB,MAAM,CAAG,GAAG,AAC3D,GAAuB,EAAoB,CAAC,EAAE,EAEhD,IAA0B,EAC5B,EACA,mBAAoB,IAA4C,AAAhC,OAAqB,MAAM,CAC3D,gBAAgB,cAChB,UAAW,KACT,GAAmB,MACf,CAAC,IAAoB,GAAqB,MAAM,CAAG,GAAG,AACxD,GAAoB,EAAoB,CAAC,EAAE,EAE7C,IAAuB,EACzB,EACA,gBAAiB,IAA4C,IAAhC,GAAqB,MAAM,CACxD,aAAa,WACb,gBAAgB,cAChB,sBAAsB,gDACtB,mBAAmB,iBACnB,gBAAiB,IAAM,CAAC,CACtB,GAAI,EAAO,MACX,KAAM,GACN,IAAK,IACL,MAAO,GACT,CAAC,CACD,yBAAyB,wBACzB,0BAA0B,yCAG5B,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,8FACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,uDAA8C,WAC7D,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,2CACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,wEAA+D,aAC9E,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,sCACK,QAAjB,EAAyB,EAAmB,IAAI,IAAM,IAAM,IAAkB,MAAQ,GAAgB,OAAS,MAElH,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,sCACK,QAAjB,EAAyB,EAAoB,IAAI,GAAK,IAAkB,OAAS,QAGtF,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,wEAA+D,oBAC9E,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,4DAAoD,OAAO,QAAQ,CAAC,IAAkB,GAAe,OAAO,CAAC,GAAK,kBAKvI,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,8FACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,uDAA8C,YAC7D,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,iDACqB,IAAjC,GAAsB,MAAM,CAAS,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,iCAAwB,SAAa,KACzF,GAAsB,GAAG,CAAC,AAAC,GAC1B,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,UAAmB,EAAE,KAAK,EAAjB,EAAE,KAAK,SAKvB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,8FACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,uDAA8C,UAC7D,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,2BACgB,IAA5B,GAAiB,MAAM,EAAmC,IAAzB,GAAc,MAAM,EAAwC,IAA9B,GAAmB,MAAM,CACvF,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,iCAAwB,SACrC,KAEH,GAAiB,GAAG,CAAC,AAAC,GACrB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAe,UAAU,4DACxB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,2CACZ,EAAE,GAAG,CAAC,MAAI,EAAE,OAAO,CAAC,IAAI,IAE3B,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,iEAAyD,EAAE,KAAK,EAAI,QAJ3E,EAAE,EAAE,GAQf,GAAc,GAAG,CAAE,AAAD,GACjB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAe,UAAU,4DACxB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,2CACZ,EAAE,GAAG,CAAC,MAAI,EAAE,IAAI,CAAC,IAAI,IAExB,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,iEAAyD,EAAE,KAAK,EAAI,QAJ3E,EAAE,EAAE,GAQf,GAAmB,GAAG,CAAE,AAAD,GACtB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAe,UAAU,4DACxB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,2CACZ,EAAE,GAAG,CAAC,MAAI,EAAE,IAAI,IAEnB,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,iEAAyD,EAAE,KAAK,EAAI,QAJ3E,EAAE,EAAE,kBAetC,CDtrCe,SAAS,IACtB,IAAM,EAAS,CAAA,EAAA,EAAA,SAAA,AAAS,IAClB,EAAa,EAAO,QAAQ,EAAI,EAAO,MAAM,OACnD,AAA0B,AAAtB,iBAAO,GAAwD,GAAG,CAAhC,EAAW,IAAI,GAAG,MAAM,CAE1D,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,mBAAmB,4BAC9B,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,iCAAwB,yBAM3C,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,mBAAmB,4BAC9B,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAe,WAAY,KAGlC"}