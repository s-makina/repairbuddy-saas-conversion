module.exports=[648,a=>{"use strict";var b=a.i(57850),c=a.i(7160);function d({title:a,description:d,actions:e,className:f}){return(0,b.jsxs)("div",{className:(0,c.cn)("flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between",f),children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl font-semibold text-[var(--rb-text)]",children:a}),d?(0,b.jsx)("p",{className:"mt-1 text-sm text-zinc-600",children:d}):null]}),e?(0,b.jsx)("div",{className:"flex items-center gap-2",children:e}):null]})}a.s(["PageHeader",()=>d])},29054,a=>{"use strict";var b=a.i(57850),c=a.i(7160);function d({className:a,type:d,...e}){return(0,b.jsx)("input",{type:d,className:(0,c.cn)("w-full rounded-[var(--rb-radius-sm)] border border-zinc-300 bg-white px-3 py-2 text-sm text-[var(--rb-text)] outline-none transition","placeholder:text-zinc-400","focus-visible:ring-2 focus-visible:ring-[color:color-mix(in_srgb,var(--rb-orange),white_65%)] focus-visible:ring-offset-2 focus-visible:ring-offset-white","disabled:cursor-not-allowed disabled:bg-[var(--rb-surface-muted)] disabled:opacity-70",a),...e})}a.s(["Input",()=>d])},71513,a=>{"use strict";var b=a.i(6454);a.s(["notify",0,{success:(a,c={})=>b.toast.success(a,c),error:(a,c={})=>b.toast.error(a,c),info:(a,c={})=>b.toast.info(a,c),warning:(a,c={})=>b.toast.warning(a,c),loading:(a,c={})=>b.toast.loading(a,c),dismiss(a){b.toast.dismiss(a)},message:(a,c,d={})=>"success"===a?b.toast.success(c,d):"error"===a?b.toast.error(c,d):"warning"===a?b.toast.warning(c,d):"loading"===a?b.toast.loading(c,d):b.toast.info(c,d)}])},90319,a=>{"use strict";var b=a.i(57850),c=a.i(7160);function d({label:a,fieldId:d,description:e,error:f,required:g,className:h,labelClassName:i,fieldClassName:j,children:k}){let l=e?`${d}__description`:void 0,m=f?`${d}__error`:void 0,n=[l,m].filter(Boolean).join(" ")||void 0,o="function"==typeof k?k({describedBy:n,descriptionId:l,errorId:m,invalid:!!f}):k;return(0,b.jsxs)("div",{className:(0,c.cn)("grid gap-1 sm:grid-cols-[220px_1fr] sm:gap-4",h),children:[(0,b.jsx)("div",{className:"sm:pt-2",children:(0,b.jsxs)("label",{className:(0,c.cn)("block text-sm font-medium text-[var(--rb-text)]",i),htmlFor:d,children:[a,g?(0,b.jsx)("span",{className:"text-red-600",children:" *"}):null]})}),(0,b.jsxs)("div",{className:(0,c.cn)("min-w-0",j),children:[o,e?(0,b.jsx)("div",{id:l,className:"mt-1 text-xs text-zinc-500",children:e}):null,f?(0,b.jsx)("div",{id:m,className:"mt-1 text-xs text-red-600",children:f}):null]})]})}a.s(["FormRow",()=>d])},59186,a=>{"use strict";var b=a.i(57850),c=a.i(45056),d=a.i(93609),e=a.i(91601),f=a.i(648),g=a.i(4600),h=a.i(97867),i=a.i(29054),j=a.i(90319),k=a.i(34075),l=a.i(71513);function m(){let a=(0,d.useRouter)(),m=(0,d.useParams)(),n=m.business??m.tenant,[o,p]=(0,c.useState)(!0),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(null),[u,v]=(0,c.useState)([]),[w,x]=(0,c.useState)([]),[y,z]=(0,c.useState)([]),[A,B]=(0,c.useState)(""),[C,D]=(0,c.useState)(null),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)(null),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)(!1),[M,N]=(0,c.useState)(!0),[O,P]=(0,c.useState)([""]);(0,c.useEffect)(()=>{let a=!0;return async function(){if("string"==typeof n&&0!==n.length){p(!0),t(null);try{let[b,c,d]=await Promise.all([(0,k.apiFetch)(`/api/${n}/app/repairbuddy/devices?limit=200`),(0,k.apiFetch)(`/api/${n}/app/repairbuddy/device-brands?limit=200`),(0,k.apiFetch)(`/api/${n}/app/repairbuddy/device-types?limit=200`)]);if(!a)return;let e=Array.isArray(d.device_types)?d.device_types:[],f=Array.isArray(c.device_brands)?c.device_brands:[];v(Array.isArray(b.devices)?b.devices:[]),x(f),z(e),D(e.length>0?e[0].id:null),F(f.length>0?f[0].id:null)}catch(b){if(!a)return;t(b instanceof Error?b.message:"Failed to load form data."),v([]),x([]),z([])}finally{if(!a)return;p(!1)}}}(),()=>{a=!1}},[n]);let Q=(0,c.useMemo)(()=>u.slice().sort((a,b)=>a.model.localeCompare(b.model)),[u]);async function R(b){if((b.preventDefault(),"string"==typeof n&&0!==n.length)&&!q){r(!0),t(null);try{let b=A.trim();if(0===b.length)return void t("Model is required.");if("number"!=typeof C)return void t("Device type is required.");if("number"!=typeof E)return void t("Device brand is required.");let c={model:b,device_type_id:C,device_brand_id:E,parent_device_id:G,disable_in_booking_form:I,is_other:K,is_active:M};if("number"==typeof G){await (0,k.apiFetch)(`/api/${n}/app/repairbuddy/devices`,{method:"POST",body:c}),l.notify.success("Device created."),a.replace(`/app/${n}/devices`);return}let d=await (0,k.apiFetch)(`/api/${n}/app/repairbuddy/devices`,{method:"POST",body:c}),e=d.device?.id;if("number"!=typeof e){l.notify.success("Device created."),a.replace(`/app/${n}/devices`);return}let f=O.map(a=>a.trim()).filter(a=>a.length>0),g=Array.from(new Set(f));if(g.length>0){for(let a of g)await (0,k.apiFetch)(`/api/${n}/app/repairbuddy/devices`,{method:"POST",body:{...c,model:`${b} - ${a}`,parent_device_id:e}});l.notify.success("Device and variations created.")}else l.notify.success("Device created.");a.replace(`/app/${n}/devices`)}catch(a){a instanceof k.ApiError?t(a.message):t("Failed to create device.")}finally{r(!1)}}}let S=q||o;return(0,b.jsx)(e.RequireAuth,{requiredPermission:"devices.manage",children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(f.PageHeader,{title:"New device",description:"Create a new device model (optionally with variations).",actions:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(h.Button,{variant:"outline",size:"sm",onClick:()=>{"string"==typeof n&&0!==n.length&&a.push(`/app/${n}/devices`)},disabled:q,children:"Cancel"}),(0,b.jsx)(h.Button,{variant:"primary",size:"sm",type:"submit",form:"rb_device_new_form",disabled:S,children:q?"Saving...":"Save"})]})}),s?(0,b.jsx)("div",{className:"text-sm text-red-600",children:s}):null,(0,b.jsx)(g.Card,{className:"shadow-none",children:(0,b.jsx)(g.CardContent,{className:"pt-5",children:(0,b.jsxs)("form",{id:"rb_device_new_form",className:"space-y-4",onSubmit:R,children:[(0,b.jsx)(j.FormRow,{label:"Model",fieldId:"device_model",required:!0,children:(0,b.jsx)(i.Input,{id:"device_model",value:A,onChange:a=>B(a.target.value),disabled:S})}),(0,b.jsx)(j.FormRow,{label:"Device type",fieldId:"device_type",required:!0,children:(0,b.jsx)("select",{id:"device_type",className:"w-full rounded-[var(--rb-radius-sm)] border border-zinc-300 bg-white px-3 py-2 text-sm text-[var(--rb-text)]",value:C??"",onChange:a=>{let b=a.target.value;if(!b)return void D(null);let c=Number(b);D(Number.isFinite(c)?c:null)},disabled:S,children:y.slice().sort((a,b)=>a.name.localeCompare(b.name)).map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))})}),(0,b.jsx)(j.FormRow,{label:"Device brand",fieldId:"device_brand",required:!0,children:(0,b.jsx)("select",{id:"device_brand",className:"w-full rounded-[var(--rb-radius-sm)] border border-zinc-300 bg-white px-3 py-2 text-sm text-[var(--rb-text)]",value:E??"",onChange:a=>{let b=a.target.value;if(!b)return void F(null);let c=Number(b);F(Number.isFinite(c)?c:null)},disabled:S,children:w.slice().sort((a,b)=>a.name.localeCompare(b.name)).map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))})}),(0,b.jsx)(j.FormRow,{label:"Variation base",fieldId:"device_parent",description:"Leave empty to create a base device.",children:(0,b.jsxs)("select",{id:"device_parent",className:"w-full rounded-[var(--rb-radius-sm)] border border-zinc-300 bg-white px-3 py-2 text-sm text-[var(--rb-text)]",value:G??"",onChange:a=>{let b=a.target.value;if(!b)return void H(null);let c=Number(b);H(Number.isFinite(c)?c:null),P([""])},disabled:S,children:[(0,b.jsx)("option",{value:"",children:"(none)"}),Q.map(a=>(0,b.jsx)("option",{value:a.id,children:a.model},a.id))]})}),null===G?(0,b.jsx)(j.FormRow,{label:"Variations",fieldId:"device_variations_0",description:'Each entry becomes a child device. Example: "Black", "64GB", "Silver".',children:(0,b.jsxs)("div",{className:"space-y-2",children:[O.map((a,c)=>{let d=`device_variations_${c}`;return(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(i.Input,{id:d,value:a,onChange:a=>{let b=a.target.value;P(a=>a.map((a,d)=>d===c?b:a))},disabled:S}),O.length>1?(0,b.jsx)(h.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{P(a=>a.filter((a,b)=>b!==c))},disabled:S,children:"Remove"}):null]},d)}),(0,b.jsx)("div",{children:(0,b.jsx)(h.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{P(a=>[...a,""])},disabled:S,children:"Add variation"})})]})}):null,(0,b.jsxs)("div",{className:"grid gap-1 sm:grid-cols-[220px_1fr] sm:gap-4",children:[(0,b.jsx)("div",{className:"sm:pt-2",children:(0,b.jsx)("span",{className:"block text-sm font-medium text-[var(--rb-text)]",children:"Options"})}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:I,onChange:a=>J(a.target.checked),disabled:S}),"Disable in booking form"]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:K,onChange:a=>L(a.target.checked),disabled:S}),"Is ",'"Other"'," device"]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:M,onChange:a=>N(a.target.checked),disabled:S}),"Active"]})]})]})]})})})]})})}a.s(["default",()=>m])}];

//# sourceMappingURL=frontend_src_12cc8200._.js.map