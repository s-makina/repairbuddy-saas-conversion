module.exports=[18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},31699,(a,b,c)=>{"use strict";b.exports=a.r(18622)},57850,(a,b,c)=>{"use strict";b.exports=a.r(31699).vendored["react-ssr"].ReactJsxRuntime},45056,(a,b,c)=>{"use strict";b.exports=a.r(31699).vendored["react-ssr"].React},97134,(a,b,c)=>{"use strict";b.exports=a.r(31699).vendored["react-ssr"].ReactDOM},34075,1631,35644,a=>{"use strict";let b=process.env.NEXT_PUBLIC_API_BASE_URL?.replace(/\/+$/,"")||"http://localhost:8000";function c(){return null}function d(a){}function e(){}function f(){return null}function g(a){}function h(){}a.s(["clearToken",()=>e,"getToken",()=>c,"setToken",()=>d],1631),a.s(["clearImpersonationSessionId",()=>h,"getImpersonationSessionId",()=>f,"setImpersonationSessionId",()=>g],35644);class i extends Error{status;data;constructor(a,b,c){super(a),this.status=b,this.data=c}}async function j(a,d={}){let e,g,h=`${b}${a.startsWith("/")?"":"/"}${a}`,k=new Headers(d.headers);k.set("Accept","application/json");let l=d.token??c();l&&k.set("Authorization",`Bearer ${l}`);let m="number"==typeof d.impersonationSessionId||null===d.impersonationSessionId?d.impersonationSessionId:f();"number"==typeof m&&Number.isFinite(m)&&m>0&&k.set("X-RB-Impersonation",String(m)),void 0!==d.body&&(d.body instanceof FormData?e=d.body:(k.set("Content-Type","application/json"),e=JSON.stringify(d.body)));let n="number"==typeof d.timeoutMs?d.timeoutMs:15e3,o=d.signal?null:new AbortController,p=o?setTimeout(()=>o.abort(),n):null;try{g=await fetch(h,{...d,headers:k,body:e,signal:o?.signal??d.signal})}catch(a){if(o&&null!==p&&clearTimeout(p),a instanceof DOMException&&"AbortError"===a.name)throw new i("Request timed out",408,null);throw a}finally{o&&null!==p&&clearTimeout(p)}let q=(g.headers.get("content-type")||"").includes("application/json")?await g.json().catch(()=>null):await g.text().catch(()=>"");if(!g.ok)throw new i((q&&"object"==typeof q&&"message"in q?String(q.message):`Request failed with status ${g.status}`)||"Request failed",g.status,q);return q}async function k(a,d={}){let e,g,h=`${b}${a.startsWith("/")?"":"/"}${a}`,j=new Headers(d.headers);j.set("Accept","application/octet-stream");let l=d.token??c();l&&j.set("Authorization",`Bearer ${l}`);let m="number"==typeof d.impersonationSessionId||null===d.impersonationSessionId?d.impersonationSessionId:f();"number"==typeof m&&Number.isFinite(m)&&m>0&&j.set("X-RB-Impersonation",String(m)),void 0!==d.body&&(j.set("Content-Type","application/json"),e=JSON.stringify(d.body));let n="number"==typeof d.timeoutMs?d.timeoutMs:3e4,o=d.signal?null:new AbortController,p=o?setTimeout(()=>o.abort(),n):null;try{g=await fetch(h,{...d,headers:j,body:e,signal:o?.signal??d.signal})}catch(a){if(o&&null!==p&&clearTimeout(p),a instanceof DOMException&&"AbortError"===a.name)throw new i("Request timed out",408,null);throw a}finally{o&&null!==p&&clearTimeout(p)}if(!g.ok){let a=(g.headers.get("content-type")||"").includes("application/json")?await g.json().catch(()=>null):await g.text().catch(()=>"");throw new i((a&&"object"==typeof a&&"message"in a?String(a.message):`Request failed with status ${g.status}`)||"Request failed",g.status,a)}let q=await g.blob(),r=URL.createObjectURL(q),s=g.headers.get("content-disposition")||"",t=/filename\*?=(?:UTF-8''|\")?([^;\"\n]+)\"?/i.exec(s),u=t?.[1]?decodeURIComponent(t[1]):null,v=d.filename??u??"export",w=document.createElement("a");w.href=r,w.download=v,document.body.appendChild(w),w.click(),w.remove(),URL.revokeObjectURL(r)}a.s(["ApiError",()=>i,"apiDownload",()=>k,"apiFetch",()=>j],34075)},75458,a=>{"use strict";var b=a.i(57850),c=a.i(45056),d=a.i(34075),e=a.i(1631),f=a.i(35644);let g=(0,c.createContext)(null);function h({children:a}){let[h,i]=(0,c.useState)(!0),[j,k]=(0,c.useState)(null),[l,m]=(0,c.useState)(null),[n,o]=(0,c.useState)(null),[p,q]=(0,c.useState)(null),[r,s]=(0,c.useState)([]),[t,u]=(0,c.useState)([]),[v,w]=(0,c.useState)(null),x=(0,c.useCallback)(()=>{(0,f.clearImpersonationSessionId)(),o(null),u([]),w(null)},[]),y=(0,c.useCallback)(async()=>{let a=(0,e.getToken)();if(!a){k(null),m(null),o(null),q(null),s([]),u([]),w(null),i(!1);return}try{let b=await (0,d.apiFetch)("/api/auth/me",{token:a});b.user?(k(a),m(b.user),q(b.tenant),s(Array.isArray(b.permissions)?b.permissions:[]),o(b.actor_user??null),u(Array.isArray(b.actor_permissions)?b.actor_permissions:[]),w(b.impersonation??null),b.impersonation?.session_id?(0,f.setImpersonationSessionId)(b.impersonation.session_id):(0,f.clearImpersonationSessionId)()):((0,e.clearToken)(),(0,f.clearImpersonationSessionId)(),k(null),m(null),o(null),q(null),s([]),u([]),w(null))}catch{(0,e.clearToken)(),(0,f.clearImpersonationSessionId)(),k(null),m(null),o(null),q(null),s([]),u([]),w(null)}finally{i(!1)}},[]);(0,c.useEffect)(()=>{y()},[y]);let z=(0,c.useCallback)(async(a,b)=>{let c;try{c=await (0,d.apiFetch)("/api/auth/login",{method:"POST",body:{email:a,password:b}})}catch(a){if(a instanceof Error&&"status"in a&&"data"in a&&403===a.status&&a.data&&"object"==typeof a.data&&!0===a.data.verification_required)return{status:"verification_required"};throw a}return"token"in c&&"string"==typeof c.token?((0,e.setToken)(c.token),k(c.token),m(c.user),q(c.tenant),s(Array.isArray(c.permissions)?c.permissions:[]),{status:"ok",must_change_password:!!c.user?.must_change_password}):"otp_required"in c&&c.otp_required?{status:"otp_required",otp_login_token:c.otp_login_token}:{status:"verification_required"}},[]),A=(0,c.useCallback)(async(a,b)=>{let c=await (0,d.apiFetch)("/api/auth/login/otp",{method:"POST",body:{otp_login_token:a,code:b}});return(0,e.setToken)(c.token),k(c.token),m(c.user),q(c.tenant),s(Array.isArray(c.permissions)?c.permissions:[]),{must_change_password:!!c.user?.must_change_password}},[]),B=(0,c.useCallback)(async a=>{await (0,d.apiFetch)("/api/auth/register",{method:"POST",body:a})},[]),C=(0,c.useCallback)(async a=>{await (0,d.apiFetch)("/api/auth/email/resend",{method:"POST",body:{email:a}})},[]),D=(0,c.useCallback)(async()=>{let a=(0,e.getToken)();try{a&&await (0,d.apiFetch)("/api/auth/logout",{method:"POST",token:a})}finally{(0,e.clearToken)(),(0,f.clearImpersonationSessionId)(),k(null),m(null),o(null),q(null),s([]),u([]),w(null)}},[]),E=(0,c.useMemo)(()=>{let a=!!j,b=!!l?.is_admin,c=!!v?.session_id;return{loading:h,token:j,user:l,actorUser:n,tenant:p,permissions:r,actorPermissions:t,impersonation:v,isAuthenticated:a,isAdmin:b,isImpersonating:c,can:a=>r.includes(a),refresh:y,login:z,loginOtp:A,register:B,resendVerificationEmail:C,logout:D,clearImpersonation:x}},[h,j,l,n,p,r,t,v,y,z,A,B,C,D,x]);return(0,b.jsx)(g.Provider,{value:E,children:a})}function i(){let a=(0,c.useContext)(g);if(!a)throw Error("useAuth must be used within AuthProvider");return a}a.s(["AuthProvider",()=>h,"useAuth",()=>i])},24618,a=>{"use strict";var b=a.i(57850),c=a.i(75458),d=a.i(6454);function e({children:a}){return(0,b.jsxs)(c.AuthProvider,{children:[a,(0,b.jsx)(d.Toaster,{richColors:!0,closeButton:!0,position:"top-right"})]})}a.s(["Providers",()=>e])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__74037608._.js.map