module.exports=[18794,a=>{"use strict";var b=a.i(57850),c=a.i(93609),d=a.i(91601),e=a.i(648),f=a.i(45056),g=a.i(59843),h=a.i(72245),i=a.i(7954),j=a.i(40360),k=a.i(3596),l=a.i(78807),m=a.i(72481),n=a.i(23585),o=a.i(72438),p=a.i(95506),q=a.i(75412),r=a.i(89523),s=a.i(7963),t=a.i(22663),u=a.i(38794),v=a.i(75385),w=a.i(97867),x=a.i(4600),y=a.i(26606);let z=[{key:"company-profile",label:"Operations"},{key:"general",label:"General"},{key:"currency",label:"Currency"},{key:"invoices-reports",label:"Invoices & Reports"},{key:"job-statuses",label:"Statuses"},{key:"payments",label:"Payments"},{key:"reviews",label:"Reviews"},{key:"estimates",label:"Estimates"},{key:"my-account",label:"My Account"},{key:"devices-brands",label:"Devices & Brands"},{key:"sms",label:"SMS"},{key:"taxes",label:"Taxes"},{key:"service-settings",label:"Service Settings"},{key:"time-logs",label:"Time Logs"},{key:"maintenance-reminders",label:"Maintenance Reminders"},{key:"styling-labels",label:"Styling & Labels"},{key:"signature-workflow",label:"Signature Workflow"},{key:"booking",label:"Booking"}],A={general:{businessName:"",businessPhone:"",businessAddress:"",logoUrl:"",email:"",displayName:"",primaryContactName:"",registrationNumber:"",caseNumberPrefix:"RB",caseNumberLength:6,emailCustomer:!0,attachPdf:!0,nextServiceDateEnabled:!1,gdprAcceptanceText:"I agree to the privacy policy.",gdprLinkLabel:"Privacy policy",gdprLinkUrl:"",defaultCountry:"US",disableStatusCheckBySerial:!1},currency:{currency:"USD",currencyPosition:"left",thousandSeparator:",",decimalSeparator:".",numberOfDecimals:2},invoicesReports:{addQrCodeToInvoice:!0,invoiceFooterMessage:"Thank you for your business.",invoicePrintType:"standard",displayPickupDate:!0,displayDeliveryDate:!0,displayNextServiceDate:!1,invoiceDisclaimerTerms:"",repairOrderType:"standard",termsUrl:"",repairOrderPrintSize:"a4",displayBusinessAddressDetails:!0,displayCustomerEmailAddressDetails:!0,repairOrderFooterMessage:""},jobStatuses:{statuses:[{id:"status_received",name:"Received",slug:"received",description:"Job received",invoiceLabel:"Received",manageWooStock:!1,status:"active"},{id:"status_completed",name:"Completed",slug:"completed",description:"Job completed",invoiceLabel:"Completed",manageWooStock:!1,status:"active"},{id:"status_cancelled",name:"Cancelled",slug:"cancelled",description:"Job cancelled",invoiceLabel:"Cancelled",manageWooStock:!1,status:"active"}],completedStatusId:"status_completed",cancelledStatusId:"status_cancelled"},payments:{statuses:[{id:"pay_unpaid",name:"Unpaid",slug:"unpaid",description:"",status:"active"},{id:"pay_paid",name:"Paid",slug:"paid",description:"",status:"active"},{id:"pay_refunded",name:"Refunded",slug:"refunded",description:"",status:"active"}],paymentMethods:{cash:!0,card:!0,bankTransfer:!1,paypal:!1,other:!1}},reviews:{requestFeedbackBySms:!1,requestFeedbackByEmail:!0,feedbackPage:"",sendReviewRequestIfJobStatusId:"status_completed",autoFeedbackRequestIntervalDays:2,emailSubject:"How did we do?",emailMessageTemplate:"Thanks for choosing us. Please leave feedback.",smsMessageTemplate:"Thanks for your visit. Please leave feedback."},estimates:{customerEmailSubject:"Your estimate",customerEmailBody:"Please review your estimate.",disableEstimates:!1,bookingQuoteSendToJobs:!0,adminApproveRejectEmailSubject:"Estimate decision",adminApproveRejectEmailBody:"An estimate was approved or rejected."},myAccount:{disableBooking:!1,disableEstimates:!1,disableReviews:!1,bookingFormType:"simple"},devicesBrands:{enablePinCodeField:!1,showPinCodeInDocuments:!1,useWooProductsAsDevices:!1,labels:{note:"Note",pin:"PIN",device:"Device",deviceBrand:"Brand",deviceType:"Type",imei:"IMEI"},additionalDeviceFields:[],pickupDeliveryEnabled:!1,pickupCharge:"0",deliveryCharge:"0",rentalEnabled:!1,rentalPerDay:"0",rentalPerWeek:"0"},pagesSetup:{dashboardPage:"",statusCheckPage:"",feedbackPage:"",bookingPage:"",servicesPage:"",partsPage:"",redirectAfterLogin:"",enableRegistration:!0},sms:{activateSmsForSelectiveStatuses:!1,gateway:"twilio",gatewayAccountSid:"",gatewayAuthToken:"",gatewayFromNumber:"",sendWhenStatusChangedToIds:["status_received","status_completed"],testNumber:"",testMessage:"Test message"},taxes:{enableTaxes:!1,taxes:[{id:"tax_none",name:"No tax",ratePercent:0,status:"active"},{id:"tax_standard",name:"Standard",ratePercent:20,status:"active"}],defaultTaxId:"tax_none",invoiceAmounts:"exclusive"},serviceSettings:{sidebarDescription:"",disableBookingOnServicePage:!1,bookingFormType:"simple"},timeLogs:{disableTimeLog:!1,defaultTaxIdForHours:"tax_none",enableTimeLogForStatusIds:[],activities:"Repair\nDiagnostic\nTesting\nCleaning\nConsultation\nOther"},maintenanceReminders:{reminders:[{id:"reminder_1",name:"Maintenance reminder",intervalDays:180,status:"active"}]},stylingLabels:{labels:{delivery:"Delivery",pickup:"Pickup",nextService:"Next service",caseNumber:"Case number"},colors:{primary:"#2563eb",secondary:"#f97316"}},signatureWorkflow:{pickup:{enabled:!1,triggerStatusId:"status_completed",templates:{emailSubject:"Pickup signature requested",emailTemplate:"Please sign the pickup form.",smsText:"Please sign the pickup form."},statusAfterSubmissionId:"status_completed"},delivery:{enabled:!1,triggerStatusId:"status_completed",templates:{emailSubject:"Delivery signature requested",emailTemplate:"Please sign the delivery form.",smsText:"Please sign the delivery form."},statusAfterSubmissionId:"status_completed"}},booking:{customerEmailSubject:"Booking confirmation",customerEmailBody:"Thanks for your booking.",adminEmailSubject:"New booking",adminEmailBody:"A new booking has been received.",publicBookingMode:"ungrouped",publicBookingUiStyle:"wizard",sendBookingQuoteToJobs:!0,customerCreationEmailBehavior:"send_login_credentials",turnOffOtherDeviceBrand:!1,turnOffOtherService:!1,turnOffServicePrice:!1,turnOffIdImeiInBooking:!1,defaultType:"",defaultBrand:"",defaultDevice:""}};var B=a.i(34075),C=a.i(49604),D=a.i(36747);function E(a,b){let c,d,e,f=b.setup_state??{},g=f.identity?.logo_url,h=f.identity??{},i="string"==typeof b.logo_url?b.logo_url:"string"==typeof g?g:"",j="string"==typeof b.billing_country?b.billing_country.trim().toUpperCase():"";return{...a,general:{...a.general,businessName:b.name??"",businessPhone:b.contact_phone??"",email:b.contact_email??"",displayName:"string"==typeof h.display_name?h.display_name:a.general.displayName,primaryContactName:"string"==typeof h.primary_contact_name?h.primary_contact_name:a.general.primaryContactName,registrationNumber:"string"==typeof h.registration_number?h.registration_number:a.general.registrationNumber,businessAddress:(c=b.billing_address_json??{},d=[],"string"==typeof c.line1&&c.line1.trim()&&d.push(c.line1.trim()),"string"==typeof c.line2&&c.line2.trim()&&d.push(c.line2.trim()),"string"==typeof c.city&&c.city.trim()&&d.push(c.city.trim()),"string"==typeof c.state&&c.state.trim()&&d.push(c.state.trim()),"string"==typeof c.postal_code&&c.postal_code.trim()&&d.push(c.postal_code.trim()),(e="string"==typeof b.billing_country?b.billing_country.trim().toUpperCase():"")&&d.push(e),d.join(", ")),logoUrl:i,defaultCountry:j||a.general.defaultCountry}}}var F=a.i(29054);let G=["UTC","Europe/London","Europe/Berlin","Europe/Paris","Africa/Cairo","Asia/Dubai","Asia/Riyadh","Asia/Kolkata","Asia/Singapore","Asia/Tokyo","Australia/Sydney","America/New_York","America/Chicago","America/Denver","America/Los_Angeles"];function H({tenantSlug:a}){let[c,d]=(0,f.useState)(!0),[e,g]=(0,f.useState)(!1),[h,i]=(0,f.useState)(!1),[j,k]=(0,f.useState)(null),[l,m]=(0,f.useState)(null),[n,o]=(0,f.useState)(null),[p,q]=(0,f.useState)(""),[r,s]=(0,f.useState)(""),[t,u]=(0,f.useState)(""),[y,z]=(0,f.useState)(""),[A,C]=(0,f.useState)("UTC"),[E,H]=(0,f.useState)("Mon–Fri 09:00–17:00"),[I,J]=(0,f.useState)(""),[K,L]=(0,f.useState)(""),[M,N]=(0,f.useState)(!0),[O,P]=(0,f.useState)(!1),Q=(0,f.useMemo)(()=>{try{let a=Intl,b="function"==typeof a.supportedValuesOf?a.supportedValuesOf("timeZone"):null;return Array.isArray(b)&&b.length>0?b:G}catch{return G}},[]);(0,f.useEffect)(()=>{let b=!0;return async function(){try{k(null),m(null),d(!0);let c=await (0,D.getSetup)(String(a));if(!b)return;o(c);let e=c.tenant;C(e.timezone??"UTC");let f=c.setup?.state??{},g=f.branding??{},h=f.operations??{};q("string"==typeof g.support_email?g.support_email:""),s("string"==typeof g.support_phone?g.support_phone:""),u("string"==typeof g.website?g.website:""),z("string"==typeof g.document_footer?g.document_footer:""),H("string"==typeof h.working_hours?h.working_hours:"Mon–Fri 09:00–17:00"),J("string"==typeof h.default_labor_rate?h.default_labor_rate:""),L("string"==typeof h.warranty_terms?h.warranty_terms:""),N("boolean"!=typeof h.notify_status_change||h.notify_status_change),P("boolean"==typeof h.notify_invoice_created&&h.notify_invoice_created)}catch(a){if(!b)return;k(a instanceof Error?a.message:"Failed to load settings."),o(null)}finally{if(!b)return;d(!1)}}(),()=>{b=!1}},[a]);let R=n?.tenant,S=(0,f.useMemo)(()=>n?.setup?.state??null,[n?.setup?.state]),T=(0,f.useMemo)(()=>{if(!R)return!1;let a=S??{},b=a.branding??{},c=a.operations??{};return(A.trim()||"")!==((R.timezone??"").trim()||"")||(p.trim()||"")!==("string"==typeof b.support_email?b.support_email.trim():"")||(r.trim()||"")!==("string"==typeof b.support_phone?b.support_phone.trim():"")||(t.trim()||"")!==("string"==typeof b.website?b.website.trim():"")||(y.trim()||"")!==("string"==typeof b.document_footer?b.document_footer.trim():"")||(E.trim()||"")!==("string"==typeof c.working_hours?c.working_hours.trim():"")||(I.trim()||"")!==("string"==typeof c.default_labor_rate?c.default_labor_rate.trim():"")||(K.trim()||"")!==("string"==typeof c.warranty_terms?c.warranty_terms.trim():"")||M!==("boolean"!=typeof c.notify_status_change||c.notify_status_change)||O!==("boolean"==typeof c.notify_invoice_created&&c.notify_invoice_created)},[I,y,R,S,O,M,p,r,A,K,t,E]),U=f.default.useCallback(async b=>{i(!0),k(null);try{let c=await (0,D.updateSetup)(String(a),{logo:b});o(a=>a?{...a,tenant:c.tenant}:a)}catch(a){k(a instanceof Error?a.message:"Failed to upload logo.")}finally{i(!1)}},[a]);async function V(b){if(b.preventDefault(),k(null),m(null),!A.trim())return void k("Timezone is required.");g(!0);try{let b={...n?.setup?.state??{},branding:{support_email:p.trim()||null,support_phone:r.trim()||null,website:t.trim()||null,document_footer:y.trim()||null},operations:{working_hours:E.trim()||null,default_labor_rate:I.trim()||null,warranty_terms:K.trim()||null,notify_status_change:!!M,notify_invoice_created:!!O}},c=await (0,D.updateSetup)(String(a),{timezone:A.trim()||null,language:"en",setup_state:b});o(a=>a?{...a,tenant:c.tenant,setup:{...a.setup,state:b}}:a),m("Settings saved.")}catch(a){a instanceof B.ApiError?k(a.message):k("Failed to save settings.")}finally{g(!1)}}return(0,b.jsxs)("div",{className:"space-y-4",children:[j?(0,b.jsx)(v.Alert,{variant:"danger",title:"Could not load or save settings",children:j}):null,l?(0,b.jsx)(v.Alert,{variant:"success",title:"Success",children:l}):null,c?(0,b.jsx)("div",{className:"text-sm text-zinc-500",children:"Loading settings..."}):null,!c&&n?(0,b.jsxs)("form",{className:"space-y-6",onSubmit:V,children:[(0,b.jsxs)(x.Card,{children:[(0,b.jsxs)(x.CardHeader,{children:[(0,b.jsx)(x.CardTitle,{children:"Branding"}),(0,b.jsx)(x.CardDescription,{children:"Customer-facing visuals and contact information."})]}),(0,b.jsx)(x.CardContent,{className:"space-y-4",children:(0,b.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-[var(--rb-text)]",children:"Logo"}),(0,b.jsxs)("div",{className:"mt-2 flex items-center gap-3",children:[n?.tenant?.logo_url?(0,b.jsx)("img",{src:n.tenant.logo_url,alt:"Logo",className:"h-10 w-10 rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white object-contain"}):(0,b.jsx)("div",{className:"h-10 w-10 rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white"}),(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsx)("input",{type:"file",accept:"image/png,image/jpeg,image/webp",disabled:h,onChange:a=>{let b=a.target.files&&a.target.files[0]?a.target.files[0]:null;b&&U(b)},className:"block w-full text-sm text-zinc-700 file:mr-3 file:rounded-[var(--rb-radius-sm)] file:border-0 file:bg-[var(--rb-surface-muted)] file:px-3 file:py-2 file:text-sm file:font-medium file:text-[var(--rb-text)] hover:file:bg-[color:color-mix(in_srgb,var(--rb-surface-muted),black_4%)]"})})]}),(0,b.jsx)("div",{className:"mt-2 text-xs text-zinc-500",children:h?"Uploading...":"PNG/JPG/WEBP up to 5MB"})]}),(0,b.jsxs)("div",{className:"sm:col-span-2",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Customer-facing contact (optional)"}),(0,b.jsxs)("div",{className:"mt-2 grid gap-3 sm:grid-cols-2",children:[(0,b.jsx)(F.Input,{value:p,onChange:a=>q(a.target.value),placeholder:"Public support email",disabled:e}),(0,b.jsx)(F.Input,{value:r,onChange:a=>s(a.target.value),placeholder:"Public support phone",disabled:e}),(0,b.jsx)("div",{className:"sm:col-span-2",children:(0,b.jsx)(F.Input,{value:t,onChange:a=>u(a.target.value),placeholder:"Website (optional)",disabled:e})}),(0,b.jsx)("div",{className:"sm:col-span-2",children:(0,b.jsx)(F.Input,{value:y,onChange:a=>z(a.target.value),placeholder:"Document footer text (optional)",disabled:e})})]})]})]})})]}),(0,b.jsxs)(x.Card,{children:[(0,b.jsxs)(x.CardHeader,{children:[(0,b.jsx)(x.CardTitle,{children:"Operations"}),(0,b.jsx)(x.CardDescription,{children:"Defaults and notifications."})]}),(0,b.jsx)(x.CardContent,{className:"space-y-4",children:(0,b.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-[var(--rb-text)]",children:"Timezone"}),(0,b.jsxs)("div",{className:"mt-1",children:[(0,b.jsx)(F.Input,{value:A,onChange:a=>C(a.target.value),placeholder:"UTC",list:"rb-timezones",disabled:e}),(0,b.jsx)("datalist",{id:"rb-timezones",children:Q.map(a=>(0,b.jsx)("option",{value:a},a))})]}),(0,b.jsx)("div",{className:"mt-2 text-xs text-zinc-500",children:"Example: UTC, Europe/Berlin, America/New_York"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-[var(--rb-text)]",children:"Language"}),(0,b.jsx)("div",{className:"mt-1",children:(0,b.jsx)(F.Input,{value:"English (en)",disabled:!0})}),(0,b.jsx)("div",{className:"mt-2 text-xs text-zinc-500",children:"Currently supported language: English"})]}),(0,b.jsxs)("div",{className:"sm:col-span-2",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Operations defaults (optional)"}),(0,b.jsxs)("div",{className:"mt-2 grid gap-3 sm:grid-cols-2",children:[(0,b.jsx)("div",{className:"sm:col-span-2",children:(0,b.jsx)(F.Input,{value:E,onChange:a=>H(a.target.value),placeholder:"Working hours (e.g. Mon–Fri 09:00–17:00)",disabled:e})}),(0,b.jsx)(F.Input,{value:I,onChange:a=>J(a.target.value),placeholder:"Default labor rate (optional)",disabled:e}),(0,b.jsx)(F.Input,{value:K,onChange:a=>L(a.target.value),placeholder:"Default warranty terms (optional)",disabled:e}),(0,b.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm text-[var(--rb-text)]",children:[(0,b.jsx)("input",{type:"checkbox",checked:M,onChange:a=>N(a.target.checked),disabled:e}),"Email on status change"]}),(0,b.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm text-[var(--rb-text)]",children:[(0,b.jsx)("input",{type:"checkbox",checked:O,onChange:a=>P(a.target.checked),disabled:e}),"Email on invoice created"]})]})]})]})})]}),(0,b.jsx)("div",{className:"flex items-center justify-end gap-2",children:(0,b.jsx)(w.Button,{type:"submit",disabled:e||!T,children:e?"Saving...":"Save changes"})})]}):null]})}var I=a.i(39159);function J({title:a,description:c,children:d}){return(0,b.jsxs)(x.Card,{children:[(0,b.jsxs)(x.CardHeader,{children:[(0,b.jsx)(x.CardTitle,{children:a}),c?(0,b.jsx)(x.CardDescription,{children:c}):null]}),(0,b.jsx)(x.CardContent,{className:"space-y-4",children:d})]})}function K({draft:a,updateBooking:c}){let d=a.booking;return(0,b.jsx)(J,{title:"Booking",description:"Booking/quote templates and form defaults.",children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Email templates"}),(0,b.jsxs)("div",{className:"mt-2 grid gap-4 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Customer email subject"}),(0,b.jsx)(F.Input,{value:d.customerEmailSubject,onChange:a=>c({customerEmailSubject:a.target.value})})]}),(0,b.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Customer email body"}),(0,b.jsx)("textarea",{className:"min-h-[140px] w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:d.customerEmailBody,onChange:a=>c({customerEmailBody:a.target.value})})]}),(0,b.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Admin email subject"}),(0,b.jsx)(F.Input,{value:d.adminEmailSubject,onChange:a=>c({adminEmailSubject:a.target.value})})]}),(0,b.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Admin email body"}),(0,b.jsx)("textarea",{className:"min-h-[140px] w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:d.adminEmailBody,onChange:a=>c({adminEmailBody:a.target.value})})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Booking workflow"}),(0,b.jsxs)("div",{className:"mt-2 grid gap-2",children:[(0,b.jsxs)("div",{className:"grid gap-1 sm:max-w-[360px]",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Public booking mode"}),(0,b.jsxs)(I.Select,{value:d.publicBookingMode,onChange:a=>c({publicBookingMode:a.target.value}),children:[(0,b.jsx)("option",{value:"ungrouped",children:"Ungrouped (brand → device)"}),(0,b.jsx)("option",{value:"grouped",children:"Grouped (type → brand → device)"}),(0,b.jsx)("option",{value:"warranty",children:"Warranty (grouped + date of purchase)"})]})]}),(0,b.jsxs)("div",{className:"grid gap-1 sm:max-w-[360px]",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Public booking UI style"}),(0,b.jsxs)(I.Select,{value:d.publicBookingUiStyle??"wizard",onChange:a=>c({publicBookingUiStyle:a.target.value}),children:[(0,b.jsx)("option",{value:"wizard",children:"List / Wizard"}),(0,b.jsx)("option",{value:"images",children:"Images / Cards"})]}),(0,b.jsx)("div",{className:"text-xs text-zinc-500",children:"Controls the design used on /t/<tenant>/book."})]}),(0,b.jsxs)("div",{className:"grid gap-1 sm:max-w-[360px]",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"New customer email behavior"}),(0,b.jsxs)(I.Select,{value:d.customerCreationEmailBehavior??"send_login_credentials",onChange:a=>c({customerCreationEmailBehavior:a.target.value}),children:[(0,b.jsx)("option",{value:"send_login_credentials",children:"Send login credentials (OTP)"}),(0,b.jsx)("option",{value:"do_not_email",children:"Do not email"})]}),(0,b.jsx)("div",{className:"text-xs text-zinc-500",children:"Controls whether customers get an email when an account is created on booking submit."})]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:d.sendBookingQuoteToJobs,onChange:a=>c({sendBookingQuoteToJobs:a.target.checked})}),"Send booking/quote to jobs"]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:d.turnOffOtherDeviceBrand,onChange:a=>c({turnOffOtherDeviceBrand:a.target.checked})}),"Turn off “other device brand”"]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:d.turnOffOtherService,onChange:a=>c({turnOffOtherService:a.target.checked})}),"Turn off “other service”"]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:d.turnOffServicePrice,onChange:a=>c({turnOffServicePrice:a.target.checked})}),"Turn off service price"]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:d.turnOffIdImeiInBooking,onChange:a=>c({turnOffIdImeiInBooking:a.target.checked})}),"Turn off ID/IMEI in booking"]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Defaults"}),(0,b.jsxs)("div",{className:"mt-2 grid gap-3 sm:grid-cols-2",children:[(0,b.jsx)(F.Input,{value:d.defaultType,onChange:a=>c({defaultType:a.target.value}),placeholder:"Default type"}),(0,b.jsx)(F.Input,{value:d.defaultBrand,onChange:a=>c({defaultBrand:a.target.value}),placeholder:"Default brand"}),(0,b.jsx)(F.Input,{value:d.defaultDevice,onChange:a=>c({defaultDevice:a.target.value}),placeholder:"Default device"})]})]})]})})}var L=a.i(17933),M=a.i(46036),N=a.i(94703),O=a.i(21282),P=a.i(52929);function Q({draft:a,updateCurrency:d}){let e=a.currency,g=(0,c.useParams)(),h=g.business??g.tenant,[i,j]=(0,f.useState)(!0),[k,l]=(0,f.useState)(null),[m,n]=(0,f.useState)(null),[o,p]=(0,f.useState)(!1),[q,r]=(0,f.useState)([]),[s,t]=(0,f.useState)([]),[u,y]=(0,f.useState)(!1),[z,A]=(0,f.useState)(""),[C,D]=(0,f.useState)(""),[E,G]=(0,f.useState)(""),[H,J]=(0,f.useState)(!0),[K,Q]=(0,f.useState)(!1),[R,S]=(0,f.useState)(null);function T(a){let b=(Array.isArray(a)?a:[]).map(a=>({code:(a.code??"").trim().toUpperCase(),symbol:a.symbol??null,name:(a.name??"").trim(),is_active:!!a.is_active,is_default:!!a.is_default})).filter(a=>/^[A-Z]{3}$/.test(a.code)&&a.name.length>0);if(!b.some(a=>a.is_default&&a.is_active)){let a=b.find(a=>a.is_active);a?a.is_default=!0:b[0]&&(b[0].is_default=!0)}let c=!1;return b.map(a=>{let b={...a};return b.is_active||(b.is_default=!1),b.is_default&&(c&&(b.is_default=!1),c=!0),b}).sort((a,b)=>a.code.localeCompare(b.code))}let U=f.default.useCallback(async()=>{if("string"==typeof h&&0!==h.length){j(!0),l(null),n(null);try{let a=await (0,P.getTenantCurrencies)(String(h)),b=T(Array.isArray(a.currencies)?a.currencies:[]);r(b),t(b);let c=b.find(a=>a.is_default)?.code??null;c&&/^[A-Z]{3}$/.test(c)&&d({currency:c})}catch(a){l(a instanceof Error?a.message:"Failed to load currencies."),r([]),t([])}finally{j(!1)}}},[h,d]);(0,f.useEffect)(()=>{U()},[U]);let V=(0,f.useMemo)(()=>JSON.stringify(T(q))!==JSON.stringify(T(s)),[q,s]),W=(0,f.useMemo)(()=>q.find(a=>a.is_default)?.code??"",[q]),X=(0,f.useMemo)(()=>q.filter(a=>a.is_active),[q]),Y=f.default.useCallback((a,b)=>{r(c=>{let d=c.map(c=>c.code===a?{...c,...b}:c);return b.is_default?d.map(b=>b.code===a?{...b,is_default:!0,is_active:!0}:{...b,is_default:!1}):!1===b.is_active?d.map(b=>b.code===a?{...b,is_active:!1,is_default:!1}:b):d})},[]),Z=(0,f.useMemo)(()=>{let a=z.trim().toUpperCase();return!!/^[A-Z]{3}$/.test(a)&&q.some(b=>b.code===a)},[q,z]);async function $(){if("string"==typeof h&&0!==h.length&&V){l(null),n(null),p(!0);try{let a=T(q),b=await (0,P.updateTenantCurrencies)(String(h),a.map(a=>({code:a.code,symbol:a.symbol??null,name:a.name,is_active:!!a.is_active,is_default:!!a.is_default}))),c=T(Array.isArray(b.currencies)?b.currencies:[]);r(c),t(c);let e=c.find(a=>a.is_default)?.code??null;e&&/^[A-Z]{3}$/.test(e)&&d({currency:e}),n("Currencies updated.")}catch(a){a instanceof B.ApiError?l(a.message):l(a instanceof Error?a.message:"Failed to save currencies.")}finally{p(!1)}}}let _=(0,f.useMemo)(()=>/^[A-Z]{3}$/.test(z.trim().toUpperCase())&&!!E.trim()&&!Z,[Z,z,E]),aa=(0,f.useMemo)(()=>{let a=(e.thousandSeparator??"").trim(),b=(e.decimalSeparator??"").trim();return a.length>0&&b.length>0&&a===b},[e.decimalSeparator,e.thousandSeparator]);return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)(x.Card,{children:[(0,b.jsxs)(x.CardHeader,{children:[(0,b.jsx)(x.CardTitle,{children:"Business currencies"}),(0,b.jsx)(x.CardDescription,{children:"Manage currencies for this business. Set the default from the Actions menu."})]}),(0,b.jsxs)(x.CardContent,{className:"space-y-4",children:[k?(0,b.jsx)(v.Alert,{variant:"danger",title:"Could not load currencies",children:k}):null,m?(0,b.jsx)(v.Alert,{variant:"success",title:"Status",children:m}):null,(0,b.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[V?(0,b.jsx)(L.Badge,{variant:"warning",children:"Unsaved changes"}):(0,b.jsx)(L.Badge,{variant:"success",children:"Saved"}),W?(0,b.jsxs)(L.Badge,{variant:"info",children:["Default: ",W]}):null]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsx)(w.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>void U(),disabled:i||o,children:"Refresh"}),(0,b.jsx)(w.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{r(T(s)),l(null),n(null)},disabled:i||o||!V,children:"Reset"}),(0,b.jsx)(w.Button,{type:"button",variant:"secondary",size:"sm",onClick:()=>void $(),disabled:i||o||!V,children:o?"Saving...":"Save"}),(0,b.jsx)(w.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{A(""),D(""),G(""),J(!0),Q(!1),y(!0)},disabled:i||o,children:"Add currency"})]})]}),i?(0,b.jsx)("div",{className:"text-sm text-zinc-500",children:"Loading currencies..."}):null,i?null:(0,b.jsx)("div",{className:"overflow-x-auto rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-white",children:(0,b.jsxs)("table",{className:"min-w-full border-collapse text-left text-sm",children:[(0,b.jsx)("thead",{className:"bg-[var(--rb-surface-muted)]",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"whitespace-nowrap border-b border-[var(--rb-border)] px-3 py-2 text-xs font-semibold uppercase tracking-wide text-zinc-600",children:"Code"}),(0,b.jsx)("th",{className:"whitespace-nowrap border-b border-[var(--rb-border)] px-3 py-2 text-xs font-semibold uppercase tracking-wide text-zinc-600",children:"Name"}),(0,b.jsx)("th",{className:"whitespace-nowrap border-b border-[var(--rb-border)] px-3 py-2 text-xs font-semibold uppercase tracking-wide text-zinc-600",children:"Symbol"}),(0,b.jsx)("th",{className:"whitespace-nowrap border-b border-[var(--rb-border)] px-3 py-2 text-xs font-semibold uppercase tracking-wide text-zinc-600",children:"Status"}),(0,b.jsx)("th",{className:"whitespace-nowrap border-b border-[var(--rb-border)] px-3 py-2 text-xs font-semibold uppercase tracking-wide text-zinc-600"})]})}),(0,b.jsx)("tbody",{children:0===q.length?(0,b.jsx)("tr",{children:(0,b.jsx)("td",{className:"px-3 py-3 text-sm text-zinc-600",colSpan:5,children:"No currencies configured. Add a currency to get started."})}):q.map(a=>(0,b.jsxs)("tr",{className:"border-t border-[var(--rb-border)]",children:[(0,b.jsx)("td",{className:"px-3 py-2 align-middle",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"font-mono text-sm",children:a.code}),a.is_default?(0,b.jsx)(L.Badge,{variant:"info",children:"Default"}):null]})}),(0,b.jsx)("td",{className:"px-3 py-2 align-middle",children:(0,b.jsx)(F.Input,{value:a.name,onChange:b=>Y(a.code,{name:b.target.value}),disabled:o,placeholder:"Currency name"})}),(0,b.jsx)("td",{className:"px-3 py-2 align-middle",children:(0,b.jsx)(F.Input,{value:a.symbol??"",onChange:b=>Y(a.code,{symbol:b.target.value}),disabled:o,placeholder:"$"})}),(0,b.jsx)("td",{className:"px-3 py-2 align-middle",children:(0,b.jsx)(L.Badge,{variant:a.is_active?"success":"default",children:a.is_active?"Active":"Inactive"})}),(0,b.jsx)("td",{className:"px-3 py-2 align-middle text-right",children:(0,b.jsx)(M.DropdownMenu,{align:"right",trigger:({toggle:a})=>(0,b.jsx)(w.Button,{variant:"outline",size:"sm",onClick:a,disabled:o,children:"Actions"}),children:({close:c})=>(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(M.DropdownMenuItem,{onSelect:()=>{c(),Y(a.code,{is_default:!0})},disabled:o||a.is_default||!a.is_active,children:"Set default"}),(0,b.jsx)(M.DropdownMenuItem,{onSelect:()=>{c(),Y(a.code,{is_active:!a.is_active})},disabled:o||a.is_default,children:a.is_active?"Disable":"Enable"}),(0,b.jsx)(M.DropdownMenuSeparator,{}),(0,b.jsx)(M.DropdownMenuItem,{onSelect:()=>{c(),S(a.code)},destructive:!0,disabled:o||a.is_default,children:"Remove"})]})})})]},a.code))})]})}),0!==X.length||i?null:(0,b.jsx)(v.Alert,{variant:"warning",title:"No active currency",children:"Enable at least one currency so you can set a default."})]})]}),(0,b.jsx)(N.Modal,{open:u,onClose:()=>{o||y(!1)},title:"Add currency",footer:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,b.jsx)(w.Button,{variant:"outline",onClick:()=>y(!1),disabled:o,children:"Cancel"}),(0,b.jsx)(w.Button,{variant:"secondary",onClick:()=>{!function(){let a=z.trim().toUpperCase();if(!/^[A-Z]{3}$/.test(a))return;let b=E.trim();if(!b||q.some(b=>b.code===a))return;let c={code:a,symbol:C.trim()?C.trim():null,name:b,is_active:!!H,is_default:!!K};r(b=>{let d=[...b.filter(b=>b.code!==a),c];return c.is_default&&(d=d.map(b=>b.code===a?{...b,is_default:!0,is_active:!0}:{...b,is_default:!1})),T(d)}),A(""),D(""),G(""),J(!0),Q(!1)}(),y(!1)},disabled:o||!_,children:"Add"})]}),children:(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)(v.Alert,{variant:"info",title:"Tip",children:"Add a 3-letter ISO code (example: USD). You can set it active immediately, and optionally set it as the default."}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",htmlFor:"currency_code_new",children:"Code"}),(0,b.jsx)(F.Input,{id:"currency_code_new",value:z,onChange:a=>A(a.target.value.toUpperCase().replace(/[^A-Z]/g,"").slice(0,3)),type:"text",placeholder:"USD",disabled:o}),Z?(0,b.jsx)("div",{className:"text-xs text-zinc-500",children:"This currency is already added."}):null]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",htmlFor:"currency_symbol_new",children:"Symbol"}),(0,b.jsx)(F.Input,{id:"currency_symbol_new",value:C,onChange:a=>D(a.target.value),type:"text",placeholder:"$",disabled:o})]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",htmlFor:"currency_name_new",children:"Name"}),(0,b.jsx)(F.Input,{id:"currency_name_new",value:E,onChange:a=>G(a.target.value),type:"text",placeholder:"US Dollar",disabled:o})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("div",{className:"text-sm font-medium",children:"Active"}),(0,b.jsxs)("label",{className:"flex h-10 items-center gap-2 rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 text-sm text-[var(--rb-text)]",children:[(0,b.jsx)("input",{type:"checkbox",checked:H,onChange:a=>J(a.target.checked),disabled:o||K}),"Active"]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("div",{className:"text-sm font-medium",children:"Default"}),(0,b.jsxs)("label",{className:"flex h-10 items-center gap-2 rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 text-sm text-[var(--rb-text)]",children:[(0,b.jsx)("input",{type:"checkbox",checked:K,onChange:a=>{let b=a.target.checked;Q(b),b&&J(!0)},disabled:o}),"Set as default"]})]})]})]})}),(0,b.jsx)(O.ConfirmDialog,{open:null!==R,title:"Remove currency",message:(0,b.jsxs)("span",{children:["Remove currency ",(0,b.jsx)("span",{className:"font-mono",children:R})," from this business?"]}),confirmText:"Remove",confirmVariant:"outline",busy:o,onCancel:()=>S(null),onConfirm:()=>{R&&r(a=>T(a.filter(a=>a.code!==R))),S(null)}}),(0,b.jsxs)(x.Card,{children:[(0,b.jsxs)(x.CardHeader,{children:[(0,b.jsx)(x.CardTitle,{children:"Currency formatting"}),(0,b.jsx)(x.CardDescription,{children:"Formatting changes are saved with the main “Save” button at the top of this page."})]}),(0,b.jsxs)(x.CardContent,{className:"space-y-4",children:[aa?(0,b.jsx)(v.Alert,{variant:"warning",title:"Check your separators",children:"Thousand and decimal separators are the same. This can make numbers ambiguous."}):null,(0,b.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Default currency code"}),(0,b.jsx)(F.Input,{value:W||e.currency,placeholder:"USD",disabled:!0})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Currency position"}),(0,b.jsxs)(I.Select,{value:e.currencyPosition,onChange:a=>d({currencyPosition:a.target.value}),children:[(0,b.jsx)("option",{value:"left",children:"Left"}),(0,b.jsx)("option",{value:"right",children:"Right"}),(0,b.jsx)("option",{value:"left_space",children:"Left (space)"}),(0,b.jsx)("option",{value:"right_space",children:"Right (space)"})]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Thousand separator"}),(0,b.jsx)(F.Input,{value:e.thousandSeparator,onChange:a=>d({thousandSeparator:a.target.value.slice(0,1)}),placeholder:",",maxLength:1})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Decimal separator"}),(0,b.jsx)(F.Input,{value:e.decimalSeparator,onChange:a=>d({decimalSeparator:a.target.value.slice(0,1)}),placeholder:".",maxLength:1})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Number of decimals"}),(0,b.jsx)(F.Input,{value:String(e.numberOfDecimals),onChange:a=>{let b=Number.parseInt(a.target.value,10);d({numberOfDecimals:Number.isFinite(b)?Math.min(6,Math.max(0,b)):0})},type:"number",min:0,max:6})]})]})]})]})]})}var R=a.i(54177);function S({draft:a,updateDevicesBrands:c,isMock:d}){let[e,g]=(0,f.useState)(!1),[h,i]=(0,f.useState)(null),[j,k]=(0,f.useState)(null),l=a.devicesBrands,[m,n]=(0,f.useState)(""),[o,p]=(0,f.useState)(0),[q,r]=(0,f.useState)(10),s=l.additionalDeviceFields,t=f.default.useMemo(()=>{let a=m.trim().toLowerCase();return a?s.filter(b=>`${b.id} ${b.label}`.toLowerCase().includes(a)):s},[s,m]),u=t.length,v=f.default.useMemo(()=>{let a=o*q,b=a+q;return t.slice(a,b)},[t,o,q]),y=(0,f.useMemo)(()=>h?s.find(a=>a.id===h)??null:null,[h,s]),[z,A]=(0,f.useState)(()=>({id:"",label:"",type:"text",displayInBookingForm:!0,displayInInvoice:!0,displayForCustomer:!0}));function B(){k(null),i(null),A({id:"",label:"",type:"text",displayInBookingForm:!0,displayInInvoice:!0,displayForCustomer:!0}),g(!0)}let C=f.default.useCallback(a=>{k(null),i(a.id),A({...a}),g(!0)},[]);function D(){g(!1),i(null),k(null)}function E(){let a,b=z.label.trim();if(!b)return void k("Label is required.");let d={id:h??(a=globalThis,a.crypto?.randomUUID?`device_field_${a.crypto.randomUUID()}`:`device_field_${Date.now()}_${Math.random().toString(16).slice(2)}`),label:b,type:"text",displayInBookingForm:!!z.displayInBookingForm,displayInInvoice:!!z.displayInInvoice,displayForCustomer:!!z.displayForCustomer};c({additionalDeviceFields:h?s.map(a=>a.id===h?d:a):[...s,d]}),D()}let G=f.default.useCallback(a=>{globalThis.confirm(`Delete field "${a.label}"?`)&&c({additionalDeviceFields:s.filter(b=>b.id!==a.id)})},[s,c]),H=f.default.useMemo(()=>[{id:"label",header:"Label",cell:a=>(0,b.jsxs)("div",{className:"min-w-[200px]",children:[(0,b.jsx)("div",{className:"text-sm font-medium text-[var(--rb-text)]",children:a.label}),(0,b.jsxs)("div",{className:"mt-0.5 text-xs text-zinc-500",children:["ID: ",a.id]})]})},{id:"type",header:"Type",cell:()=>(0,b.jsx)("div",{className:"text-sm text-zinc-600",children:"Text"}),className:"whitespace-nowrap"},{id:"booking",header:"In booking form?",cell:a=>(0,b.jsx)(L.Badge,{variant:a.displayInBookingForm?"success":"default",children:a.displayInBookingForm?"Display":"Hide"}),className:"whitespace-nowrap"},{id:"invoice",header:"In invoice?",cell:a=>(0,b.jsx)(L.Badge,{variant:a.displayInInvoice?"success":"default",children:a.displayInInvoice?"Display":"Hide"}),className:"whitespace-nowrap"},{id:"customer",header:"In customer output?",cell:a=>(0,b.jsx)(L.Badge,{variant:a.displayForCustomer?"success":"default",children:a.displayForCustomer?"Display":"Hide"}),className:"whitespace-nowrap"},{id:"actions",header:"Actions",cell:a=>(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(w.Button,{size:"sm",variant:"outline",disabled:d,onClick:()=>C(a),children:"Edit"}),(0,b.jsx)(w.Button,{size:"sm",variant:"outline",disabled:d,onClick:()=>G(a),children:"Delete"})]}),className:"whitespace-nowrap"}],[G,d,C]);return(0,b.jsxs)(J,{title:"Devices & Brands",description:"Device fields, labels and pickup/delivery/rental toggles.",children:[(0,b.jsx)("div",{className:"grid gap-4 sm:grid-cols-2",children:(0,b.jsxs)("div",{className:"sm:col-span-2",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Device form"}),(0,b.jsxs)("div",{className:"mt-2 grid gap-3",children:[(0,b.jsxs)("label",{className:"flex items-start gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:l.enablePinCodeField,onChange:a=>c({enablePinCodeField:a.target.checked})}),(0,b.jsxs)("span",{children:[(0,b.jsx)("span",{className:"block font-medium text-[var(--rb-text)]",children:"Enable pin code field"}),(0,b.jsx)("span",{className:"mt-0.5 block text-xs text-zinc-500",children:"Adds a PIN input on the device form."})]})]}),(0,b.jsxs)("label",{className:"flex items-start gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:l.showPinCodeInDocuments,onChange:a=>c({showPinCodeInDocuments:a.target.checked}),disabled:!l.enablePinCodeField}),(0,b.jsxs)("span",{children:[(0,b.jsx)("span",{className:"block font-medium text-[var(--rb-text)]",children:"Show pin code in documents"}),(0,b.jsx)("span",{className:"mt-0.5 block text-xs text-zinc-500",children:"Visible in invoices, emails, and status check (if enabled)."})]})]})]})]})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Labels"}),(0,b.jsx)("div",{className:"mt-1 text-xs text-zinc-500",children:"Customize how fields are named across the app."}),(0,b.jsxs)("div",{className:"mt-2 grid gap-3 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Note label"}),(0,b.jsx)(F.Input,{value:l.labels.note,onChange:a=>c({labels:{...l.labels,note:a.target.value}}),placeholder:"Note"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"PIN label"}),(0,b.jsx)(F.Input,{value:l.labels.pin,onChange:a=>c({labels:{...l.labels,pin:a.target.value}}),placeholder:"PIN"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Device label"}),(0,b.jsx)(F.Input,{value:l.labels.device,onChange:a=>c({labels:{...l.labels,device:a.target.value}}),placeholder:"Device"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Brand label"}),(0,b.jsx)(F.Input,{value:l.labels.deviceBrand,onChange:a=>c({labels:{...l.labels,deviceBrand:a.target.value}}),placeholder:"Brand"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Type label"}),(0,b.jsx)(F.Input,{value:l.labels.deviceType,onChange:a=>c({labels:{...l.labels,deviceType:a.target.value}}),placeholder:"Type"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"IMEI label"}),(0,b.jsx)(F.Input,{value:l.labels.imei,onChange:a=>c({labels:{...l.labels,imei:a.target.value}}),placeholder:"IMEI"})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Additional device fields"}),(0,b.jsx)("div",{className:"mt-1 text-xs text-zinc-500",children:"Custom fields shown on the device form."})]}),(0,b.jsx)(w.Button,{variant:"outline",disabled:d,onClick:B,children:"Add field"})]}),(0,b.jsx)(x.Card,{className:"shadow-none",children:(0,b.jsxs)(x.CardContent,{className:"pt-5",children:[(0,b.jsx)(R.DataTable,{title:"Additional device fields",data:v,columns:H,getRowId:a=>a.id,emptyMessage:"No additional fields yet.",search:{placeholder:"Search fields..."},onRowClick:d?void 0:a=>C(a),server:{query:m,onQueryChange:a=>{n(a),p(0)},pageIndex:o,onPageIndexChange:p,pageSize:q,onPageSizeChange:a=>{r(a),p(0)},totalRows:u}}),0===s.length?(0,b.jsxs)("div",{className:"mt-3 flex flex-wrap items-center justify-between gap-2 rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-[var(--rb-surface-muted)] px-3 py-2",children:[(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:"Add your first field to capture extra device info (e.g. Password, Pattern, Account email)."}),(0,b.jsx)(w.Button,{variant:"outline",size:"sm",disabled:d,onClick:B,children:"Add field"})]}):null]})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Pickup / Delivery"}),(0,b.jsxs)("div",{className:"mt-2 grid gap-3 sm:grid-cols-2",children:[(0,b.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:l.pickupDeliveryEnabled,onChange:a=>c({pickupDeliveryEnabled:a.target.checked})}),"Pickup/delivery enabled"]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Pickup charge"}),(0,b.jsx)(F.Input,{value:l.pickupCharge,onChange:a=>c({pickupCharge:a.target.value}),placeholder:"Pickup charge",disabled:!l.pickupDeliveryEnabled})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Delivery charge"}),(0,b.jsx)(F.Input,{value:l.deliveryCharge,onChange:a=>c({deliveryCharge:a.target.value}),placeholder:"Delivery charge",disabled:!l.pickupDeliveryEnabled})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Rental"}),(0,b.jsxs)("div",{className:"mt-2 grid gap-3 sm:grid-cols-2",children:[(0,b.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:l.rentalEnabled,onChange:a=>c({rentalEnabled:a.target.checked})}),"Rental enabled"]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Per day"}),(0,b.jsx)(F.Input,{value:l.rentalPerDay,onChange:a=>c({rentalPerDay:a.target.value}),placeholder:"Per-day",disabled:!l.rentalEnabled})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Per week"}),(0,b.jsx)(F.Input,{value:l.rentalPerWeek,onChange:a=>c({rentalPerWeek:a.target.value}),placeholder:"Per-week",disabled:!l.rentalEnabled})]})]})]}),(0,b.jsx)(N.Modal,{open:e,onClose:D,title:y?"Edit additional device field":"Add additional device field",footer:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,b.jsx)(w.Button,{variant:"outline",onClick:D,children:"Close"}),(0,b.jsx)(w.Button,{disabled:d,onClick:E,children:"Save"})]}),children:(0,b.jsxs)("div",{className:"space-y-3",children:[j?(0,b.jsx)("div",{className:"text-sm text-red-600",children:j}):null,(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Label"}),(0,b.jsx)(F.Input,{value:z.label,onChange:a=>{k(null),A(b=>({...b,label:a.target.value}))},placeholder:"e.g. Password",autoFocus:!0,onKeyDown:a=>{"Enter"===a.key&&(a.preventDefault(),E())}})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Type"}),(0,b.jsx)(I.Select,{value:z.type,onChange:()=>{},disabled:!0,children:(0,b.jsx)("option",{value:"text",children:"Text"})})]}),(0,b.jsxs)("div",{className:"grid gap-3 sm:grid-cols-3",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"In booking form?"}),(0,b.jsxs)(I.Select,{value:z.displayInBookingForm?"yes":"no",onChange:a=>A(b=>({...b,displayInBookingForm:"yes"===a.target.value})),children:[(0,b.jsx)("option",{value:"yes",children:"Display"}),(0,b.jsx)("option",{value:"no",children:"Hide"})]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"In invoice?"}),(0,b.jsxs)(I.Select,{value:z.displayInInvoice?"yes":"no",onChange:a=>A(b=>({...b,displayInInvoice:"yes"===a.target.value})),children:[(0,b.jsx)("option",{value:"yes",children:"Display"}),(0,b.jsx)("option",{value:"no",children:"Hide"})]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"In customer output?"}),(0,b.jsxs)(I.Select,{value:z.displayForCustomer?"yes":"no",onChange:a=>A(b=>({...b,displayForCustomer:"yes"===a.target.value})),children:[(0,b.jsx)("option",{value:"yes",children:"Display"}),(0,b.jsx)("option",{value:"no",children:"Hide"})]})]})]})]})})]})}function T({draft:a,updateEstimates:c}){let d=a.estimates;return(0,b.jsx)(J,{title:"Estimates",description:"Email templates and estimate workflow toggles.",children:(0,b.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,b.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:d.disableEstimates,onChange:a=>c({disableEstimates:a.target.checked})}),"Disable estimates"]}),(0,b.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:d.bookingQuoteSendToJobs,onChange:a=>c({bookingQuoteSendToJobs:a.target.checked})}),"Booking & quote forms: send to jobs"]}),(0,b.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Email subject to customer"}),(0,b.jsx)(F.Input,{value:d.customerEmailSubject,onChange:a=>c({customerEmailSubject:a.target.value})})]}),(0,b.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Email body to customer"}),(0,b.jsx)("textarea",{className:"min-h-[140px] w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:d.customerEmailBody,onChange:a=>c({customerEmailBody:a.target.value})})]}),(0,b.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Approve/reject email subject to admin"}),(0,b.jsx)(F.Input,{value:d.adminApproveRejectEmailSubject,onChange:a=>c({adminApproveRejectEmailSubject:a.target.value})})]}),(0,b.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Approve/reject email body to admin"}),(0,b.jsx)("textarea",{className:"min-h-[140px] w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:d.adminApproveRejectEmailBody,onChange:a=>c({adminApproveRejectEmailBody:a.target.value})})]})]})})}function U({draft:a,updateGeneral:c}){let d=a.general;return(0,b.jsx)(J,{title:"General",description:"Business identity, case numbering and customer communication defaults.",children:(0,b.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Business name"}),(0,b.jsx)(F.Input,{value:d.businessName,onChange:a=>c({businessName:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Display name"}),(0,b.jsx)(F.Input,{value:d.displayName,onChange:a=>c({displayName:a.target.value}),placeholder:"Defaults to business name"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Primary contact person name"}),(0,b.jsx)(F.Input,{value:d.primaryContactName,onChange:a=>c({primaryContactName:a.target.value}),placeholder:"e.g. Alex Johnson"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Business registration number"}),(0,b.jsx)(F.Input,{value:d.registrationNumber,onChange:a=>c({registrationNumber:a.target.value}),placeholder:"Optional"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Business phone"}),(0,b.jsx)(F.Input,{value:d.businessPhone,onChange:a=>c({businessPhone:a.target.value}),placeholder:"+1 555 123 4567"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Email"}),(0,b.jsx)(F.Input,{value:d.email,onChange:a=>c({email:a.target.value}),type:"email",placeholder:"support@company.com"})]}),(0,b.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Business address"}),(0,b.jsx)(F.Input,{value:d.businessAddress,onChange:a=>c({businessAddress:a.target.value}),placeholder:"Street, City, Region"})]}),(0,b.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Logo URL"}),(0,b.jsx)(F.Input,{value:d.logoUrl,onChange:a=>c({logoUrl:a.target.value}),placeholder:"https://..."})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Case number prefix"}),(0,b.jsx)(F.Input,{value:d.caseNumberPrefix,onChange:a=>c({caseNumberPrefix:a.target.value}),placeholder:"RB"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Case number length"}),(0,b.jsx)(F.Input,{value:String(d.caseNumberLength),onChange:a=>c({caseNumberLength:Number(a.target.value||0)}),type:"number",min:1})]}),(0,b.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,b.jsxs)("label",{className:"flex items-start gap-2 text-sm",children:[(0,b.jsx)("input",{className:"mt-0.5",type:"checkbox",checked:d.emailCustomer,onChange:a=>c({emailCustomer:a.target.checked})}),(0,b.jsx)("span",{className:"font-medium",children:"Email customer"})]}),(0,b.jsx)("div",{className:"pl-6 text-xs text-zinc-500",children:"Send customer updates by email by default."})]}),(0,b.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,b.jsxs)("label",{className:"flex items-start gap-2 text-sm",children:[(0,b.jsx)("input",{className:"mt-0.5",type:"checkbox",checked:d.attachPdf,onChange:a=>c({attachPdf:a.target.checked})}),(0,b.jsx)("span",{className:"font-medium",children:"Attach PDF"})]}),(0,b.jsx)("div",{className:"pl-6 text-xs text-zinc-500",children:"Attach a PDF copy to outgoing customer emails."})]}),(0,b.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,b.jsxs)("label",{className:"flex items-start gap-2 text-sm",children:[(0,b.jsx)("input",{className:"mt-0.5",type:"checkbox",checked:d.nextServiceDateEnabled,onChange:a=>c({nextServiceDateEnabled:a.target.checked})}),(0,b.jsx)("span",{className:"font-medium",children:"Next service date"})]}),(0,b.jsx)("div",{className:"pl-6 text-xs text-zinc-500",children:"Enable tracking a next service date on jobs and documents."})]}),(0,b.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"GDPR acceptance text"}),(0,b.jsx)("textarea",{className:"min-h-[90px] w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:d.gdprAcceptanceText,onChange:a=>c({gdprAcceptanceText:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"GDPR link label"}),(0,b.jsx)(F.Input,{value:d.gdprLinkLabel,onChange:a=>c({gdprLinkLabel:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"GDPR link URL"}),(0,b.jsx)(F.Input,{value:d.gdprLinkUrl,onChange:a=>c({gdprLinkUrl:a.target.value}),placeholder:"https://..."})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Default country"}),(0,b.jsx)(F.Input,{value:d.defaultCountry,onChange:a=>c({defaultCountry:a.target.value}),placeholder:"US"})]}),(0,b.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,b.jsxs)("label",{className:"flex items-start gap-2 text-sm",children:[(0,b.jsx)("input",{className:"mt-0.5",type:"checkbox",checked:d.disableStatusCheckBySerial,onChange:a=>c({disableStatusCheckBySerial:a.target.checked})}),(0,b.jsx)("span",{className:"font-medium",children:"Disable status check by serial"})]}),(0,b.jsx)("div",{className:"pl-6 text-xs text-zinc-500",children:"Hide serial-based status lookup to reduce customer self-service options."})]})]})})}function V({draft:a,updateInvoicesReports:c}){let d=a.invoicesReports;return(0,b.jsx)(J,{title:"Invoices & Reports",description:"Document printing, footer content and invoice display preferences.",children:(0,b.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,b.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:d.addQrCodeToInvoice,onChange:a=>c({addQrCodeToInvoice:a.target.checked})}),"Add QR code to invoice"]}),(0,b.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Invoice footer message"}),(0,b.jsx)(F.Input,{value:d.invoiceFooterMessage,onChange:a=>c({invoiceFooterMessage:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Invoice print type"}),(0,b.jsxs)(I.Select,{value:d.invoicePrintType,onChange:a=>c({invoicePrintType:a.target.value}),children:[(0,b.jsx)("option",{value:"standard",children:"Standard"}),(0,b.jsx)("option",{value:"thermal",children:"Thermal"})]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Repair order type"}),(0,b.jsxs)(I.Select,{value:d.repairOrderType,onChange:a=>c({repairOrderType:a.target.value}),children:[(0,b.jsx)("option",{value:"standard",children:"Standard"}),(0,b.jsx)("option",{value:"detailed",children:"Detailed"})]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Repair order print size"}),(0,b.jsxs)(I.Select,{value:d.repairOrderPrintSize,onChange:a=>c({repairOrderPrintSize:a.target.value}),children:[(0,b.jsx)("option",{value:"a4",children:"A4"}),(0,b.jsx)("option",{value:"letter",children:"Letter"})]})]}),(0,b.jsxs)("div",{className:"sm:col-span-2 grid gap-2",children:[(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:d.displayPickupDate,onChange:a=>c({displayPickupDate:a.target.checked})}),"Display pickup date"]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:d.displayDeliveryDate,onChange:a=>c({displayDeliveryDate:a.target.checked})}),"Display delivery date"]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:d.displayNextServiceDate,onChange:a=>c({displayNextServiceDate:a.target.checked})}),"Display next service date"]})]}),(0,b.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Invoice disclaimer / terms"}),(0,b.jsx)("textarea",{className:"min-h-[120px] w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:d.invoiceDisclaimerTerms,onChange:a=>c({invoiceDisclaimerTerms:a.target.value})})]}),(0,b.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Terms URL"}),(0,b.jsx)(F.Input,{value:d.termsUrl,onChange:a=>c({termsUrl:a.target.value}),placeholder:"https://..."})]}),(0,b.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:d.displayBusinessAddressDetails,onChange:a=>c({displayBusinessAddressDetails:a.target.checked})}),"Display business address details"]}),(0,b.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:d.displayCustomerEmailAddressDetails,onChange:a=>c({displayCustomerEmailAddressDetails:a.target.checked})}),"Display customer email/address details"]}),(0,b.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Repair order footer message"}),(0,b.jsx)(F.Input,{value:d.repairOrderFooterMessage,onChange:a=>c({repairOrderFooterMessage:a.target.value})})]})]})})}var W=a.i(73016),X=a.i(75458);let Y=[{value:"",label:"Default"},{value:"info",label:"Info"},{value:"success",label:"Success"},{value:"warning",label:"Warning"},{value:"danger",label:"Danger"}];function Z(a){return"info"===a||"success"===a||"warning"===a||"danger"===a||"default"===a?a:"default"}function $(a){if("string"!=typeof a)return null;let b=a.trim();return b.length>0?b:null}function _({tenantSlug:a}){let d=(0,X.useAuth)(),e=(0,c.useRouter)(),[g,h]=f.default.useState(!0),[i,j]=f.default.useState(!1),[k,l]=f.default.useState(null),[m,n]=f.default.useState(null),[o,p]=f.default.useState("job"),[q,r]=f.default.useState([]),[s,t]=f.default.useState([]),[u,v]=f.default.useState(""),[y,z]=f.default.useState(0),[A,C]=f.default.useState(10),[D,E]=f.default.useState(!1),[G,H]=f.default.useState("job"),[K,M]=f.default.useState(""),[O,P]=f.default.useState(""),[Q,S]=f.default.useState(""),[T,U]=f.default.useState(""),V=f.default.useCallback((a,b)=>{H(a),M(b.slug),P(b.label??""),S("string"==typeof b.color?b.color:""),U("number"==typeof b.sort_order?String(b.sort_order):""),E(!0)},[]),_=f.default.useCallback(async()=>{if("string"!=typeof a||0===a.length)return void l("Business is missing.");try{h(!0),l(null),n(null);let[b,c]=await Promise.all([(0,B.apiFetch)(`/api/${a}/app/repairbuddy/job-statuses`),(0,B.apiFetch)(`/api/${a}/app/repairbuddy/payment-statuses`)]);r(Array.isArray(b.job_statuses)?b.job_statuses:[]),t(Array.isArray(c.payment_statuses)?c.payment_statuses:[])}catch(b){if(b instanceof B.ApiError&&428===b.status&&"string"==typeof a&&a.length>0){let b=`/app/${a}/business-settings?section=job-statuses`;e.replace(`/app/${a}/branches/select?next=${encodeURIComponent(b)}`);return}l(b instanceof Error?b.message:"Failed to load statuses.")}finally{h(!1)}},[e,a]);f.default.useEffect(()=>{if(!d.loading&&d.isAuthenticated){if(!d.can("jobs.view"))return void e.replace("/app");_()}},[d,_,e]);let aa=f.default.useMemo(()=>{let a="job"===o?q:s,b=u.trim().toLowerCase();return b?a.filter(a=>`${a.slug} ${a.label} ${a.color??""} ${a.sort_order??""}`.toLowerCase().includes(b)):a},[o,q,s,u]),ab=aa.length,ac=f.default.useMemo(()=>{let a=y*A,b=a+A;return aa.slice(a,b)},[aa,y,A]),ad=f.default.useMemo(()=>[{id:"label",header:"Label",cell:a=>(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(L.Badge,{variant:Z(a.color),children:a.label}),"string"==typeof a.color&&a.color.length>0?(0,b.jsxs)("span",{className:"text-xs text-zinc-500",children:["(",a.color,")"]}):null]}),(0,b.jsx)("div",{className:"mt-1 truncate text-xs text-zinc-600",children:a.slug})]}),className:"min-w-[280px]"},{id:"invoice",header:"Invoice label",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:a.invoice_label??"—"}),className:"min-w-[200px]"},{id:"order",header:"Order",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:"number"==typeof a.sort_order?a.sort_order:"—"}),className:"whitespace-nowrap"},{id:"active",header:"Active",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:!1===a.is_active?"No":"Yes"}),className:"whitespace-nowrap"},{id:"actions",header:"Actions",cell:a=>(0,b.jsx)("div",{className:"whitespace-nowrap",children:(0,b.jsx)(w.Button,{variant:"outline",size:"sm",onClick:()=>V("job",a),children:"Edit"})}),className:"whitespace-nowrap"}],[V]),ae=f.default.useMemo(()=>[{id:"label",header:"Label",cell:a=>(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(L.Badge,{variant:Z(a.color),children:a.label}),"string"==typeof a.color&&a.color.length>0?(0,b.jsxs)("span",{className:"text-xs text-zinc-500",children:["(",a.color,")"]}):null]}),(0,b.jsx)("div",{className:"mt-1 truncate text-xs text-zinc-600",children:a.slug})]}),className:"min-w-[280px]"},{id:"order",header:"Order",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:"number"==typeof a.sort_order?a.sort_order:"—"}),className:"whitespace-nowrap"},{id:"active",header:"Active",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:!1===a.is_active?"No":"Yes"}),className:"whitespace-nowrap"},{id:"actions",header:"Actions",cell:a=>(0,b.jsx)("div",{className:"whitespace-nowrap",children:(0,b.jsx)(w.Button,{variant:"outline",size:"sm",onClick:()=>V("payment",a),children:"Edit"})}),className:"whitespace-nowrap"}],[V]);async function af(b){if(i)return;if("string"!=typeof a||0===a.length)return void l("Business is missing.");let c="job"===G?`/api/${a}/app/repairbuddy/job-statuses/${encodeURIComponent(K)}`:`/api/${a}/app/repairbuddy/payment-statuses/${encodeURIComponent(K)}`,d="reset"===b?{label:null,color:null,sort_order:null}:{label:$(O),color:$(Q),sort_order:function(a){if("string"!=typeof a&&"number"!=typeof a)return null;let b=String(a).trim();if(0===b.length)return null;let c=Number.parseInt(b,10);return Number.isFinite(c)?Math.max(0,Math.min(1e5,c)):null}(T)};try{j(!0),l(null),n(null),await (0,B.apiFetch)(c,{method:"PATCH",body:d}),E(!1),n("reset"===b?"Status reset to defaults.":"Status saved."),await _()}catch(b){if(b instanceof B.ApiError&&428===b.status&&"string"==typeof a&&a.length>0){let b=`/app/${a}/business-settings?section=job-statuses`;e.replace(`/app/${a}/branches/select?next=${encodeURIComponent(b)}`);return}l(b instanceof Error?b.message:"Failed to save status.")}finally{j(!1)}}return(0,b.jsxs)(J,{title:"Statuses",description:"Customize display labels, colors, and ordering for job and payment statuses.",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[m?(0,b.jsx)("div",{className:"text-sm text-zinc-600",children:m}):(0,b.jsx)("div",{}),(0,b.jsx)(w.Button,{variant:"outline",size:"sm",onClick:()=>void _(),disabled:g||i,children:"Refresh"})]}),k?(0,b.jsx)("div",{className:"text-sm text-red-600",children:k}):null,(0,b.jsxs)(W.Tabs,{value:o,onValueChange:a=>{("job"===a||"payment"===a)&&(p(a),v(""),z(0))},children:[(0,b.jsxs)(W.TabsList,{children:[(0,b.jsx)(W.TabsTrigger,{value:"job",children:"Job statuses"}),(0,b.jsx)(W.TabsTrigger,{value:"payment",children:"Payment statuses"})]}),(0,b.jsx)(W.TabsContent,{value:"job",children:(0,b.jsx)(x.Card,{className:"shadow-none",children:(0,b.jsx)(x.CardContent,{className:"pt-5",children:(0,b.jsx)(R.DataTable,{title:`Job statuses \xb7 ${a}`,data:ac,columns:ad,getRowId:a=>a.id,emptyMessage:"No job statuses.",server:{query:u,onQueryChange:a=>{v(a),z(0)},pageIndex:y,onPageIndexChange:z,pageSize:A,onPageSizeChange:a=>{C(a),z(0)},totalRows:ab}})})})}),(0,b.jsx)(W.TabsContent,{value:"payment",children:(0,b.jsx)(x.Card,{className:"shadow-none",children:(0,b.jsx)(x.CardContent,{className:"pt-5",children:(0,b.jsx)(R.DataTable,{title:`Payment statuses \xb7 ${a}`,data:ac,columns:ae,getRowId:a=>a.id,emptyMessage:"No payment statuses.",server:{query:u,onQueryChange:a=>{v(a),z(0)},pageIndex:y,onPageIndexChange:z,pageSize:A,onPageSizeChange:a=>{C(a),z(0)},totalRows:ab}})})})})]}),(0,b.jsx)(N.Modal,{open:D,onClose:()=>{i||E(!1)},title:"job"===G?"Edit job status":"Edit payment status",footer:(0,b.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,b.jsx)(w.Button,{variant:"outline",disabled:i,onClick:()=>void af("reset"),children:"Reset to defaults"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(w.Button,{variant:"outline",disabled:i,onClick:()=>E(!1),children:"Cancel"}),(0,b.jsx)(w.Button,{disabled:i,onClick:()=>void af("save"),children:i?"Saving...":"Save"})]})]}),children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Label"}),(0,b.jsx)(F.Input,{value:O,onChange:a=>P(a.target.value),placeholder:"e.g. In Service",maxLength:255}),(0,b.jsx)("div",{className:"text-xs text-zinc-500",children:"Leave blank to fall back to the default label."})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Color"}),(0,b.jsx)(I.Select,{value:Q,onChange:a=>S(a.target.value),children:Y.map(a=>(0,b.jsx)("option",{value:a.value,children:a.label},a.label+a.value))}),(0,b.jsx)("div",{className:"text-xs text-zinc-500",children:"Used to style badges in the UI."})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Sort order"}),(0,b.jsx)(F.Input,{value:T,onChange:a=>U(a.target.value),placeholder:"e.g. 10",inputMode:"numeric"}),(0,b.jsx)("div",{className:"text-xs text-zinc-500",children:"Lower numbers appear first. Leave blank to use the default order."})]})]})})]})}async function aa(a,b){let c=new URLSearchParams;b?.q&&c.set("q",b.q);let d=c.toString()?`?${c.toString()}`:"";return(0,B.apiFetch)(`/api/${a}/app/repairbuddy/maintenance-reminders${d}`)}async function ab(a,b){return(0,B.apiFetch)(`/api/${a}/app/repairbuddy/maintenance-reminders`,{method:"POST",body:b})}async function ac(a,b,c){return(0,B.apiFetch)(`/api/${a}/app/repairbuddy/maintenance-reminders/${b}`,{method:"PATCH",body:c})}async function ad(a,b){return(0,B.apiFetch)(`/api/${a}/app/repairbuddy/maintenance-reminders/${b}`,{method:"DELETE"})}async function ae(a,b,c){return(0,B.apiFetch)(`/api/${a}/app/repairbuddy/maintenance-reminders/${b}/test`,{method:"POST",body:c})}function af(a){return a?"Yes":"No"}function ag(a){return a?"success":"warning"}function ah({tenantSlug:a,draft:c,isMock:d}){let[e,h]=(0,f.useState)(!1),[i,j]=(0,f.useState)(!1),[k,l]=(0,f.useState)(null),[m,n]=(0,f.useState)(null),[o,p]=(0,f.useState)(""),[q,r]=(0,f.useState)(0),[s,t]=(0,f.useState)(10),[u,v]=(0,f.useState)(!1),[y,z]=(0,f.useState)(null),[A,C]=(0,f.useState)([]),[D,E]=(0,f.useState)([]),[F,G]=(0,f.useState)([]),H=f.default.useCallback(async()=>{v(!0),z(null);try{let b=await aa(String(a),{q:o.trim()||void 0});C(Array.isArray(b.reminders)?b.reminders:[])}catch(a){z(a instanceof Error?a.message:"Failed to load reminders.")}finally{v(!1)}},[o,a]);(0,f.useEffect)(()=>{H()},[H]),(0,f.useEffect)(()=>{let b=!0;return async function(){try{let[c,d]=await Promise.all([(0,B.apiFetch)(`/api/${String(a)}/app/repairbuddy/device-types?limit=200`),(0,B.apiFetch)(`/api/${String(a)}/app/repairbuddy/device-brands?limit=200`)]);if(!b)return;E(Array.isArray(c.device_types)?c.device_types:[]),G(Array.isArray(d.device_brands)?d.device_brands:[])}catch{if(!b)return;E([]),G([])}}(),()=>{b=!1}},[a]);let I=A.length,K=(0,f.useMemo)(()=>{let a=q*s,b=a+s;return A.slice(a,b)},[q,s,A]),M=(0,f.useMemo)(()=>[{id:"name",header:"Name",cell:a=>(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"truncate font-medium text-[var(--rb-text)]",children:a.name}),a.description?(0,b.jsx)("div",{className:"truncate text-xs text-zinc-600",children:a.description}):null]}),className:"min-w-[240px]"},{id:"interval",header:"Interval",cell:a=>(0,b.jsxs)("div",{className:"text-sm text-zinc-700",children:[a.interval_days," days"]}),className:"whitespace-nowrap"},{id:"type",header:"Device Type",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:a.device_type_name??"All"}),className:"min-w-[160px]"},{id:"brand",header:"Brand",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:a.device_brand_name??"All"}),className:"min-w-[160px]"},{id:"email",header:"Email",cell:a=>(0,b.jsx)(L.Badge,{variant:ag(a.email_enabled),children:af(a.email_enabled)}),className:"whitespace-nowrap"},{id:"sms",header:"SMS",cell:a=>(0,b.jsx)(L.Badge,{variant:ag(a.sms_enabled),children:af(a.sms_enabled)}),className:"whitespace-nowrap"},{id:"enabled",header:"Reminder",cell:a=>(0,b.jsx)(L.Badge,{variant:ag(a.reminder_enabled),children:a.reminder_enabled?"Enabled":"Disabled"}),className:"whitespace-nowrap"},{id:"last_run",header:"Last run",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:a.last_executed_at?new Date(a.last_executed_at).toLocaleString():"—"}),className:"whitespace-nowrap"},{id:"actions",header:"Actions",cell:c=>(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(w.Button,{size:"sm",variant:"outline",onClick:()=>{l(c),h(!0)},children:"Edit"}),(0,b.jsx)(w.Button,{size:"sm",variant:"outline",onClick:()=>{n(c),j(!0)},children:"Send test"}),(0,b.jsx)(w.Button,{asChild:!0,size:"sm",variant:"outline",children:(0,b.jsx)(g.default,{href:`/app/${String(a)}/reminder-logs?reminder_id=${c.id}`,children:"Logs"})})]}),className:"whitespace-nowrap"}],[a]);async function O(b){if(globalThis.confirm(`Delete reminder "${b.name}"?`)){z(null);try{await ad(String(a),b.id),await H()}catch(a){z(a instanceof Error?a.message:"Delete failed.")}}}return(0,b.jsxs)(J,{title:"Maintenance Reminders",description:"Automated service follow-ups based on delivery date.",children:[(0,b.jsx)("div",{className:"flex flex-wrap items-center justify-end gap-2",children:(0,b.jsx)(w.Button,{variant:"outline",onClick:()=>{l(null),h(!0)},children:"Add reminder"})}),(0,b.jsx)(x.Card,{className:"shadow-none",children:(0,b.jsx)(x.CardContent,{className:"pt-5",children:(0,b.jsx)(R.DataTable,{title:"Reminders",data:K,columns:M,getRowId:a=>a.id,loading:u,emptyMessage:"No reminders configured.",search:{placeholder:"Search reminders..."},server:{query:o,onQueryChange:a=>{p(a),r(0)},pageIndex:q,onPageIndexChange:r,pageSize:s,onPageSizeChange:a=>{t(a),r(0)},totalRows:I}})})}),y?(0,b.jsx)("div",{className:"text-sm text-red-600",children:y}):null,(0,b.jsx)(N.Modal,{open:e,onClose:()=>{h(!1),l(null)},title:k?`Edit reminder \xb7 ${k.name}`:"Add reminder",footer:(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,b.jsx)("div",{children:k?(0,b.jsx)(w.Button,{variant:"outline",onClick:()=>void O(k),children:"Delete"}):null}),(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,b.jsx)(w.Button,{variant:"outline",onClick:()=>{h(!1),l(null)},children:"Close"}),(0,b.jsx)(w.Button,{form:"maintenanceReminderForm",type:"submit",children:"Save"})]})]}),children:(0,b.jsx)(ai,{tenantSlug:a,deviceTypes:D,deviceBrands:F,initial:k,onSaved:async()=>{h(!1),l(null),await H()},onError:a=>z(a)})}),(0,b.jsx)(N.Modal,{open:i,onClose:()=>{j(!1),n(null)},title:m?`Send test \xb7 ${m.name}`:"Send test",footer:(0,b.jsx)("div",{className:"flex items-center justify-end gap-2",children:(0,b.jsx)(w.Button,{variant:"outline",onClick:()=>{j(!1),n(null)},children:"Close"})}),children:(0,b.jsx)(aj,{tenantSlug:a,reminder:m,onError:a=>z(a)})})]})}function ai({tenantSlug:a,deviceTypes:c,deviceBrands:d,initial:e,onSaved:g,onError:h}){let[i,j]=(0,f.useState)(!1),[k,l]=(0,f.useState)(null),[m,n]=(0,f.useState)(e?.name??""),[o,p]=(0,f.useState)(e?.description??""),[q,r]=(0,f.useState)(e?.interval_days??180),[s,t]=(0,f.useState)(e?.device_type_id??0),[u,v]=(0,f.useState)(e?.device_brand_id??0),[w,x]=(0,f.useState)(e?.reminder_enabled??!0),[y,z]=(0,f.useState)(e?.email_enabled??!1),[A,C]=(0,f.useState)(e?.sms_enabled??!1),[D,E]=(0,f.useState)(e?.email_body??""),[G,H]=(0,f.useState)(e?.sms_body??"");async function J(b){b.preventDefault(),l(null);let c=m.trim();if(!c)return void l("Name is required.");if(!Number.isFinite(q)||q<=0)return void l("Interval must be at least 1 day.");if(y&&!D.trim())return void l("Email body is required when email is enabled.");if(A&&!G.trim())return void l("SMS body is required when SMS is enabled.");let d={name:c,description:o.trim()?o.trim():null,interval_days:q,device_type_id:s||null,device_brand_id:u||null,reminder_enabled:w,email_enabled:y,sms_enabled:A,email_body:D.trim()?D:null,sms_body:G.trim()?G:null};j(!0);try{e?await ac(String(a),e.id,d):await ab(String(a),d),await g()}catch(b){let a=b instanceof B.ApiError||b instanceof Error?b.message:"Save failed.";l(a),h(a)}finally{j(!1)}}return(0,f.useEffect)(()=>{n(e?.name??""),p(e?.description??""),r(e?.interval_days??180),t(e?.device_type_id??0),v(e?.device_brand_id??0),x(e?.reminder_enabled??!0),z(e?.email_enabled??!1),C(e?.sms_enabled??!1),E(e?.email_body??""),H(e?.sms_body??"")},[e]),(0,b.jsxs)("form",{id:"maintenanceReminderForm",onSubmit:J,className:"space-y-4",children:[k?(0,b.jsx)("div",{className:"text-sm text-red-600",children:k}):null,(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Name"}),(0,b.jsx)(F.Input,{value:m,onChange:a=>n(a.target.value),placeholder:"e.g. 6-month service",disabled:i})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Interval (days)"}),(0,b.jsx)(F.Input,{type:"number",min:1,max:3650,value:String(q),onChange:a=>r(Number(a.target.value||0)),disabled:i})]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Description"}),(0,b.jsx)(F.Input,{value:o,onChange:a=>p(a.target.value),placeholder:"Optional",disabled:i})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Device Type"}),(0,b.jsxs)(I.Select,{value:String(s),onChange:a=>t(Number(a.target.value)),disabled:i,children:[(0,b.jsx)("option",{value:"0",children:"All"}),c.filter(a=>a&&"number"==typeof a.id).map(a=>(0,b.jsx)("option",{value:String(a.id),children:a.name},a.id))]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Brand"}),(0,b.jsxs)(I.Select,{value:String(u),onChange:a=>v(Number(a.target.value)),disabled:i,children:[(0,b.jsx)("option",{value:"0",children:"All"}),d.filter(a=>a&&"number"==typeof a.id).map(a=>(0,b.jsx)("option",{value:String(a.id),children:a.name},a.id))]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-3",children:[(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:w,onChange:a=>x(a.target.checked),disabled:i}),(0,b.jsx)("span",{children:"Reminder enabled"})]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:y,onChange:a=>z(a.target.checked),disabled:i}),(0,b.jsx)("span",{children:"Email enabled"})]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:A,onChange:a=>C(a.target.checked),disabled:i}),(0,b.jsx)("span",{children:"SMS enabled"})]})]}),(0,b.jsx)("div",{className:"space-y-1",children:(0,b.jsxs)("div",{className:"text-xs text-zinc-500",children:["Template variables: ","{{customer_name}}"," ","{{device_name}}"," ","{{unsubscribe_device}}"]})}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Email body"}),(0,b.jsx)("textarea",{className:"w-full rounded-[var(--rb-radius-sm)] border border-zinc-300 bg-white px-3 py-2 text-sm text-[var(--rb-text)] outline-none transition focus-visible:ring-2 focus-visible:ring-[color:color-mix(in_srgb,var(--rb-orange),white_65%)]",rows:6,value:D,onChange:a=>E(a.target.value),placeholder:"Write your email message...",disabled:i})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"SMS body"}),(0,b.jsx)("textarea",{className:"w-full rounded-[var(--rb-radius-sm)] border border-zinc-300 bg-white px-3 py-2 text-sm text-[var(--rb-text)] outline-none transition focus-visible:ring-2 focus-visible:ring-[color:color-mix(in_srgb,var(--rb-orange),white_65%)]",rows:4,value:G,onChange:a=>H(a.target.value),placeholder:"Write your SMS message...",disabled:i})]})]})}function aj({tenantSlug:a,reminder:c,onError:d}){let[e,g]=(0,f.useState)(""),[h,i]=(0,f.useState)(""),[j,k]=(0,f.useState)(!1),[l,m]=(0,f.useState)(null),[n,o]=(0,f.useState)(null),[p,q]=(0,f.useState)(null);async function r(){if(!c)return;m(null),o(null),q(null);let b=e.trim(),f=h.trim();if(!b&&!f)return void m("Email or phone is required.");k(!0);try{let d=await ae(String(a),c.id,{email:b||null,phone:f||null});o(d.preview),q(d.status)}catch(b){let a=b instanceof B.ApiError||b instanceof Error?b.message:"Test failed.";m(a),d(a)}finally{k(!1)}}return(0,f.useEffect)(()=>{m(null),o(null),q(null)},[c]),(0,b.jsxs)("div",{className:"space-y-3",children:[l?(0,b.jsx)("div",{className:"text-sm text-red-600",children:l}):null,(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Email"}),(0,b.jsx)(F.Input,{value:e,onChange:a=>g(a.target.value),placeholder:"name@company.com",disabled:j})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Phone"}),(0,b.jsx)(F.Input,{value:h,onChange:a=>i(a.target.value),placeholder:"+1 555 000 0000",disabled:j})]})]}),(0,b.jsx)("div",{className:"flex items-center justify-end",children:(0,b.jsx)(w.Button,{onClick:()=>void r(),disabled:j||!c,children:j?"Sending...":"Send test"})}),p?(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-2 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"text-xs text-zinc-600",children:["Email status: ",p.email]}),(0,b.jsxs)("div",{className:"text-xs text-zinc-600",children:["SMS status: ",p.sms]})]}):null,n?(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"rounded border border-zinc-200 bg-white p-3",children:[(0,b.jsx)("div",{className:"text-xs font-semibold text-zinc-700",children:"Email preview"}),(0,b.jsx)("pre",{className:"mt-2 whitespace-pre-wrap text-xs text-zinc-700",children:n.email||"(empty)"})]}),(0,b.jsxs)("div",{className:"rounded border border-zinc-200 bg-white p-3",children:[(0,b.jsx)("div",{className:"text-xs font-semibold text-zinc-700",children:"SMS preview"}),(0,b.jsx)("pre",{className:"mt-2 whitespace-pre-wrap text-xs text-zinc-700",children:n.sms||"(empty)"})]})]}):null]})}function ak({draft:a,updateMyAccount:c}){let d=a.myAccount;return(0,b.jsx)(J,{title:"My Account",description:"Customer portal toggles and booking form type.",children:(0,b.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,b.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:d.disableBooking,onChange:a=>c({disableBooking:a.target.checked})}),"Disable booking"]}),(0,b.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:d.disableEstimates,onChange:a=>c({disableEstimates:a.target.checked})}),"Disable estimates"]}),(0,b.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:d.disableReviews,onChange:a=>c({disableReviews:a.target.checked})}),"Disable reviews"]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Booking form type"}),(0,b.jsxs)(I.Select,{value:d.bookingFormType,onChange:a=>c({bookingFormType:a.target.value}),children:[(0,b.jsx)("option",{value:"simple",children:"Simple"}),(0,b.jsx)("option",{value:"detailed",children:"Detailed"})]})]})]})})}function al({draft:a,updatePayments:c,isMock:d}){let e=a.payments;return(0,b.jsx)(J,{title:"Payments",description:"Allowed payment methods.",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Payment methods"}),(0,b.jsxs)("div",{className:"mt-2 grid gap-2 sm:grid-cols-2",children:[(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:e.paymentMethods.cash,onChange:a=>c({paymentMethods:{...e.paymentMethods,cash:a.target.checked}})}),"Cash"]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm text-zinc-400",children:[(0,b.jsx)("input",{type:"checkbox",checked:e.paymentMethods.card,disabled:!0}),"Card"]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm text-zinc-400",children:[(0,b.jsx)("input",{type:"checkbox",checked:e.paymentMethods.bankTransfer,disabled:!0}),"Bank transfer"]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm text-zinc-400",children:[(0,b.jsx)("input",{type:"checkbox",checked:e.paymentMethods.paypal,disabled:!0}),"PayPal"]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm text-zinc-400",children:[(0,b.jsx)("input",{type:"checkbox",checked:e.paymentMethods.other,disabled:!0}),"Other"]})]})]})})}function am({draft:a,updateReviews:c}){let d=a.reviews,e=(0,f.useMemo)(()=>a.jobStatuses.statuses,[a.jobStatuses.statuses]);return(0,b.jsx)(J,{title:"Reviews",description:"Customer feedback request rules and message templates.",children:(0,b.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,b.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:d.requestFeedbackBySms,onChange:a=>c({requestFeedbackBySms:a.target.checked})}),"Request feedback by SMS"]}),(0,b.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:d.requestFeedbackByEmail,onChange:a=>c({requestFeedbackByEmail:a.target.checked})}),"Request feedback by Email"]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Feedback page selection"}),(0,b.jsxs)(I.Select,{value:d.feedbackPage,onChange:a=>c({feedbackPage:a.target.value}),children:[(0,b.jsx)("option",{value:"",children:"Select page (mock)"}),(0,b.jsx)("option",{value:"feedback",children:"Feedback"}),(0,b.jsx)("option",{value:"reviews",children:"Reviews"})]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Send review request if job status is"}),(0,b.jsx)(I.Select,{value:d.sendReviewRequestIfJobStatusId,onChange:a=>c({sendReviewRequestIfJobStatusId:a.target.value}),children:e.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Auto feedback request interval (days)"}),(0,b.jsx)(F.Input,{type:"number",min:0,value:String(d.autoFeedbackRequestIntervalDays),onChange:a=>c({autoFeedbackRequestIntervalDays:Number(a.target.value||0)})})]}),(0,b.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Email subject"}),(0,b.jsx)(F.Input,{value:d.emailSubject,onChange:a=>c({emailSubject:a.target.value})})]}),(0,b.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Email message template"}),(0,b.jsx)("textarea",{className:"min-h-[120px] w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:d.emailMessageTemplate,onChange:a=>c({emailMessageTemplate:a.target.value})})]}),(0,b.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"SMS message template"}),(0,b.jsx)("textarea",{className:"min-h-[90px] w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:d.smsMessageTemplate,onChange:a=>c({smsMessageTemplate:a.target.value})})]})]})})}function an({draft:a,updateServiceSettings:c}){let d=a.serviceSettings;return(0,b.jsx)(J,{title:"Service Settings",description:"Settings for the public service page and booking behavior.",children:(0,b.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Sidebar description"}),(0,b.jsx)("textarea",{className:"min-h-[120px] w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:d.sidebarDescription,onChange:a=>c({sidebarDescription:a.target.value})})]}),(0,b.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:d.disableBookingOnServicePage,onChange:a=>c({disableBookingOnServicePage:a.target.checked})}),"Disable booking on service page"]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Booking form type"}),(0,b.jsxs)(I.Select,{value:d.bookingFormType,onChange:a=>c({bookingFormType:a.target.value}),children:[(0,b.jsx)("option",{value:"simple",children:"Simple"}),(0,b.jsx)("option",{value:"detailed",children:"Detailed"})]})]})]})})}function ao({draft:a,updateSignatureWorkflow:c}){let d=a.signatureWorkflow,e=(0,f.useMemo)(()=>a.jobStatuses.statuses,[a.jobStatuses.statuses]);return(0,b.jsx)(J,{title:"Signature Workflow",description:"Pickup and delivery signature automation.",children:(0,b.jsxs)("div",{className:"grid gap-6",children:[(0,b.jsx)(ap,{title:"Pickup signature",value:d.pickup,statuses:e,onChange:function(a){c({pickup:{...d.pickup,...a}})}}),(0,b.jsx)(ap,{title:"Delivery signature",value:d.delivery,statuses:e,onChange:function(a){c({delivery:{...d.delivery,...a}})}})]})})}function ap({title:a,value:c,statuses:d,onChange:e}){return(0,b.jsxs)("div",{className:"rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-white p-4",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:a}),(0,b.jsxs)("div",{className:"mt-3 grid gap-4 sm:grid-cols-2",children:[(0,b.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:c.enabled,onChange:a=>e({enabled:a.target.checked})}),"Enable"]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Trigger status"}),(0,b.jsx)(I.Select,{value:c.triggerStatusId,onChange:a=>e({triggerStatusId:a.target.value}),children:d.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Status after submission"}),(0,b.jsx)(I.Select,{value:c.statusAfterSubmissionId,onChange:a=>e({statusAfterSubmissionId:a.target.value}),children:d.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))})]}),(0,b.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Email subject"}),(0,b.jsx)(F.Input,{value:c.templates.emailSubject,onChange:a=>e({templates:{...c.templates,emailSubject:a.target.value}})})]}),(0,b.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Email template"}),(0,b.jsx)("textarea",{className:"min-h-[140px] w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:c.templates.emailTemplate,onChange:a=>e({templates:{...c.templates,emailTemplate:a.target.value}})})]}),(0,b.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"SMS text"}),(0,b.jsx)("textarea",{className:"min-h-[90px] w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:c.templates.smsText,onChange:a=>e({templates:{...c.templates,smsText:a.target.value}})})]})]})]})}function aq({draft:a,updateSms:c}){let d=a.sms,e=(0,f.useMemo)(()=>a.jobStatuses.statuses,[a.jobStatuses.statuses]);return(0,b.jsx)(J,{title:"SMS",description:"SMS gateway setup and when messages are sent (UI-only).",children:(0,b.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,b.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:d.activateSmsForSelectiveStatuses,onChange:a=>c({activateSmsForSelectiveStatuses:a.target.checked})}),"Activate SMS for selective statuses"]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Gateway selection"}),(0,b.jsxs)(I.Select,{value:d.gateway,onChange:a=>c({gateway:a.target.value}),children:[(0,b.jsx)("option",{value:"twilio",children:"Twilio"}),(0,b.jsx)("option",{value:"nexmo",children:"Nexmo"}),(0,b.jsx)("option",{value:"custom",children:"Custom"})]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"From number"}),(0,b.jsx)(F.Input,{value:d.gatewayFromNumber,onChange:a=>c({gatewayFromNumber:a.target.value}),placeholder:"+15551234567"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Account SID"}),(0,b.jsx)(F.Input,{value:d.gatewayAccountSid,onChange:a=>c({gatewayAccountSid:a.target.value}),placeholder:"(mock)"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Auth token"}),(0,b.jsx)(F.Input,{value:d.gatewayAuthToken,onChange:a=>c({gatewayAuthToken:a.target.value}),placeholder:"(mock)"})]}),(0,b.jsxs)("div",{className:"sm:col-span-2",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Send when status changed to"}),(0,b.jsx)("div",{className:"mt-2 grid gap-2 sm:grid-cols-2",children:e.map(a=>(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:d.sendWhenStatusChangedToIds.includes(a.id),onChange:()=>{var b;let e;return b=a.id,void((e=new Set(d.sendWhenStatusChangedToIds)).has(b)?e.delete(b):e.add(b),c({sendWhenStatusChangedToIds:Array.from(e)}))}}),a.name]},a.id))})]}),(0,b.jsxs)("div",{className:"sm:col-span-2",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Test SMS"}),(0,b.jsxs)("div",{className:"mt-2 grid gap-3 sm:grid-cols-2",children:[(0,b.jsx)(F.Input,{value:d.testNumber,onChange:a=>c({testNumber:a.target.value}),placeholder:"Test number"}),(0,b.jsx)(F.Input,{value:d.testMessage,onChange:a=>c({testMessage:a.target.value}),placeholder:"Test message"})]}),(0,b.jsx)("div",{className:"mt-2 text-xs text-zinc-500",children:"Sending is disabled in this phase."})]})]})})}function ar({draft:a,updateStylingLabels:c}){let d=a.stylingLabels;return(0,b.jsx)(J,{title:"Styling & Labels",description:"Customer-facing label text and primary/secondary colors.",children:(0,b.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"sm:col-span-2",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Labels"}),(0,b.jsxs)("div",{className:"mt-2 grid gap-3 sm:grid-cols-2",children:[(0,b.jsx)(F.Input,{value:d.labels.delivery,onChange:a=>c({labels:{...d.labels,delivery:a.target.value}}),placeholder:"Delivery"}),(0,b.jsx)(F.Input,{value:d.labels.pickup,onChange:a=>c({labels:{...d.labels,pickup:a.target.value}}),placeholder:"Pickup"}),(0,b.jsx)(F.Input,{value:d.labels.nextService,onChange:a=>c({labels:{...d.labels,nextService:a.target.value}}),placeholder:"Next service"}),(0,b.jsx)(F.Input,{value:d.labels.caseNumber,onChange:a=>c({labels:{...d.labels,caseNumber:a.target.value}}),placeholder:"Case number"})]})]}),(0,b.jsxs)("div",{className:"sm:col-span-2",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Colors"}),(0,b.jsxs)("div",{className:"mt-2 grid gap-3 sm:grid-cols-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs font-medium text-zinc-600",children:"Primary"}),(0,b.jsxs)("div",{className:"mt-1 flex items-center gap-3",children:[(0,b.jsx)("input",{type:"color",value:d.colors.primary,onChange:a=>c({colors:{...d.colors,primary:a.target.value}}),className:"h-10 w-14 rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white shadow-sm"}),(0,b.jsx)(F.Input,{value:d.colors.primary,onChange:a=>c({colors:{...d.colors,primary:a.target.value}})})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs font-medium text-zinc-600",children:"Secondary"}),(0,b.jsxs)("div",{className:"mt-1 flex items-center gap-3",children:[(0,b.jsx)("input",{type:"color",value:d.colors.secondary,onChange:a=>c({colors:{...d.colors,secondary:a.target.value}}),className:"h-10 w-14 rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white shadow-sm"}),(0,b.jsx)(F.Input,{value:d.colors.secondary,onChange:a=>c({colors:{...d.colors,secondary:a.target.value}})})]})]})]})]})]})})}var as=a.i(4870);function at({tenantSlug:a,draft:c,updateTaxes:d,isMock:e}){let[g,h]=(0,f.useState)(!1),[i,j]=(0,f.useState)(!1),[k,l]=(0,f.useState)(!1),[m,n]=(0,f.useState)(!1),[o,p]=(0,f.useState)(null),[q,r]=(0,f.useState)(null),[s,t]=(0,f.useState)(!1),[u,v]=(0,f.useState)(""),[y,z]=(0,f.useState)("RB"),[A,B]=(0,f.useState)([]),[E,G]=(0,f.useState)(!1),[H,K]=(0,f.useState)(""),[L,M]=(0,f.useState)(0),[O,P]=(0,f.useState)(10),Q=c.taxes;async function S(b){if(!e)try{await (0,C.updateRepairBuddySettings)(String(a),{...c,taxes:b})}catch(a){p(a instanceof Error?a.message:"Failed to save tax preferences.")}}async function T(){if(!e){r(null),p(null),n(!0);try{let b=await (0,D.getSetup)(String(a)),c=b.setup?.state??{},d=c.tax??{},e={...c,tax:{...d,tax_registered:!!s,invoice_prefix:y.trim()||null}};await (0,D.updateSetup)(String(a),{billing_vat_number:u.trim()||null,setup_state:e}),r("Saved.")}catch(a){p(a instanceof Error?a.message:"Failed to save tax settings.")}finally{n(!1)}}}(0,f.useEffect)(()=>{let b=!0;return async function(){p(null),G(!0);try{let[c,d]=await Promise.all([(0,as.getRepairBuddyTaxes)(String(a)),(0,D.getSetup)(String(a))]);if(!b)return;B(Array.isArray(c.taxes)?c.taxes:[]);let e="string"==typeof d.tenant?.billing_vat_number?d.tenant.billing_vat_number:"";v(e);let f=(d.setup?.state??{}).tax??{};t("boolean"==typeof f.tax_registered&&f.tax_registered),z("string"==typeof f.invoice_prefix?f.invoice_prefix:"RB")}catch(a){if(!b)return;p(a instanceof Error?a.message:"Failed to load taxes.")}finally{if(!b)return;G(!1)}}(),()=>{b=!1}},[a]),(0,f.useEffect)(()=>{},[a]),(0,f.useEffect)(()=>{let a,b,c,e,f,g,h,i;a=A.map(a=>({id:String(a.id),name:a.name,ratePercent:Number(a.rate),status:a.is_active?"active":"inactive"})),b=A.find(a=>a.is_default)??null,c=new Set(A.map(a=>String(a.id))),f=new Set((e=A.filter(a=>a.is_active)).map(a=>String(a.id))),h="string"==typeof(g=Q.defaultTaxId)&&g.length>0&&c.has(g)&&f.has(g),i=e.length>0?String(e[0]?.id):"",d({taxes:a,defaultTaxId:b?String(b.id):h?g:i})},[A]);let U=(0,f.useMemo)(()=>A.filter(a=>a.is_active),[A]),V=(0,f.useMemo)(()=>{let a=new Set(U.map(a=>String(a.id)));return Q.defaultTaxId&&a.has(String(Q.defaultTaxId))?String(Q.defaultTaxId):""},[U,Q.defaultTaxId]),W=(0,f.useMemo)(()=>{let a=H.trim().toLowerCase();return a?A.filter(b=>`${b.id} ${b.name} ${b.rate}`.toLowerCase().includes(a)):A},[H,A]),X=W.length;(0,f.useEffect)(()=>{let a=Math.min(L,Math.max(1,Math.ceil(X/O))-1);a!==L&&M(a)},[L,O,X]);let Y=(0,f.useMemo)(()=>{let a=L*O,b=a+O;return W.slice(a,b)},[W,L,O]),Z=(0,f.useMemo)(()=>[{id:"name",header:"Name",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:a.name}),className:"min-w-[220px]"},{id:"rate",header:"Rate (%)",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:Number(a.rate)}),className:"whitespace-nowrap"},{id:"active",header:"Active",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:a.is_active?"Yes":"No"}),className:"whitespace-nowrap"},{id:"default",header:"Default",cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:a.is_default?"Yes":"No"}),className:"whitespace-nowrap"},{id:"actions",header:"Actions",cell:a=>(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(w.Button,{size:"sm",variant:"outline",disabled:e||k,onClick:()=>{ah(String(a.id)),aj(a.name),al(String(a.rate)),an(a.is_active),ap(a.is_default),j(!0)},children:"Edit"}),(0,b.jsx)(w.Button,{size:"sm",variant:"outline",disabled:e||k,onClick:()=>void au(a),children:"Delete"})]}),className:"whitespace-nowrap"}],[k,e]),[$,_]=(0,f.useState)(""),[aa,ab]=(0,f.useState)("0"),[ac,ad]=(0,f.useState)(!0),[ae,af]=(0,f.useState)(!1),[ag,ah]=(0,f.useState)(null),[ai,aj]=(0,f.useState)(""),[ak,al]=(0,f.useState)("0"),[am,an]=(0,f.useState)(!0),[ao,ap]=(0,f.useState)(!1);async function aq(){G(!0);try{let b=await (0,as.getRepairBuddyTaxes)(String(a));B(Array.isArray(b.taxes)?b.taxes:[])}catch(a){p(a instanceof Error?a.message:"Failed to load taxes.")}finally{G(!1)}}async function ar(){r(null),p(null),l(!0);try{let b=$.trim(),c=Number(aa);if(!b)throw Error("Name is required.");if(!Number.isFinite(c))throw Error("Rate is invalid.");await (0,as.createRepairBuddyTax)(String(a),{name:b,rate:c,is_active:ac,is_default:ae}),await aq(),h(!1),_(""),ab("0"),ad(!0),af(!1),r("Tax created.")}catch(a){p(a instanceof Error?a.message:"Failed to create tax.")}finally{l(!1)}}async function at(){if(ag){r(null),p(null),l(!0);try{let b=Number(ag);if(!Number.isFinite(b))throw Error("Invalid tax.");let c=ai.trim(),d=Number(ak);if(!c)throw Error("Name is required.");if(!Number.isFinite(d))throw Error("Rate is invalid.");await (0,as.updateRepairBuddyTax)(String(a),b,{name:c,rate:d}),await (0,as.setRepairBuddyTaxActive)(String(a),b,am),ao&&await (0,as.setRepairBuddyTaxDefault)(String(a),b),await aq(),j(!1),r("Tax updated.")}catch(a){p(a instanceof Error?a.message:"Failed to update tax.")}finally{l(!1)}}}async function au(b){if(globalThis.confirm(`Delete tax "${b.name}"?`)){r(null),p(null),l(!0);try{B(a=>a.filter(a=>String(a.id)!==String(b.id))),await (0,as.deleteRepairBuddyTax)(String(a),Number(b.id)),await aq(),r("Tax deleted.")}catch(a){p(a instanceof Error?a.message:"Failed to delete tax."),aq()}finally{l(!1)}}}return(0,b.jsxs)(J,{title:"Taxes",description:"Tax rates and invoice calculation preferences.",children:[o?(0,b.jsx)("div",{className:"text-sm text-red-600",children:o}):null,q?(0,b.jsx)("div",{className:"text-sm text-green-700",children:q}):null,(0,b.jsx)(x.Card,{className:"shadow-none",children:(0,b.jsx)(x.CardContent,{className:"pt-5",children:(0,b.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,b.jsx)("div",{className:"sm:col-span-2",children:(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:s,onChange:a=>t(a.target.checked),disabled:m||k}),"Tax/VAT registered?"]})}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"VAT number"}),(0,b.jsx)(F.Input,{value:u,onChange:a=>v(a.target.value),placeholder:"EU123456789",disabled:m||k})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Invoice prefix (optional)"}),(0,b.jsx)(F.Input,{value:y,onChange:a=>z(a.target.value),placeholder:"RB",disabled:m||k})]}),(0,b.jsx)("div",{className:"sm:col-span-2 flex items-center justify-end gap-2",children:(0,b.jsx)(w.Button,{variant:"outline",disabled:e||m||k,onClick:()=>void T(),children:m?"Saving...":"Save"})})]})})}),(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:Q.enableTaxes,onChange:a=>{let b=a.target.checked;d({enableTaxes:b}),S({...Q,enableTaxes:b})}}),"Enable taxes"]}),(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,b.jsx)("div",{className:"text-sm text-zinc-600",children:"Manage tax rates for this business."}),(0,b.jsx)(w.Button,{variant:"outline",disabled:e||k,onClick:()=>h(!0),children:"Add tax"})]}),(0,b.jsx)(x.Card,{className:"shadow-none",children:(0,b.jsx)(x.CardContent,{className:"pt-5",children:(0,b.jsx)(R.DataTable,{title:"Taxes",data:Y,columns:Z,getRowId:a=>a.id,loading:E,emptyMessage:"No tax rates.",search:{placeholder:"Search taxes..."},server:{query:H,onQueryChange:a=>{K(a),M(0)},pageIndex:L,onPageIndexChange:M,pageSize:O,onPageSizeChange:a=>{P(a),M(0)},totalRows:X}})})}),(0,b.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Default tax"}),(0,b.jsxs)(I.Select,{value:V,disabled:0===U.length||k||E,onChange:async b=>{let c=b.target.value;if(d({defaultTaxId:c}),S({...Q,defaultTaxId:c}),!c)return;let e=Number(c);if(Number.isFinite(e)&&!(e<=0))try{l(!0),await (0,as.setRepairBuddyTaxDefault)(String(a),e),await aq()}catch(a){p(a instanceof Error?a.message:"Failed to set default tax.")}finally{l(!1)}},children:[(0,b.jsx)("option",{value:"",children:"None"}),U.map(a=>(0,b.jsxs)("option",{value:String(a.id),children:[a.name," (",Number(a.rate),"%)"]},a.id))]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Invoice amounts"}),(0,b.jsxs)(I.Select,{value:Q.invoiceAmounts,onChange:a=>{let b=a.target.value;d({invoiceAmounts:b}),S({...Q,invoiceAmounts:b})},children:[(0,b.jsx)("option",{value:"exclusive",children:"Exclusive"}),(0,b.jsx)("option",{value:"inclusive",children:"Inclusive"})]})]})]}),(0,b.jsx)(N.Modal,{open:g,onClose:()=>h(!1),title:"Add tax",footer:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,b.jsx)(w.Button,{variant:"outline",onClick:()=>h(!1),children:"Close"}),(0,b.jsx)(w.Button,{disabled:e||k,onClick:()=>void ar(),children:k?"Saving...":"Save"})]}),children:(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Name"}),(0,b.jsx)(F.Input,{value:$,onChange:a=>_(a.target.value),placeholder:"e.g. VAT"})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Rate (%)"}),(0,b.jsx)(F.Input,{type:"number",min:0,value:aa,onChange:a=>ab(a.target.value)})]}),(0,b.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Active"}),(0,b.jsxs)(I.Select,{value:ac?"yes":"no",onChange:a=>ad("yes"===a.target.value),children:[(0,b.jsx)("option",{value:"yes",children:"Yes"}),(0,b.jsx)("option",{value:"no",children:"No"})]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Default"}),(0,b.jsxs)(I.Select,{value:ae?"yes":"no",onChange:a=>af("yes"===a.target.value),children:[(0,b.jsx)("option",{value:"no",children:"No"}),(0,b.jsx)("option",{value:"yes",children:"Yes"})]})]})]})]})}),(0,b.jsx)(N.Modal,{open:i,onClose:()=>j(!1),title:"Edit tax",footer:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,b.jsx)(w.Button,{variant:"outline",onClick:()=>j(!1),children:"Close"}),(0,b.jsx)(w.Button,{disabled:e||k,onClick:()=>void at(),children:k?"Saving...":"Save"})]}),children:(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Name"}),(0,b.jsx)(F.Input,{value:ai,onChange:a=>aj(a.target.value)})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Rate (%)"}),(0,b.jsx)(F.Input,{type:"number",min:0,value:ak,onChange:a=>al(a.target.value)})]}),(0,b.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Active"}),(0,b.jsxs)(I.Select,{value:am?"yes":"no",onChange:a=>an("yes"===a.target.value),children:[(0,b.jsx)("option",{value:"yes",children:"Yes"}),(0,b.jsx)("option",{value:"no",children:"No"})]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Default"}),(0,b.jsxs)(I.Select,{value:ao?"yes":"no",onChange:a=>ap("yes"===a.target.value),children:[(0,b.jsx)("option",{value:"no",children:"No"}),(0,b.jsx)("option",{value:"yes",children:"Yes"})]})]})]})]})})]})}function au({tenantSlug:a,draft:c,updateTimeLogs:d,isMock:e}){let g=c.timeLogs,h=(0,f.useMemo)(()=>c.jobStatuses.statuses,[c.jobStatuses.statuses]),[i,j]=(0,f.useState)([]),[k,l]=(0,f.useState)(!1);(0,f.useEffect)(()=>{let b=!0;return async function(){if(!e){l(!0);try{let c=await (0,as.getRepairBuddyTaxes)(String(a));if(!b)return;j(Array.isArray(c.taxes)?c.taxes:[])}catch{if(!b)return;j([])}finally{if(!b)return;l(!1)}}}(),()=>{b=!1}},[e,a]);let m=(0,f.useMemo)(()=>(e?c.taxes.taxes.map(a=>({id:Number.isFinite(Number(a.id))?Number(a.id):0,name:a.name,rate:a.ratePercent,is_default:a.id===c.taxes.defaultTaxId,is_active:"active"===a.status})):i).filter(a=>a&&a.is_active).map(a=>({id:String(a.id),name:a.name,ratePercent:Number(a.rate),isDefault:!!a.is_default})),[c.taxes.defaultTaxId,c.taxes.taxes,e,i]),n=(0,f.useMemo)(()=>{let a=m.find(a=>a.isDefault)?.id??"";return a||(m[0]?.id??"")},[m]),o=(0,f.useMemo)(()=>{let a=new Set(m.map(a=>a.id));return g.defaultTaxIdForHours&&a.has(String(g.defaultTaxIdForHours))?String(g.defaultTaxIdForHours):n&&a.has(String(n))?String(n):""},[n,m,g.defaultTaxIdForHours]);return(0,f.useEffect)(()=>{o&&g.defaultTaxIdForHours!==o&&d({defaultTaxIdForHours:o})},[o,g.defaultTaxIdForHours,d]),(0,b.jsx)(J,{title:"Time Logs",description:"Time tracking and hourly tax defaults.",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:g.disableTimeLog,onChange:a=>d({disableTimeLog:a.target.checked})}),"Disable time log"]}),(0,b.jsx)("div",{className:"grid gap-4 sm:grid-cols-2",children:(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Default tax for hours"}),(0,b.jsx)(I.Select,{value:o,disabled:k||0===m.length,onChange:a=>d({defaultTaxIdForHours:a.target.value}),children:0===m.length?(0,b.jsx)("option",{value:"",children:"No active taxes"}):m.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.name," (",a.ratePercent,"%)"]},a.id))})]})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Enable time log for statuses"}),(0,b.jsx)("div",{className:"mt-2 grid gap-2 sm:grid-cols-3",children:h.map(a=>(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:g.enableTimeLogForStatusIds.includes(a.id),onChange:()=>{var b;let c;return b=a.id,void((c=new Set(g.enableTimeLogForStatusIds)).has(b)?c.delete(b):c.add(b),d({enableTimeLogForStatusIds:Array.from(c)}))}}),a.name]},a.id))})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Activities"}),(0,b.jsx)("textarea",{className:"min-h-[140px] w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:g.activities,onChange:a=>d({activities:a.target.value}),placeholder:"List of activities (one per line)"})]})]})})}function av(){return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"rounded-[var(--rb-radius-lg)] border border-[var(--rb-border)] bg-white px-5 py-4",children:(0,b.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(y.Skeleton,{className:"h-4 w-40 rounded-[var(--rb-radius-sm)]"}),(0,b.jsx)(y.Skeleton,{className:"mt-2 h-3 w-36 rounded-[var(--rb-radius-sm)]"}),(0,b.jsx)(y.Skeleton,{className:"mt-3 h-9 w-[520px] max-w-full rounded-[var(--rb-radius-sm)]"})]}),(0,b.jsx)(y.Skeleton,{className:"h-9 w-20 rounded-[var(--rb-radius-sm)]"})]})}),(0,b.jsx)(x.Card,{className:"shadow-none",children:(0,b.jsxs)(x.CardContent,{className:"pt-5",children:[(0,b.jsx)(y.Skeleton,{className:"h-5 w-48 rounded-[var(--rb-radius-sm)]"}),(0,b.jsx)(y.Skeleton,{className:"mt-3 h-4 w-full rounded-[var(--rb-radius-sm)]"}),(0,b.jsx)(y.Skeleton,{className:"mt-2 h-4 w-4/5 rounded-[var(--rb-radius-sm)]"}),(0,b.jsx)(y.Skeleton,{className:"mt-2 h-4 w-3/5 rounded-[var(--rb-radius-sm)]"}),(0,b.jsx)("div",{className:"mt-5 grid gap-3 sm:grid-cols-2",children:Array.from({length:6}).map((a,c)=>(0,b.jsx)("div",{className:"rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2",children:(0,b.jsx)(y.Skeleton,{className:"h-4 w-40 rounded-[var(--rb-radius-sm)]"})},c))})]})})]})}let aw={"company-profile":h.Building2,general:p.Settings,currency:i.Calculator,"invoices-reports":n.FileText,"job-statuses":s.Tag,payments:m.CreditCard,reviews:r.Star,estimates:n.FileText,"my-account":t.User,"devices-brands":o.Laptop,sms:k.CircleHelp,taxes:i.Calculator,"service-settings":u.Wrench,"time-logs":l.Clock,"maintenance-reminders":l.Clock,"styling-labels":q.Sparkles,"signature-workflow":n.FileText,booking:j.Calendar};function ax({tenantSlug:a}){let d=(0,c.useSearchParams)(),{draft:e,updateSection:h,setDraft:i,isMock:j,savingDisabledReason:l,loading:m,saving:n,error:o,save:p}=function(a){let b=(0,c.useRouter)(),[d,e]=(0,f.useState)(A),[g,h]=(0,f.useState)(!1),[i,j]=(0,f.useState)(!1),[k,l]=(0,f.useState)(null),[m,n]=(0,f.useState)(null),o=(0,f.useCallback)((a,b)=>{e(c=>({...c,[a]:{...c[a],...b}}))},[]);(0,f.useEffect)(()=>{let c=!0;return async function(){if(a){h(!0),l(null);try{let[b,d,f]=await Promise.all([(0,C.getRepairBuddySettings)(String(a)),(0,D.getSetup)(String(a)),(0,B.apiFetch)(`/api/${String(a)}/app/repairbuddy/job-statuses`)]);if(!c)return;n(d.tenant);let g=b.settings&&"object"==typeof b.settings?b.settings:null,h={...A,...g??{},general:{...A.general,...g?.general??{}}},i=Array.isArray(f?.job_statuses)?f.job_statuses:[];i.length>0&&(h.jobStatuses={...h.jobStatuses??A.jobStatuses,statuses:i.map(a=>{let b="string"==typeof a.slug?a.slug:"",c="string"==typeof a.label?a.label:b,d="string"==typeof a.invoice_label?a.invoice_label:c;return{id:`status_${b}`,name:c,slug:b,description:"",invoiceLabel:d,manageWooStock:!1,status:!1===a.is_active?"inactive":"active"}}),completedStatusId:h.jobStatuses?.completedStatusId??A.jobStatuses.completedStatusId,cancelledStatusId:h.jobStatuses?.cancelledStatusId??A.jobStatuses.cancelledStatusId});let j=!h.timeLogs||!Array.isArray(h.timeLogs.enableTimeLogForStatusIds)||0===h.timeLogs.enableTimeLogForStatusIds.length,k=h.jobStatuses?.cancelledStatusId;if(j&&h.jobStatuses&&Array.isArray(h.jobStatuses.statuses)){let a=h.jobStatuses.statuses.filter(a=>"active"===a.status).map(a=>a.id).filter(a=>"string"!=typeof k||!k||a!==k);h.timeLogs={...h.timeLogs,enableTimeLogForStatusIds:a}}e(E(function(a){let b=a.devicesBrands;if(!b||!Array.isArray(b.additionalDeviceFields))return a;let c=b.additionalDeviceFields.map(a=>{if(!a||"object"!=typeof a)return null;let b="string"==typeof a.id&&a.id.trim()?a.id.trim():`device_field_${Date.now()}_${Math.random().toString(16).slice(2)}`,c="string"==typeof a.label?a.label:"";if(!c.trim())return null;let d="boolean"!=typeof a.displayInBookingForm||a.displayInBookingForm,e="boolean"!=typeof a.displayInInvoice||a.displayInInvoice,f="boolean"!=typeof a.displayForCustomer||a.displayForCustomer;return{id:b,label:c.trim(),type:"text",displayInBookingForm:d,displayInInvoice:e,displayForCustomer:f}}).filter(a=>!!a);return{...a,devicesBrands:{...b,additionalDeviceFields:c}}}(h),d.tenant))}catch(d){if(!c)return;if(d instanceof B.ApiError&&428===d.status&&a){let c=`/app/${String(a)}/business-settings`;b.replace(`/app/${String(a)}/branches/select?next=${encodeURIComponent(c)}`);return}l(d instanceof Error?d.message:"Failed to load business settings.")}finally{if(!c)return;h(!1)}}}(),()=>{c=!1}},[b,a]);let p=(0,f.useCallback)(()=>{e(A)},[]),q=(0,f.useCallback)(async()=>{if(a){j(!0),l(null);try{let b=await (0,D.getSetup)(String(a)),c=d.currency.currency.trim().toUpperCase(),f=d.general.defaultCountry.trim().toUpperCase(),g=d.general.businessAddress.trim(),h=f?RegExp(`,\\s*${f}$`,"i"):null,i=h?g.replace(h,"").trim():g,j=b.tenant.billing_address_json??{},k=i?{...j,line1:i}:null,l=b.tenant.setup_state??{},m=l.identity??{},o={...l,identity:{...m,display_name:d.general.displayName||null,primary_contact_name:d.general.primaryContactName||null,registration_number:d.general.registrationNumber||null,logo_url:d.general.logoUrl}},p=await (0,D.updateSetup)(String(a),{name:d.general.businessName,contact_email:d.general.email||null,contact_phone:d.general.businessPhone||null,billing_country:f||null,billing_address_json:k,currency:3===c.length?c:null,setup_state:o});n(p.tenant);let q=await (0,C.updateRepairBuddySettings)(String(a),d);q.settings&&e(E(q.settings,p.tenant))}catch(a){throw a instanceof B.ApiError?l(a.message):l(a instanceof Error?a.message:"Failed to save business settings."),a}finally{j(!1)}}},[d,a]);return(0,f.useMemo)(()=>({draft:d,setDraft:e,updateSection:o,reset:p,save:q,isMock:!1,loading:g,saving:i,error:k,tenant:m,savingDisabledReason:""}),[d,k,g,p,q,i,m,o])}(a),[q,r]=(0,f.useState)(null),s=(0,f.useCallback)(a=>h("currency",a),[h]),t=(0,f.useMemo)(()=>{let a=d.get("section"),b=new Set(z.map(a=>a.key));return a&&b.has(a)?a:"company-profile"},[d]),u=(0,f.useMemo)(()=>z.find(a=>a.key===t)??null,[t]),y=(0,f.useMemo)(()=>{switch(t){case"company-profile":return(0,b.jsx)(H,{tenantSlug:a});case"general":return(0,b.jsx)(U,{draft:e,updateGeneral:a=>h("general",a)});case"currency":return(0,b.jsx)(Q,{draft:e,updateCurrency:s});case"invoices-reports":return(0,b.jsx)(V,{draft:e,updateInvoicesReports:a=>h("invoicesReports",a)});case"job-statuses":return(0,b.jsx)(_,{tenantSlug:a});case"payments":return(0,b.jsx)(al,{draft:e,updatePayments:a=>h("payments",a),isMock:j});case"reviews":return(0,b.jsx)(am,{draft:e,updateReviews:a=>h("reviews",a)});case"estimates":return(0,b.jsx)(T,{draft:e,updateEstimates:a=>h("estimates",a)});case"my-account":return(0,b.jsx)(ak,{draft:e,updateMyAccount:a=>h("myAccount",a)});case"devices-brands":return(0,b.jsx)(S,{draft:e,updateDevicesBrands:a=>h("devicesBrands",a),isMock:j});case"sms":return(0,b.jsx)(aq,{draft:e,updateSms:a=>h("sms",a)});case"taxes":return(0,b.jsx)(at,{tenantSlug:a,draft:e,updateTaxes:a=>h("taxes",a),isMock:j});case"service-settings":return(0,b.jsx)(an,{draft:e,updateServiceSettings:a=>h("serviceSettings",a)});case"time-logs":return(0,b.jsx)(au,{tenantSlug:a,draft:e,updateTimeLogs:a=>h("timeLogs",a),isMock:j});case"maintenance-reminders":return(0,b.jsx)(ah,{tenantSlug:a,draft:e,isMock:j});case"styling-labels":return(0,b.jsx)(ar,{draft:e,updateStylingLabels:a=>h("stylingLabels",a)});case"signature-workflow":return(0,b.jsx)(ao,{draft:e,updateSignatureWorkflow:a=>h("signatureWorkflow",a)});case"booking":return(0,b.jsx)(K,{draft:e,updateBooking:a=>h("booking",a)});default:return null}},[e,j,t,a,s,h]);async function F(){r(null);try{await p(),r("Saved.")}catch{return}}return(0,b.jsxs)("div",{className:"space-y-6",children:[o?(0,b.jsx)(v.Alert,{variant:"danger",title:"Could not load or save business settings",children:o}):null,q?(0,b.jsx)(v.Alert,{variant:"success",title:"Success",children:q}):null,(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-[260px_1fr]",children:[(0,b.jsxs)(x.Card,{children:[(0,b.jsxs)(x.CardHeader,{children:[(0,b.jsx)(x.CardTitle,{children:"Business Settings"}),(0,b.jsx)(x.CardDescription,{children:"Operational settings for this business."})]}),(0,b.jsx)(x.CardContent,{className:"space-y-1",children:z.map(c=>{let d=c.key===t,e=aw[c.key]??k.CircleHelp;return(0,b.jsx)(g.default,{href:`/app/${a}/business-settings?section=${c.key}`,scroll:!1,className:"block rounded-[var(--rb-radius-sm)] px-3 py-2 text-sm transition-colors "+(d?"bg-[var(--rb-surface-muted)] font-medium text-[var(--rb-text)]":"text-zinc-700 hover:bg-[var(--rb-surface-muted)]"),children:(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)(e,{className:"h-4 w-4 shrink-0 "+(d?"text-[var(--rb-text)]":"text-zinc-500"),"aria-hidden":!0}),(0,b.jsx)("span",{children:c.label})]})},c.key)})})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"rounded-[var(--rb-radius-lg)] border border-[var(--rb-border)] bg-white px-5 py-4",children:(0,b.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:u?.label??"Business Settings"}),(0,b.jsxs)("div",{className:"mt-1 text-xs text-zinc-500",children:["Business: ",a]}),l?(0,b.jsx)("div",{className:"mt-2 text-xs text-zinc-500",children:l}):null,(0,b.jsxs)("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[(0,b.jsx)(w.Button,{asChild:!0,variant:"outline",size:"sm",children:(0,b.jsx)(g.default,{href:`/t/${a}/portal`,children:"Preview portal"})}),(0,b.jsx)(w.Button,{asChild:!0,variant:"outline",size:"sm",children:(0,b.jsx)(g.default,{href:`/t/${a}/status`,children:"Preview status"})}),(0,b.jsx)(w.Button,{asChild:!0,variant:"outline",size:"sm",children:(0,b.jsx)(g.default,{href:`/t/${a}/book`,children:"Preview booking"})}),(0,b.jsx)(w.Button,{asChild:!0,variant:"outline",size:"sm",children:(0,b.jsx)(g.default,{href:`/t/${a}/services`,children:"Preview services"})}),(0,b.jsx)(w.Button,{asChild:!0,variant:"outline",size:"sm",children:(0,b.jsx)(g.default,{href:`/t/${a}/parts`,children:"Preview parts"})})]})]}),(0,b.jsx)(w.Button,{variant:"outline",onClick:()=>void F(),disabled:!!l||m||n,children:n?"Saving...":"Save"})]})}),m?(0,b.jsx)(av,{}):y]})]})]})}function ay(){let a=(0,c.useParams)(),f=a.business??a.tenant;return f?(0,b.jsx)(d.RequireAuth,{requiredPermission:"settings.manage",children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(e.PageHeader,{title:"Business Settings",description:"Operational settings for this business."}),(0,b.jsx)(ax,{tenantSlug:f})]})}):(0,b.jsx)(d.RequireAuth,{requiredPermission:"settings.manage",children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(e.PageHeader,{title:"Business Settings",description:"Operational settings for this business."}),(0,b.jsx)("div",{className:"rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-white px-4 py-3 text-sm text-zinc-700",children:"Missing tenant in route."})]})})}a.s(["default",()=>ay],18794)}];

//# sourceMappingURL=frontend_src_app_app_%5Btenant%5D_business-settings_page_tsx_2335e0b5._.js.map