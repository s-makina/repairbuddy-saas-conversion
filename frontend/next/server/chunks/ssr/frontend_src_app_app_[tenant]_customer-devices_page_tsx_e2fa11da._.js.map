{"version":3,"sources":["../../../../../frontend/src/app/app/%5Btenant%5D/customer-devices/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React from \"react\";\r\nimport { useParams, useRouter } from \"next/navigation\";\r\nimport { RequireAuth } from \"@/components/RequireAuth\";\r\nimport { useAuth } from \"@/lib/auth\";\r\nimport { Button } from \"@/components/ui/Button\";\r\nimport { Badge } from \"@/components/ui/Badge\";\r\nimport { Alert } from \"@/components/ui/Alert\";\r\nimport { Card, CardContent } from \"@/components/ui/Card\";\r\nimport { ConfirmDialog } from \"@/components/ui/ConfirmDialog\";\r\nimport { DataTable, type DataTableColumn } from \"@/components/ui/DataTable\";\r\nimport { DropdownMenu, DropdownMenuItem, DropdownMenuSeparator } from \"@/components/ui/DropdownMenu\";\r\nimport { Modal } from \"@/components/ui/Modal\";\r\nimport { ListPageShell } from \"@/components/shells/ListPageShell\";\r\nimport { apiFetch, ApiError } from \"@/lib/api\";\r\n\r\ntype ApiClient = {\r\n  id: number;\r\n  name: string;\r\n};\r\n\r\ntype ApiDeviceBrand = {\r\n  id: number;\r\n  name: string;\r\n};\r\n\r\ntype ApiDeviceType = {\r\n  id: number;\r\n  name: string;\r\n};\r\n\r\ntype ApiDevice = {\r\n  id: number;\r\n  model: string;\r\n  device_type_id: number;\r\n  device_brand_id: number;\r\n  parent_device_id: number | null;\r\n  disable_in_booking_form: boolean;\r\n  is_other: boolean;\r\n};\r\n\r\ntype ApiCustomerDevice = {\r\n  id: number;\r\n  customer_id: number;\r\n  device_id: number | null;\r\n  label: string;\r\n  serial: string | null;\r\n  pin: string | null;\r\n  notes: string | null;\r\n};\r\n\r\ntype ApiCustomerDeviceExtraField = {\r\n  field_definition_id: number;\r\n  key: string;\r\n  label: string;\r\n  type: string;\r\n  show_in_booking: boolean;\r\n  show_in_invoice: boolean;\r\n  show_in_portal: boolean;\r\n  is_active: boolean;\r\n  value_text: string | null;\r\n};\r\n\r\ntype Row = {\r\n  customerDevice: ApiCustomerDevice;\r\n  client: ApiClient | null;\r\n  device: ApiDevice | null;\r\n  brand: ApiDeviceBrand | null;\r\n  type: ApiDeviceType | null;\r\n};\r\n\r\nexport default function TenantCustomerDevicesPage() {\r\n  const auth = useAuth();\r\n  const router = useRouter();\r\n  const params = useParams() as { tenant?: string; business?: string };\r\n  const tenantSlug = params.business ?? params.tenant;\r\n\r\n  const [loading, setLoading] = React.useState(true);\r\n  const [error, setError] = React.useState<string | null>(null);\r\n  const [status, setStatus] = React.useState<string | null>(null);\r\n  const [busy, setBusy] = React.useState(false);\r\n\r\n  const [customerDevices, setCustomerDevices] = React.useState<ApiCustomerDevice[]>([]);\r\n  const [clients, setClients] = React.useState<ApiClient[]>([]);\r\n  const [devices, setDevices] = React.useState<ApiDevice[]>([]);\r\n  const [brands, setBrands] = React.useState<ApiDeviceBrand[]>([]);\r\n  const [types, setTypes] = React.useState<ApiDeviceType[]>([]);\r\n\r\n  const [query, setQuery] = React.useState(\"\");\r\n  const [pageIndex, setPageIndex] = React.useState(0);\r\n  const [pageSize, setPageSize] = React.useState(10);\r\n\r\n  const [editOpen, setEditOpen] = React.useState(false);\r\n  const [editId, setEditId] = React.useState<number | null>(null);\r\n  const [editCustomerId, setEditCustomerId] = React.useState<number | null>(null);\r\n  const [editDeviceId, setEditDeviceId] = React.useState<number | null>(null);\r\n  const [editLabel, setEditLabel] = React.useState(\"\");\r\n  const [editSerial, setEditSerial] = React.useState(\"\");\r\n  const [editPin, setEditPin] = React.useState(\"\");\r\n  const [editNotes, setEditNotes] = React.useState(\"\");\r\n\r\n  const [confirmOpen, setConfirmOpen] = React.useState(false);\r\n  const [confirmTitle, setConfirmTitle] = React.useState(\"\");\r\n  const [confirmMessage, setConfirmMessage] = React.useState<React.ReactNode>(\"\");\r\n  const [confirmAction, setConfirmAction] = React.useState<(() => Promise<void>) | null>(null);\r\n\r\n  const [extraOpen, setExtraOpen] = React.useState(false);\r\n  const [extraBusy, setExtraBusy] = React.useState(false);\r\n  const [extraError, setExtraError] = React.useState<string | null>(null);\r\n  const [extraStatus, setExtraStatus] = React.useState<string | null>(null);\r\n  const [extraFor, setExtraFor] = React.useState<Row | null>(null);\r\n  const [extraFields, setExtraFields] = React.useState<ApiCustomerDeviceExtraField[]>([]);\r\n\r\n  const canManage = auth.can(\"customer_devices.manage\");\r\n\r\n  const load = React.useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n\r\n      if (typeof tenantSlug !== \"string\" || tenantSlug.length === 0) {\r\n        throw new Error(\"Business is missing.\");\r\n      }\r\n\r\n      const [cdRes, clientsRes, devicesRes, brandsRes, typesRes] = await Promise.all([\r\n        apiFetch<{ customer_devices: ApiCustomerDevice[] }>(`/api/${tenantSlug}/app/repairbuddy/customer-devices?limit=200`),\r\n        apiFetch<{ clients: ApiClient[] }>(`/api/${tenantSlug}/app/clients?limit=200`),\r\n        apiFetch<{ devices: ApiDevice[] }>(`/api/${tenantSlug}/app/repairbuddy/devices?limit=200`),\r\n        apiFetch<{ device_brands: ApiDeviceBrand[] }>(`/api/${tenantSlug}/app/repairbuddy/device-brands?limit=200`),\r\n        apiFetch<{ device_types: ApiDeviceType[] }>(`/api/${tenantSlug}/app/repairbuddy/device-types?limit=200`),\r\n      ]);\r\n\r\n      setCustomerDevices(Array.isArray(cdRes?.customer_devices) ? cdRes.customer_devices : []);\r\n      setClients(Array.isArray(clientsRes?.clients) ? clientsRes.clients : []);\r\n      setDevices(Array.isArray(devicesRes?.devices) ? devicesRes.devices : []);\r\n      setBrands(Array.isArray(brandsRes?.device_brands) ? brandsRes.device_brands : []);\r\n      setTypes(Array.isArray(typesRes?.device_types) ? typesRes.device_types : []);\r\n    } catch (e) {\r\n      if (e instanceof ApiError && e.status === 428 && typeof tenantSlug === \"string\" && tenantSlug.length > 0) {\r\n        const next = `/app/${tenantSlug}/customer-devices`;\r\n        router.replace(`/app/${tenantSlug}/branches/select?next=${encodeURIComponent(next)}`);\r\n        return;\r\n      }\r\n\r\n      setError(e instanceof Error ? e.message : \"Failed to load customer devices.\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [router, tenantSlug]);\r\n\r\n  React.useEffect(() => {\r\n    void load();\r\n  }, [load]);\r\n\r\n  function openCreate() {\r\n    if (!canManage) return;\r\n    setEditId(null);\r\n    setEditCustomerId(clients.length > 0 ? clients[0].id : null);\r\n    setEditDeviceId(null);\r\n    setEditLabel(\"\");\r\n    setEditSerial(\"\");\r\n    setEditPin(\"\");\r\n    setEditNotes(\"\");\r\n    setEditOpen(true);\r\n    setError(null);\r\n    setStatus(null);\r\n  }\r\n\r\n  function openEdit(row: Row) {\r\n    if (!canManage) return;\r\n    setEditId(row.customerDevice.id);\r\n    setEditCustomerId(row.customerDevice.customer_id);\r\n    setEditDeviceId(typeof row.customerDevice.device_id === \"number\" ? row.customerDevice.device_id : null);\r\n    setEditLabel(row.customerDevice.label ?? \"\");\r\n    setEditSerial(row.customerDevice.serial ?? \"\");\r\n    setEditPin(row.customerDevice.pin ?? \"\");\r\n    setEditNotes(row.customerDevice.notes ?? \"\");\r\n    setEditOpen(true);\r\n    setError(null);\r\n    setStatus(null);\r\n  }\r\n\r\n  function openConfirm(args: { title: string; message: React.ReactNode; action: () => Promise<void> }) {\r\n    setConfirmTitle(args.title);\r\n    setConfirmMessage(args.message);\r\n    setConfirmAction(() => args.action);\r\n    setConfirmOpen(true);\r\n  }\r\n\r\n  async function onSaveCustomerDevice(e: React.FormEvent) {\r\n    e.preventDefault();\r\n    if (busy) return;\r\n    if (typeof tenantSlug !== \"string\" || tenantSlug.length === 0) return;\r\n    if (!canManage) {\r\n      setError(\"Forbidden.\");\r\n      return;\r\n    }\r\n\r\n    setBusy(true);\r\n    setError(null);\r\n    setStatus(null);\r\n\r\n    try {\r\n      if (typeof editCustomerId !== \"number\") {\r\n        setError(\"Client is required.\");\r\n        return;\r\n      }\r\n\r\n      const label = editLabel.trim();\r\n      if (label.length === 0) {\r\n        setError(\"Label is required.\");\r\n        return;\r\n      }\r\n\r\n      const payload = {\r\n        customer_id: editCustomerId,\r\n        device_id: editDeviceId,\r\n        label,\r\n        serial: editSerial.trim().length > 0 ? editSerial.trim() : null,\r\n        pin: editPin.trim().length > 0 ? editPin.trim() : null,\r\n        notes: editNotes.trim().length > 0 ? editNotes.trim() : null,\r\n      };\r\n\r\n      if (editId) {\r\n        await apiFetch<{ customer_device: ApiCustomerDevice }>(`/api/${tenantSlug}/app/repairbuddy/customer-devices/${editId}`, {\r\n          method: \"PATCH\",\r\n          body: payload,\r\n        });\r\n        setStatus(\"Customer device updated.\");\r\n      } else {\r\n        await apiFetch<{ customer_device: ApiCustomerDevice }>(`/api/${tenantSlug}/app/repairbuddy/customer-devices`, {\r\n          method: \"POST\",\r\n          body: payload,\r\n        });\r\n        setStatus(\"Customer device created.\");\r\n      }\r\n\r\n      setEditOpen(false);\r\n      setPageIndex(0);\r\n      await load();\r\n    } catch (err) {\r\n      if (err instanceof ApiError) {\r\n        setError(err.message);\r\n      } else {\r\n        setError(editId ? \"Failed to update customer device.\" : \"Failed to create customer device.\");\r\n      }\r\n    } finally {\r\n      setBusy(false);\r\n    }\r\n  }\r\n\r\n  async function onDeleteCustomerDevice(row: Row) {\r\n    if (busy) return;\r\n    if (typeof tenantSlug !== \"string\" || tenantSlug.length === 0) return;\r\n    if (!canManage) {\r\n      setError(\"Forbidden.\");\r\n      return;\r\n    }\r\n\r\n    const deviceLabel = row.device ? `${row.brand?.name ?? \"\"} ${row.device.model}`.trim() : row.customerDevice.label;\r\n\r\n    openConfirm({\r\n      title: \"Delete customer device\",\r\n      message: (\r\n        <div>\r\n          Delete <span className=\"font-semibold\">{deviceLabel}</span>?\r\n        </div>\r\n      ),\r\n      action: async () => {\r\n        setBusy(true);\r\n        setError(null);\r\n        setStatus(null);\r\n        try {\r\n          await apiFetch<{ message: string }>(`/api/${tenantSlug}/app/repairbuddy/customer-devices/${row.customerDevice.id}`, {\r\n            method: \"DELETE\",\r\n          });\r\n          setStatus(\"Customer device deleted.\");\r\n          setPageIndex(0);\r\n          await load();\r\n        } catch (err) {\r\n          if (err instanceof ApiError) {\r\n            setError(err.message);\r\n          } else {\r\n            setError(\"Failed to delete customer device.\");\r\n          }\r\n        } finally {\r\n          setBusy(false);\r\n        }\r\n      },\r\n    });\r\n  }\r\n\r\n  async function openExtraFields(row: Row) {\r\n    setExtraError(null);\r\n    setExtraStatus(null);\r\n\r\n    if (typeof tenantSlug !== \"string\" || tenantSlug.length === 0) {\r\n      setExtraError(\"Business is missing.\");\r\n      return;\r\n    }\r\n\r\n    setExtraFor(row);\r\n    setExtraOpen(true);\r\n    setExtraBusy(true);\r\n    try {\r\n      const res = await apiFetch<{ customer_device_id: number; extra_fields: ApiCustomerDeviceExtraField[] }>(\r\n        `/api/${tenantSlug}/app/repairbuddy/customer-devices/${row.customerDevice.id}/extra-fields`,\r\n      );\r\n      setExtraFields(Array.isArray(res?.extra_fields) ? res.extra_fields : []);\r\n    } catch (e) {\r\n      if (e instanceof ApiError && e.status === 428 && typeof tenantSlug === \"string\" && tenantSlug.length > 0) {\r\n        const next = `/app/${tenantSlug}/customer-devices`;\r\n        router.replace(`/app/${tenantSlug}/branches/select?next=${encodeURIComponent(next)}`);\r\n        return;\r\n      }\r\n      setExtraError(e instanceof Error ? e.message : \"Failed to load extra fields.\");\r\n      setExtraFields([]);\r\n    } finally {\r\n      setExtraBusy(false);\r\n    }\r\n  }\r\n\r\n  async function saveExtraFields() {\r\n    setExtraError(null);\r\n    setExtraStatus(null);\r\n\r\n    if (!extraFor) {\r\n      setExtraError(\"No customer device selected.\");\r\n      return;\r\n    }\r\n\r\n    if (typeof tenantSlug !== \"string\" || tenantSlug.length === 0) {\r\n      setExtraError(\"Business is missing.\");\r\n      return;\r\n    }\r\n\r\n    setExtraBusy(true);\r\n    try {\r\n      const res = await apiFetch<{ customer_device_id: number; extra_fields: ApiCustomerDeviceExtraField[] }>(\r\n        `/api/${tenantSlug}/app/repairbuddy/customer-devices/${extraFor.customerDevice.id}/extra-fields`,\r\n        {\r\n          method: \"PUT\",\r\n          body: {\r\n            values: extraFields.map((f) => ({\r\n              field_definition_id: f.field_definition_id,\r\n              value_text: f.value_text,\r\n            })),\r\n          },\r\n        },\r\n      );\r\n      setExtraFields(Array.isArray(res?.extra_fields) ? res.extra_fields : []);\r\n      setExtraStatus(\"Saved.\");\r\n    } catch (e) {\r\n      setExtraError(e instanceof Error ? e.message : \"Failed to save extra fields.\");\r\n    } finally {\r\n      setExtraBusy(false);\r\n    }\r\n  }\r\n\r\n  const clientById = React.useMemo(() => new Map(clients.map((c) => [c.id, c])), [clients]);\r\n  const deviceById = React.useMemo(() => new Map(devices.map((d) => [d.id, d])), [devices]);\r\n  const brandById = React.useMemo(() => new Map(brands.map((b) => [b.id, b])), [brands]);\r\n  const typeById = React.useMemo(() => new Map(types.map((t) => [t.id, t])), [types]);\r\n\r\n  const rows = React.useMemo<Row[]>(() => {\r\n    return customerDevices.map((cd) => {\r\n      const client = clientById.get(cd.customer_id) ?? null;\r\n      const device = typeof cd.device_id === \"number\" ? deviceById.get(cd.device_id) ?? null : null;\r\n      const brand = device ? brandById.get(device.device_brand_id) ?? null : null;\r\n      const type = device ? typeById.get(device.device_type_id) ?? null : null;\r\n      return { customerDevice: cd, client, device, brand, type };\r\n    });\r\n  }, [brandById, clientById, customerDevices, deviceById, typeById]);\r\n\r\n  const filtered = React.useMemo(() => {\r\n    const needle = query.trim().toLowerCase();\r\n    if (!needle) return rows;\r\n\r\n    return rows.filter((r) => {\r\n      const label = r.device ? `${r.brand?.name ?? \"\"} ${r.device.model}`.trim() : r.customerDevice.label;\r\n      const hay = `${r.customerDevice.id} ${label} ${r.client?.name ?? \"\"} ${r.customerDevice.serial ?? \"\"}`.toLowerCase();\r\n      return hay.includes(needle);\r\n    });\r\n  }, [query, rows]);\r\n\r\n  const totalRows = filtered.length;\r\n  const pageRows = React.useMemo(() => {\r\n    const start = pageIndex * pageSize;\r\n    const end = start + pageSize;\r\n    return filtered.slice(start, end);\r\n  }, [filtered, pageIndex, pageSize]);\r\n\r\n  const columns = React.useMemo<Array<DataTableColumn<Row>>>(\r\n    () => [\r\n      {\r\n        id: \"device\",\r\n        header: \"Device\",\r\n        cell: (row) => (\r\n          <div className=\"min-w-0\">\r\n            <div className=\"truncate font-semibold text-[var(--rb-text)]\">\r\n              {row.device ? `${row.brand?.name ?? \"\"} ${row.device.model}`.trim() : row.customerDevice.label}\r\n            </div>\r\n            <div className=\"truncate text-xs text-zinc-600\">{row.customerDevice.id}</div>\r\n          </div>\r\n        ),\r\n        className: \"min-w-[280px]\",\r\n      },\r\n      {\r\n        id: \"client\",\r\n        header: \"Client\",\r\n        cell: (row) => <div className=\"text-sm text-zinc-700\">{row.client?.name ?? row.customerDevice.customer_id}</div>,\r\n        className: \"min-w-[220px]\",\r\n      },\r\n      {\r\n        id: \"type\",\r\n        header: \"Type\",\r\n        cell: (row) => <div className=\"text-sm text-zinc-700\">{row.type?.name ?? \"—\"}</div>,\r\n        className: \"min-w-[160px]\",\r\n      },\r\n      {\r\n        id: \"serial\",\r\n        header: \"Serial\",\r\n        cell: (row) => <Badge variant=\"default\">{row.customerDevice.serial ?? \"—\"}</Badge>,\r\n        className: \"whitespace-nowrap\",\r\n      },\r\n      {\r\n        id: \"actions\",\r\n        header: \"\",\r\n        headerClassName: \"text-right\",\r\n        className: \"w-[160px] whitespace-nowrap text-right\",\r\n        cell: (row) => {\r\n          if (!canManage) {\r\n            return (\r\n              <div className=\"flex justify-end\">\r\n                <Button variant=\"outline\" size=\"sm\" onClick={() => void openExtraFields(row)}>\r\n                  Extra fields\r\n                </Button>\r\n              </div>\r\n            );\r\n          }\r\n\r\n          return (\r\n            <DropdownMenu\r\n              align=\"right\"\r\n              trigger={({ toggle }) => (\r\n                <Button variant=\"ghost\" size=\"sm\" onClick={toggle} disabled={busy} className=\"px-2\">\r\n                  Actions\r\n                </Button>\r\n              )}\r\n            >\r\n              {({ close }) => (\r\n                <>\r\n                  <DropdownMenuItem\r\n                    onSelect={() => {\r\n                      close();\r\n                      openEdit(row);\r\n                    }}\r\n                    disabled={busy}\r\n                  >\r\n                    Edit\r\n                  </DropdownMenuItem>\r\n                  <DropdownMenuItem\r\n                    onSelect={() => {\r\n                      close();\r\n                      void openExtraFields(row);\r\n                    }}\r\n                    disabled={busy}\r\n                  >\r\n                    Extra fields\r\n                  </DropdownMenuItem>\r\n                  <DropdownMenuSeparator />\r\n                  <DropdownMenuItem\r\n                    destructive\r\n                    onSelect={() => {\r\n                      close();\r\n                      void onDeleteCustomerDevice(row);\r\n                    }}\r\n                    disabled={busy}\r\n                  >\r\n                    Delete\r\n                  </DropdownMenuItem>\r\n                </>\r\n              )}\r\n            </DropdownMenu>\r\n          );\r\n        },\r\n      },\r\n    ],\r\n    [busy, canManage, tenantSlug],\r\n  );\r\n\r\n  return (\r\n    <RequireAuth requiredPermission=\"customer_devices.view\">\r\n      <div className=\"space-y-4\">\r\n        <ConfirmDialog\r\n          open={confirmOpen}\r\n          title={confirmTitle}\r\n          message={confirmMessage}\r\n          busy={busy}\r\n          confirmText=\"Delete\"\r\n          confirmVariant=\"secondary\"\r\n          onCancel={() => {\r\n            if (busy) return;\r\n            setConfirmOpen(false);\r\n            setConfirmAction(null);\r\n          }}\r\n          onConfirm={() => {\r\n            if (!confirmAction) return;\r\n            void (async () => {\r\n              await confirmAction();\r\n              setConfirmOpen(false);\r\n              setConfirmAction(null);\r\n            })();\r\n          }}\r\n        />\r\n\r\n        <Modal\r\n          open={editOpen}\r\n          onClose={() => {\r\n            if (busy) return;\r\n            setEditOpen(false);\r\n          }}\r\n          title={editId ? \"Edit customer device\" : \"Add customer device\"}\r\n          footer={\r\n            <div className=\"flex items-center justify-end gap-2\">\r\n              <Button variant=\"outline\" onClick={() => setEditOpen(false)} disabled={busy}>\r\n                Cancel\r\n              </Button>\r\n              <Button disabled={busy} type=\"submit\" form=\"rb_customer_device_form\">\r\n                {busy ? \"Saving...\" : \"Save\"}\r\n              </Button>\r\n            </div>\r\n          }\r\n        >\r\n          <form id=\"rb_customer_device_form\" className=\"space-y-3\" onSubmit={onSaveCustomerDevice}>\r\n            <div className=\"space-y-1\">\r\n              <label className=\"text-sm font-medium\" htmlFor=\"cd_customer\">\r\n                Client\r\n              </label>\r\n              <select\r\n                id=\"cd_customer\"\r\n                className=\"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm\"\r\n                value={editCustomerId ?? \"\"}\r\n                onChange={(e) => {\r\n                  const raw = e.target.value;\r\n                  if (!raw) {\r\n                    setEditCustomerId(null);\r\n                    return;\r\n                  }\r\n                  const n = Number(raw);\r\n                  setEditCustomerId(Number.isFinite(n) ? n : null);\r\n                }}\r\n                disabled={busy}\r\n              >\r\n                {clients\r\n                  .slice()\r\n                  .sort((a, b) => a.name.localeCompare(b.name))\r\n                  .map((c) => (\r\n                    <option key={c.id} value={c.id}>\r\n                      {c.name}\r\n                    </option>\r\n                  ))}\r\n              </select>\r\n            </div>\r\n\r\n            <div className=\"space-y-1\">\r\n              <label className=\"text-sm font-medium\" htmlFor=\"cd_device\">\r\n                Device model (optional)\r\n              </label>\r\n              <select\r\n                id=\"cd_device\"\r\n                className=\"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm\"\r\n                value={editDeviceId ?? \"\"}\r\n                onChange={(e) => {\r\n                  const raw = e.target.value;\r\n                  if (!raw) {\r\n                    setEditDeviceId(null);\r\n                    return;\r\n                  }\r\n                  const n = Number(raw);\r\n                  setEditDeviceId(Number.isFinite(n) ? n : null);\r\n                }}\r\n                disabled={busy}\r\n              >\r\n                <option value=\"\">(none)</option>\r\n                {devices\r\n                  .slice()\r\n                  .sort((a, b) => a.model.localeCompare(b.model))\r\n                  .map((d) => (\r\n                    <option key={d.id} value={d.id}>\r\n                      {d.model}\r\n                    </option>\r\n                  ))}\r\n              </select>\r\n            </div>\r\n\r\n            <div className=\"space-y-1\">\r\n              <label className=\"text-sm font-medium\" htmlFor=\"cd_label\">\r\n                Label\r\n              </label>\r\n              <input\r\n                id=\"cd_label\"\r\n                className=\"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm\"\r\n                value={editLabel}\r\n                onChange={(e) => setEditLabel(e.target.value)}\r\n                disabled={busy}\r\n                required\r\n              />\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 gap-3 sm:grid-cols-2\">\r\n              <div className=\"space-y-1\">\r\n                <label className=\"text-sm font-medium\" htmlFor=\"cd_serial\">\r\n                  Serial\r\n                </label>\r\n                <input\r\n                  id=\"cd_serial\"\r\n                  className=\"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm\"\r\n                  value={editSerial}\r\n                  onChange={(e) => setEditSerial(e.target.value)}\r\n                  disabled={busy}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"space-y-1\">\r\n                <label className=\"text-sm font-medium\" htmlFor=\"cd_pin\">\r\n                  PIN\r\n                </label>\r\n                <input\r\n                  id=\"cd_pin\"\r\n                  className=\"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm\"\r\n                  value={editPin}\r\n                  onChange={(e) => setEditPin(e.target.value)}\r\n                  disabled={busy}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"space-y-1\">\r\n              <label className=\"text-sm font-medium\" htmlFor=\"cd_notes\">\r\n                Notes\r\n              </label>\r\n              <textarea\r\n                id=\"cd_notes\"\r\n                className=\"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm\"\r\n                value={editNotes}\r\n                onChange={(e) => setEditNotes(e.target.value)}\r\n                disabled={busy}\r\n                rows={4}\r\n              />\r\n            </div>\r\n          </form>\r\n        </Modal>\r\n\r\n        {status ? <div className=\"text-sm text-green-700\">{status}</div> : null}\r\n        {error ? <div className=\"text-sm text-red-600\">{error}</div> : null}\r\n\r\n        <ListPageShell\r\n          title=\"Customer Devices\"\r\n          description=\"Devices owned by clients (intake inventory).\"\r\n          actions={\r\n            <Button variant=\"primary\" size=\"sm\" onClick={openCreate} disabled={!canManage || loading || busy}>\r\n              Add device\r\n            </Button>\r\n          }\r\n          loading={loading}\r\n          error={null}\r\n          empty={!loading && !error && rows.length === 0}\r\n          emptyTitle=\"No customer devices\"\r\n          emptyDescription=\"Customer devices will appear when linked to clients.\"\r\n        >\r\n      <Modal\r\n        open={extraOpen}\r\n        onClose={() => {\r\n          if (!extraBusy) {\r\n            setExtraOpen(false);\r\n            setExtraFor(null);\r\n            setExtraFields([]);\r\n            setExtraError(null);\r\n            setExtraStatus(null);\r\n          }\r\n        }}\r\n        title={extraFor ? `Extra Fields · #${extraFor.customerDevice.id}` : \"Extra Fields\"}\r\n        footer={\r\n          <div className=\"flex items-center justify-end gap-2\">\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={() => {\r\n                if (!extraBusy) {\r\n                  setExtraOpen(false);\r\n                  setExtraFor(null);\r\n                  setExtraFields([]);\r\n                  setExtraError(null);\r\n                  setExtraStatus(null);\r\n                }\r\n              }}\r\n              disabled={extraBusy}\r\n            >\r\n              Close\r\n            </Button>\r\n            <Button onClick={() => void saveExtraFields()} disabled={extraBusy}>\r\n              {extraBusy ? \"Saving...\" : \"Save\"}\r\n            </Button>\r\n          </div>\r\n        }\r\n      >\r\n        {extraError ? (\r\n          <Alert variant=\"danger\" title=\"Could not load extra fields\">\r\n            {extraError}\r\n          </Alert>\r\n        ) : null}\r\n\r\n        {extraStatus ? (\r\n          <Alert variant=\"success\" title=\"Success\">\r\n            {extraStatus}\r\n          </Alert>\r\n        ) : null}\r\n\r\n        {extraBusy && extraFields.length === 0 ? <div className=\"text-sm text-zinc-500\">Loading...</div> : null}\r\n\r\n        {!extraBusy && extraFields.length === 0 ? <div className=\"text-sm text-zinc-600\">No extra fields defined.</div> : null}\r\n\r\n        {extraFields.length > 0 ? (\r\n          <div className=\"space-y-3\">\r\n            {extraFields\r\n              .filter((f) => f.is_active)\r\n              .map((f) => (\r\n                <div key={f.field_definition_id} className=\"space-y-1\">\r\n                  <div className=\"text-sm font-medium text-[var(--rb-text)]\">{f.label}</div>\r\n                  <input\r\n                    className=\"h-10 w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 text-sm\"\r\n                    value={f.value_text ?? \"\"}\r\n                    onChange={(e) => {\r\n                      const next = e.target.value;\r\n                      setExtraFields((prev) => prev.map((p) => (p.field_definition_id === f.field_definition_id ? { ...p, value_text: next } : p)));\r\n                    }}\r\n                    disabled={extraBusy}\r\n                  />\r\n                </div>\r\n              ))}\r\n          </div>\r\n        ) : null}\r\n      </Modal>\r\n\r\n      <Card className=\"shadow-none\">\r\n        <CardContent className=\"pt-5\">\r\n          <DataTable\r\n            title={typeof tenantSlug === \"string\" ? `Customer Devices · ${tenantSlug}` : \"Customer Devices\"}\r\n            data={pageRows}\r\n            loading={loading}\r\n            emptyMessage=\"No customer devices.\"\r\n            columns={columns}\r\n            getRowId={(row) => row.customerDevice.id}\r\n            search={{\r\n              placeholder: \"Search devices, clients, serial...\",\r\n            }}\r\n            server={{\r\n              query,\r\n              onQueryChange: (value) => {\r\n                setQuery(value);\r\n                setPageIndex(0);\r\n              },\r\n              pageIndex,\r\n              onPageIndexChange: setPageIndex,\r\n              pageSize,\r\n              onPageSizeChange: (value) => {\r\n                setPageSize(value);\r\n                setPageIndex(0);\r\n              },\r\n              totalRows,\r\n            }}\r\n          />\r\n        </CardContent>\r\n      </Card>\r\n        </ListPageShell>\r\n      </div>\r\n    </RequireAuth>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}