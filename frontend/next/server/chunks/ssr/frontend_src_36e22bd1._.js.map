{"version":3,"sources":["../../../../../frontend/src/components/ui/Alert.tsx","../../../../../frontend/src/components/ui/Badge.tsx","../../../../../frontend/src/components/ui/Input.tsx","../../../../../frontend/src/components/ui/Modal.tsx","../../../../../frontend/src/components/ui/ConfirmDialog.tsx","../../../../../frontend/src/lib/money.ts","../../../../../frontend/src/lib/datetime.ts","../../../../../frontend/src/lib/billing.ts","../../../../../frontend/src/app/admin/tenants/%5Btenant%5D/billing/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React from \"react\";\r\nimport { cn } from \"@/lib/cn\";\r\n\r\nexport type AlertVariant = \"info\" | \"success\" | \"warning\" | \"danger\";\r\n\r\nfunction AlertIcon({ variant, className }: { variant: AlertVariant; className?: string }) {\r\n  const common = \"h-4 w-4 shrink-0\";\r\n\r\n  if (variant === \"success\") {\r\n    return (\r\n      <svg viewBox=\"0 0 24 24\" className={cn(common, className)} fill=\"none\" stroke=\"currentColor\" strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\" aria-hidden=\"true\">\r\n        <path d=\"M20 6L9 17l-5-5\" />\r\n      </svg>\r\n    );\r\n  }\r\n\r\n  if (variant === \"warning\") {\r\n    return (\r\n      <svg viewBox=\"0 0 24 24\" className={cn(common, className)} fill=\"none\" stroke=\"currentColor\" strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\" aria-hidden=\"true\">\r\n        <path d=\"M12 9v4\" />\r\n        <path d=\"M12 17h.01\" />\r\n        <path d=\"M10.3 3.6l-8.3 14.3A2 2 0 0 0 3.7 21h16.6a2 2 0 0 0 1.7-3.1L13.7 3.6a2 2 0 0 0-3.4 0z\" />\r\n      </svg>\r\n    );\r\n  }\r\n\r\n  if (variant === \"danger\") {\r\n    return (\r\n      <svg viewBox=\"0 0 24 24\" className={cn(common, className)} fill=\"none\" stroke=\"currentColor\" strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\" aria-hidden=\"true\">\r\n        <path d=\"M18 6L6 18\" />\r\n        <path d=\"M6 6l12 12\" />\r\n      </svg>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <svg viewBox=\"0 0 24 24\" className={cn(common, className)} fill=\"none\" stroke=\"currentColor\" strokeWidth={2} strokeLinecap=\"round\" strokeLinejoin=\"round\" aria-hidden=\"true\">\r\n      <path d=\"M12 16v-4\" />\r\n      <path d=\"M12 8h.01\" />\r\n      <path d=\"M12 22a10 10 0 1 0-10-10 10 10 0 0 0 10 10z\" />\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport function Alert({\r\n  className,\r\n  variant = \"info\",\r\n  title,\r\n  children,\r\n  ...props\r\n}: React.HTMLAttributes<HTMLDivElement> & {\r\n  variant?: AlertVariant;\r\n  title?: string;\r\n}) {\r\n  const variants: Record<AlertVariant, { wrapper: string; icon: string; title: string }> = {\r\n    info: {\r\n      wrapper:\r\n        \"border-[color:color-mix(in_srgb,var(--rb-blue),white_75%)] bg-[color:color-mix(in_srgb,var(--rb-blue),white_92%)] text-[var(--rb-text)]\",\r\n      icon: \"text-[var(--rb-blue)]\",\r\n      title: \"text-[var(--rb-blue)]\",\r\n    },\r\n    success: {\r\n      wrapper: \"border-[color:color-mix(in_srgb,#16a34a,white_75%)] bg-[color:color-mix(in_srgb,#16a34a,white_92%)] text-[var(--rb-text)]\",\r\n      icon: \"text-[#166534]\",\r\n      title: \"text-[#166534]\",\r\n    },\r\n    warning: {\r\n      wrapper:\r\n        \"border-[color:color-mix(in_srgb,var(--rb-orange),white_70%)] bg-[color:color-mix(in_srgb,var(--rb-orange),white_92%)] text-[var(--rb-text)]\",\r\n      icon: \"text-[color:color-mix(in_srgb,var(--rb-orange),black_20%)]\",\r\n      title: \"text-[color:color-mix(in_srgb,var(--rb-orange),black_20%)]\",\r\n    },\r\n    danger: {\r\n      wrapper: \"border-[color:color-mix(in_srgb,#dc2626,white_75%)] bg-[color:color-mix(in_srgb,#dc2626,white_92%)] text-[var(--rb-text)]\",\r\n      icon: \"text-[#991b1b]\",\r\n      title: \"text-[#991b1b]\",\r\n    },\r\n  };\r\n\r\n  const v = variants[variant];\r\n\r\n  return (\r\n    <div\r\n      role=\"alert\"\r\n      className={cn(\"rounded-[var(--rb-radius-md)] border px-4 py-3\", v.wrapper, className)}\r\n      {...props}\r\n    >\r\n      <div className=\"flex gap-3\">\r\n        <AlertIcon variant={variant} className={cn(\"mt-0.5\", v.icon)} />\r\n        <div className=\"min-w-0\">\r\n          {title ? <div className={cn(\"text-sm font-semibold\", v.title)}>{title}</div> : null}\r\n          {children ? <div className={cn(\"text-sm text-zinc-700\", title ? \"mt-1\" : \"\")}>\r\n            {children}\r\n          </div> : null}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport React from \"react\";\r\nimport { cn } from \"@/lib/cn\";\r\n\r\nexport type BadgeVariant = \"default\" | \"info\" | \"success\" | \"warning\" | \"danger\";\r\n\r\nexport function Badge({\r\n  className,\r\n  variant = \"default\",\r\n  ...props\r\n}: React.HTMLAttributes<HTMLSpanElement> & { variant?: BadgeVariant }) {\r\n  const variants: Record<BadgeVariant, string> = {\r\n    default: \"bg-[var(--rb-surface-muted)] text-[var(--rb-text)] border-[var(--rb-border)]\",\r\n    info: \"bg-[color:color-mix(in_srgb,var(--rb-blue),white_85%)] text-[var(--rb-blue)] border-[color:color-mix(in_srgb,var(--rb-blue),white_70%)]\",\r\n    success: \"bg-[color:color-mix(in_srgb,#16a34a,white_85%)] text-[#166534] border-[color:color-mix(in_srgb,#16a34a,white_70%)]\",\r\n    warning: \"bg-[color:color-mix(in_srgb,var(--rb-orange),white_85%)] text-[color:color-mix(in_srgb,var(--rb-orange),black_20%)] border-[color:color-mix(in_srgb,var(--rb-orange),white_70%)]\",\r\n    danger: \"bg-[color:color-mix(in_srgb,#dc2626,white_85%)] text-[#991b1b] border-[color:color-mix(in_srgb,#dc2626,white_70%)]\",\r\n  };\r\n\r\n  return (\r\n    <span\r\n      className={cn(\r\n        \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-medium\",\r\n        variants[variant],\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport React from \"react\";\r\nimport { cn } from \"@/lib/cn\";\r\n\r\nexport function Input({ className, type, ...props }: React.InputHTMLAttributes<HTMLInputElement>) {\r\n  return (\r\n    <input\r\n      type={type}\r\n      className={cn(\r\n        \"w-full rounded-[var(--rb-radius-sm)] border border-zinc-300 bg-white px-3 py-2 text-sm text-[var(--rb-text)] outline-none transition\",\r\n        \"placeholder:text-zinc-400\",\r\n        \"focus-visible:ring-2 focus-visible:ring-[color:color-mix(in_srgb,var(--rb-orange),white_65%)] focus-visible:ring-offset-2 focus-visible:ring-offset-white\",\r\n        \"disabled:cursor-not-allowed disabled:bg-[var(--rb-surface-muted)] disabled:opacity-70\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport React, { useEffect } from \"react\";\r\nimport { cn } from \"@/lib/cn\";\r\n\r\nexport function Modal({\r\n  open,\r\n  onClose,\r\n  title,\r\n  children,\r\n  footer,\r\n  position = \"center\",\r\n  variant = \"glass\",\r\n  className,\r\n}: {\r\n  open: boolean;\r\n  onClose: () => void;\r\n  title?: React.ReactNode;\r\n  children: React.ReactNode;\r\n  footer?: React.ReactNode;\r\n  position?: \"center\" | \"top-center\";\r\n  variant?: \"glass\" | \"solid\";\r\n  className?: string;\r\n}) {\r\n  useEffect(() => {\r\n    function onKeyDown(e: KeyboardEvent) {\r\n      if (!open) return;\r\n      if (e.key === \"Escape\") onClose();\r\n    }\r\n\r\n    document.addEventListener(\"keydown\", onKeyDown);\r\n    return () => document.removeEventListener(\"keydown\", onKeyDown);\r\n  }, [onClose, open]);\r\n\r\n  if (!open) return null;\r\n\r\n  const containerClassName =\r\n    position === \"top-center\"\r\n      ? \"fixed inset-0 z-50 flex items-start justify-center px-4 pt-8\"\r\n      : \"fixed inset-0 z-50 flex items-center justify-center px-4\";\r\n\r\n  const panelClassName =\r\n    variant === \"solid\"\r\n      ? cn(\r\n          \"relative w-full max-w-lg overflow-hidden rounded-[var(--rb-radius-lg)]\",\r\n          \"border border-[var(--rb-border)]\",\r\n          \"bg-white\",\r\n          \"shadow-[var(--rb-shadow)]\",\r\n        )\r\n      : cn(\r\n          \"relative w-full max-w-lg overflow-hidden rounded-[var(--rb-radius-lg)]\",\r\n          \"border border-[color:color-mix(in_srgb,var(--rb-border),white_55%)]\",\r\n          \"bg-white/75 backdrop-blur-xl\",\r\n          \"shadow-[0_18px_55px_-18px_rgba(0,0,0,0.55)]\",\r\n          \"ring-1 ring-white/25\",\r\n        );\r\n\r\n  const showInnerGlow = variant === \"glass\";\r\n\r\n  return (\r\n    <div className={containerClassName}>\r\n      <button\r\n        type=\"button\"\r\n        className={cn(\r\n          \"absolute inset-0\",\r\n          \"bg-black/35 backdrop-blur-md\",\r\n          \"bg-[radial-gradient(900px_600px_at_20%_20%,color-mix(in_srgb,#16a34a,transparent_82%)_0%,transparent_60%),radial-gradient(900px_600px_at_80%_30%,color-mix(in_srgb,var(--rb-blue),transparent_82%)_0%,transparent_60%),radial-gradient(900px_600px_at_50%_85%,color-mix(in_srgb,var(--rb-orange),transparent_85%)_0%,transparent_65%)]\",\r\n        )}\r\n        aria-label=\"Close\"\r\n        onClick={onClose}\r\n      />\r\n      <div\r\n        role=\"dialog\"\r\n        aria-modal=\"true\"\r\n        className={cn(\r\n          panelClassName,\r\n          className,\r\n        )}\r\n      >\r\n        {showInnerGlow ? (\r\n          <div className=\"pointer-events-none absolute inset-0 bg-[radial-gradient(650px_420px_at_20%_15%,color-mix(in_srgb,#16a34a,transparent_88%)_0%,transparent_60%),radial-gradient(650px_420px_at_80%_5%,color-mix(in_srgb,var(--rb-blue),transparent_90%)_0%,transparent_60%)]\" />\r\n        ) : null}\r\n        {title ? (\r\n          <div\r\n            className={cn(\r\n              \"relative px-5 py-4\",\r\n              variant === \"solid\"\r\n                ? \"border-b border-[var(--rb-border)]\"\r\n                : \"border-b border-[color:color-mix(in_srgb,var(--rb-border),white_60%)]\",\r\n            )}\r\n          >\r\n            <div className=\"text-sm font-semibold text-[var(--rb-text)]\">{title}</div>\r\n          </div>\r\n        ) : null}\r\n\r\n        <div className=\"relative px-5 py-4\">{children}</div>\r\n\r\n        {footer ? (\r\n          <div\r\n            className={cn(\r\n              \"relative px-5 py-4\",\r\n              variant === \"solid\"\r\n                ? \"border-t border-[var(--rb-border)]\"\r\n                : \"border-t border-[color:color-mix(in_srgb,var(--rb-border),white_60%)]\",\r\n            )}\r\n          >\r\n            {footer}\r\n          </div>\r\n        ) : null}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport React from \"react\";\r\nimport { Modal } from \"@/components/ui/Modal\";\r\nimport { Button } from \"@/components/ui/Button\";\r\n\r\nexport function ConfirmDialog({\r\n  open,\r\n  title,\r\n  message,\r\n  confirmText = \"Confirm\",\r\n  confirmVariant = \"primary\",\r\n  cancelText = \"Cancel\",\r\n  busy = false,\r\n  onCancel,\r\n  onConfirm,\r\n}: {\r\n  open: boolean;\r\n  title: string;\r\n  message: React.ReactNode;\r\n  confirmText?: string;\r\n  confirmVariant?: \"primary\" | \"secondary\" | \"outline\" | \"ghost\";\r\n  cancelText?: string;\r\n  busy?: boolean;\r\n  onCancel: () => void;\r\n  onConfirm: () => void;\r\n}) {\r\n  return (\r\n    <Modal\r\n      open={open}\r\n      onClose={() => {\r\n        if (!busy) onCancel();\r\n      }}\r\n      title={title}\r\n      footer={\r\n        <div className=\"flex items-center justify-end gap-2\">\r\n          <Button variant=\"outline\" onClick={onCancel} disabled={busy}>\r\n            {cancelText}\r\n          </Button>\r\n          <Button variant={confirmVariant} onClick={onConfirm} disabled={busy}>\r\n            {busy ? \"Working...\" : confirmText}\r\n          </Button>\r\n        </div>\r\n      }\r\n    >\r\n      <div className=\"text-sm text-zinc-700\">{message}</div>\r\n    </Modal>\r\n  );\r\n}\r\n","export function formatMoney(args: {\r\n  amountCents: number | null | undefined;\r\n  currency: string | null | undefined;\r\n  fallback?: string;\r\n}): string {\r\n  const amountCents = args.amountCents;\r\n  const currency = args.currency?.toUpperCase() ?? null;\r\n\r\n  if (typeof amountCents !== \"number\" || !Number.isFinite(amountCents)) {\r\n    return args.fallback ?? \"—\";\r\n  }\r\n\r\n  const amount = amountCents / 100;\r\n\r\n  if (!currency || currency.length !== 3) {\r\n    return `${amount.toFixed(2)}`;\r\n  }\r\n\r\n  try {\r\n    return new Intl.NumberFormat(undefined, {\r\n      style: \"currency\",\r\n      currency,\r\n      minimumFractionDigits: 2,\r\n      maximumFractionDigits: 2,\r\n    }).format(amount);\r\n  } catch {\r\n    return `${currency} ${amount.toFixed(2)}`;\r\n  }\r\n}\r\n","export type DateFormatPreference = {\r\n  locale?: string;\r\n  dateStyle?: Intl.DateTimeFormatOptions[\"dateStyle\"];\r\n  timeStyle?: Intl.DateTimeFormatOptions[\"timeStyle\"];\r\n  hour12?: boolean;\r\n};\r\n\r\nconst DEFAULT_DATE_PREFERENCE: Required<DateFormatPreference> = {\r\n  locale: \"en-GB\",\r\n  dateStyle: \"medium\",\r\n  timeStyle: \"short\",\r\n  hour12: false,\r\n};\r\n\r\nfunction parseDate(value?: string | Date | null): Date | null {\r\n  if (!value) return null;\r\n  if (value instanceof Date) return Number.isFinite(value.getTime()) ? value : null;\r\n  const d = new Date(value);\r\n  return Number.isFinite(d.getTime()) ? d : null;\r\n}\r\n\r\nexport function formatDate(value?: string | Date | null, pref?: DateFormatPreference): string {\r\n  const d = parseDate(value);\r\n  if (!d) return \"—\";\r\n\r\n  const p = { ...DEFAULT_DATE_PREFERENCE, ...(pref ?? {}) };\r\n  return new Intl.DateTimeFormat(p.locale, { dateStyle: p.dateStyle }).format(d);\r\n}\r\n\r\nexport function formatDateTime(value?: string | Date | null, pref?: DateFormatPreference): string {\r\n  const d = parseDate(value);\r\n  if (!d) return \"—\";\r\n\r\n  const p = { ...DEFAULT_DATE_PREFERENCE, ...(pref ?? {}) };\r\n  return new Intl.DateTimeFormat(p.locale, { dateStyle: p.dateStyle, timeStyle: p.timeStyle, hour12: p.hour12 }).format(d);\r\n}\r\n","import { ApiError, apiDownload, apiFetch } from \"@/lib/api\";\r\nimport type {\r\n  BillingPlan,\r\n  BillingPlanVersion,\r\n  BillingPrice,\r\n  BillingInterval,\r\n  EntitlementDefinition,\r\n  Invoice,\r\n  Tenant,\r\n  TenantSubscription,\r\n  PlanEntitlement,\r\n} from \"@/lib/types\";\r\n\r\nexport type BillingCatalogPayload = {\r\n  billing_plans: BillingPlan[];\r\n  entitlement_definitions: EntitlementDefinition[];\r\n  billing_intervals?: BillingInterval[];\r\n};\r\n\r\nexport async function getBillingCatalog(args?: {\r\n  includeInactive?: boolean;\r\n}): Promise<BillingCatalogPayload> {\r\n  const qs = new URLSearchParams();\r\n  if (typeof args?.includeInactive === \"boolean\") {\r\n    qs.set(\"include_inactive\", args.includeInactive ? \"1\" : \"0\");\r\n  }\r\n\r\n  return apiFetch<BillingCatalogPayload>(`/api/admin/billing/catalog${qs.toString() ? `?${qs.toString()}` : \"\"}`);\r\n}\r\n\r\nexport async function listBillingIntervals(args?: { includeInactive?: boolean }): Promise<{ billing_intervals: BillingInterval[] }> {\r\n  const qs = new URLSearchParams();\r\n  if (typeof args?.includeInactive === \"boolean\") {\r\n    qs.set(\"include_inactive\", args.includeInactive ? \"1\" : \"0\");\r\n  }\r\n\r\n  return apiFetch<{ billing_intervals: BillingInterval[] }>(`/api/admin/billing/intervals${qs.toString() ? `?${qs.toString()}` : \"\"}`);\r\n}\r\n\r\nexport async function createBillingInterval(args: {\r\n  code?: string;\r\n  name: string;\r\n  months: number;\r\n  isActive?: boolean;\r\n}): Promise<{ interval: BillingInterval }> {\r\n  return apiFetch<{ interval: BillingInterval }>(\"/api/admin/billing/intervals\", {\r\n    method: \"POST\",\r\n    body: {\r\n      code: args.code?.trim() || undefined,\r\n      name: args.name,\r\n      months: args.months,\r\n      is_active: typeof args.isActive === \"boolean\" ? args.isActive : undefined,\r\n    },\r\n  });\r\n}\r\n\r\nexport async function updateBillingInterval(args: {\r\n  intervalId: number;\r\n  code: string;\r\n  name: string;\r\n  months: number;\r\n  isActive?: boolean;\r\n  reason?: string;\r\n}): Promise<{ interval: BillingInterval }> {\r\n  return apiFetch<{ interval: BillingInterval }>(`/api/admin/billing/intervals/${args.intervalId}`, {\r\n    method: \"PUT\",\r\n    body: {\r\n      code: args.code,\r\n      name: args.name,\r\n      months: args.months,\r\n      is_active: typeof args.isActive === \"boolean\" ? args.isActive : undefined,\r\n      reason: args.reason,\r\n    },\r\n  });\r\n}\r\n\r\nexport async function setBillingIntervalActive(args: {\r\n  intervalId: number;\r\n  isActive: boolean;\r\n  reason?: string;\r\n}): Promise<{ interval: BillingInterval }> {\r\n  return apiFetch<{ interval: BillingInterval }>(`/api/admin/billing/intervals/${args.intervalId}/active`, {\r\n    method: \"PATCH\",\r\n    body: {\r\n      is_active: args.isActive,\r\n      reason: args.reason,\r\n    },\r\n  });\r\n}\r\n\r\nexport async function createBillingPlan(args: {\r\n  name: string;\r\n  code?: string;\r\n  description?: string;\r\n  isActive?: boolean;\r\n}): Promise<{ plan: BillingPlan }> {\r\n  return apiFetch<{ plan: BillingPlan }>(\"/api/admin/billing/plans\", {\r\n    method: \"POST\",\r\n    body: {\r\n      name: args.name,\r\n      code: args.code?.trim() || undefined,\r\n      description: args.description?.trim() || undefined,\r\n      is_active: typeof args.isActive === \"boolean\" ? args.isActive : undefined,\r\n    },\r\n  });\r\n}\r\n\r\nexport async function updateBillingPlan(args: {\r\n  planId: number;\r\n  name: string;\r\n  code: string;\r\n  description?: string;\r\n  isActive?: boolean;\r\n  reason?: string;\r\n}): Promise<{ plan: BillingPlan }> {\r\n  return apiFetch<{ plan: BillingPlan }>(`/api/admin/billing/plans/${args.planId}`, {\r\n    method: \"PUT\",\r\n    body: {\r\n      name: args.name,\r\n      code: args.code,\r\n      description: args.description?.trim() || undefined,\r\n      is_active: typeof args.isActive === \"boolean\" ? args.isActive : undefined,\r\n      reason: args.reason,\r\n    },\r\n  });\r\n}\r\n\r\nexport async function createDraftBillingPlanVersionFromActive(args: {\r\n  planId: number;\r\n  reason?: string;\r\n}): Promise<{ version: BillingPlanVersion }> {\r\n  return apiFetch<{ version: BillingPlanVersion }>(`/api/admin/billing/plans/${args.planId}/versions/draft-from-active`, {\r\n    method: \"POST\",\r\n    body: {\r\n      reason: args.reason,\r\n    },\r\n  });\r\n}\r\n\r\nexport async function validateBillingPlanVersionDraft(args: {\r\n  versionId: number;\r\n  reason?: string;\r\n}): Promise<{ status: \"ok\" } | { message: string; errors?: string[] }> {\r\n  try {\r\n    return await apiFetch<{ status: \"ok\" } | { message: string; errors?: string[] }>(\r\n      `/api/admin/billing/versions/${args.versionId}/validate`,\r\n      {\r\n        method: \"POST\",\r\n        body: {\r\n          reason: args.reason,\r\n        },\r\n      },\r\n    );\r\n  } catch (e) {\r\n    if (e instanceof ApiError) {\r\n      const data: unknown = e.data;\r\n      if (data && typeof data === \"object\") {\r\n        const maybe = data as { status?: unknown; message?: unknown; errors?: unknown };\r\n        if (maybe.status === \"ok\") {\r\n          return { status: \"ok\" };\r\n        }\r\n        if (typeof maybe.message === \"string\") {\r\n          return {\r\n            message: maybe.message,\r\n            errors: Array.isArray(maybe.errors) ? maybe.errors.map(String) : undefined,\r\n          };\r\n        }\r\n      }\r\n    }\r\n    throw e;\r\n  }\r\n}\r\n\r\nexport async function syncBillingPlanVersionEntitlements(args: {\r\n  versionId: number;\r\n  entitlements: Array<Pick<PlanEntitlement, \"entitlement_definition_id\" | \"value_json\">>;\r\n  reason?: string;\r\n}): Promise<{ version: BillingPlanVersion }> {\r\n  return apiFetch<{ version: BillingPlanVersion }>(`/api/admin/billing/versions/${args.versionId}/entitlements/sync`, {\r\n    method: \"POST\",\r\n    body: {\r\n      entitlements: args.entitlements,\r\n      reason: args.reason,\r\n    },\r\n  });\r\n}\r\n\r\nexport async function createBillingPrice(args: {\r\n  versionId: number;\r\n  currency: string;\r\n  interval?: string;\r\n  billingIntervalId?: number | null;\r\n  amountCents: number;\r\n  trialDays?: number | null;\r\n  isDefault?: boolean;\r\n  reason?: string;\r\n}): Promise<{ price: BillingPrice; version: BillingPlanVersion }> {\r\n  return apiFetch<{ price: BillingPrice; version: BillingPlanVersion }>(`/api/admin/billing/versions/${args.versionId}/prices`, {\r\n    method: \"POST\",\r\n    body: {\r\n      currency: args.currency,\r\n      billing_interval_id: typeof args.billingIntervalId === \"number\" ? args.billingIntervalId : undefined,\r\n      interval: args.interval,\r\n      amount_cents: args.amountCents,\r\n      trial_days: typeof args.trialDays === \"number\" ? args.trialDays : undefined,\r\n      is_default: typeof args.isDefault === \"boolean\" ? args.isDefault : undefined,\r\n      reason: args.reason,\r\n    },\r\n  });\r\n}\r\n\r\nexport async function updateBillingPrice(args: {\r\n  priceId: number;\r\n  amountCents: number;\r\n  trialDays?: number | null;\r\n  isDefault?: boolean;\r\n  reason?: string;\r\n}): Promise<{ price: BillingPrice; version: BillingPlanVersion }> {\r\n  return apiFetch<{ price: BillingPrice; version: BillingPlanVersion }>(`/api/admin/billing/prices/${args.priceId}`, {\r\n    method: \"PATCH\",\r\n    body: {\r\n      amount_cents: args.amountCents,\r\n      trial_days: typeof args.trialDays === \"number\" ? args.trialDays : undefined,\r\n      is_default: typeof args.isDefault === \"boolean\" ? args.isDefault : undefined,\r\n      reason: args.reason,\r\n    },\r\n  });\r\n}\r\n\r\nexport async function deleteBillingPrice(args: {\r\n  priceId: number;\r\n  reason?: string;\r\n}): Promise<{ status: \"ok\"; version: BillingPlanVersion }> {\r\n  return apiFetch<{ status: \"ok\"; version: BillingPlanVersion }>(`/api/admin/billing/prices/${args.priceId}`, {\r\n    method: \"DELETE\",\r\n    body: {\r\n      reason: args.reason,\r\n    },\r\n  });\r\n}\r\n\r\nexport async function activateBillingPlanVersion(args: {\r\n  versionId: number;\r\n  confirm: string;\r\n  reason?: string;\r\n}): Promise<{ version: BillingPlanVersion }> {\r\n  return apiFetch<{ version: BillingPlanVersion }>(`/api/admin/billing/versions/${args.versionId}/activate`, {\r\n    method: \"POST\",\r\n    body: {\r\n      confirm: args.confirm,\r\n      reason: args.reason,\r\n    },\r\n  });\r\n}\r\n\r\nexport async function retireBillingPlanVersion(args: {\r\n  versionId: number;\r\n  reason?: string;\r\n}): Promise<{ version: BillingPlanVersion }> {\r\n  return apiFetch<{ version: BillingPlanVersion }>(`/api/admin/billing/versions/${args.versionId}/retire`, {\r\n    method: \"POST\",\r\n    body: {\r\n      reason: args.reason,\r\n    },\r\n  });\r\n}\r\n\r\nexport async function createEntitlementDefinition(args: {\r\n  code?: string;\r\n  name: string;\r\n  valueType: string;\r\n  description?: string;\r\n  isPremium?: boolean;\r\n}): Promise<{ definition: EntitlementDefinition }> {\r\n  return apiFetch<{ definition: EntitlementDefinition }>(\"/api/admin/billing/entitlement-definitions\", {\r\n    method: \"POST\",\r\n    body: {\r\n      code: args.code?.trim() || undefined,\r\n      name: args.name,\r\n      value_type: args.valueType,\r\n      description: args.description?.trim() || undefined,\r\n      is_premium: typeof args.isPremium === \"boolean\" ? args.isPremium : undefined,\r\n    },\r\n  });\r\n}\r\n\r\nexport async function updateEntitlementDefinition(args: {\r\n  id: number;\r\n  code: string;\r\n  name: string;\r\n  valueType: string;\r\n  description?: string;\r\n  isPremium?: boolean;\r\n  reason?: string;\r\n}): Promise<{ definition: EntitlementDefinition }> {\r\n  return apiFetch<{ definition: EntitlementDefinition }>(`/api/admin/billing/entitlement-definitions/${args.id}`, {\r\n    method: \"PUT\",\r\n    body: {\r\n      code: args.code,\r\n      name: args.name,\r\n      value_type: args.valueType,\r\n      description: args.description?.trim() || undefined,\r\n      is_premium: typeof args.isPremium === \"boolean\" ? args.isPremium : undefined,\r\n      reason: args.reason,\r\n    },\r\n  });\r\n}\r\n\r\nexport async function deleteEntitlementDefinition(args: {\r\n  id: number;\r\n  reason?: string;\r\n}): Promise<{ status: \"ok\" }> {\r\n  return apiFetch<{ status: \"ok\" }>(`/api/admin/billing/entitlement-definitions/${args.id}`, {\r\n    method: \"DELETE\",\r\n    body: {\r\n      reason: args.reason,\r\n    },\r\n  });\r\n}\r\n\r\nexport type TenantSubscriptionsPayload = {\r\n  tenant: Tenant;\r\n  subscriptions: TenantSubscription[];\r\n};\r\n\r\nexport async function getTenantSubscriptions(tenantId: number): Promise<TenantSubscriptionsPayload> {\r\n  return apiFetch<TenantSubscriptionsPayload>(`/api/admin/businesses/${tenantId}/subscriptions`);\r\n}\r\n\r\nexport async function assignTenantSubscription(args: {\r\n  tenantId: number;\r\n  billingPlanVersionId: number;\r\n  billingPriceId: number;\r\n  reason?: string;\r\n}): Promise<{ subscription: TenantSubscription }> {\r\n  return apiFetch<{ subscription: TenantSubscription }>(`/api/admin/businesses/${args.tenantId}/subscriptions`, {\r\n    method: \"POST\",\r\n    body: {\r\n      billing_plan_version_id: args.billingPlanVersionId,\r\n      billing_price_id: args.billingPriceId,\r\n      reason: args.reason,\r\n    },\r\n  });\r\n}\r\n\r\nexport async function cancelTenantSubscription(args: {\r\n  tenantId: number;\r\n  subscriptionId: number;\r\n  atPeriodEnd?: boolean;\r\n  reason?: string;\r\n}): Promise<{ subscription: TenantSubscription }> {\r\n  return apiFetch<{ subscription: TenantSubscription }>(\r\n    `/api/admin/businesses/${args.tenantId}/subscriptions/${args.subscriptionId}/cancel`,\r\n    {\r\n      method: \"POST\",\r\n      body: {\r\n        at_period_end: typeof args.atPeriodEnd === \"boolean\" ? args.atPeriodEnd : undefined,\r\n        reason: args.reason,\r\n      },\r\n    },\r\n  );\r\n}\r\n\r\nexport type TenantInvoicesPayload = {\r\n  tenant: Tenant;\r\n  invoices: Invoice[];\r\n};\r\n\r\nexport async function getTenantInvoices(args: {\r\n  tenantId: number;\r\n  status?: string;\r\n  limit?: number;\r\n}): Promise<TenantInvoicesPayload> {\r\n  const qs = new URLSearchParams();\r\n  if (args.status && args.status.trim().length > 0) qs.set(\"status\", args.status.trim());\r\n  if (typeof args.limit === \"number\" && Number.isFinite(args.limit)) qs.set(\"limit\", String(args.limit));\r\n\r\n  return apiFetch<TenantInvoicesPayload>(`/api/admin/businesses/${args.tenantId}/invoices${qs.toString() ? `?${qs.toString()}` : \"\"}`);\r\n}\r\n\r\nexport async function getTenantInvoice(args: {\r\n  tenantId: number;\r\n  invoiceId: number;\r\n}): Promise<{ tenant: Tenant; invoice: Invoice }> {\r\n  return apiFetch<{ tenant: Tenant; invoice: Invoice }>(`/api/admin/businesses/${args.tenantId}/invoices/${args.invoiceId}`);\r\n}\r\n\r\nexport async function createInvoiceFromSubscription(args: {\r\n  tenantId: number;\r\n  tenantSubscriptionId: number;\r\n  reason?: string;\r\n}): Promise<{ invoice: Invoice }> {\r\n  return apiFetch<{ invoice: Invoice }>(`/api/admin/businesses/${args.tenantId}/invoices`, {\r\n    method: \"POST\",\r\n    body: {\r\n      tenant_subscription_id: args.tenantSubscriptionId,\r\n      reason: args.reason,\r\n    },\r\n  });\r\n}\r\n\r\nexport async function issueInvoice(args: {\r\n  tenantId: number;\r\n  invoiceId: number;\r\n  reason?: string;\r\n}): Promise<{ invoice: Invoice }> {\r\n  return apiFetch<{ invoice: Invoice }>(`/api/admin/businesses/${args.tenantId}/invoices/${args.invoiceId}/issue`, {\r\n    method: \"POST\",\r\n    body: {\r\n      reason: args.reason,\r\n    },\r\n  });\r\n}\r\n\r\nexport async function markInvoicePaid(args: {\r\n  tenantId: number;\r\n  invoiceId: number;\r\n  paidAt?: string;\r\n  paidMethod?: string;\r\n  paidNote?: string;\r\n  reason?: string;\r\n}): Promise<{ invoice: Invoice }> {\r\n  return apiFetch<{ invoice: Invoice }>(`/api/admin/businesses/${args.tenantId}/invoices/${args.invoiceId}/paid`, {\r\n    method: \"POST\",\r\n    body: {\r\n      paid_at: args.paidAt,\r\n      paid_method: args.paidMethod,\r\n      paid_note: args.paidNote,\r\n      reason: args.reason,\r\n    },\r\n  });\r\n}\r\n\r\nexport async function downloadInvoicePdf(args: {\r\n  tenantId: number;\r\n  invoiceId: number;\r\n  invoiceNumber?: string | null;\r\n}): Promise<void> {\r\n  const filename = args.invoiceNumber ? `invoice_${args.invoiceNumber}.pdf` : \"invoice.pdf\";\r\n\r\n  await apiDownload(`/api/admin/businesses/${args.tenantId}/invoices/${args.invoiceId}/pdf`, {\r\n    filename,\r\n  });\r\n}\r\n","\"use client\";\r\n\r\nimport React, { useEffect, useMemo, useState } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { useParams } from \"next/navigation\";\r\nimport { RequireAuth } from \"@/components/RequireAuth\";\r\nimport { useDashboardHeader } from \"@/components/DashboardShell\";\r\nimport { Alert } from \"@/components/ui/Alert\";\r\nimport { Badge } from \"@/components/ui/Badge\";\r\nimport { Button } from \"@/components/ui/Button\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/Card\";\r\nimport { ConfirmDialog } from \"@/components/ui/ConfirmDialog\";\r\nimport { Modal } from \"@/components/ui/Modal\";\r\nimport { Input } from \"@/components/ui/Input\";\r\nimport { formatDateTime } from \"@/lib/datetime\";\r\nimport { getBillingCatalog, getTenantSubscriptions, assignTenantSubscription, cancelTenantSubscription } from \"@/lib/billing\";\r\nimport { formatMoney } from \"@/lib/money\";\r\nimport type { BillingPlan, BillingPlanVersion, BillingPrice, Tenant, TenantSubscription } from \"@/lib/types\";\r\n\r\nexport default function AdminTenantBillingOverviewPage() {\r\n  const params = useParams() as { business?: string };\r\n  const tenantId = Number(params.business);\r\n  const dashboardHeader = useDashboardHeader();\r\n\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const [tenant, setTenant] = useState<Tenant | null>(null);\r\n  const [subscriptions, setSubscriptions] = useState<TenantSubscription[]>([]);\r\n\r\n  const [catalogLoading, setCatalogLoading] = useState(true);\r\n  const [catalogError, setCatalogError] = useState<string | null>(null);\r\n  const [plans, setPlans] = useState<BillingPlan[]>([]);\r\n\r\n  const [reloadNonce, setReloadNonce] = useState(0);\r\n\r\n  const [assignOpen, setAssignOpen] = useState(false);\r\n  const [assignBusy, setAssignBusy] = useState(false);\r\n  const [assignError, setAssignError] = useState<string | null>(null);\r\n\r\n  const [selectedPlanId, setSelectedPlanId] = useState<string>(\"\");\r\n  const [selectedVersionId, setSelectedVersionId] = useState<string>(\"\");\r\n  const [selectedPriceId, setSelectedPriceId] = useState<string>(\"\");\r\n  const [reason, setReason] = useState<string>(\"\");\r\n\r\n  const [cancelConfirmOpen, setCancelConfirmOpen] = useState(false);\r\n  const [cancelBusy, setCancelBusy] = useState(false);\r\n  const [cancelAtPeriodEnd, setCancelAtPeriodEnd] = useState(true);\r\n\r\n  useEffect(() => {\r\n    dashboardHeader.setHeader({\r\n      breadcrumb: \"Admin / Businesses\",\r\n      title: tenant ? `${tenant.name} — Billing` : `Business ${tenantId} — Billing`,\r\n      subtitle: tenant ? `Business ID ${tenant.id} • ${tenant.slug}` : undefined,\r\n      actions: (\r\n        <div className=\"flex items-center gap-2\">\r\n          <Link href={`/admin/businesses/${tenantId}`}>\r\n            <Button variant=\"outline\" size=\"sm\">\r\n              Back\r\n            </Button>\r\n          </Link>\r\n          <Button variant=\"outline\" size=\"sm\" onClick={() => setReloadNonce((v) => v + 1)} disabled={loading || catalogLoading}>\r\n            Refresh\r\n          </Button>\r\n        </div>\r\n      ),\r\n    });\r\n\r\n    return () => dashboardHeader.setHeader(null);\r\n  }, [catalogLoading, dashboardHeader, loading, tenant, tenantId]);\r\n\r\n  useEffect(() => {\r\n    let alive = true;\r\n\r\n    async function loadTenantSubs() {\r\n      if (!Number.isFinite(tenantId) || tenantId <= 0) {\r\n        setError(\"Invalid business id.\");\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        setLoading(true);\r\n        setError(null);\r\n\r\n        const res = await getTenantSubscriptions(tenantId);\r\n        if (!alive) return;\r\n\r\n        setTenant(res.tenant);\r\n        setSubscriptions(Array.isArray(res.subscriptions) ? res.subscriptions : []);\r\n      } catch (e) {\r\n        if (!alive) return;\r\n        setError(e instanceof Error ? e.message : \"Failed to load subscriptions.\");\r\n        setTenant(null);\r\n        setSubscriptions([]);\r\n      } finally {\r\n        if (!alive) return;\r\n        setLoading(false);\r\n      }\r\n    }\r\n\r\n    void loadTenantSubs();\r\n\r\n    return () => {\r\n      alive = false;\r\n    };\r\n  }, [tenantId, reloadNonce]);\r\n\r\n  useEffect(() => {\r\n    let alive = true;\r\n\r\n    async function loadCatalog() {\r\n      try {\r\n        setCatalogLoading(true);\r\n        setCatalogError(null);\r\n\r\n        const res = await getBillingCatalog({ includeInactive: true });\r\n        if (!alive) return;\r\n\r\n        setPlans(Array.isArray(res.billing_plans) ? res.billing_plans : []);\r\n      } catch (e) {\r\n        if (!alive) return;\r\n        setCatalogError(e instanceof Error ? e.message : \"Failed to load billing catalog.\");\r\n        setPlans([]);\r\n      } finally {\r\n        if (!alive) return;\r\n        setCatalogLoading(false);\r\n      }\r\n    }\r\n\r\n    void loadCatalog();\r\n\r\n    return () => {\r\n      alive = false;\r\n    };\r\n  }, [reloadNonce]);\r\n\r\n  const currentSubscription = useMemo(() => {\r\n    const sorted = (Array.isArray(subscriptions) ? subscriptions : []).slice().sort((a, b) => (b.id ?? 0) - (a.id ?? 0));\r\n    return sorted[0] ?? null;\r\n  }, [subscriptions]);\r\n\r\n  const tenantCurrency = (tenant?.currency ?? \"\").toUpperCase();\r\n\r\n  const selectedPlan = useMemo(() => {\r\n    const id = Number(selectedPlanId);\r\n    return plans.find((p) => p.id === id) ?? null;\r\n  }, [plans, selectedPlanId]);\r\n\r\n  const versionsForSelectedPlan = useMemo(() => {\r\n    return Array.isArray(selectedPlan?.versions) ? selectedPlan?.versions ?? [] : [];\r\n  }, [selectedPlan]);\r\n\r\n  const selectedVersion = useMemo(() => {\r\n    const id = Number(selectedVersionId);\r\n    return versionsForSelectedPlan.find((v) => v.id === id) ?? null;\r\n  }, [selectedVersionId, versionsForSelectedPlan]);\r\n\r\n  const pricesForSelectedVersion = useMemo(() => {\r\n    const prices = Array.isArray(selectedVersion?.prices) ? selectedVersion?.prices ?? [] : [];\r\n    if (tenantCurrency.length === 3) {\r\n      return prices.filter((p) => String(p.currency).toUpperCase() === tenantCurrency);\r\n    }\r\n    return prices;\r\n  }, [selectedVersion, tenantCurrency]);\r\n\r\n  const selectedPrice = useMemo(() => {\r\n    const id = Number(selectedPriceId);\r\n    return pricesForSelectedVersion.find((p) => p.id === id) ?? null;\r\n  }, [pricesForSelectedVersion, selectedPriceId]);\r\n\r\n  function resetAssignForm() {\r\n    setAssignError(null);\r\n    setSelectedPlanId(\"\");\r\n    setSelectedVersionId(\"\");\r\n    setSelectedPriceId(\"\");\r\n  }\r\n\r\n  async function onOpenAssign() {\r\n    setAssignOpen(true);\r\n    resetAssignForm();\r\n  }\r\n\r\n  async function onAssign() {\r\n    if (!Number.isFinite(tenantId) || tenantId <= 0) return;\r\n    if (!selectedVersion || !selectedPrice) {\r\n      setAssignError(\"Please select a plan version and a price.\");\r\n      return;\r\n    }\r\n\r\n    setAssignBusy(true);\r\n    setAssignError(null);\r\n\r\n    try {\r\n      await assignTenantSubscription({\r\n        tenantId,\r\n        billingPlanVersionId: selectedVersion.id,\r\n        billingPriceId: selectedPrice.id,\r\n        reason: reason.trim() || undefined,\r\n      });\r\n\r\n      setAssignOpen(false);\r\n      setReloadNonce((v) => v + 1);\r\n    } catch (e) {\r\n      setAssignError(e instanceof Error ? e.message : \"Failed to assign subscription.\");\r\n    } finally {\r\n      setAssignBusy(false);\r\n    }\r\n  }\r\n\r\n  async function onConfirmCancel() {\r\n    if (!currentSubscription) return;\r\n    if (!Number.isFinite(tenantId) || tenantId <= 0) return;\r\n\r\n    setCancelBusy(true);\r\n\r\n    try {\r\n      await cancelTenantSubscription({\r\n        tenantId,\r\n        subscriptionId: currentSubscription.id,\r\n        atPeriodEnd: cancelAtPeriodEnd,\r\n        reason: reason.trim() || undefined,\r\n      });\r\n\r\n      setCancelConfirmOpen(false);\r\n      setReloadNonce((v) => v + 1);\r\n    } catch (e) {\r\n      setError(e instanceof Error ? e.message : \"Failed to cancel subscription.\");\r\n    } finally {\r\n      setCancelBusy(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <RequireAuth requiredPermission=\"admin.billing.read\">\r\n      <div className=\"space-y-6\">\r\n        {error ? (\r\n          <Alert variant=\"danger\" title=\"Billing could not be loaded\">\r\n            {error}\r\n          </Alert>\r\n        ) : null}\r\n\r\n        {catalogError ? (\r\n          <Alert variant=\"danger\" title=\"Billing catalog could not be loaded\">\r\n            {catalogError}\r\n          </Alert>\r\n        ) : null}\r\n\r\n        <div className=\"grid grid-cols-1 gap-6 lg:grid-cols-3\">\r\n          <Card className=\"lg:col-span-2\">\r\n            <CardHeader className=\"flex flex-row items-start justify-between gap-4\">\r\n              <div className=\"min-w-0\">\r\n                <CardTitle className=\"truncate\">Subscription</CardTitle>\r\n                <div className=\"mt-1 text-sm text-zinc-600\">Current subscription and assignment actions</div>\r\n              </div>\r\n              <div className=\"flex items-center gap-2\">\r\n                <Link href={`/admin/businesses/${tenantId}/billing/invoices`}>\r\n                  <Button variant=\"outline\" size=\"sm\">\r\n                    Invoices\r\n                  </Button>\r\n                </Link>\r\n                <Button variant=\"secondary\" size=\"sm\" onClick={onOpenAssign} disabled={catalogLoading || loading}>\r\n                  Assign / Change\r\n                </Button>\r\n              </div>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-4\">\r\n              {loading ? <div className=\"text-sm text-zinc-500\">Loading subscription…</div> : null}\r\n\r\n              {!loading && !currentSubscription ? <div className=\"text-sm text-zinc-600\">No subscription assigned yet.</div> : null}\r\n\r\n              {currentSubscription ? (\r\n                <div className=\"grid grid-cols-1 gap-4 sm:grid-cols-2\">\r\n                  <div>\r\n                    <div className=\"text-xs text-zinc-500\">Plan</div>\r\n                    <div className=\"mt-1 text-sm text-zinc-800\">{currentSubscription.plan_version?.plan?.name ?? \"—\"}</div>\r\n                    <div className=\"mt-1 text-xs text-zinc-500\">Version ID: {currentSubscription.billing_plan_version_id}</div>\r\n                  </div>\r\n\r\n                  <div>\r\n                    <div className=\"text-xs text-zinc-500\">Status</div>\r\n                    <div className=\"mt-1\">\r\n                      <Badge variant={currentSubscription.status === \"active\" ? \"success\" : \"default\"}>{currentSubscription.status}</Badge>\r\n                    </div>\r\n                    {currentSubscription.cancel_at_period_end ? (\r\n                      <div className=\"mt-1 text-xs text-amber-700\">Cancel at period end</div>\r\n                    ) : null}\r\n                  </div>\r\n\r\n                  <div>\r\n                    <div className=\"text-xs text-zinc-500\">Price</div>\r\n                    <div className=\"mt-1 text-sm text-zinc-800\">\r\n                      {currentSubscription.price\r\n                        ? `${formatMoney({ amountCents: currentSubscription.price.amount_cents, currency: currentSubscription.price.currency })} / ${currentSubscription.price.interval}`\r\n                        : \"—\"}\r\n                    </div>\r\n                    <div className=\"mt-1 text-xs text-zinc-500\">Currency: {currentSubscription.currency ?? \"—\"}</div>\r\n                  </div>\r\n\r\n                  <div>\r\n                    <div className=\"text-xs text-zinc-500\">Period</div>\r\n                    <div className=\"mt-1 text-sm text-zinc-800\">\r\n                      {formatDateTime(currentSubscription.current_period_start ?? null)} → {formatDateTime(currentSubscription.current_period_end ?? null)}\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"sm:col-span-2\">\r\n                    <div className=\"flex flex-wrap items-center gap-2\">\r\n                      <Button\r\n                        variant=\"outline\"\r\n                        size=\"sm\"\r\n                        onClick={() => setCancelConfirmOpen(true)}\r\n                        disabled={cancelBusy}\r\n                      >\r\n                        Cancel subscription\r\n                      </Button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ) : null}\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle>Tenant billing profile</CardTitle>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-3\">\r\n              <div>\r\n                <div className=\"text-xs text-zinc-500\">Currency</div>\r\n                <div className=\"mt-1 text-sm text-zinc-800\">{tenantCurrency || \"—\"}</div>\r\n              </div>\r\n              <div>\r\n                <div className=\"text-xs text-zinc-500\">Billing country</div>\r\n                <div className=\"mt-1 text-sm text-zinc-800\">{tenant?.billing_country ?? \"—\"}</div>\r\n              </div>\r\n              <div>\r\n                <div className=\"text-xs text-zinc-500\">VAT number</div>\r\n                <div className=\"mt-1 text-sm text-zinc-800\">{tenant?.billing_vat_number ?? \"—\"}</div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n\r\n        <Modal\r\n          open={assignOpen}\r\n          onClose={() => {\r\n            if (!assignBusy) setAssignOpen(false);\r\n          }}\r\n          title=\"Assign / Change subscription\"\r\n          footer={\r\n            <div className=\"flex items-center justify-end gap-2\">\r\n              <Button\r\n                variant=\"outline\"\r\n                onClick={() => {\r\n                  if (!assignBusy) setAssignOpen(false);\r\n                }}\r\n                disabled={assignBusy}\r\n              >\r\n                Cancel\r\n              </Button>\r\n              <Button variant=\"primary\" onClick={onAssign} disabled={assignBusy}>\r\n                {assignBusy ? \"Saving…\" : \"Save\"}\r\n              </Button>\r\n            </div>\r\n          }\r\n        >\r\n          <div className=\"space-y-4\">\r\n            {assignError ? (\r\n              <Alert variant=\"danger\" title=\"Cannot assign subscription\">\r\n                {assignError}\r\n              </Alert>\r\n            ) : null}\r\n\r\n            <div>\r\n              <div className=\"text-sm font-medium text-[var(--rb-text)]\">Tenant currency</div>\r\n              <div className=\"mt-1 text-sm text-zinc-700\">{tenantCurrency || \"—\"} (prices are filtered to match)</div>\r\n            </div>\r\n\r\n            <div className=\"space-y-1\">\r\n              <label className=\"text-sm font-medium\">Plan</label>\r\n              <select\r\n                className=\"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm\"\r\n                value={selectedPlanId}\r\n                onChange={(e) => {\r\n                  setSelectedPlanId(e.target.value);\r\n                  setSelectedVersionId(\"\");\r\n                  setSelectedPriceId(\"\");\r\n                }}\r\n                disabled={catalogLoading || assignBusy}\r\n              >\r\n                <option value=\"\">— Select plan —</option>\r\n                {plans.map((p) => (\r\n                  <option key={p.id} value={String(p.id)}>\r\n                    {p.name} ({p.code})\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n\r\n            <div className=\"space-y-1\">\r\n              <label className=\"text-sm font-medium\">Plan version</label>\r\n              <select\r\n                className=\"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm\"\r\n                value={selectedVersionId}\r\n                onChange={(e) => {\r\n                  setSelectedVersionId(e.target.value);\r\n                  setSelectedPriceId(\"\");\r\n                }}\r\n                disabled={!selectedPlan || assignBusy}\r\n              >\r\n                <option value=\"\">— Select version —</option>\r\n                {versionsForSelectedPlan.map((v: BillingPlanVersion) => (\r\n                  <option key={v.id} value={String(v.id)}>\r\n                    v{v.version} ({v.status})\r\n                  </option>\r\n                ))}\r\n              </select>\r\n              {selectedPlan && versionsForSelectedPlan.length === 0 ? (\r\n                <div className=\"text-xs text-zinc-500\">No versions available for this plan.</div>\r\n              ) : null}\r\n            </div>\r\n\r\n            <div className=\"space-y-1\">\r\n              <label className=\"text-sm font-medium\">Price</label>\r\n              <select\r\n                className=\"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm\"\r\n                value={selectedPriceId}\r\n                onChange={(e) => setSelectedPriceId(e.target.value)}\r\n                disabled={!selectedVersion || assignBusy}\r\n              >\r\n                <option value=\"\">— Select price —</option>\r\n                {pricesForSelectedVersion.map((p: BillingPrice) => (\r\n                  <option key={p.id} value={String(p.id)}>\r\n                    {formatMoney({ amountCents: p.amount_cents, currency: p.currency })} / {p.interval}\r\n                    {p.is_default ? \" (default)\" : \"\"}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n              {selectedVersion && pricesForSelectedVersion.length === 0 ? (\r\n                <div className=\"text-xs text-amber-700\">\r\n                  No prices found for this version{tenantCurrency ? ` in ${tenantCurrency}` : \"\"}.\r\n                </div>\r\n              ) : null}\r\n            </div>\r\n\r\n            <div className=\"space-y-1\">\r\n              <label className=\"text-sm font-medium\">Reason (optional)</label>\r\n              <Input value={reason} onChange={(e) => setReason(e.target.value)} placeholder=\"Support / plan change reason…\" />\r\n            </div>\r\n          </div>\r\n        </Modal>\r\n\r\n        <ConfirmDialog\r\n          open={cancelConfirmOpen}\r\n          title=\"Cancel subscription\"\r\n          message={\r\n            <div className=\"space-y-3\">\r\n              <div>This will cancel the current subscription for this tenant.</div>\r\n              <label className=\"flex items-center gap-2 text-sm\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={cancelAtPeriodEnd}\r\n                  onChange={(e) => setCancelAtPeriodEnd(e.target.checked)}\r\n                  disabled={cancelBusy}\r\n                />\r\n                Cancel at period end\r\n              </label>\r\n            </div>\r\n          }\r\n          confirmText=\"Cancel subscription\"\r\n          confirmVariant=\"secondary\"\r\n          busy={cancelBusy}\r\n          onCancel={() => {\r\n            if (!cancelBusy) setCancelConfirmOpen(false);\r\n          }}\r\n          onConfirm={() => void onConfirmCancel()}\r\n        />\r\n      </div>\r\n    </RequireAuth>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}