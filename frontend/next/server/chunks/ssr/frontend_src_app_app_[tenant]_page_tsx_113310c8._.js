module.exports=[63787,a=>{"use strict";var b=a.i(57850),c=a.i(34075),d=a.i(17933),e=a.i(97867),f=a.i(4600),g=a.i(54177),h=a.i(648),i=a.i(26606),j=a.i(93609),k=a.i(45056);function l(a,b){let c="string"==typeof b&&b.trim().length>0?b.toUpperCase():"USD",d=Number.isFinite(a)?a:0;try{return new Intl.NumberFormat(void 0,{style:"currency",currency:c,maximumFractionDigits:2}).format(d/100)}catch{return`${c} ${(d/100).toFixed(2)}`}}function m({title:a,subtitle:c}){return(0,b.jsx)(f.Card,{className:"shadow-none",children:(0,b.jsxs)(f.CardContent,{className:"pt-5",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-baseline justify-between gap-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:a}),(0,b.jsx)("div",{className:"mt-1 text-sm text-zinc-600",children:c})]}),(0,b.jsx)(d.Badge,{variant:"default",children:"Mock"})]}),(0,b.jsx)("div",{className:"mt-4 h-40 w-full rounded-[var(--rb-radius-lg)] border border-[var(--rb-border)] bg-[var(--rb-surface-muted)]"})]})})}function n(a){if(!a)return"—";let b=new Date(a);if(Number.isNaN(b.getTime()))return"—";try{return b.toLocaleDateString(void 0,{month:"short",day:"numeric"})}catch{return"—"}}function o(){return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:Array.from({length:4}).map((a,c)=>(0,b.jsx)(f.Card,{className:"relative overflow-hidden shadow-none",children:(0,b.jsx)(f.CardContent,{className:"pt-5",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)(i.Skeleton,{className:"h-3 w-24 rounded-[var(--rb-radius-sm)]"}),(0,b.jsx)("div",{className:"mt-2",children:(0,b.jsx)(i.Skeleton,{className:"h-8 w-28 rounded-[var(--rb-radius-sm)]"})})]}),(0,b.jsx)(i.Skeleton,{className:"h-5 w-16 rounded-full"})]})})},c))}),(0,b.jsxs)("div",{className:"grid gap-4 lg:grid-cols-3",children:[(0,b.jsx)(f.Card,{className:"shadow-none lg:col-span-2",children:(0,b.jsxs)(f.CardContent,{className:"pt-5",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-baseline justify-between gap-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Skeleton,{className:"h-4 w-36 rounded-[var(--rb-radius-sm)]"}),(0,b.jsx)(i.Skeleton,{className:"mt-2 h-4 w-56 rounded-[var(--rb-radius-sm)]"})]}),(0,b.jsx)(i.Skeleton,{className:"h-5 w-14 rounded-full"})]}),(0,b.jsx)("div",{className:"mt-4",children:(0,b.jsx)(i.Skeleton,{className:"h-40 w-full rounded-[var(--rb-radius-lg)] border border-[var(--rb-border)]"})})]})}),(0,b.jsx)(f.Card,{className:"shadow-none",children:(0,b.jsxs)(f.CardContent,{className:"pt-5",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-baseline justify-between gap-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Skeleton,{className:"h-4 w-32 rounded-[var(--rb-radius-sm)]"}),(0,b.jsx)(i.Skeleton,{className:"mt-2 h-4 w-48 rounded-[var(--rb-radius-sm)]"})]}),(0,b.jsx)(i.Skeleton,{className:"h-5 w-14 rounded-full"})]}),(0,b.jsx)("div",{className:"mt-4",children:(0,b.jsx)(i.Skeleton,{className:"h-40 w-full rounded-[var(--rb-radius-lg)] border border-[var(--rb-border)]"})})]})})]}),(0,b.jsxs)("div",{className:"grid gap-4 lg:grid-cols-3",children:[(0,b.jsxs)("div",{className:"lg:col-span-2 space-y-4",children:[(0,b.jsx)(i.TableSkeleton,{rows:6,columns:5}),(0,b.jsx)(i.TableSkeleton,{rows:6,columns:5})]}),(0,b.jsx)(f.Card,{className:"shadow-none",children:(0,b.jsxs)(f.CardContent,{className:"pt-5",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Skeleton,{className:"h-4 w-36 rounded-[var(--rb-radius-sm)]"}),(0,b.jsx)(i.Skeleton,{className:"mt-2 h-4 w-44 rounded-[var(--rb-radius-sm)]"})]}),(0,b.jsx)(i.Skeleton,{className:"h-9 w-20 rounded-[var(--rb-radius-sm)]"})]}),(0,b.jsx)("div",{className:"mt-4 space-y-3",children:Array.from({length:5}).map((a,c)=>(0,b.jsx)("div",{className:"rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-white p-3",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)(i.Skeleton,{className:"h-4 w-3/4 rounded-[var(--rb-radius-sm)]"}),(0,b.jsx)(i.Skeleton,{className:"mt-2 h-4 w-full rounded-[var(--rb-radius-sm)]"}),(0,b.jsx)(i.Skeleton,{className:"mt-2 h-3 w-24 rounded-[var(--rb-radius-sm)]"})]}),(0,b.jsx)(i.Skeleton,{className:"h-5 w-16 rounded-full"})]})},c))})]})})]})]})}function p(){let a=(0,j.useParams)(),i=a.business??a.tenant,[p,q]=(0,k.useState)(!0),[r,s]=(0,k.useState)(null),[t,u]=(0,k.useState)(null);(0,k.useEffect)(()=>{let a=!0;async function b(){try{q(!0);let b=await (0,c.apiFetch)(`/api/${i}/app/dashboard`);if(!a)return;s(b)}catch(b){if(!a)return;u(b instanceof Error?b.message:"Failed to load dashboard.")}finally{if(!a)return;q(!1)}}return"string"==typeof i&&i.length>0?b():(q(!1),u("Tenant is missing.")),()=>{a=!1}},[i]);let v=r?.user?.role==="customer",w=k.default.useMemo(()=>{let a=r?.metrics,b=Number.isFinite(a?.active_jobs_count)?a?.active_jobs_count??0:0,c=Number.isFinite(a?.completed_jobs_count)?a?.completed_jobs_count??0:0,d=Number.isFinite(a?.pending_estimates_count)?a?.pending_estimates_count??0:0,e=Number.isFinite(a?.revenue_last_30d?.amount_cents)?a?.revenue_last_30d?.amount_cents??0:0,f=a?.revenue_last_30d?.currency??r?.tenant?.currency??"USD";return{activeJobs:Math.max(0,b),completedJobs:Math.max(0,c),pendingEstimates:Math.max(0,d),revenue:l(e,f),revenueCurrency:"string"==typeof f?f.toUpperCase():(r?.tenant?.currency??"USD").toUpperCase()}},[r?.metrics,r?.tenant?.currency]),x=k.default.useMemo(()=>{let a=r?.recent?.jobs;return Array.isArray(a)?a.filter(a=>a&&"number"==typeof a.id).map(a=>{let b="string"==typeof a.currency&&a.currency?a.currency:r?.tenant?.currency??"USD",c="number"==typeof a.total_cents&&Number.isFinite(a.total_cents)?a.total_cents:0;return{id:"string"==typeof a.case_number&&a.case_number?a.case_number:`#${a.id}`,title:"string"==typeof a.title?a.title:"",status:"string"==typeof a.status?a.status:"",total:l(c,b),date:n(a.updated_at)}}):[]},[r?.recent?.jobs,r?.tenant?.currency]),y=k.default.useMemo(()=>{let a=r?.recent?.estimates;return Array.isArray(a)?a.filter(a=>a&&"number"==typeof a.id).map(a=>{let b="string"==typeof a.currency&&a.currency?a.currency:r?.tenant?.currency??"USD",c="number"==typeof a.total_cents&&Number.isFinite(a.total_cents)?a.total_cents:0;return{id:"string"==typeof a.case_number&&a.case_number?a.case_number:`#${a.id}`,title:"string"==typeof a.title?a.title:"",status:"string"==typeof a.status?a.status:"",total:l(c,b),date:n(a.updated_at)}}):[]},[r?.recent?.estimates,r?.tenant?.currency]),z=k.default.useMemo(()=>{let a=r?.activity;if(!Array.isArray(a))return[];let b=a.filter(a=>a&&"number"==typeof a.id).map(a=>{let b=("string"==typeof a.summary&&a.summary.trim().length>0?a.summary.trim():null)??("string"==typeof a.event_type&&a.event_type.trim().length>0?a.event_type.trim():"Activity"),c=("string"==typeof a.description&&a.description.trim().length>0?a.description.trim():null)??("string"==typeof a.entity_type&&a.entity_type.trim().length>0?`${a.entity_type} #${a.entity_id}`:null),d="string"==typeof a.visibility&&a.visibility?a.visibility:"public";return{id:String(a.id),type:"private"===d?"private":"public",title:b,description:c??"",occurred_at:function(a){if(!a)return"—";let b=new Date(a);if(Number.isNaN(b.getTime()))return"—";let c=Math.floor((Date.now()-b.getTime())/1e3);if(c<60)return"Just now";let d=Math.floor(c/60);if(d<60)return`${d} min ago`;let e=Math.floor(d/60);if(e<24)return`${e} hr ago`;let f=Math.floor(e/24);return f<7?`${f} day${1===f?"":"s"} ago`:n(a)}(a.created_at)}});return v?b.filter(a=>"public"===a.type):b},[r?.activity,v]),A=k.default.useMemo(()=>[{id:"id",header:"Job",cell:a=>(0,b.jsx)("span",{className:"font-medium text-[var(--rb-text)]",children:a.id})},{id:"title",header:"Title",cell:a=>(0,b.jsx)("span",{className:"text-zinc-700",children:a.title})},{id:"status",header:"Status",cell:a=>(0,b.jsx)(d.Badge,{variant:a.status.toLowerCase().includes("deliver")?"success":a.status.toLowerCase().includes("diagn")?"info":"default",children:a.status})},{id:"total",header:"Total",cell:a=>(0,b.jsx)("span",{className:"text-zinc-700",children:a.total}),className:"text-right"},{id:"date",header:"Date",cell:a=>(0,b.jsx)("span",{className:"text-zinc-500",children:a.date})}],[]),B=k.default.useMemo(()=>[{id:"id",header:"Estimate",cell:a=>(0,b.jsx)("span",{className:"font-medium text-[var(--rb-text)]",children:a.id})},{id:"title",header:"Title",cell:a=>(0,b.jsx)("span",{className:"text-zinc-700",children:a.title})},{id:"status",header:"Status",cell:a=>(0,b.jsx)(d.Badge,{variant:"approved"===a.status.toLowerCase()?"success":"rejected"===a.status.toLowerCase()?"danger":"default",children:a.status})},{id:"total",header:"Total",cell:a=>(0,b.jsx)("span",{className:"text-zinc-700",children:a.total}),className:"text-right"},{id:"date",header:"Date",cell:a=>(0,b.jsx)("span",{className:"text-zinc-500",children:a.date})}],[]);function C({label:a,value:c,badge:e,variant:g}){let h={default:{card:"bg-white border-t-4 border-t-[var(--rb-border)]",dot:"bg-[var(--rb-border)]"},info:{card:"bg-[color:color-mix(in_srgb,var(--rb-blue),white_92%)] border-t-4 border-t-[color:color-mix(in_srgb,var(--rb-blue),white_20%)]",dot:"bg-[var(--rb-blue)]"},success:{card:"bg-[color:color-mix(in_srgb,#16a34a,white_92%)] border-t-4 border-t-[color:color-mix(in_srgb,#16a34a,white_20%)]",dot:"bg-[#16a34a]"},warning:{card:"bg-[color:color-mix(in_srgb,var(--rb-orange),white_92%)] border-t-4 border-t-[color:color-mix(in_srgb,var(--rb-orange),white_20%)]",dot:"bg-[var(--rb-orange)]"},danger:{card:"bg-[color:color-mix(in_srgb,#dc2626,white_92%)] border-t-4 border-t-[color:color-mix(in_srgb,#dc2626,white_20%)]",dot:"bg-[#dc2626]"}};return(0,b.jsx)(f.Card,{className:`relative overflow-hidden shadow-none ${h[g].card}`,children:(0,b.jsx)(f.CardContent,{className:"pt-5",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs font-semibold text-zinc-600 uppercase tracking-wider",children:[(0,b.jsx)("span",{className:`h-2 w-2 rounded-full ${h[g].dot}`}),(0,b.jsx)("span",{children:a})]}),(0,b.jsx)("div",{className:"mt-2 truncate text-2xl font-bold text-[var(--rb-text)]",children:c})]}),(0,b.jsx)(d.Badge,{variant:g,children:e})]})})})}return!p||r||t?(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(h.PageHeader,{title:"Dashboard",description:v?"Your repairs, estimates and updates.":"Business overview (mocked widgets).",actions:(0,b.jsx)(e.Button,{variant:"outline",size:"sm",onClick:()=>void window.location.reload(),disabled:p,children:"Refresh"})}),t?(0,b.jsx)("div",{className:"text-sm text-red-600",children:t}):null,r?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[(0,b.jsx)(C,{label:"Active Jobs",value:String(w.activeJobs),badge:"jobs",variant:"info"}),(0,b.jsx)(C,{label:"Completed",value:String(w.completedJobs),badge:"done",variant:"success"}),(0,b.jsx)(C,{label:"Pending Estimates",value:String(w.pendingEstimates),badge:"est",variant:"warning"}),(0,b.jsx)(C,{label:"Revenue",value:w.revenue,badge:(r.tenant.currency??"USD").toUpperCase(),variant:"default"})]}),(0,b.jsxs)("div",{className:"grid gap-4 lg:grid-cols-3",children:[(0,b.jsx)("div",{className:"lg:col-span-2",children:(0,b.jsx)(m,{title:v?"My Jobs Overview":"Revenue Analytics",subtitle:v?"Recent activity trend (mock).":"Weekly / Monthly / Yearly (mock)."})}),(0,b.jsx)("div",{children:(0,b.jsx)(m,{title:v?"My Active Jobs":"Job Status",subtitle:"Distribution (mock)."})})]}),(0,b.jsxs)("div",{className:"grid gap-4 lg:grid-cols-3",children:[(0,b.jsx)("div",{className:"lg:col-span-2 space-y-4",children:v?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(g.DataTable,{title:"My Jobs",data:x,columns:A,getRowId:a=>a.id,emptyMessage:"No jobs found."}),(0,b.jsx)(g.DataTable,{title:"My Estimates",data:y,columns:B,getRowId:a=>a.id,emptyMessage:"No estimates found."})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(m,{title:"Device Types",subtitle:"Top devices (mock)."}),(0,b.jsx)(m,{title:"Performance",subtitle:"Average repair time (mock)."})]})}),(0,b.jsx)(f.Card,{className:"shadow-none",children:(0,b.jsxs)(f.CardContent,{className:"pt-5",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Recent Activity"}),(0,b.jsx)("div",{className:"mt-1 text-sm text-zinc-600",children:"Latest updates (mock)."})]}),(0,b.jsx)(e.Button,{variant:"outline",size:"sm",disabled:!0,children:"View All"})]}),(0,b.jsxs)("div",{className:"mt-4 space-y-3",children:[0===z.length?(0,b.jsx)("div",{className:"text-sm text-zinc-600",children:"—"}):null,z.map(a=>(0,b.jsx)("div",{className:"rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-white p-3",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"truncate text-sm font-semibold text-[var(--rb-text)]",children:a.title}),(0,b.jsx)("div",{className:"mt-1 text-sm text-zinc-600",children:a.description}),(0,b.jsx)("div",{className:"mt-2 text-xs text-zinc-500",children:a.occurred_at})]}),(0,b.jsx)(d.Badge,{variant:"private"===a.type?"warning":"info",children:a.type})]})},a.id))]}),(0,b.jsxs)("div",{className:"mt-5 text-xs text-zinc-500",children:["Tenant: ",r.tenant.slug," · Signed in as: ",r.user.email]})]})})]})]}):null]}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(h.PageHeader,{title:"Dashboard",description:"Loading dashboard...",actions:(0,b.jsx)(e.Button,{variant:"outline",size:"sm",disabled:!0,children:"Refresh"})}),(0,b.jsx)(o,{})]})}a.s(["default",()=>p])}];

//# sourceMappingURL=frontend_src_app_app_%5Btenant%5D_page_tsx_113310c8._.js.map