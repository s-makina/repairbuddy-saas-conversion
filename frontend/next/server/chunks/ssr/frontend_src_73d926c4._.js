module.exports=[648,a=>{"use strict";var b=a.i(57850),c=a.i(7160);function d({title:a,description:d,actions:e,className:f}){return(0,b.jsxs)("div",{className:(0,c.cn)("flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between",f),children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl font-semibold text-[var(--rb-text)]",children:a}),d?(0,b.jsx)("p",{className:"mt-1 text-sm text-zinc-600",children:d}):null]}),e?(0,b.jsx)("div",{className:"flex items-center gap-2",children:e}):null]})}a.s(["PageHeader",()=>d])},26606,a=>{"use strict";var b=a.i(57850),c=a.i(7160),d=a.i(4600);function e({className:a,"aria-hidden":d=!0,...e}){return(0,b.jsx)("div",{"aria-hidden":d,className:(0,c.cn)("rb-skeleton",a),...e})}function f({lines:a=3,className:f}){let g=Math.max(1,Math.min(a,12));return(0,b.jsx)(d.Card,{className:(0,c.cn)("overflow-hidden",f),children:(0,b.jsxs)(d.CardContent,{className:"space-y-3 pt-5",children:[(0,b.jsx)(e,{className:"h-4 w-32 rounded-[var(--rb-radius-sm)]"}),Array.from({length:g}).map((a,d)=>(0,b.jsx)(e,{className:(0,c.cn)("h-3 rounded-[var(--rb-radius-sm)]",d===g-1?"w-3/5":"w-full")},d))]})})}function g({rows:a=6,columns:d=5,className:f}){let g=Math.max(1,Math.min(a,20)),h=Math.max(1,Math.min(d,10));return(0,b.jsxs)("div",{className:(0,c.cn)("overflow-hidden rounded-[var(--rb-radius-lg)] border border-[var(--rb-border)] bg-white shadow-[var(--rb-shadow)]",f),children:[(0,b.jsx)("div",{className:"border-b border-[var(--rb-border)] px-5 py-4",children:(0,b.jsx)("div",{className:"grid gap-3",style:{gridTemplateColumns:`repeat(${h}, minmax(0, 1fr))`},children:Array.from({length:h}).map((a,c)=>(0,b.jsx)(e,{className:"h-3 w-full rounded-[var(--rb-radius-sm)]"},c))})}),(0,b.jsx)("div",{className:"px-5 pb-5 pt-4",children:(0,b.jsx)("div",{className:"space-y-3",children:Array.from({length:g}).map((a,d)=>(0,b.jsx)("div",{className:"grid gap-3",style:{gridTemplateColumns:`repeat(${h}, minmax(0, 1fr))`},children:Array.from({length:h}).map((a,d)=>(0,b.jsx)(e,{className:(0,c.cn)("h-3 rounded-[var(--rb-radius-sm)]",0===d?"w-3/4":"w-full")},d))},d))})})]})}a.s(["CardSkeleton",()=>f,"Skeleton",()=>e,"TableSkeleton",()=>g])},33585,a=>{"use strict";var b=a.i(57850),c=a.i(34075),d=a.i(97867),e=a.i(4600),f=a.i(648),g=a.i(26606),h=a.i(91601),i=a.i(93609),j=a.i(45056);function k(){let a=(0,i.useParams)(),k=a.business??a.tenant,[l,m]=(0,j.useState)(!0),[n,o]=(0,j.useState)([]),[p,q]=(0,j.useState)([]),[r,s]=(0,j.useState)(null),[t,u]=(0,j.useState)(null),[v,w]=(0,j.useState)(!1),[x,y]=(0,j.useState)(null),z=(0,j.useMemo)(()=>x?n.find(a=>a.id===x)??null:null,[n,x]),[A,B]=(0,j.useState)(""),[C,D]=(0,j.useState)({});async function E(){if("string"!=typeof k||0===k.length){o([]),q([]),y(null),s("Workspace not found."),u(null),m(!1);return}s(null),u(null),m(!0);try{let[a,b]=await Promise.all([(0,c.apiFetch)(`/api/${k}/app/roles`),(0,c.apiFetch)(`/api/${k}/app/permissions`)]),d=Array.isArray(a.roles)?a.roles:[],e=Array.isArray(b.permissions)?b.permissions:[];o(d),q(e);let f=d[0]?.id??null;y(a=>"number"==typeof a&&d.some(b=>b.id===a)?a:f)}catch(a){s(a instanceof Error?a.message:"Failed to load roles.")}finally{m(!1)}}async function F(){w(!0),s(null),u(null);try{let a=(window.prompt("Role name")??"").trim();if(!a)return void w(!1);await (0,c.apiFetch)(`/api/${k}/app/roles`,{method:"POST",body:{name:a,permission_names:[]}}),u("Role created."),await E()}catch(a){a instanceof c.ApiError?s(a.message):s("Failed to create role.")}finally{w(!1)}}async function G(a){if(a.preventDefault(),z){w(!0),s(null),u(null);try{let a=A.trim();if(0===a.length){s("Role name is required."),w(!1);return}let b=Object.entries(C).filter(([,a])=>a).map(([a])=>a);await (0,c.apiFetch)(`/api/${k}/app/roles/${z.id}`,{method:"PUT",body:{name:a,permission_names:b}}),u("Role updated."),await E()}catch(a){a instanceof c.ApiError?s(a.message):s("Failed to update role.")}finally{w(!1)}}}async function H(){if(z&&window.confirm(`Delete role "${z.name}"?`)){w(!0),s(null),u(null);try{await (0,c.apiFetch)(`/api/${k}/app/roles/${z.id}`,{method:"DELETE"}),y(null),u("Role deleted."),await E()}catch(a){a instanceof c.ApiError?s(a.message):s("Failed to delete role.")}finally{w(!1)}}}return(0,j.useEffect)(()=>{E()},[k]),(0,j.useEffect)(()=>{if(!z)return;B(z.name);let a={};for(let b of z.permissions??[])a[b.name]=!0;D(a)},[z]),(0,b.jsx)(h.RequireAuth,{requiredPermission:"roles.manage",children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(f.PageHeader,{title:"Roles",description:"Create roles and assign permissions."}),t?(0,b.jsx)("div",{className:"text-sm text-green-700",children:t}):null,r?(0,b.jsx)("div",{className:"text-sm text-red-600",children:r}):null,(0,b.jsx)(e.Card,{className:"shadow-none",children:(0,b.jsxs)(e.CardContent,{className:"pt-5",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Roles"}),(0,b.jsx)("div",{className:"mt-1 text-sm text-zinc-600",children:"Select a role to edit its permissions."})]}),(0,b.jsx)(d.Button,{type:"button",onClick:()=>void F(),disabled:v,children:"Create role"})]}),l?(0,b.jsx)("div",{className:"mt-4",children:(0,b.jsx)(function(){return(0,b.jsx)(e.Card,{className:"shadow-none",children:(0,b.jsxs)(e.CardContent,{className:"pt-5",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(g.Skeleton,{className:"h-4 w-24 rounded-[var(--rb-radius-sm)]"}),(0,b.jsx)(g.Skeleton,{className:"mt-2 h-4 w-64 rounded-[var(--rb-radius-sm)]"})]}),(0,b.jsx)(g.Skeleton,{className:"h-9 w-28 rounded-[var(--rb-radius-sm)]"})]}),(0,b.jsxs)("div",{className:"mt-4 grid gap-4 lg:grid-cols-3",children:[(0,b.jsx)("div",{className:"space-y-2",children:Array.from({length:6}).map((a,c)=>(0,b.jsxs)("div",{className:"rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-white px-3 py-2",children:[(0,b.jsx)(g.Skeleton,{className:"h-4 w-40 rounded-[var(--rb-radius-sm)]"}),(0,b.jsx)(g.Skeleton,{className:"mt-2 h-3 w-24 rounded-[var(--rb-radius-sm)]"})]},c))}),(0,b.jsxs)("div",{className:"lg:col-span-2 space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)(g.Skeleton,{className:"h-4 w-24 rounded-[var(--rb-radius-sm)]"}),(0,b.jsx)(g.Skeleton,{className:"h-9 w-full rounded-[var(--rb-radius-sm)]"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Skeleton,{className:"h-4 w-28 rounded-[var(--rb-radius-sm)]"}),(0,b.jsx)("div",{className:"grid gap-2 sm:grid-cols-2",children:Array.from({length:10}).map((a,c)=>(0,b.jsx)("div",{className:"rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2",children:(0,b.jsx)(g.Skeleton,{className:"h-4 w-40 rounded-[var(--rb-radius-sm)]"})},c))})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(g.Skeleton,{className:"h-9 w-20 rounded-[var(--rb-radius-sm)]"}),(0,b.jsx)(g.Skeleton,{className:"h-9 w-20 rounded-[var(--rb-radius-sm)]"})]})]})]})]})})},{})}):(0,b.jsxs)("div",{className:"mt-4 grid gap-4 lg:grid-cols-3",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[0===n.length?(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"text-sm text-zinc-600",children:"No roles."}),(0,b.jsx)(d.Button,{type:"button",variant:"outline",onClick:()=>void E(),disabled:v,children:"Retry"})]}):null,n.map(a=>{let c=a.id===x;return(0,b.jsxs)("button",{type:"button",onClick:()=>y(a.id),className:"w-full rounded-[var(--rb-radius-md)] border px-3 py-2 text-left "+(c?"border-[var(--rb-orange)] bg-[rgba(244,162,46,0.10)]":"border-[var(--rb-border)] bg-white hover:bg-[var(--rb-surface-muted)]"),children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:a.name}),(0,b.jsxs)("div",{className:"mt-1 text-xs text-zinc-600",children:[(a.permissions??[]).length," permissions"]})]},a.id)})]}),(0,b.jsx)("div",{className:"lg:col-span-2",children:z?(0,b.jsxs)("form",{className:"space-y-4",onSubmit:G,children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",htmlFor:"role_name",children:"Role name"}),(0,b.jsx)("input",{id:"role_name",className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:A,onChange:a=>B(a.target.value),required:!0,disabled:v})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"text-sm font-medium",children:"Permissions"}),(0,b.jsx)("div",{className:"grid gap-2 sm:grid-cols-2",children:p.map(a=>{let c=!!C[a.name];return(0,b.jsxs)("label",{className:"flex items-center gap-2 rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:c,onChange:b=>D(c=>({...c,[a.name]:b.target.checked}))}),(0,b.jsx)("span",{className:"font-mono text-[12px] text-zinc-700",children:a.name})]},a.id)})})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(d.Button,{type:"submit",disabled:v,children:v?"Saving...":"Save"}),(0,b.jsx)(d.Button,{type:"button",variant:"outline",onClick:()=>void H(),disabled:v,children:"Delete"})]})]}):(0,b.jsx)("div",{className:"text-sm text-zinc-600",children:n.length>0?"Select a role to edit.":"Create a role to get started."})})]})]})})]})})}a.s(["default",()=>k])}];

//# sourceMappingURL=frontend_src_73d926c4._.js.map