module.exports=[61722,a=>{"use strict";var b=a.i(57850),c=a.i(34075),d=a.i(97867),e=a.i(17933),f=a.i(4600),g=a.i(21282),h=a.i(54177),i=a.i(46036),j=a.i(648),k=a.i(91601),l=a.i(75458),m=a.i(71513),n=a.i(26606),o=a.i(93609),p=a.i(45056);function q(a){return(0,b.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:a.className,"aria-hidden":"true",children:[(0,b.jsx)("path",{d:"M12 20h9",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,b.jsx)("path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}function r(a){return(0,b.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:a.className,"aria-hidden":"true",children:[(0,b.jsx)("path",{d:"M3 9.5L5 4h14l2 5.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,b.jsx)("path",{d:"M4 10h16v10H4V10z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,b.jsx)("path",{d:"M9 20v-6h6v6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}function s(){let a=(0,l.useAuth)(),s=(0,o.useParams)(),t=s.business??s.tenant,[u,v]=(0,p.useState)(!0),[w,x]=(0,p.useState)([]),[y,z]=(0,p.useState)([]),[A,B]=(0,p.useState)([]),[C,D]=(0,p.useState)(""),[E,F]=(0,p.useState)(""),[G,H]=(0,p.useState)(null),[I,J]=(0,p.useState)(""),[K,L]=(0,p.useState)({}),[M,N]=(0,p.useState)(!1),[O,P]=(0,p.useState)(null),[Q,R]=(0,p.useState)("all"),[S,T]=(0,p.useState)("all"),[U,V]=(0,p.useState)(""),[W,X]=(0,p.useState)(0),[Y,Z]=(0,p.useState)(10),[$,_]=(0,p.useState)(0),[aa,ab]=(0,p.useState)(null),[ac,ad]=(0,p.useState)(null),[ae,af]=(0,p.useState)(!1),[ag,ah]=(0,p.useState)(""),[ai,aj]=(0,p.useState)(""),[ak,al]=(0,p.useState)(null),am=(0,p.useMemo)(()=>{let a=new Map;for(let b of y)a.set(b.id,b.name);return a},[y]),an=(0,p.useMemo)(()=>A.slice().sort((a,b)=>`${a.code} ${a.name}`.localeCompare(`${b.code} ${b.name}`)).map(a=>({id:a.id,label:`${a.code} - ${a.name}${a.is_active?"":" (inactive)"}`,isActive:a.is_active})),[A]),ao=(0,p.useMemo)(()=>an.filter(a=>a.isActive),[an]),ap=(0,p.useMemo)(()=>{let a=I.trim().toLowerCase();return a?ao.filter(b=>b.label.toLowerCase().includes(a)):ao},[ao,I]),aq=(0,p.useMemo)(()=>0!==ap.length&&ap.every(a=>!!K[a.id]),[ap,K]),ar=(0,p.useMemo)(()=>ap.some(a=>!!K[a.id]),[ap,K]),as=(0,p.useRef)(null);(0,p.useEffect)(()=>{as.current&&(as.current.indeterminate=ar&&!aq)},[aq,ar]);let at=(0,p.useMemo)(()=>[{label:"All roles",value:"all"},{label:"(none)",value:"none"},...y.map(a=>({label:a.name,value:String(a.id)}))],[y]),au=(0,p.useMemo)(()=>[{label:"All statuses",value:"all"},{label:"Pending",value:"pending"},{label:"Active",value:"active"},{label:"Inactive",value:"inactive"},{label:"Suspended",value:"suspended"}],[]),av=(0,p.useMemo)(()=>new Map([["pending","warning"],["active","success"],["inactive","default"],["suspended","danger"]]),[]);async function aw({includeRoles:b}){if("string"==typeof t&&0!==t.length){v(!0);try{let d=new URLSearchParams;U.trim().length>0&&d.set("q",U.trim()),Q&&"all"!==Q&&d.set("role",Q),S&&"all"!==S&&d.set("status",S),aa?.id&&aa?.dir&&(d.set("sort",aa.id),d.set("dir",aa.dir)),d.set("page",String(W+1)),d.set("per_page",String(Y));let e=`/api/${t}/app/users?${d.toString()}`;if(b){let[b,d,f]=await Promise.all([(0,c.apiFetch)(e),(0,c.apiFetch)(`/api/${t}/app/roles`),(0,c.apiFetch)(`/api/${t}/app/branches`)]);x(Array.isArray(b.users)?b.users:[]),_("number"==typeof b.meta?.total?b.meta.total:0),Z("number"==typeof b.meta?.per_page?b.meta.per_page:Y),z(Array.isArray(d.roles)?d.roles:[]),B(Array.isArray(f.branches)?f.branches:[]);let g=(Array.isArray(d.roles)?d.roles:[])[0]?.id??null;H(g);let h=a.tenant?.default_branch_id??null,i=(Array.isArray(f.branches)?f.branches:[]).filter(a=>a.is_active).map(a=>a.id),j=(h&&i.includes(h)?[h]:[]).concat(i.length>0?[i[0]]:[]).filter((a,b,c)=>c.indexOf(a)===b);L(a=>{if(Object.keys(a).length>0)return a;let b={};for(let a of j)b[a]=!0;return b})}else{let a=await (0,c.apiFetch)(e);x(Array.isArray(a.users)?a.users:[]),_("number"==typeof a.meta?.total?a.meta.total:0),Z("number"==typeof a.meta?.per_page?a.meta.per_page:Y)}}catch(a){m.notify.error(a instanceof Error?a.message:"Failed to load users.")}finally{v(!1)}}}async function ax(a){P(a);try{await (0,c.apiFetch)(`/api/${t}/app/users/${a}/reset-password`,{method:"POST"}),m.notify.success("Password reset link sent.")}catch(a){a instanceof c.ApiError?m.notify.error(a.message):m.notify.error("Failed to send password reset link.")}finally{P(null)}}async function ay(b){if(b.preventDefault(),!G||0===ao.length)return;let d=Object.entries(K).filter(([,a])=>a).map(([a])=>Number(a)).filter(a=>Number.isFinite(a)&&a>0);if(0===d.length)return void m.notify.error("Select at least one shop.");N(!0);try{if(ac){await (0,c.apiFetch)(`/api/${t}/app/users/${ac}`,{method:"PUT",body:{name:C,email:E,role_id:G}});let a=await (0,c.apiFetch)(`/api/${t}/app/users/${ac}/shop`,{method:"PATCH",body:{branch_ids:d}});x(b=>b.map(b=>b.id===ac?a.user:b)),m.notify.success("User updated.")}else await (0,c.apiFetch)(`/api/${t}/app/users`,{method:"POST",body:{name:C,email:E,role_id:G,branch_ids:d}}),m.notify.success("User created. One-time password emailed.");D(""),F(""),J(""),L({}),ad(null),X(0),await aw({includeRoles:!1}),await a.refresh()}catch(a){a instanceof c.ApiError?m.notify.error(a.message):m.notify.error(ac?"Failed to update user.":"Failed to create user.")}finally{N(!1)}}async function az(a,b){P(a);try{await (0,c.apiFetch)(`/api/${t}/app/users/${a}/status`,{method:"PATCH",body:{status:b}}),m.notify.success("User updated."),await aw({includeRoles:!1})}catch(a){a instanceof c.ApiError?m.notify.error(a.message):m.notify.error("Failed to update user.")}finally{P(null)}}function aA(a){ah(a.title),aj(a.message),al(()=>a.action),af(!0)}return(0,p.useEffect)(()=>{X(0),ab(null),aw({includeRoles:!0})},[t]),(0,p.useEffect)(()=>{"string"==typeof t&&0!==t.length&&aw({includeRoles:!1})},[U,Q,S,W,Y,aa?.id,aa?.dir]),u&&0===w.length&&0===y.length&&0===A.length?(0,b.jsx)(k.RequireAuth,{requiredPermission:"users.manage",children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(j.PageHeader,{title:"Users",description:"Manage tenant users and their roles.",actions:(0,b.jsx)(d.Button,{type:"button",disabled:!0,children:"Invite user"})}),(0,b.jsx)(function(){return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(f.Card,{className:"shadow-none",children:(0,b.jsxs)(f.CardContent,{className:"pt-5",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Skeleton,{className:"h-4 w-32 rounded-[var(--rb-radius-sm)]"}),(0,b.jsx)(n.Skeleton,{className:"mt-2 h-4 w-72 rounded-[var(--rb-radius-sm)]"})]}),(0,b.jsx)(n.Skeleton,{className:"h-9 w-28 rounded-[var(--rb-radius-sm)]"})]}),(0,b.jsxs)("div",{className:"mt-4 grid gap-6 lg:grid-cols-12",children:[(0,b.jsxs)("div",{className:"lg:col-span-7 space-y-3",children:[Array.from({length:4}).map((a,c)=>(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)(n.Skeleton,{className:"h-3 w-20 rounded-[var(--rb-radius-sm)]"}),(0,b.jsx)(n.Skeleton,{className:"h-9 w-full rounded-[var(--rb-radius-sm)]"})]},c)),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(n.Skeleton,{className:"h-9 w-28 rounded-[var(--rb-radius-sm)]"}),(0,b.jsx)(n.Skeleton,{className:"h-9 w-20 rounded-[var(--rb-radius-sm)]"})]})]}),(0,b.jsx)("div",{className:"lg:col-span-5",children:(0,b.jsxs)("div",{className:"rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-[var(--rb-surface-muted)] p-4",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Skeleton,{className:"h-4 w-20 rounded-[var(--rb-radius-sm)]"}),(0,b.jsx)(n.Skeleton,{className:"mt-2 h-3 w-48 rounded-[var(--rb-radius-sm)]"})]}),(0,b.jsx)(n.Skeleton,{className:"h-3 w-20 rounded-[var(--rb-radius-sm)]"})]}),(0,b.jsx)("div",{className:"mt-4 space-y-2",children:Array.from({length:6}).map((a,c)=>(0,b.jsx)("div",{className:"rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2",children:(0,b.jsx)(n.Skeleton,{className:"h-4 w-40 rounded-[var(--rb-radius-sm)]"})},c))})]})})]})]})}),(0,b.jsx)(n.TableSkeleton,{rows:8,columns:6})]})},{})]})}):(0,b.jsx)(k.RequireAuth,{requiredPermission:"users.manage",children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(j.PageHeader,{title:"Users",description:"Manage tenant users and their roles.",actions:(0,b.jsx)(d.Button,{type:"button",onClick:()=>{let a;ad(null),D(""),F(""),J(""),L({}),(a=document.getElementById("invite-user"))?a.scrollIntoView({behavior:"smooth",block:"start"}):window.scrollTo({top:0,behavior:"smooth"})},children:"Invite user"})}),(0,b.jsx)(g.ConfirmDialog,{open:ae,title:ag,message:ai,busy:!!O,onCancel:()=>{O||(af(!1),al(null))},onConfirm:()=>{ak&&(async()=>{await ak(),af(!1),al(null)})()}}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{children:(0,b.jsx)(f.Card,{className:"shadow-none",children:(0,b.jsxs)(f.CardContent,{className:"pt-5",children:[(0,b.jsx)("div",{id:"invite-user"}),(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:ac?"Edit user":"Create user"}),(0,b.jsx)("form",{className:"mt-4",onSubmit:ay,children:(0,b.jsxs)("div",{className:"grid gap-6 lg:grid-cols-12",children:[(0,b.jsx)("div",{className:"lg:col-span-7",children:(0,b.jsxs)("div",{className:"grid gap-3",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",htmlFor:"user_name",children:"Name"}),(0,b.jsx)("input",{id:"user_name",className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:C,onChange:a=>D(a.target.value),required:!0})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",htmlFor:"user_email",children:"Email"}),(0,b.jsx)("input",{id:"user_email",className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:E,onChange:a=>F(a.target.value),type:"email",required:!0})]}),(0,b.jsx)("div",{className:"space-y-1",children:(0,b.jsx)("div",{className:"text-sm text-zinc-600",children:"A one-time password will be generated and emailed to the user."})}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",htmlFor:"user_role",children:"Role"}),(0,b.jsx)("select",{id:"user_role",className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:G??"",onChange:a=>H(Number(a.target.value)),required:!0,children:y.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(d.Button,{type:"submit",disabled:M||u||0===y.length||0===ao.length||0===Object.values(K).filter(Boolean).length,children:M?"Saving...":ac?"Save changes":"Create user"}),ac?(0,b.jsx)(d.Button,{type:"button",variant:"outline",disabled:M||u,onClick:()=>{ad(null),D(""),F(""),J(""),L({})},children:"Cancel"}):null]}),0===y.length?(0,b.jsx)("div",{className:"mt-2 text-sm text-zinc-600",children:"Create a role first before adding users."}):null,0===ao.length?(0,b.jsx)("div",{className:"mt-2 text-sm text-zinc-600",children:"Create a shop first before adding users."}):null]})]})}),(0,b.jsx)("div",{className:"lg:col-span-5",children:(0,b.jsxs)("div",{className:"rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-[var(--rb-surface-muted)] p-4",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Shops"}),(0,b.jsx)("div",{className:"mt-1 text-xs text-zinc-600",children:"Select one or more shops this user can access."})]}),(0,b.jsxs)("div",{className:"text-xs text-zinc-600",children:["Selected: ",Object.values(K).filter(Boolean).length]})]}),(0,b.jsxs)("div",{className:"mt-3 space-y-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium",htmlFor:"new_user_shop_search",children:"Search"}),(0,b.jsx)("input",{id:"new_user_shop_search",className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:I,onChange:a=>J(a.target.value),placeholder:"Search shops...",disabled:M||u})]}),(0,b.jsx)("div",{className:"mt-3 max-h-[260px] overflow-y-auto pr-1",children:(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsxs)("label",{className:"flex items-center justify-between gap-3 rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2",children:[(0,b.jsx)("div",{className:"min-w-0",children:(0,b.jsx)("div",{className:"truncate text-sm font-medium text-[var(--rb-text)]",children:"Check all"})}),(0,b.jsx)("input",{ref:as,type:"checkbox",checked:aq,onChange:a=>{let b=a.target.checked;L(a=>{let c={...a};for(let a of ap)c[a.id]=b;return c})},disabled:M||u})]}),ap.map(a=>{let c=!!K[a.id];return(0,b.jsxs)("label",{className:"flex items-center justify-between gap-3 rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2",children:[(0,b.jsx)("div",{className:"min-w-0",children:(0,b.jsx)("div",{className:"truncate text-sm font-medium text-[var(--rb-text)]",children:a.label})}),(0,b.jsx)("input",{type:"checkbox",checked:c,onChange:b=>L(c=>({...c,[a.id]:b.target.checked})),disabled:M||u})]},a.id)})]})})]})})]})})]})})}),(0,b.jsx)("div",{children:(0,b.jsx)(f.Card,{className:"shadow-none",children:(0,b.jsx)(f.CardContent,{className:"pt-5",children:(0,b.jsx)(h.DataTable,{title:"Users",data:w,loading:u,emptyMessage:"No users yet.",getRowId:a=>a.id,search:{placeholder:"Search name or email..."},server:{query:U,onQueryChange:a=>{V(a),X(0)},pageIndex:W,onPageIndexChange:X,pageSize:Y,onPageSizeChange:a=>{Z(a),X(0)},totalRows:$,sort:aa,onSortChange:a=>{ab(a),X(0)}},exportConfig:{url:`/api/${t}/app/users/export`,formats:["csv","xlsx","pdf"],filename:({format:a})=>`users_export.${a}`},columnVisibilityKey:`rb:datatable:${t}:users`,filters:[{id:"role",label:"Role",value:Q,options:at,onChange:a=>{R(String(a)),X(0)}},{id:"status",label:"Status",value:S,options:au,onChange:a=>{T(String(a)),X(0)}}],columns:[{id:"name",header:"Name",sortId:"name",cell:a=>(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"truncate font-semibold text-[var(--rb-text)]",children:a.name}),(0,b.jsx)("div",{className:"truncate text-xs text-zinc-600",children:a.email})]}),className:"max-w-[340px]"},{id:"email",header:"Email",sortId:"email",hiddenByDefault:!0,cell:a=>(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:a.email}),className:"whitespace-nowrap"},{id:"role",header:"Role",cell:a=>{let c=a.role_id??null;return(0,b.jsx)("div",{className:"text-sm text-zinc-700",children:c?am.get(c)??"(unknown)":"(none)"})},className:"whitespace-nowrap"},{id:"shop",header:"Shops",className:"min-w-[220px]",cell:a=>{let c=Array.isArray(a.branches)?a.branches:[],d=c.filter(a=>!!a?.is_active),e=(d.length>0?d:c).filter(a=>a&&"number"==typeof a.id).slice().sort((a,b)=>`${a.code??""} ${a.name??""}`.localeCompare(`${b.code??""} ${b.name??""}`)),f=e.slice(0,2),g=e.slice(2),h=g.length,i=g.map(a=>`${a.code?`${a.code} - `:""}${a.name}`).join("\n");return(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(r,{className:"h-4 w-4 text-zinc-500"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:0===f.length?(0,b.jsx)("span",{className:"text-sm text-zinc-600",children:"(none)"}):(0,b.jsxs)(b.Fragment,{children:[f.map(a=>(0,b.jsxs)("span",{className:"inline-flex items-center rounded-full border border-[var(--rb-border)] bg-white px-2 py-0.5 text-xs text-zinc-700",title:`${a.code?`${a.code} - `:""}${a.name}`,children:[a.code?`${a.code} - `:"",a.name]},a.id)),h>0?(0,b.jsxs)("span",{className:"inline-flex items-center rounded-full border border-[var(--rb-border)] bg-white px-2 py-0.5 text-xs text-zinc-700",title:i,children:["+",h," more"]}):null]})})]})}},{id:"status",header:"Status",sortId:"status",className:"whitespace-nowrap",cell:a=>{let c=a.status??"active";return(0,b.jsx)(e.Badge,{variant:av.get(c)??"default",children:c})}},{id:"actions",header:"",headerClassName:"text-right",className:"whitespace-nowrap text-right",cell:a=>{let c=a.status??"active",e=O===a.id||M;return(0,b.jsx)(i.DropdownMenu,{align:"right",trigger:({toggle:a})=>(0,b.jsx)(d.Button,{variant:"ghost",size:"sm",onClick:a,disabled:e,"aria-label":"User actions",title:"User actions",className:"px-2",children:(0,b.jsx)(q,{className:"h-4 w-4"})}),children:({close:d})=>(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(i.DropdownMenuItem,{onSelect:()=>{d();let b=Array.isArray(a.branches)?a.branches:[],c={};for(let a of b)"number"==typeof a.id&&(c[a.id]=!0);ad(a.id),D(a.name??""),F(a.email??""),H(a.role_id??null),L(c),J(""),window.scrollTo({top:0,behavior:"smooth"})},disabled:e,children:"Edit"}),(0,b.jsx)(i.DropdownMenuSeparator,{}),(0,b.jsx)(i.DropdownMenuItem,{onSelect:()=>{d(),aA({title:"Send password reset",message:(0,b.jsxs)("div",{children:["Send a password reset link to ",(0,b.jsx)("span",{className:"font-semibold",children:a.email}),"?"]}),action:async()=>ax(a.id)})},disabled:e,children:"Reset password"}),(0,b.jsx)(i.DropdownMenuSeparator,{}),(0,b.jsx)(i.DropdownMenuItem,{onSelect:()=>{d(),aA({title:"Suspend user",message:(0,b.jsxs)("div",{children:["Suspend ",(0,b.jsx)("span",{className:"font-semibold",children:a.email}),"? They may lose access immediately."]}),action:async()=>az(a.id,"suspended")})},destructive:!0,disabled:e||"suspended"===c,children:"Suspend"}),(0,b.jsx)(i.DropdownMenuItem,{onSelect:()=>{d(),aA({title:"Set user inactive",message:(0,b.jsxs)("div",{children:["Set ",(0,b.jsx)("span",{className:"font-semibold",children:a.email})," to inactive? They will not be able to sign in."]}),action:async()=>az(a.id,"inactive")})},destructive:!0,disabled:e||"inactive"===c,children:"Set inactive"}),(0,b.jsx)(i.DropdownMenuItem,{onSelect:()=>{d(),az(a.id,"active")},disabled:e||"active"===c,children:"Activate"})]})})}}]})})})})]})]})})}a.s(["default",()=>s])}];

//# sourceMappingURL=frontend_src_app_app_%5Btenant%5D_users_page_tsx_cfa52118._.js.map