module.exports=[17933,a=>{"use strict";var b=a.i(57850),c=a.i(7160);function d({className:a,variant:d="default",...e}){return(0,b.jsx)("span",{className:(0,c.cn)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-medium",{default:"bg-[var(--rb-surface-muted)] text-[var(--rb-text)] border-[var(--rb-border)]",info:"bg-[color:color-mix(in_srgb,var(--rb-blue),white_85%)] text-[var(--rb-blue)] border-[color:color-mix(in_srgb,var(--rb-blue),white_70%)]",success:"bg-[color:color-mix(in_srgb,#16a34a,white_85%)] text-[#166534] border-[color:color-mix(in_srgb,#16a34a,white_70%)]",warning:"bg-[color:color-mix(in_srgb,var(--rb-orange),white_85%)] text-[color:color-mix(in_srgb,var(--rb-orange),black_20%)] border-[color:color-mix(in_srgb,var(--rb-orange),white_70%)]",danger:"bg-[color:color-mix(in_srgb,#dc2626,white_85%)] text-[#991b1b] border-[color:color-mix(in_srgb,#dc2626,white_70%)]"}[d],a),...e})}a.s(["Badge",()=>d])},648,a=>{"use strict";var b=a.i(57850),c=a.i(7160);function d({title:a,description:d,actions:e,className:f}){return(0,b.jsxs)("div",{className:(0,c.cn)("flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between",f),children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl font-semibold text-[var(--rb-text)]",children:a}),d?(0,b.jsx)("p",{className:"mt-1 text-sm text-zinc-600",children:d}):null]}),e?(0,b.jsx)("div",{className:"flex items-center gap-2",children:e}):null]})}a.s(["PageHeader",()=>d])},39159,a=>{"use strict";var b=a.i(57850),c=a.i(7160);function d({className:a,children:d,...e}){return(0,b.jsx)("select",{className:(0,c.cn)("w-full appearance-none rounded-[var(--rb-radius-sm)] border border-zinc-300 bg-white px-3 py-2 text-sm text-[var(--rb-text)] outline-none transition","focus-visible:ring-2 focus-visible:ring-[color:color-mix(in_srgb,var(--rb-orange),white_65%)] focus-visible:ring-offset-2 focus-visible:ring-offset-white","disabled:cursor-not-allowed disabled:bg-[var(--rb-surface-muted)] disabled:opacity-70","bg-[right_0.75rem_center] bg-no-repeat pr-10",'[background-image:url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="%236b7280" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>\')]',a),...e,children:d})}a.s(["Select",()=>d])},80481,a=>{"use strict";var b=a.i(57850),c=a.i(45056),d=a.i(93609),e=a.i(79360),f=a.i(80751),g=a.i(52887),h=a.i(51612),i=a.i(18396),j=a.i(648),k=a.i(97867),l=a.i(4600),m=a.i(17933),n=a.i(39159),o=a.i(34075),p=a.i(75458);function q({field:a,label:c,active:d,onSelect:e}){return(0,b.jsx)(k.Button,{size:"sm",variant:d?"primary":"outline",className:"rounded-none border-0",onClick:()=>e(a),type:"button",children:c})}function r(a){if("string"!=typeof a)return null;let b=a.trim();if(""===b)return null;let c=new Date(b);return Number.isNaN(c.getTime())?null:c.toISOString().slice(0,10)}function s(){let a=(0,p.useAuth)(),s=(0,d.useRouter)(),t="get-up-and-glo",u=a.isAdmin,[v,w]=c.default.useState("pickup_date"),[x,y]=c.default.useState("all"),[z,A]=c.default.useState(!0),[B,C]=c.default.useState(null),[D,E]=c.default.useState([]),[F,G]=c.default.useState(null),[H,I]=c.default.useState(!1),[J,K]=c.default.useState(!1),L=c.default.useRef(null),M=c.default.useRef(0);c.default.useEffect(()=>{"my_assignments"!==x||u||y("all")},[x,u]);let N=a.user?.id??null,O=c.default.useCallback(async()=>{A(!0),C(null);try{let a=new URLSearchParams;a.set("page","1"),a.set("per_page","100");let[b,c]=await Promise.all([(0,o.apiFetch)(`/api/${t}/app/repairbuddy/jobs?${a.toString()}`),(0,o.apiFetch)(`/api/${t}/app/repairbuddy/estimates?limit=200`)]),d=Array.isArray(b?.jobs)?b.jobs:[],e=Array.isArray(c?.estimates)?c.estimates:[],f=[];for(let a of d){let b="number"==typeof a?.id?a.id:NaN;if(!Number.isFinite(b))continue;let c=Array.isArray(a?.assigned_technicians)?a.assigned_technicians:[],d="number"==typeof N&&c.some(a=>a?.id===N),e="string"==typeof a?.customer?.name?a.customer.name:"Unknown";f.push({id:`job-${b}`,type:"job",numericId:b,caseNumber:"string"==typeof a?.case_number&&""!==a.case_number.trim()?a.case_number:String(b),customerName:e,status:"string"==typeof a?.status&&""!==a.status.trim()?a.status:"Job",assignedToMe:d,pickup_date:r(a?.pickup_date),delivery_date:r(a?.delivery_date),next_service_date:r(a?.next_service_date),post_date:r(a?.created_at)})}for(let a of e){let b="number"==typeof a?.id?a.id:NaN;if(!Number.isFinite(b))continue;let c="number"==typeof N&&"number"==typeof a?.assigned_technician_id&&a.assigned_technician_id===N,d="string"==typeof a?.customer?.name?a.customer.name:"Unknown";f.push({id:`estimate-${b}`,type:"estimate",numericId:b,caseNumber:"string"==typeof a?.case_number&&""!==a.case_number.trim()?a.case_number:String(b),customerName:d,status:"string"==typeof a?.status&&""!==a.status.trim()?a.status:"Estimate",assignedToMe:c,pickup_date:r(a?.pickup_date),delivery_date:r(a?.delivery_date),next_service_date:null,post_date:r(a?.created_at)})}E(f),M.current=Date.now()}catch(a){if(a instanceof o.ApiError&&428===a.status){let a=`/app/${t}/calendar`;s.replace(`/app/${t}/branches/select?next=${encodeURIComponent(a)}`);return}C(a instanceof Error?a.message:"Failed to load calendar data."),E([])}finally{A(!1)}},[s,t,N]);c.default.useEffect(()=>{O()},[O]);let P=c.default.useMemo(()=>"jobs"===x?D.filter(a=>"job"===a.type):"estimates"===x?D.filter(a=>"estimate"===a.type):"my_assignments"===x?D.filter(a=>a.assignedToMe):D,[x,D]),Q=c.default.useCallback(a=>"pickup_date"===v?a.pickup_date:"delivery_date"===v?a.delivery_date:"next_service_date"===v?a.next_service_date:a.post_date,[v]),R=c.default.useMemo(()=>{if(!F)return P;let a=F.start,b=F.end;return P.filter(c=>{let d=Q(c);return!!d&&d>=a&&d<b})},[F,Q,P]),S=c.default.useMemo(()=>({jobs:R.filter(a=>"job"===a.type).length,estimates:R.filter(a=>"estimate"===a.type).length}),[R]),T=c.default.useCallback((a,b,c)=>{let d=a.startStr.split("T")[0]??a.startStr,e=a.endStr.split("T")[0]??a.endStr;try{let a=[];for(let b of P){var f;let c=Q(b);if(!c||!(c>=d)||!(c<e))continue;let g="estimate"===b.type?"Estimate":"Job",h="estimate"===b.type?`/app/${t}/estimates/${b.numericId}`:`/app/${t}/jobs/${b.numericId}`;a.push({id:b.id,title:`${g} ${b.caseNumber}`,start:c,allDay:!0,classNames:["estimate"===b.type?"estimate-event":"job-event",(f=b.status,`status-${f.toLowerCase().replace(/\s+/g,"").replace(/\//g,"")}`)],extendedProps:{type:b.type,status:b.status,tooltip:`Case: ${b.caseNumber} | Customer: ${b.customerName} | Status: ${b.status}`,customerName:b.customerName,caseNumber:b.caseNumber,href:h}})}b(a)}catch(a){c(a instanceof Error?a:Error("Failed to build calendar events."))}},[Q,t,P]);async function U(){if(!H){I(!0);try{await O(),L.current?.getApi().refetchEvents()}finally{I(!1)}}}c.default.useEffect(()=>{L.current?.getApi().refetchEvents()},[v,x]);let V=c.default.useCallback(a=>w(a),[]),W=0===P.length?z?"Loadingâ€¦":B?"Calendar data could not be loaded.":"No items match the current filter.":null;return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(j.PageHeader,{title:"Service Calendar",description:"View and manage all your service appointments and estimates",actions:(0,b.jsx)("div",{className:"flex flex-wrap items-center gap-2",children:(0,b.jsxs)("div",{className:"inline-flex overflow-hidden rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white",children:[(0,b.jsx)(q,{field:"pickup_date",label:"Pickup Date",active:"pickup_date"===v,onSelect:V}),(0,b.jsx)("div",{className:"h-8 w-px bg-[var(--rb-border)]"}),(0,b.jsx)(q,{field:"delivery_date",label:"Delivery Date",active:"delivery_date"===v,onSelect:V}),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"h-8 w-px bg-[var(--rb-border)]"}),(0,b.jsx)(q,{field:"next_service_date",label:"Next Service",active:"next_service_date"===v,onSelect:V})]}),(0,b.jsx)("div",{className:"h-8 w-px bg-[var(--rb-border)]"}),(0,b.jsx)(q,{field:"post_date",label:"Creation",active:"post_date"===v,onSelect:V})]})})}),(0,b.jsx)(l.Card,{className:"shadow-none",children:(0,b.jsxs)(l.CardContent,{className:"pt-5",children:[(0,b.jsxs)("div",{className:"rounded-[var(--rb-radius-md)] bg-[var(--rb-surface-muted)] p-4",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Filter:"}),(0,b.jsxs)(n.Select,{value:x,onChange:a=>y(a.target.value),className:"w-auto min-w-[180px]",disabled:z||H||J,children:[(0,b.jsx)("option",{value:"all",children:"All Items"}),(0,b.jsx)("option",{value:"jobs",children:"Jobs Only"}),(0,b.jsx)("option",{value:"estimates",children:"Estimates Only"}),u?(0,b.jsx)("option",{value:"my_assignments",children:"My Assignments"}):null]}),(0,b.jsx)("input",{type:"hidden",value:v,readOnly:!0})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(k.Button,{size:"sm",variant:"outline",onClick:()=>void O(),disabled:z||H,children:"Reload data"}),(0,b.jsx)(k.Button,{size:"sm",variant:"primary",onClick:()=>void U(),disabled:z||H,children:H?"Loading...":"Refresh"})]})]}),B?(0,b.jsx)("div",{className:"mt-3 rounded-[var(--rb-radius-sm)] border border-red-200 bg-red-50 p-3 text-sm text-red-800",children:B}):null,!B&&"number"==typeof M.current&&M.current>0?(0,b.jsxs)("div",{className:"mt-3 text-xs text-zinc-500",children:["Last updated: ",new Date(M.current).toLocaleString()]}):null]}),(0,b.jsxs)("div",{className:"relative mt-4",children:[(0,b.jsx)("div",{className:"rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-white",style:{minHeight:500},children:(0,b.jsx)(e.default,{ref:L,plugins:[f.default,g.default,h.default,i.default],initialView:"dayGridMonth",headerToolbar:{left:"prevYear,prev,next,nextYear today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},buttonText:{today:"Today",month:"Month",week:"Week",day:"Day",list:"List"},height:"auto",expandRows:!0,navLinks:!0,nowIndicator:!0,editable:!1,selectable:!0,dayMaxEvents:10,events:T,datesSet:a=>{let b=a.start,c=a.end,d=b instanceof Date&&!Number.isNaN(b.getTime())?b.toISOString().slice(0,10):null,e=c instanceof Date&&!Number.isNaN(c.getTime())?c.toISOString().slice(0,10):null;d&&e&&G({start:d,end:e})},eventDidMount:a=>{let b=a.event.extendedProps?.tooltip;"string"==typeof b&&b.length>0&&a.el.setAttribute("title",b)},eventClick:a=>{let b=a.event.extendedProps?.href;"string"==typeof b&&""!==b.trim()&&(a.jsEvent.preventDefault(),s.push(b))},eventContent:a=>{let c=a.event.extendedProps,d=c?.status,e="string"==typeof c?.customerName?c.customerName:"";return(0,b.jsxs)("div",{className:"flex min-w-0 flex-col",children:[(0,b.jsx)("div",{className:"truncate text-[0.8125rem] font-semibold leading-[1.1]",children:a.event.title}),e?(0,b.jsx)("div",{className:"truncate text-[0.8125rem] leading-[1.1]",children:e}):null,d?(0,b.jsx)("div",{className:"truncate text-[0.8125rem] opacity-80",children:d}):null]})},loading:a=>{K(a)}})}),J||z?(0,b.jsx)("div",{className:"absolute left-1/2 top-1/2 z-10 w-[280px] -translate-x-1/2 -translate-y-1/2 rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-white p-4 shadow",children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,b.jsx)("div",{className:"h-7 w-7 animate-spin rounded-full border-2 border-[var(--rb-border)] border-t-[var(--rb-blue)]"}),(0,b.jsx)("div",{className:"text-sm text-zinc-600",children:"Loading calendar events..."})]})}):null,z||B||!W?null:(0,b.jsx)("div",{className:"mt-3 rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-[var(--rb-surface-muted)] p-4 text-sm text-zinc-600",children:W})]}),(0,b.jsx)("div",{className:"mt-5 border-t border-[var(--rb-border)] pt-4",children:(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsx)("span",{className:"text-sm text-zinc-500",children:"Legend:"}),(0,b.jsx)(m.Badge,{className:"!bg-[var(--rb-blue)] !text-white !border-transparent shadow-sm",children:"Job"}),(0,b.jsx)(m.Badge,{className:"!bg-[var(--rb-orange)] !text-white !border-transparent shadow-sm",children:"Estimate"}),(0,b.jsx)(m.Badge,{className:"!bg-[#16a34a] !text-white !border-transparent shadow-sm",children:"New/Quote"}),(0,b.jsx)(m.Badge,{className:"!bg-[#0ea5e9] !text-white !border-transparent shadow-sm",children:"In Process"}),(0,b.jsx)(m.Badge,{className:"!bg-[#dc2626] !text-white !border-transparent shadow-sm",children:"Cancelled"}),(0,b.jsx)(m.Badge,{className:"!bg-[#fd7e14] !text-white !border-transparent shadow-sm",children:"Ready"}),(0,b.jsx)(m.Badge,{className:"!bg-[#6f42c1] !text-white !border-transparent shadow-sm",children:"Completed"}),(0,b.jsx)(m.Badge,{className:"!bg-[#e83e8c] !text-white !border-transparent shadow-sm",children:"Delivered"})]})})]})}),(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,b.jsxs)(l.Card,{className:"relative overflow-hidden border-0 bg-gradient-to-br from-[var(--rb-blue)] via-[#1d4ed8] to-[#0ea5e9] text-white shadow-sm",children:[(0,b.jsx)("div",{className:"pointer-events-none absolute -right-12 -top-12 h-40 w-40 rounded-full bg-white/10"}),(0,b.jsx)("div",{className:"pointer-events-none absolute -bottom-16 -left-16 h-56 w-56 rounded-full bg-black/10"}),(0,b.jsxs)(l.CardContent,{className:"relative pt-5",children:[(0,b.jsx)("div",{className:"text-sm font-semibold opacity-90",children:"Total Jobs"}),(0,b.jsx)("div",{className:"mt-2 text-4xl font-bold",children:S.jobs})]})]}),(0,b.jsxs)(l.Card,{className:"relative overflow-hidden border-0 bg-gradient-to-br from-[#16a34a] via-[#22c55e] to-[#10b981] text-white shadow-sm",children:[(0,b.jsx)("div",{className:"pointer-events-none absolute -right-12 -top-12 h-40 w-40 rounded-full bg-white/10"}),(0,b.jsx)("div",{className:"pointer-events-none absolute -bottom-16 -left-16 h-56 w-56 rounded-full bg-black/10"}),(0,b.jsxs)(l.CardContent,{className:"relative pt-5",children:[(0,b.jsx)("div",{className:"text-sm font-semibold opacity-90",children:"Total Estimates"}),(0,b.jsx)("div",{className:"mt-2 text-4xl font-bold",children:S.estimates})]})]})]})]})}a.s(["default",()=>s])}];

//# sourceMappingURL=frontend_src_fe207fb1._.js.map