(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,68501,e=>{"use strict";var t=e.i(48277),a=e.i(14575);function r({className:e,variant:r="default",...s}){return(0,t.jsx)("span",{className:(0,a.cn)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-medium",{default:"bg-[var(--rb-surface-muted)] text-[var(--rb-text)] border-[var(--rb-border)]",info:"bg-[color:color-mix(in_srgb,var(--rb-blue),white_85%)] text-[var(--rb-blue)] border-[color:color-mix(in_srgb,var(--rb-blue),white_70%)]",success:"bg-[color:color-mix(in_srgb,#16a34a,white_85%)] text-[#166534] border-[color:color-mix(in_srgb,#16a34a,white_70%)]",warning:"bg-[color:color-mix(in_srgb,var(--rb-orange),white_85%)] text-[color:color-mix(in_srgb,var(--rb-orange),black_20%)] border-[color:color-mix(in_srgb,var(--rb-orange),white_70%)]",danger:"bg-[color:color-mix(in_srgb,#dc2626,white_85%)] text-[#991b1b] border-[color:color-mix(in_srgb,#dc2626,white_70%)]"}[r],e),...s})}e.s(["Badge",()=>r])},19463,e=>{"use strict";var t=e.i(48277),a=e.i(14575);function r({title:e,description:r,actions:s,className:i}){return(0,t.jsxs)("div",{className:(0,a.cn)("flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between",i),children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-xl font-semibold text-[var(--rb-text)]",children:e}),r?(0,t.jsx)("p",{className:"mt-1 text-sm text-zinc-600",children:r}):null]}),s?(0,t.jsx)("div",{className:"flex items-center gap-2",children:s}):null]})}e.s(["PageHeader",()=>r])},40709,e=>{"use strict";var t=e.i(48277),a=e.i(14575);function r({className:e,children:r,...s}){return(0,t.jsx)("select",{className:(0,a.cn)("w-full appearance-none rounded-[var(--rb-radius-sm)] border border-zinc-300 bg-white px-3 py-2 text-sm text-[var(--rb-text)] outline-none transition","focus-visible:ring-2 focus-visible:ring-[color:color-mix(in_srgb,var(--rb-orange),white_65%)] focus-visible:ring-offset-2 focus-visible:ring-offset-white","disabled:cursor-not-allowed disabled:bg-[var(--rb-surface-muted)] disabled:opacity-70","bg-[right_0.75rem_center] bg-no-repeat pr-10",'[background-image:url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="%236b7280" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>\')]',e),...s,children:r})}e.s(["Select",()=>r])},9392,e=>{"use strict";var t=e.i(48277),a=e.i(30668),r=e.i(96086),s=e.i(2585),i=e.i(23187),l=e.i(86099),n=e.i(78030),d=e.i(69503),o=e.i(19463),c=e.i(9693),u=e.i(72015),m=e.i(68501),b=e.i(40709),x=e.i(1831),p=e.i(1314);function f({field:e,label:a,active:r,onSelect:s}){return(0,t.jsx)(c.Button,{size:"sm",variant:r?"primary":"outline",className:"rounded-none border-0",onClick:()=>s(e),type:"button",children:a})}function v(e){if("string"!=typeof e)return null;let t=e.trim();if(""===t)return null;let a=new Date(t);return Number.isNaN(a.getTime())?null:a.toISOString().slice(0,10)}function h(){let e=(0,p.useAuth)(),h=(0,r.useRouter)(),g="get-up-and-glo",j=e.isAdmin,[N,y]=a.default.useState("pickup_date"),[w,_]=a.default.useState("all"),[S,k]=a.default.useState(!0),[C,$]=a.default.useState(null),[A,E]=a.default.useState([]),[B,T]=a.default.useState(null),[D,P]=a.default.useState(!1),[M,R]=a.default.useState(!1),z=a.default.useRef(null),L=a.default.useRef(0);a.default.useEffect(()=>{"my_assignments"!==w||j||_("all")},[w,j]);let I=e.user?.id??null,F=a.default.useCallback(async()=>{k(!0),$(null);try{let e=new URLSearchParams;e.set("page","1"),e.set("per_page","100");let[t,a]=await Promise.all([(0,x.apiFetch)(`/api/${g}/app/repairbuddy/jobs?${e.toString()}`),(0,x.apiFetch)(`/api/${g}/app/repairbuddy/estimates?limit=200`)]),r=Array.isArray(t?.jobs)?t.jobs:[],s=Array.isArray(a?.estimates)?a.estimates:[],i=[];for(let e of r){let t="number"==typeof e?.id?e.id:NaN;if(!Number.isFinite(t))continue;let a=Array.isArray(e?.assigned_technicians)?e.assigned_technicians:[],r="number"==typeof I&&a.some(e=>e?.id===I),s="string"==typeof e?.customer?.name?e.customer.name:"Unknown";i.push({id:`job-${t}`,type:"job",numericId:t,caseNumber:"string"==typeof e?.case_number&&""!==e.case_number.trim()?e.case_number:String(t),customerName:s,status:"string"==typeof e?.status&&""!==e.status.trim()?e.status:"Job",assignedToMe:r,pickup_date:v(e?.pickup_date),delivery_date:v(e?.delivery_date),next_service_date:v(e?.next_service_date),post_date:v(e?.created_at)})}for(let e of s){let t="number"==typeof e?.id?e.id:NaN;if(!Number.isFinite(t))continue;let a="number"==typeof I&&"number"==typeof e?.assigned_technician_id&&e.assigned_technician_id===I,r="string"==typeof e?.customer?.name?e.customer.name:"Unknown";i.push({id:`estimate-${t}`,type:"estimate",numericId:t,caseNumber:"string"==typeof e?.case_number&&""!==e.case_number.trim()?e.case_number:String(t),customerName:r,status:"string"==typeof e?.status&&""!==e.status.trim()?e.status:"Estimate",assignedToMe:a,pickup_date:v(e?.pickup_date),delivery_date:v(e?.delivery_date),next_service_date:null,post_date:v(e?.created_at)})}E(i),L.current=Date.now()}catch(e){if(e instanceof x.ApiError&&428===e.status){let e=`/app/${g}/calendar`;h.replace(`/app/${g}/branches/select?next=${encodeURIComponent(e)}`);return}$(e instanceof Error?e.message:"Failed to load calendar data."),E([])}finally{k(!1)}},[h,g,I]);a.default.useEffect(()=>{F()},[F]);let O=a.default.useMemo(()=>"jobs"===w?A.filter(e=>"job"===e.type):"estimates"===w?A.filter(e=>"estimate"===e.type):"my_assignments"===w?A.filter(e=>e.assignedToMe):A,[w,A]),U=a.default.useCallback(e=>"pickup_date"===N?e.pickup_date:"delivery_date"===N?e.delivery_date:"next_service_date"===N?e.next_service_date:e.post_date,[N]),J=a.default.useMemo(()=>{if(!B)return O;let e=B.start,t=B.end;return O.filter(a=>{let r=U(a);return!!r&&r>=e&&r<t})},[B,U,O]),G=a.default.useMemo(()=>({jobs:J.filter(e=>"job"===e.type).length,estimates:J.filter(e=>"estimate"===e.type).length}),[J]),H=a.default.useCallback((e,t,a)=>{let r=e.startStr.split("T")[0]??e.startStr,s=e.endStr.split("T")[0]??e.endStr;try{let e=[];for(let t of O){var i;let a=U(t);if(!a||!(a>=r)||!(a<s))continue;let l="estimate"===t.type?"Estimate":"Job",n="estimate"===t.type?`/app/${g}/estimates/${t.numericId}`:`/app/${g}/jobs/${t.numericId}`;e.push({id:t.id,title:`${l} ${t.caseNumber}`,start:a,allDay:!0,classNames:["estimate"===t.type?"estimate-event":"job-event",(i=t.status,`status-${i.toLowerCase().replace(/\s+/g,"").replace(/\//g,"")}`)],extendedProps:{type:t.type,status:t.status,tooltip:`Case: ${t.caseNumber} | Customer: ${t.customerName} | Status: ${t.status}`,customerName:t.customerName,caseNumber:t.caseNumber,href:n}})}t(e)}catch(e){a(e instanceof Error?e:Error("Failed to build calendar events."))}},[U,g,O]);async function K(){if(!D){P(!0);try{await F(),z.current?.getApi().refetchEvents()}finally{P(!1)}}}a.default.useEffect(()=>{z.current?.getApi().refetchEvents()},[N,w]);let V=a.default.useCallback(e=>y(e),[]),W=0===O.length?S?"Loadingâ€¦":C?"Calendar data could not be loaded.":"No items match the current filter.":null;return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(o.PageHeader,{title:"Service Calendar",description:"View and manage all your service appointments and estimates",actions:(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-2",children:(0,t.jsxs)("div",{className:"inline-flex overflow-hidden rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white",children:[(0,t.jsx)(f,{field:"pickup_date",label:"Pickup Date",active:"pickup_date"===N,onSelect:V}),(0,t.jsx)("div",{className:"h-8 w-px bg-[var(--rb-border)]"}),(0,t.jsx)(f,{field:"delivery_date",label:"Delivery Date",active:"delivery_date"===N,onSelect:V}),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"h-8 w-px bg-[var(--rb-border)]"}),(0,t.jsx)(f,{field:"next_service_date",label:"Next Service",active:"next_service_date"===N,onSelect:V})]}),(0,t.jsx)("div",{className:"h-8 w-px bg-[var(--rb-border)]"}),(0,t.jsx)(f,{field:"post_date",label:"Creation",active:"post_date"===N,onSelect:V})]})})}),(0,t.jsx)(u.Card,{className:"shadow-none",children:(0,t.jsxs)(u.CardContent,{className:"pt-5",children:[(0,t.jsxs)("div",{className:"rounded-[var(--rb-radius-md)] bg-[var(--rb-surface-muted)] p-4",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Filter:"}),(0,t.jsxs)(b.Select,{value:w,onChange:e=>_(e.target.value),className:"w-auto min-w-[180px]",disabled:S||D||M,children:[(0,t.jsx)("option",{value:"all",children:"All Items"}),(0,t.jsx)("option",{value:"jobs",children:"Jobs Only"}),(0,t.jsx)("option",{value:"estimates",children:"Estimates Only"}),j?(0,t.jsx)("option",{value:"my_assignments",children:"My Assignments"}):null]}),(0,t.jsx)("input",{type:"hidden",value:N,readOnly:!0})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(c.Button,{size:"sm",variant:"outline",onClick:()=>void F(),disabled:S||D,children:"Reload data"}),(0,t.jsx)(c.Button,{size:"sm",variant:"primary",onClick:()=>void K(),disabled:S||D,children:D?"Loading...":"Refresh"})]})]}),C?(0,t.jsx)("div",{className:"mt-3 rounded-[var(--rb-radius-sm)] border border-red-200 bg-red-50 p-3 text-sm text-red-800",children:C}):null,!C&&"number"==typeof L.current&&L.current>0?(0,t.jsxs)("div",{className:"mt-3 text-xs text-zinc-500",children:["Last updated: ",new Date(L.current).toLocaleString()]}):null]}),(0,t.jsxs)("div",{className:"relative mt-4",children:[(0,t.jsx)("div",{className:"rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-white",style:{minHeight:500},children:(0,t.jsx)(s.default,{ref:z,plugins:[i.default,l.default,n.default,d.default],initialView:"dayGridMonth",headerToolbar:{left:"prevYear,prev,next,nextYear today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},buttonText:{today:"Today",month:"Month",week:"Week",day:"Day",list:"List"},height:"auto",expandRows:!0,navLinks:!0,nowIndicator:!0,editable:!1,selectable:!0,dayMaxEvents:10,events:H,datesSet:e=>{let t=e.start,a=e.end,r=t instanceof Date&&!Number.isNaN(t.getTime())?t.toISOString().slice(0,10):null,s=a instanceof Date&&!Number.isNaN(a.getTime())?a.toISOString().slice(0,10):null;r&&s&&T({start:r,end:s})},eventDidMount:e=>{let t=e.event.extendedProps?.tooltip;"string"==typeof t&&t.length>0&&e.el.setAttribute("title",t)},eventClick:e=>{let t=e.event.extendedProps?.href;"string"==typeof t&&""!==t.trim()&&(e.jsEvent.preventDefault(),h.push(t))},eventContent:e=>{let a=e.event.extendedProps,r=a?.status,s="string"==typeof a?.customerName?a.customerName:"";return(0,t.jsxs)("div",{className:"flex min-w-0 flex-col",children:[(0,t.jsx)("div",{className:"truncate text-[0.8125rem] font-semibold leading-[1.1]",children:e.event.title}),s?(0,t.jsx)("div",{className:"truncate text-[0.8125rem] leading-[1.1]",children:s}):null,r?(0,t.jsx)("div",{className:"truncate text-[0.8125rem] opacity-80",children:r}):null]})},loading:e=>{R(e)}})}),M||S?(0,t.jsx)("div",{className:"absolute left-1/2 top-1/2 z-10 w-[280px] -translate-x-1/2 -translate-y-1/2 rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-white p-4 shadow",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,t.jsx)("div",{className:"h-7 w-7 animate-spin rounded-full border-2 border-[var(--rb-border)] border-t-[var(--rb-blue)]"}),(0,t.jsx)("div",{className:"text-sm text-zinc-600",children:"Loading calendar events..."})]})}):null,S||C||!W?null:(0,t.jsx)("div",{className:"mt-3 rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-[var(--rb-surface-muted)] p-4 text-sm text-zinc-600",children:W})]}),(0,t.jsx)("div",{className:"mt-5 border-t border-[var(--rb-border)] pt-4",children:(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm text-zinc-500",children:"Legend:"}),(0,t.jsx)(m.Badge,{className:"!bg-[var(--rb-blue)] !text-white !border-transparent shadow-sm",children:"Job"}),(0,t.jsx)(m.Badge,{className:"!bg-[var(--rb-orange)] !text-white !border-transparent shadow-sm",children:"Estimate"}),(0,t.jsx)(m.Badge,{className:"!bg-[#16a34a] !text-white !border-transparent shadow-sm",children:"New/Quote"}),(0,t.jsx)(m.Badge,{className:"!bg-[#0ea5e9] !text-white !border-transparent shadow-sm",children:"In Process"}),(0,t.jsx)(m.Badge,{className:"!bg-[#dc2626] !text-white !border-transparent shadow-sm",children:"Cancelled"}),(0,t.jsx)(m.Badge,{className:"!bg-[#fd7e14] !text-white !border-transparent shadow-sm",children:"Ready"}),(0,t.jsx)(m.Badge,{className:"!bg-[#6f42c1] !text-white !border-transparent shadow-sm",children:"Completed"}),(0,t.jsx)(m.Badge,{className:"!bg-[#e83e8c] !text-white !border-transparent shadow-sm",children:"Delivered"})]})})]})}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)(u.Card,{className:"relative overflow-hidden border-0 bg-gradient-to-br from-[var(--rb-blue)] via-[#1d4ed8] to-[#0ea5e9] text-white shadow-sm",children:[(0,t.jsx)("div",{className:"pointer-events-none absolute -right-12 -top-12 h-40 w-40 rounded-full bg-white/10"}),(0,t.jsx)("div",{className:"pointer-events-none absolute -bottom-16 -left-16 h-56 w-56 rounded-full bg-black/10"}),(0,t.jsxs)(u.CardContent,{className:"relative pt-5",children:[(0,t.jsx)("div",{className:"text-sm font-semibold opacity-90",children:"Total Jobs"}),(0,t.jsx)("div",{className:"mt-2 text-4xl font-bold",children:G.jobs})]})]}),(0,t.jsxs)(u.Card,{className:"relative overflow-hidden border-0 bg-gradient-to-br from-[#16a34a] via-[#22c55e] to-[#10b981] text-white shadow-sm",children:[(0,t.jsx)("div",{className:"pointer-events-none absolute -right-12 -top-12 h-40 w-40 rounded-full bg-white/10"}),(0,t.jsx)("div",{className:"pointer-events-none absolute -bottom-16 -left-16 h-56 w-56 rounded-full bg-black/10"}),(0,t.jsxs)(u.CardContent,{className:"relative pt-5",children:[(0,t.jsx)("div",{className:"text-sm font-semibold opacity-90",children:"Total Estimates"}),(0,t.jsx)("div",{className:"mt-2 text-4xl font-bold",children:G.estimates})]})]})]})]})}e.s(["default",()=>h])}]);