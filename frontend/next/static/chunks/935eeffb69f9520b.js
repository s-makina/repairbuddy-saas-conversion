(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,68501,e=>{"use strict";var r=e.i(48277),s=e.i(14575);function a({className:e,variant:a="default",...t}){return(0,r.jsx)("span",{className:(0,s.cn)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-medium",{default:"bg-[var(--rb-surface-muted)] text-[var(--rb-text)] border-[var(--rb-border)]",info:"bg-[color:color-mix(in_srgb,var(--rb-blue),white_85%)] text-[var(--rb-blue)] border-[color:color-mix(in_srgb,var(--rb-blue),white_70%)]",success:"bg-[color:color-mix(in_srgb,#16a34a,white_85%)] text-[#166534] border-[color:color-mix(in_srgb,#16a34a,white_70%)]",warning:"bg-[color:color-mix(in_srgb,var(--rb-orange),white_85%)] text-[color:color-mix(in_srgb,var(--rb-orange),black_20%)] border-[color:color-mix(in_srgb,var(--rb-orange),white_70%)]",danger:"bg-[color:color-mix(in_srgb,#dc2626,white_85%)] text-[#991b1b] border-[color:color-mix(in_srgb,#dc2626,white_70%)]"}[a],e),...t})}e.s(["Badge",()=>a])},19463,e=>{"use strict";var r=e.i(48277),s=e.i(14575);function a({title:e,description:a,actions:t,className:i}){return(0,r.jsxs)("div",{className:(0,s.cn)("flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between",i),children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-xl font-semibold text-[var(--rb-text)]",children:e}),a?(0,r.jsx)("p",{className:"mt-1 text-sm text-zinc-600",children:a}):null]}),t?(0,r.jsx)("div",{className:"flex items-center gap-2",children:t}):null]})}e.s(["PageHeader",()=>a])},43901,e=>{"use strict";var r=e.i(48277),s=e.i(14575),a=e.i(72015);function t({className:e,"aria-hidden":a=!0,...t}){return(0,r.jsx)("div",{"aria-hidden":a,className:(0,s.cn)("rb-skeleton",e),...t})}function i({lines:e=3,className:i}){let l=Math.max(1,Math.min(e,12));return(0,r.jsx)(a.Card,{className:(0,s.cn)("overflow-hidden",i),children:(0,r.jsxs)(a.CardContent,{className:"space-y-3 pt-5",children:[(0,r.jsx)(t,{className:"h-4 w-32 rounded-[var(--rb-radius-sm)]"}),Array.from({length:l}).map((e,a)=>(0,r.jsx)(t,{className:(0,s.cn)("h-3 rounded-[var(--rb-radius-sm)]",a===l-1?"w-3/5":"w-full")},a))]})})}function l({rows:e=6,columns:a=5,className:i}){let l=Math.max(1,Math.min(e,20)),n=Math.max(1,Math.min(a,10));return(0,r.jsxs)("div",{className:(0,s.cn)("overflow-hidden rounded-[var(--rb-radius-lg)] border border-[var(--rb-border)] bg-white shadow-[var(--rb-shadow)]",i),children:[(0,r.jsx)("div",{className:"border-b border-[var(--rb-border)] px-5 py-4",children:(0,r.jsx)("div",{className:"grid gap-3",style:{gridTemplateColumns:`repeat(${n}, minmax(0, 1fr))`},children:Array.from({length:n}).map((e,s)=>(0,r.jsx)(t,{className:"h-3 w-full rounded-[var(--rb-radius-sm)]"},s))})}),(0,r.jsx)("div",{className:"px-5 pb-5 pt-4",children:(0,r.jsx)("div",{className:"space-y-3",children:Array.from({length:l}).map((e,a)=>(0,r.jsx)("div",{className:"grid gap-3",style:{gridTemplateColumns:`repeat(${n}, minmax(0, 1fr))`},children:Array.from({length:n}).map((e,a)=>(0,r.jsx)(t,{className:(0,s.cn)("h-3 rounded-[var(--rb-radius-sm)]",0===a?"w-3/4":"w-full")},a))},a))})})]})}e.s(["CardSkeleton",()=>i,"Skeleton",()=>t,"TableSkeleton",()=>l])},37574,e=>{"use strict";var r=e.i(48277),s=e.i(30668),a=e.i(14575),t=e.i(9693),i=e.i(33441),l=e.i(43901),n=e.i(1831);function d({title:e,data:d,columns:o,getRowId:c,loading:m=!1,emptyMessage:u="No data.",search:h,filters:x=[],pageSizeOptions:p=[10,25,50],initialPageSize:b=10,server:v,exportConfig:g,columnVisibilityKey:f,onRowClick:j,className:w}){let[y,N]=(0,s.useState)(""),[S,_]=(0,s.useState)(0),[C,k]=(0,s.useState)(b),[M,A]=(0,s.useState)(null),[$,z]=(0,s.useState)(null),[I,D]=(0,s.useState)(0),B=(0,s.useId)(),F=!!v,P=F?v.query:y,E=F?v.onQueryChange:N,T=F?v.pageIndex:S,L=F?v.onPageIndexChange:_,R=F?v.pageSize:C,O=F?v.onPageSizeChange:k,U=F?v.sort??null:null,q=F?v.onSortChange:void 0,H=(0,s.useMemo)(()=>{let e=Array.isArray(o)?o:[];if(!f){let r=e.filter(e=>!e.hiddenByDefault);return r.length>0?r:e.slice(0,1)}try{let r=window.localStorage.getItem(f);if(!r){let r=e.filter(e=>!e.hiddenByDefault);return r.length>0?r:e.slice(0,1)}let s=JSON.parse(r),a=e.filter(e=>{let r=s[e.id];return"boolean"==typeof r?r:!e.hiddenByDefault});return a.length>0?a:e.slice(0,1)}catch{let r=e.filter(e=>!e.hiddenByDefault);return r.length>0?r:e.slice(0,1)}},[f,o,I]),W=(0,s.useMemo)(()=>{if(F)return Array.isArray(d)?d:[];let e=P.trim().toLowerCase();return(Array.isArray(d)?d:[]).filter(r=>{if(h&&h.getSearchText&&e.length>0&&!h.getSearchText(r).toLowerCase().includes(e))return!1;for(let e of x)if(e.predicate&&!e.predicate(r,e.value))return!1;return!0})},[d,x,F,P,h]),K=F?v.totalRows:W.length,Q=Math.max(1,Math.ceil(K/R)),J=Math.min(T,Q-1),V=Math.max(1,Math.min(8,R||10)),G=(0,s.useMemo)(()=>{if(F)return W;let e=J*R,r=e+R;return W.slice(e,r)},[J,W,F,R]),X=J>0,Y=J<Q-1,Z=!!h||x.length>0||!!g||!!f;function ee(e,r){if(f&&(r||!(H.length<=1)))try{let s=window.localStorage.getItem(f),a=(s?JSON.parse(s):{})??{};a[e]=r,window.localStorage.setItem(f,JSON.stringify(a)),D(e=>e+1)}catch{}}async function er(e){if(g&&!M){z(null),A(e);try{let r=new URLSearchParams;for(let e of(P.trim().length>0&&r.set("q",P.trim()),x)){let s=e.value;null!=s&&0!==String(s).length&&r.set(e.id,String(s))}if(F&&U?.id&&U?.dir&&(r.set("sort",U.id),r.set("dir",U.dir)),r.set("format",e),g.extraQuery)for(let[e,s]of Object.entries(g.extraQuery))null!=s&&r.set(e,String(s));let s=`${g.url}${g.url.includes("?")?"&":"?"}${r.toString()}`,a=g.filename?.({format:e});await (0,n.apiDownload)(s,{filename:a})}catch(e){z(e instanceof Error?e.message:"Export failed.")}finally{A(null)}}}return(0,r.jsxs)("div",{className:(0,a.cn)("space-y-3",w),children:[e?(0,r.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:e}):null,Z?(0,r.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-end md:justify-between",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-end",children:[h?(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-sm font-medium",htmlFor:`${B}_datatable_search`,children:"Search"}),(0,r.jsx)("input",{id:`${B}_datatable_search`,className:"w-full min-w-[220px] rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:P,onChange:e=>{E(e.target.value),L(0)},placeholder:h.placeholder??"Search..."})]}):null,x.map(e=>(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-sm font-medium",htmlFor:`${B}_datatable_filter_${e.id}`,children:e.label}),(0,r.jsx)("select",{id:`${B}_datatable_filter_${e.id}`,className:"w-full min-w-[180px] rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:String(e.value),onChange:r=>{let s=e.options.find(e=>String(e.value)===r.target.value),a=s?s.value:r.target.value;e.onChange(a),L(0)},children:e.options.map(e=>(0,r.jsx)("option",{value:String(e.value),children:e.label},String(e.value)))})]},e.id))]}),(0,r.jsxs)("div",{className:"flex flex-col items-start gap-2 md:items-end",children:[(0,r.jsxs)("div",{className:"text-sm text-zinc-600",children:[K," result(s)"]}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[g?(0,r.jsx)(i.DropdownMenu,{align:"right",trigger:({toggle:e})=>(0,r.jsx)(t.Button,{variant:"outline",size:"sm",onClick:e,disabled:!!M,children:M?"Exporting...":"Export"}),children:({close:e})=>{let s=g.formats??["csv","xlsx","pdf"];return(0,r.jsx)(r.Fragment,{children:s.map(s=>(0,r.jsxs)(i.DropdownMenuItem,{onSelect:()=>{e(),er(s)},disabled:!!M,children:["Export ",s.toUpperCase()]},s))})}}):null,f?(0,r.jsx)(i.DropdownMenu,{align:"right",trigger:({toggle:e})=>(0,r.jsx)(t.Button,{variant:"outline",size:"sm",onClick:e,children:"Columns"}),children:({close:e})=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.DropdownMenuItem,{onSelect:()=>{for(let r of(e(),o))ee(r.id,!0)},children:"Show all"}),(0,r.jsx)(i.DropdownMenuItem,{onSelect:()=>{for(let r of(e(),o))ee(r.id,!r.hiddenByDefault)},children:"Reset defaults"}),(0,r.jsx)(i.DropdownMenuSeparator,{}),o.map(e=>{let s=H.some(r=>r.id===e.id);return(0,r.jsxs)(i.DropdownMenuItem,{onSelect:()=>{ee(e.id,!s)},children:[(0,r.jsx)("span",{className:"mr-2 inline-block w-4",children:s?"✓":""}),"string"==typeof e.header?e.header:e.id]},e.id)})]})}):null]})]})]}):null,$?(0,r.jsx)("div",{className:"text-sm text-red-600",children:$}):null,(0,r.jsx)("div",{className:"overflow-x-auto rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-white",children:(0,r.jsxs)("table",{className:"min-w-full border-collapse text-left text-sm",children:[(0,r.jsx)("thead",{className:"bg-[var(--rb-surface-muted)]",children:(0,r.jsx)("tr",{children:H.map(e=>(0,r.jsx)("th",{className:(0,a.cn)("whitespace-nowrap border-b border-[var(--rb-border)] px-3 py-2 text-xs font-semibold uppercase tracking-wide text-zinc-600",e.headerClassName),children:F&&e.sortId&&q?(0,r.jsxs)("button",{type:"button",onClick:()=>(function(e){if(F&&e.sortId&&q){if(!U||U.id!==e.sortId){q({id:e.sortId,dir:"asc"}),L(0);return}if("asc"===U.dir){q({id:e.sortId,dir:"desc"}),L(0);return}q(null),L(0)}})(e),className:"inline-flex items-center gap-1 hover:text-zinc-900",children:[(0,r.jsx)("span",{children:e.header}),F&&e.sortId?U&&U.id===e.sortId?"asc"===U.dir?(0,r.jsx)("span",{className:"ml-1 text-zinc-700",children:"↑"}):(0,r.jsx)("span",{className:"ml-1 text-zinc-700",children:"↓"}):(0,r.jsx)("span",{className:"ml-1 text-zinc-400",children:"↕"}):null]}):e.header},e.id))})}),(0,r.jsx)("tbody",{children:m?Array.from({length:V}).map((e,s)=>(0,r.jsx)("tr",{className:"border-t border-[var(--rb-border)]",children:H.map((e,s)=>(0,r.jsx)("td",{className:(0,a.cn)("px-3 py-2 align-middle",e.className),children:(0,r.jsx)(l.Skeleton,{className:(0,a.cn)("h-3 rounded-[var(--rb-radius-sm)]",0===s?"w-3/4":s===H.length-1?"w-16":"w-full")})},e.id))},`loading_${s}`)):0===G.length?(0,r.jsx)("tr",{children:(0,r.jsx)("td",{className:"px-3 py-3 text-sm text-zinc-600",colSpan:Math.max(1,H.length),children:u})}):G.map(e=>(0,r.jsx)("tr",{className:(0,a.cn)("border-t border-[var(--rb-border)]",j?"cursor-pointer hover:bg-[var(--rb-surface-muted)]":null),tabIndex:j?0:void 0,role:j?"button":void 0,onClick:j?()=>{j(e)}:void 0,onKeyDown:j?r=>{("Enter"===r.key||" "===r.key)&&(r.preventDefault(),j(e))}:void 0,children:H.map(s=>(0,r.jsx)("td",{className:(0,a.cn)("px-3 py-2 align-middle",s.className),children:s.cell(e)},s.id))},String(c(e))))})]})}),(0,r.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(t.Button,{variant:"outline",size:"sm",onClick:function(){L(Math.max(0,J-1))},disabled:!X,children:"Prev"}),(0,r.jsx)(t.Button,{variant:"outline",size:"sm",onClick:function(){L(Math.min(Q-1,J+1))},disabled:!Y,children:"Next"}),(0,r.jsxs)("div",{className:"text-sm text-zinc-600",children:["Page ",J+1," / ",Q]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"text-sm text-zinc-600",children:"Rows per page"}),(0,r.jsx)("select",{className:"rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:String(R),onChange:e=>{O(Number(e.target.value)),L(0)},children:p.map(e=>(0,r.jsx)("option",{value:e,children:e},e))})]})]})]})}e.s(["DataTable",()=>d])},66474,e=>{"use strict";var r=e.i(48277),s=e.i(30668),a=e.i(14575);function t({open:e,onClose:t,title:i,children:l,footer:n,position:d="center",variant:o="glass",className:c}){if((0,s.useEffect)(()=>{function r(r){e&&"Escape"===r.key&&t()}return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[t,e]),!e)return null;let m="solid"===o?(0,a.cn)("relative w-full max-w-lg overflow-hidden rounded-[var(--rb-radius-lg)]","border border-[var(--rb-border)]","bg-white","shadow-[var(--rb-shadow)]"):(0,a.cn)("relative w-full max-w-lg overflow-hidden rounded-[var(--rb-radius-lg)]","border border-[color:color-mix(in_srgb,var(--rb-border),white_55%)]","bg-white/75 backdrop-blur-xl","shadow-[0_18px_55px_-18px_rgba(0,0,0,0.55)]","ring-1 ring-white/25");return(0,r.jsxs)("div",{className:"top-center"===d?"fixed inset-0 z-50 flex items-start justify-center px-4 pt-8":"fixed inset-0 z-50 flex items-center justify-center px-4",children:[(0,r.jsx)("button",{type:"button",className:(0,a.cn)("absolute inset-0","bg-black/35 backdrop-blur-md","bg-[radial-gradient(900px_600px_at_20%_20%,color-mix(in_srgb,#16a34a,transparent_82%)_0%,transparent_60%),radial-gradient(900px_600px_at_80%_30%,color-mix(in_srgb,var(--rb-blue),transparent_82%)_0%,transparent_60%),radial-gradient(900px_600px_at_50%_85%,color-mix(in_srgb,var(--rb-orange),transparent_85%)_0%,transparent_65%)]"),"aria-label":"Close",onClick:t}),(0,r.jsxs)("div",{role:"dialog","aria-modal":"true",className:(0,a.cn)(m,c),children:["glass"===o?(0,r.jsx)("div",{className:"pointer-events-none absolute inset-0 bg-[radial-gradient(650px_420px_at_20%_15%,color-mix(in_srgb,#16a34a,transparent_88%)_0%,transparent_60%),radial-gradient(650px_420px_at_80%_5%,color-mix(in_srgb,var(--rb-blue),transparent_90%)_0%,transparent_60%)]"}):null,i?(0,r.jsx)("div",{className:(0,a.cn)("relative px-5 py-4","solid"===o?"border-b border-[var(--rb-border)]":"border-b border-[color:color-mix(in_srgb,var(--rb-border),white_60%)]"),children:(0,r.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:i})}):null,(0,r.jsx)("div",{className:"relative px-5 py-4",children:l}),n?(0,r.jsx)("div",{className:(0,a.cn)("relative px-5 py-4","solid"===o?"border-t border-[var(--rb-border)]":"border-t border-[color:color-mix(in_srgb,var(--rb-border),white_60%)]"),children:n}):null]})]})}e.s(["Modal",()=>t])},64998,e=>{"use strict";var r=e.i(48277),s=e.i(66474),a=e.i(9693);function t({open:e,title:t,message:i,confirmText:l="Confirm",confirmVariant:n="primary",cancelText:d="Cancel",busy:o=!1,onCancel:c,onConfirm:m}){return(0,r.jsx)(s.Modal,{open:e,onClose:()=>{o||c()},title:t,footer:(0,r.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,r.jsx)(a.Button,{variant:"outline",onClick:c,disabled:o,children:d}),(0,r.jsx)(a.Button,{variant:n,onClick:m,disabled:o,children:o?"Working...":l})]}),children:(0,r.jsx)("div",{className:"text-sm text-zinc-700",children:i})})}e.s(["ConfirmDialog",()=>t])},44919,e=>{"use strict";var r=e.i(54976);e.s(["notify",0,{success:(e,s={})=>r.toast.success(e,s),error:(e,s={})=>r.toast.error(e,s),info:(e,s={})=>r.toast.info(e,s),warning:(e,s={})=>r.toast.warning(e,s),loading:(e,s={})=>r.toast.loading(e,s),dismiss(e){r.toast.dismiss(e)},message:(e,s,a={})=>"success"===e?r.toast.success(s,a):"error"===e?r.toast.error(s,a):"warning"===e?r.toast.warning(s,a):"loading"===e?r.toast.loading(s,a):r.toast.info(s,a)}])},61053,e=>{"use strict";var r=e.i(48277),s=e.i(1831),a=e.i(9693),t=e.i(68501),i=e.i(72015),l=e.i(64998),n=e.i(37574),d=e.i(33441),o=e.i(19463),c=e.i(77252),m=e.i(1314),u=e.i(44919),h=e.i(43901),x=e.i(96086),p=e.i(30668);function b(e){return(0,r.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e.className,"aria-hidden":"true",children:[(0,r.jsx)("path",{d:"M12 20h9",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,r.jsx)("path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}function v(e){return(0,r.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:e.className,"aria-hidden":"true",children:[(0,r.jsx)("path",{d:"M3 9.5L5 4h14l2 5.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,r.jsx)("path",{d:"M4 10h16v10H4V10z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,r.jsx)("path",{d:"M9 20v-6h6v6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}function g(){let e=(0,m.useAuth)(),g=(0,x.useParams)(),f=g.business??g.tenant,[j,w]=(0,p.useState)(!0),[y,N]=(0,p.useState)([]),[S,_]=(0,p.useState)([]),[C,k]=(0,p.useState)([]),[M,A]=(0,p.useState)(""),[$,z]=(0,p.useState)(""),[I,D]=(0,p.useState)(null),[B,F]=(0,p.useState)(""),[P,E]=(0,p.useState)({}),[T,L]=(0,p.useState)(!1),[R,O]=(0,p.useState)(null),[U,q]=(0,p.useState)("all"),[H,W]=(0,p.useState)("all"),[K,Q]=(0,p.useState)(""),[J,V]=(0,p.useState)(0),[G,X]=(0,p.useState)(10),[Y,Z]=(0,p.useState)(0),[ee,er]=(0,p.useState)(null),[es,ea]=(0,p.useState)(null),[et,ei]=(0,p.useState)(!1),[el,en]=(0,p.useState)(""),[ed,eo]=(0,p.useState)(""),[ec,em]=(0,p.useState)(null),eu=(0,p.useMemo)(()=>{let e=new Map;for(let r of S)e.set(r.id,r.name);return e},[S]),eh=(0,p.useMemo)(()=>C.slice().sort((e,r)=>`${e.code} ${e.name}`.localeCompare(`${r.code} ${r.name}`)).map(e=>({id:e.id,label:`${e.code} - ${e.name}${e.is_active?"":" (inactive)"}`,isActive:e.is_active})),[C]),ex=(0,p.useMemo)(()=>eh.filter(e=>e.isActive),[eh]),ep=(0,p.useMemo)(()=>{let e=B.trim().toLowerCase();return e?ex.filter(r=>r.label.toLowerCase().includes(e)):ex},[ex,B]),eb=(0,p.useMemo)(()=>0!==ep.length&&ep.every(e=>!!P[e.id]),[ep,P]),ev=(0,p.useMemo)(()=>ep.some(e=>!!P[e.id]),[ep,P]),eg=(0,p.useRef)(null);(0,p.useEffect)(()=>{eg.current&&(eg.current.indeterminate=ev&&!eb)},[eb,ev]);let ef=(0,p.useMemo)(()=>[{label:"All roles",value:"all"},{label:"(none)",value:"none"},...S.map(e=>({label:e.name,value:String(e.id)}))],[S]),ej=(0,p.useMemo)(()=>[{label:"All statuses",value:"all"},{label:"Pending",value:"pending"},{label:"Active",value:"active"},{label:"Inactive",value:"inactive"},{label:"Suspended",value:"suspended"}],[]),ew=(0,p.useMemo)(()=>new Map([["pending","warning"],["active","success"],["inactive","default"],["suspended","danger"]]),[]);async function ey({includeRoles:r}){if("string"==typeof f&&0!==f.length){w(!0);try{let a=new URLSearchParams;K.trim().length>0&&a.set("q",K.trim()),U&&"all"!==U&&a.set("role",U),H&&"all"!==H&&a.set("status",H),ee?.id&&ee?.dir&&(a.set("sort",ee.id),a.set("dir",ee.dir)),a.set("page",String(J+1)),a.set("per_page",String(G));let t=`/api/${f}/app/users?${a.toString()}`;if(r){let[r,a,i]=await Promise.all([(0,s.apiFetch)(t),(0,s.apiFetch)(`/api/${f}/app/roles`),(0,s.apiFetch)(`/api/${f}/app/branches`)]);N(Array.isArray(r.users)?r.users:[]),Z("number"==typeof r.meta?.total?r.meta.total:0),X("number"==typeof r.meta?.per_page?r.meta.per_page:G),_(Array.isArray(a.roles)?a.roles:[]),k(Array.isArray(i.branches)?i.branches:[]);let l=(Array.isArray(a.roles)?a.roles:[])[0]?.id??null;D(l);let n=e.tenant?.default_branch_id??null,d=(Array.isArray(i.branches)?i.branches:[]).filter(e=>e.is_active).map(e=>e.id),o=(n&&d.includes(n)?[n]:[]).concat(d.length>0?[d[0]]:[]).filter((e,r,s)=>s.indexOf(e)===r);E(e=>{if(Object.keys(e).length>0)return e;let r={};for(let e of o)r[e]=!0;return r})}else{let e=await (0,s.apiFetch)(t);N(Array.isArray(e.users)?e.users:[]),Z("number"==typeof e.meta?.total?e.meta.total:0),X("number"==typeof e.meta?.per_page?e.meta.per_page:G)}}catch(e){u.notify.error(e instanceof Error?e.message:"Failed to load users.")}finally{w(!1)}}}async function eN(e){O(e);try{await (0,s.apiFetch)(`/api/${f}/app/users/${e}/reset-password`,{method:"POST"}),u.notify.success("Password reset link sent.")}catch(e){e instanceof s.ApiError?u.notify.error(e.message):u.notify.error("Failed to send password reset link.")}finally{O(null)}}async function eS(r){if(r.preventDefault(),!I||0===ex.length)return;let a=Object.entries(P).filter(([,e])=>e).map(([e])=>Number(e)).filter(e=>Number.isFinite(e)&&e>0);if(0===a.length)return void u.notify.error("Select at least one shop.");L(!0);try{if(es){await (0,s.apiFetch)(`/api/${f}/app/users/${es}`,{method:"PUT",body:{name:M,email:$,role_id:I}});let e=await (0,s.apiFetch)(`/api/${f}/app/users/${es}/shop`,{method:"PATCH",body:{branch_ids:a}});N(r=>r.map(r=>r.id===es?e.user:r)),u.notify.success("User updated.")}else await (0,s.apiFetch)(`/api/${f}/app/users`,{method:"POST",body:{name:M,email:$,role_id:I,branch_ids:a}}),u.notify.success("User created. One-time password emailed.");A(""),z(""),F(""),E({}),ea(null),V(0),await ey({includeRoles:!1}),await e.refresh()}catch(e){e instanceof s.ApiError?u.notify.error(e.message):u.notify.error(es?"Failed to update user.":"Failed to create user.")}finally{L(!1)}}async function e_(e,r){O(e);try{await (0,s.apiFetch)(`/api/${f}/app/users/${e}/status`,{method:"PATCH",body:{status:r}}),u.notify.success("User updated."),await ey({includeRoles:!1})}catch(e){e instanceof s.ApiError?u.notify.error(e.message):u.notify.error("Failed to update user.")}finally{O(null)}}function eC(e){en(e.title),eo(e.message),em(()=>e.action),ei(!0)}return(0,p.useEffect)(()=>{V(0),er(null),ey({includeRoles:!0})},[f]),(0,p.useEffect)(()=>{"string"==typeof f&&0!==f.length&&ey({includeRoles:!1})},[K,U,H,J,G,ee?.id,ee?.dir]),j&&0===y.length&&0===S.length&&0===C.length?(0,r.jsx)(c.RequireAuth,{requiredPermission:"users.manage",children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(o.PageHeader,{title:"Users",description:"Manage tenant users and their roles.",actions:(0,r.jsx)(a.Button,{type:"button",disabled:!0,children:"Invite user"})}),(0,r.jsx)(function(){return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(i.Card,{className:"shadow-none",children:(0,r.jsxs)(i.CardContent,{className:"pt-5",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(h.Skeleton,{className:"h-4 w-32 rounded-[var(--rb-radius-sm)]"}),(0,r.jsx)(h.Skeleton,{className:"mt-2 h-4 w-72 rounded-[var(--rb-radius-sm)]"})]}),(0,r.jsx)(h.Skeleton,{className:"h-9 w-28 rounded-[var(--rb-radius-sm)]"})]}),(0,r.jsxs)("div",{className:"mt-4 grid gap-6 lg:grid-cols-12",children:[(0,r.jsxs)("div",{className:"lg:col-span-7 space-y-3",children:[Array.from({length:4}).map((e,s)=>(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(h.Skeleton,{className:"h-3 w-20 rounded-[var(--rb-radius-sm)]"}),(0,r.jsx)(h.Skeleton,{className:"h-9 w-full rounded-[var(--rb-radius-sm)]"})]},s)),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(h.Skeleton,{className:"h-9 w-28 rounded-[var(--rb-radius-sm)]"}),(0,r.jsx)(h.Skeleton,{className:"h-9 w-20 rounded-[var(--rb-radius-sm)]"})]})]}),(0,r.jsx)("div",{className:"lg:col-span-5",children:(0,r.jsxs)("div",{className:"rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-[var(--rb-surface-muted)] p-4",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(h.Skeleton,{className:"h-4 w-20 rounded-[var(--rb-radius-sm)]"}),(0,r.jsx)(h.Skeleton,{className:"mt-2 h-3 w-48 rounded-[var(--rb-radius-sm)]"})]}),(0,r.jsx)(h.Skeleton,{className:"h-3 w-20 rounded-[var(--rb-radius-sm)]"})]}),(0,r.jsx)("div",{className:"mt-4 space-y-2",children:Array.from({length:6}).map((e,s)=>(0,r.jsx)("div",{className:"rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2",children:(0,r.jsx)(h.Skeleton,{className:"h-4 w-40 rounded-[var(--rb-radius-sm)]"})},s))})]})})]})]})}),(0,r.jsx)(h.TableSkeleton,{rows:8,columns:6})]})},{})]})}):(0,r.jsx)(c.RequireAuth,{requiredPermission:"users.manage",children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(o.PageHeader,{title:"Users",description:"Manage tenant users and their roles.",actions:(0,r.jsx)(a.Button,{type:"button",onClick:()=>{let e;ea(null),A(""),z(""),F(""),E({}),(e=document.getElementById("invite-user"))?e.scrollIntoView({behavior:"smooth",block:"start"}):window.scrollTo({top:0,behavior:"smooth"})},children:"Invite user"})}),(0,r.jsx)(l.ConfirmDialog,{open:et,title:el,message:ed,busy:!!R,onCancel:()=>{R||(ei(!1),em(null))},onConfirm:()=>{ec&&(async()=>{await ec(),ei(!1),em(null)})()}}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{children:(0,r.jsx)(i.Card,{className:"shadow-none",children:(0,r.jsxs)(i.CardContent,{className:"pt-5",children:[(0,r.jsx)("div",{id:"invite-user"}),(0,r.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:es?"Edit user":"Create user"}),(0,r.jsx)("form",{className:"mt-4",onSubmit:eS,children:(0,r.jsxs)("div",{className:"grid gap-6 lg:grid-cols-12",children:[(0,r.jsx)("div",{className:"lg:col-span-7",children:(0,r.jsxs)("div",{className:"grid gap-3",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-sm font-medium",htmlFor:"user_name",children:"Name"}),(0,r.jsx)("input",{id:"user_name",className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:M,onChange:e=>A(e.target.value),required:!0})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-sm font-medium",htmlFor:"user_email",children:"Email"}),(0,r.jsx)("input",{id:"user_email",className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:$,onChange:e=>z(e.target.value),type:"email",required:!0})]}),(0,r.jsx)("div",{className:"space-y-1",children:(0,r.jsx)("div",{className:"text-sm text-zinc-600",children:"A one-time password will be generated and emailed to the user."})}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-sm font-medium",htmlFor:"user_role",children:"Role"}),(0,r.jsx)("select",{id:"user_role",className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:I??"",onChange:e=>D(Number(e.target.value)),required:!0,children:S.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(a.Button,{type:"submit",disabled:T||j||0===S.length||0===ex.length||0===Object.values(P).filter(Boolean).length,children:T?"Saving...":es?"Save changes":"Create user"}),es?(0,r.jsx)(a.Button,{type:"button",variant:"outline",disabled:T||j,onClick:()=>{ea(null),A(""),z(""),F(""),E({})},children:"Cancel"}):null]}),0===S.length?(0,r.jsx)("div",{className:"mt-2 text-sm text-zinc-600",children:"Create a role first before adding users."}):null,0===ex.length?(0,r.jsx)("div",{className:"mt-2 text-sm text-zinc-600",children:"Create a shop first before adding users."}):null]})]})}),(0,r.jsx)("div",{className:"lg:col-span-5",children:(0,r.jsxs)("div",{className:"rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-[var(--rb-surface-muted)] p-4",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Shops"}),(0,r.jsx)("div",{className:"mt-1 text-xs text-zinc-600",children:"Select one or more shops this user can access."})]}),(0,r.jsxs)("div",{className:"text-xs text-zinc-600",children:["Selected: ",Object.values(P).filter(Boolean).length]})]}),(0,r.jsxs)("div",{className:"mt-3 space-y-1",children:[(0,r.jsx)("label",{className:"text-sm font-medium",htmlFor:"new_user_shop_search",children:"Search"}),(0,r.jsx)("input",{id:"new_user_shop_search",className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:B,onChange:e=>F(e.target.value),placeholder:"Search shops...",disabled:T||j})]}),(0,r.jsx)("div",{className:"mt-3 max-h-[260px] overflow-y-auto pr-1",children:(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsxs)("label",{className:"flex items-center justify-between gap-3 rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2",children:[(0,r.jsx)("div",{className:"min-w-0",children:(0,r.jsx)("div",{className:"truncate text-sm font-medium text-[var(--rb-text)]",children:"Check all"})}),(0,r.jsx)("input",{ref:eg,type:"checkbox",checked:eb,onChange:e=>{let r=e.target.checked;E(e=>{let s={...e};for(let e of ep)s[e.id]=r;return s})},disabled:T||j})]}),ep.map(e=>{let s=!!P[e.id];return(0,r.jsxs)("label",{className:"flex items-center justify-between gap-3 rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2",children:[(0,r.jsx)("div",{className:"min-w-0",children:(0,r.jsx)("div",{className:"truncate text-sm font-medium text-[var(--rb-text)]",children:e.label})}),(0,r.jsx)("input",{type:"checkbox",checked:s,onChange:r=>E(s=>({...s,[e.id]:r.target.checked})),disabled:T||j})]},e.id)})]})})]})})]})})]})})}),(0,r.jsx)("div",{children:(0,r.jsx)(i.Card,{className:"shadow-none",children:(0,r.jsx)(i.CardContent,{className:"pt-5",children:(0,r.jsx)(n.DataTable,{title:"Users",data:y,loading:j,emptyMessage:"No users yet.",getRowId:e=>e.id,search:{placeholder:"Search name or email..."},server:{query:K,onQueryChange:e=>{Q(e),V(0)},pageIndex:J,onPageIndexChange:V,pageSize:G,onPageSizeChange:e=>{X(e),V(0)},totalRows:Y,sort:ee,onSortChange:e=>{er(e),V(0)}},exportConfig:{url:`/api/${f}/app/users/export`,formats:["csv","xlsx","pdf"],filename:({format:e})=>`users_export.${e}`},columnVisibilityKey:`rb:datatable:${f}:users`,filters:[{id:"role",label:"Role",value:U,options:ef,onChange:e=>{q(String(e)),V(0)}},{id:"status",label:"Status",value:H,options:ej,onChange:e=>{W(String(e)),V(0)}}],columns:[{id:"name",header:"Name",sortId:"name",cell:e=>(0,r.jsxs)("div",{className:"min-w-0",children:[(0,r.jsx)("div",{className:"truncate font-semibold text-[var(--rb-text)]",children:e.name}),(0,r.jsx)("div",{className:"truncate text-xs text-zinc-600",children:e.email})]}),className:"max-w-[340px]"},{id:"email",header:"Email",sortId:"email",hiddenByDefault:!0,cell:e=>(0,r.jsx)("div",{className:"text-sm text-zinc-700",children:e.email}),className:"whitespace-nowrap"},{id:"role",header:"Role",cell:e=>{let s=e.role_id??null;return(0,r.jsx)("div",{className:"text-sm text-zinc-700",children:s?eu.get(s)??"(unknown)":"(none)"})},className:"whitespace-nowrap"},{id:"shop",header:"Shops",className:"min-w-[220px]",cell:e=>{let s=Array.isArray(e.branches)?e.branches:[],a=s.filter(e=>!!e?.is_active),t=(a.length>0?a:s).filter(e=>e&&"number"==typeof e.id).slice().sort((e,r)=>`${e.code??""} ${e.name??""}`.localeCompare(`${r.code??""} ${r.name??""}`)),i=t.slice(0,2),l=t.slice(2),n=l.length,d=l.map(e=>`${e.code?`${e.code} - `:""}${e.name}`).join("\n");return(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(v,{className:"h-4 w-4 text-zinc-500"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-1",children:0===i.length?(0,r.jsx)("span",{className:"text-sm text-zinc-600",children:"(none)"}):(0,r.jsxs)(r.Fragment,{children:[i.map(e=>(0,r.jsxs)("span",{className:"inline-flex items-center rounded-full border border-[var(--rb-border)] bg-white px-2 py-0.5 text-xs text-zinc-700",title:`${e.code?`${e.code} - `:""}${e.name}`,children:[e.code?`${e.code} - `:"",e.name]},e.id)),n>0?(0,r.jsxs)("span",{className:"inline-flex items-center rounded-full border border-[var(--rb-border)] bg-white px-2 py-0.5 text-xs text-zinc-700",title:d,children:["+",n," more"]}):null]})})]})}},{id:"status",header:"Status",sortId:"status",className:"whitespace-nowrap",cell:e=>{let s=e.status??"active";return(0,r.jsx)(t.Badge,{variant:ew.get(s)??"default",children:s})}},{id:"actions",header:"",headerClassName:"text-right",className:"whitespace-nowrap text-right",cell:e=>{let s=e.status??"active",t=R===e.id||T;return(0,r.jsx)(d.DropdownMenu,{align:"right",trigger:({toggle:e})=>(0,r.jsx)(a.Button,{variant:"ghost",size:"sm",onClick:e,disabled:t,"aria-label":"User actions",title:"User actions",className:"px-2",children:(0,r.jsx)(b,{className:"h-4 w-4"})}),children:({close:a})=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.DropdownMenuItem,{onSelect:()=>{a();let r=Array.isArray(e.branches)?e.branches:[],s={};for(let e of r)"number"==typeof e.id&&(s[e.id]=!0);ea(e.id),A(e.name??""),z(e.email??""),D(e.role_id??null),E(s),F(""),window.scrollTo({top:0,behavior:"smooth"})},disabled:t,children:"Edit"}),(0,r.jsx)(d.DropdownMenuSeparator,{}),(0,r.jsx)(d.DropdownMenuItem,{onSelect:()=>{a(),eC({title:"Send password reset",message:(0,r.jsxs)("div",{children:["Send a password reset link to ",(0,r.jsx)("span",{className:"font-semibold",children:e.email}),"?"]}),action:async()=>eN(e.id)})},disabled:t,children:"Reset password"}),(0,r.jsx)(d.DropdownMenuSeparator,{}),(0,r.jsx)(d.DropdownMenuItem,{onSelect:()=>{a(),eC({title:"Suspend user",message:(0,r.jsxs)("div",{children:["Suspend ",(0,r.jsx)("span",{className:"font-semibold",children:e.email}),"? They may lose access immediately."]}),action:async()=>e_(e.id,"suspended")})},destructive:!0,disabled:t||"suspended"===s,children:"Suspend"}),(0,r.jsx)(d.DropdownMenuItem,{onSelect:()=>{a(),eC({title:"Set user inactive",message:(0,r.jsxs)("div",{children:["Set ",(0,r.jsx)("span",{className:"font-semibold",children:e.email})," to inactive? They will not be able to sign in."]}),action:async()=>e_(e.id,"inactive")})},destructive:!0,disabled:t||"inactive"===s,children:"Set inactive"}),(0,r.jsx)(d.DropdownMenuItem,{onSelect:()=>{a(),e_(e.id,"active")},disabled:t||"active"===s,children:"Activate"})]})})}}]})})})})]})]})})}e.s(["default",()=>g])}]);