(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,37633,e=>{"use strict";var s=e.i(48277),a=e.i(96086),t=e.i(77252),l=e.i(19463),i=e.i(30668),n=e.i(16506),r=e.i(327),c=e.i(2865),d=e.i(54133),o=e.i(35508),m=e.i(43938),u=e.i(17296),x=e.i(29150),p=e.i(45155),h=e.i(66730),g=e.i(10459),v=e.i(35169),b=e.i(55201),j=e.i(67494),f=e.i(24744),y=e.i(63571),N=e.i(9693),S=e.i(72015),C=e.i(43901);let k=[{key:"company-profile",label:"Operations"},{key:"general",label:"General"},{key:"currency",label:"Currency"},{key:"invoices-reports",label:"Invoices & Reports"},{key:"job-statuses",label:"Statuses"},{key:"payments",label:"Payments"},{key:"reviews",label:"Reviews"},{key:"estimates",label:"Estimates"},{key:"my-account",label:"My Account"},{key:"devices-brands",label:"Devices & Brands"},{key:"sms",label:"SMS"},{key:"taxes",label:"Taxes"},{key:"service-settings",label:"Service Settings"},{key:"time-logs",label:"Time Logs"},{key:"maintenance-reminders",label:"Maintenance Reminders"},{key:"styling-labels",label:"Styling & Labels"},{key:"signature-workflow",label:"Signature Workflow"},{key:"booking",label:"Booking"}],w={general:{businessName:"",businessPhone:"",businessAddress:"",logoUrl:"",email:"",displayName:"",primaryContactName:"",registrationNumber:"",caseNumberPrefix:"RB",caseNumberLength:6,emailCustomer:!0,attachPdf:!0,nextServiceDateEnabled:!1,gdprAcceptanceText:"I agree to the privacy policy.",gdprLinkLabel:"Privacy policy",gdprLinkUrl:"",defaultCountry:"US",disableStatusCheckBySerial:!1},currency:{currency:"USD",currencyPosition:"left",thousandSeparator:",",decimalSeparator:".",numberOfDecimals:2},invoicesReports:{addQrCodeToInvoice:!0,invoiceFooterMessage:"Thank you for your business.",invoicePrintType:"standard",displayPickupDate:!0,displayDeliveryDate:!0,displayNextServiceDate:!1,invoiceDisclaimerTerms:"",repairOrderType:"standard",termsUrl:"",repairOrderPrintSize:"a4",displayBusinessAddressDetails:!0,displayCustomerEmailAddressDetails:!0,repairOrderFooterMessage:""},jobStatuses:{statuses:[{id:"status_received",name:"Received",slug:"received",description:"Job received",invoiceLabel:"Received",manageWooStock:!1,status:"active"},{id:"status_completed",name:"Completed",slug:"completed",description:"Job completed",invoiceLabel:"Completed",manageWooStock:!1,status:"active"},{id:"status_cancelled",name:"Cancelled",slug:"cancelled",description:"Job cancelled",invoiceLabel:"Cancelled",manageWooStock:!1,status:"active"}],completedStatusId:"status_completed",cancelledStatusId:"status_cancelled"},payments:{statuses:[{id:"pay_unpaid",name:"Unpaid",slug:"unpaid",description:"",status:"active"},{id:"pay_paid",name:"Paid",slug:"paid",description:"",status:"active"},{id:"pay_refunded",name:"Refunded",slug:"refunded",description:"",status:"active"}],paymentMethods:{cash:!0,card:!0,bankTransfer:!1,paypal:!1,other:!1}},reviews:{requestFeedbackBySms:!1,requestFeedbackByEmail:!0,feedbackPage:"",sendReviewRequestIfJobStatusId:"status_completed",autoFeedbackRequestIntervalDays:2,emailSubject:"How did we do?",emailMessageTemplate:"Thanks for choosing us. Please leave feedback.",smsMessageTemplate:"Thanks for your visit. Please leave feedback."},estimates:{customerEmailSubject:"Your estimate",customerEmailBody:"Please review your estimate.",disableEstimates:!1,bookingQuoteSendToJobs:!0,adminApproveRejectEmailSubject:"Estimate decision",adminApproveRejectEmailBody:"An estimate was approved or rejected."},myAccount:{disableBooking:!1,disableEstimates:!1,disableReviews:!1,bookingFormType:"simple"},devicesBrands:{enablePinCodeField:!1,showPinCodeInDocuments:!1,useWooProductsAsDevices:!1,labels:{note:"Note",pin:"PIN",device:"Device",deviceBrand:"Brand",deviceType:"Type",imei:"IMEI"},additionalDeviceFields:[],pickupDeliveryEnabled:!1,pickupCharge:"0",deliveryCharge:"0",rentalEnabled:!1,rentalPerDay:"0",rentalPerWeek:"0"},pagesSetup:{dashboardPage:"",statusCheckPage:"",feedbackPage:"",bookingPage:"",servicesPage:"",partsPage:"",redirectAfterLogin:"",enableRegistration:!0},sms:{activateSmsForSelectiveStatuses:!1,gateway:"twilio",gatewayAccountSid:"",gatewayAuthToken:"",gatewayFromNumber:"",sendWhenStatusChangedToIds:["status_received","status_completed"],testNumber:"",testMessage:"Test message"},taxes:{enableTaxes:!1,taxes:[{id:"tax_none",name:"No tax",ratePercent:0,status:"active"},{id:"tax_standard",name:"Standard",ratePercent:20,status:"active"}],defaultTaxId:"tax_none",invoiceAmounts:"exclusive"},serviceSettings:{sidebarDescription:"",disableBookingOnServicePage:!1,bookingFormType:"simple"},timeLogs:{disableTimeLog:!1,defaultTaxIdForHours:"tax_none",enableTimeLogForStatusIds:[],activities:"Repair\nDiagnostic\nTesting\nCleaning\nConsultation\nOther"},maintenanceReminders:{reminders:[{id:"reminder_1",name:"Maintenance reminder",intervalDays:180,status:"active"}]},stylingLabels:{labels:{delivery:"Delivery",pickup:"Pickup",nextService:"Next service",caseNumber:"Case number"},colors:{primary:"#2563eb",secondary:"#f97316"}},signatureWorkflow:{pickup:{enabled:!1,triggerStatusId:"status_completed",templates:{emailSubject:"Pickup signature requested",emailTemplate:"Please sign the pickup form.",smsText:"Please sign the pickup form."},statusAfterSubmissionId:"status_completed"},delivery:{enabled:!1,triggerStatusId:"status_completed",templates:{emailSubject:"Delivery signature requested",emailTemplate:"Please sign the delivery form.",smsText:"Please sign the delivery form."},statusAfterSubmissionId:"status_completed"}},booking:{customerEmailSubject:"Booking confirmation",customerEmailBody:"Thanks for your booking.",adminEmailSubject:"New booking",adminEmailBody:"A new booking has been received.",publicBookingMode:"ungrouped",publicBookingUiStyle:"wizard",sendBookingQuoteToJobs:!0,customerCreationEmailBehavior:"send_login_credentials",turnOffOtherDeviceBrand:!1,turnOffOtherService:!1,turnOffServicePrice:!1,turnOffIdImeiInBooking:!1,defaultType:"",defaultBrand:"",defaultDevice:""}};var _=e.i(1831),I=e.i(62498),T=e.i(33044);function B(e,s){let a,t,l,i=s.setup_state??{},n=i.identity?.logo_url,r=i.identity??{},c="string"==typeof s.logo_url?s.logo_url:"string"==typeof n?n:"",d="string"==typeof s.billing_country?s.billing_country.trim().toUpperCase():"";return{...e,general:{...e.general,businessName:s.name??"",businessPhone:s.contact_phone??"",email:s.contact_email??"",displayName:"string"==typeof r.display_name?r.display_name:e.general.displayName,primaryContactName:"string"==typeof r.primary_contact_name?r.primary_contact_name:e.general.primaryContactName,registrationNumber:"string"==typeof r.registration_number?r.registration_number:e.general.registrationNumber,businessAddress:(a=s.billing_address_json??{},t=[],"string"==typeof a.line1&&a.line1.trim()&&t.push(a.line1.trim()),"string"==typeof a.line2&&a.line2.trim()&&t.push(a.line2.trim()),"string"==typeof a.city&&a.city.trim()&&t.push(a.city.trim()),"string"==typeof a.state&&a.state.trim()&&t.push(a.state.trim()),"string"==typeof a.postal_code&&a.postal_code.trim()&&t.push(a.postal_code.trim()),(l="string"==typeof s.billing_country?s.billing_country.trim().toUpperCase():"")&&t.push(l),t.join(", ")),logoUrl:c,defaultCountry:d||e.general.defaultCountry}}}var A=e.i(26550);let D=["UTC","Europe/London","Europe/Berlin","Europe/Paris","Africa/Cairo","Asia/Dubai","Asia/Riyadh","Asia/Kolkata","Asia/Singapore","Asia/Tokyo","Australia/Sydney","America/New_York","America/Chicago","America/Denver","America/Los_Angeles"];function E({tenantSlug:e}){let[a,t]=(0,i.useState)(!0),[l,n]=(0,i.useState)(!1),[r,c]=(0,i.useState)(!1),[d,o]=(0,i.useState)(null),[m,u]=(0,i.useState)(null),[x,p]=(0,i.useState)(null),[h,g]=(0,i.useState)(""),[v,b]=(0,i.useState)(""),[j,f]=(0,i.useState)(""),[C,k]=(0,i.useState)(""),[w,I]=(0,i.useState)("UTC"),[B,E]=(0,i.useState)("Mon–Fri 09:00–17:00"),[P,F]=(0,i.useState)(""),[M,z]=(0,i.useState)(""),[R,L]=(0,i.useState)(!0),[$,U]=(0,i.useState)(!1),O=(0,i.useMemo)(()=>{try{let e=Intl,s="function"==typeof e.supportedValuesOf?e.supportedValuesOf("timeZone"):null;return Array.isArray(s)&&s.length>0?s:D}catch{return D}},[]);(0,i.useEffect)(()=>{let s=!0;return async function(){try{o(null),u(null),t(!0);let a=await (0,T.getSetup)(String(e));if(!s)return;p(a);let l=a.tenant;I(l.timezone??"UTC");let i=a.setup?.state??{},n=i.branding??{},r=i.operations??{};g("string"==typeof n.support_email?n.support_email:""),b("string"==typeof n.support_phone?n.support_phone:""),f("string"==typeof n.website?n.website:""),k("string"==typeof n.document_footer?n.document_footer:""),E("string"==typeof r.working_hours?r.working_hours:"Mon–Fri 09:00–17:00"),F("string"==typeof r.default_labor_rate?r.default_labor_rate:""),z("string"==typeof r.warranty_terms?r.warranty_terms:""),L("boolean"!=typeof r.notify_status_change||r.notify_status_change),U("boolean"==typeof r.notify_invoice_created&&r.notify_invoice_created)}catch(e){if(!s)return;o(e instanceof Error?e.message:"Failed to load settings."),p(null)}finally{if(!s)return;t(!1)}}(),()=>{s=!1}},[e]);let q=x?.tenant,H=(0,i.useMemo)(()=>x?.setup?.state??null,[x?.setup?.state]),W=(0,i.useMemo)(()=>{if(!q)return!1;let e=H??{},s=e.branding??{},a=e.operations??{};return(w.trim()||"")!==((q.timezone??"").trim()||"")||(h.trim()||"")!==("string"==typeof s.support_email?s.support_email.trim():"")||(v.trim()||"")!==("string"==typeof s.support_phone?s.support_phone.trim():"")||(j.trim()||"")!==("string"==typeof s.website?s.website.trim():"")||(C.trim()||"")!==("string"==typeof s.document_footer?s.document_footer.trim():"")||(B.trim()||"")!==("string"==typeof a.working_hours?a.working_hours.trim():"")||(P.trim()||"")!==("string"==typeof a.default_labor_rate?a.default_labor_rate.trim():"")||(M.trim()||"")!==("string"==typeof a.warranty_terms?a.warranty_terms.trim():"")||R!==("boolean"!=typeof a.notify_status_change||a.notify_status_change)||$!==("boolean"==typeof a.notify_invoice_created&&a.notify_invoice_created)},[P,C,q,H,$,R,h,v,w,M,j,B]),J=i.default.useCallback(async s=>{c(!0),o(null);try{let a=await (0,T.updateSetup)(String(e),{logo:s});p(e=>e?{...e,tenant:a.tenant}:e)}catch(e){o(e instanceof Error?e.message:"Failed to upload logo.")}finally{c(!1)}},[e]);async function Q(s){if(s.preventDefault(),o(null),u(null),!w.trim())return void o("Timezone is required.");n(!0);try{let s={...x?.setup?.state??{},branding:{support_email:h.trim()||null,support_phone:v.trim()||null,website:j.trim()||null,document_footer:C.trim()||null},operations:{working_hours:B.trim()||null,default_labor_rate:P.trim()||null,warranty_terms:M.trim()||null,notify_status_change:!!R,notify_invoice_created:!!$}},a=await (0,T.updateSetup)(String(e),{timezone:w.trim()||null,language:"en",setup_state:s});p(e=>e?{...e,tenant:a.tenant,setup:{...e.setup,state:s}}:e),u("Settings saved.")}catch(e){e instanceof _.ApiError?o(e.message):o("Failed to save settings.")}finally{n(!1)}}return(0,s.jsxs)("div",{className:"space-y-4",children:[d?(0,s.jsx)(y.Alert,{variant:"danger",title:"Could not load or save settings",children:d}):null,m?(0,s.jsx)(y.Alert,{variant:"success",title:"Success",children:m}):null,a?(0,s.jsx)("div",{className:"text-sm text-zinc-500",children:"Loading settings..."}):null,!a&&x?(0,s.jsxs)("form",{className:"space-y-6",onSubmit:Q,children:[(0,s.jsxs)(S.Card,{children:[(0,s.jsxs)(S.CardHeader,{children:[(0,s.jsx)(S.CardTitle,{children:"Branding"}),(0,s.jsx)(S.CardDescription,{children:"Customer-facing visuals and contact information."})]}),(0,s.jsx)(S.CardContent,{className:"space-y-4",children:(0,s.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-[var(--rb-text)]",children:"Logo"}),(0,s.jsxs)("div",{className:"mt-2 flex items-center gap-3",children:[x?.tenant?.logo_url?(0,s.jsx)("img",{src:x.tenant.logo_url,alt:"Logo",className:"h-10 w-10 rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white object-contain"}):(0,s.jsx)("div",{className:"h-10 w-10 rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white"}),(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)("input",{type:"file",accept:"image/png,image/jpeg,image/webp",disabled:r,onChange:e=>{let s=e.target.files&&e.target.files[0]?e.target.files[0]:null;s&&J(s)},className:"block w-full text-sm text-zinc-700 file:mr-3 file:rounded-[var(--rb-radius-sm)] file:border-0 file:bg-[var(--rb-surface-muted)] file:px-3 file:py-2 file:text-sm file:font-medium file:text-[var(--rb-text)] hover:file:bg-[color:color-mix(in_srgb,var(--rb-surface-muted),black_4%)]"})})]}),(0,s.jsx)("div",{className:"mt-2 text-xs text-zinc-500",children:r?"Uploading...":"PNG/JPG/WEBP up to 5MB"})]}),(0,s.jsxs)("div",{className:"sm:col-span-2",children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Customer-facing contact (optional)"}),(0,s.jsxs)("div",{className:"mt-2 grid gap-3 sm:grid-cols-2",children:[(0,s.jsx)(A.Input,{value:h,onChange:e=>g(e.target.value),placeholder:"Public support email",disabled:l}),(0,s.jsx)(A.Input,{value:v,onChange:e=>b(e.target.value),placeholder:"Public support phone",disabled:l}),(0,s.jsx)("div",{className:"sm:col-span-2",children:(0,s.jsx)(A.Input,{value:j,onChange:e=>f(e.target.value),placeholder:"Website (optional)",disabled:l})}),(0,s.jsx)("div",{className:"sm:col-span-2",children:(0,s.jsx)(A.Input,{value:C,onChange:e=>k(e.target.value),placeholder:"Document footer text (optional)",disabled:l})})]})]})]})})]}),(0,s.jsxs)(S.Card,{children:[(0,s.jsxs)(S.CardHeader,{children:[(0,s.jsx)(S.CardTitle,{children:"Operations"}),(0,s.jsx)(S.CardDescription,{children:"Defaults and notifications."})]}),(0,s.jsx)(S.CardContent,{className:"space-y-4",children:(0,s.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-[var(--rb-text)]",children:"Timezone"}),(0,s.jsxs)("div",{className:"mt-1",children:[(0,s.jsx)(A.Input,{value:w,onChange:e=>I(e.target.value),placeholder:"UTC",list:"rb-timezones",disabled:l}),(0,s.jsx)("datalist",{id:"rb-timezones",children:O.map(e=>(0,s.jsx)("option",{value:e},e))})]}),(0,s.jsx)("div",{className:"mt-2 text-xs text-zinc-500",children:"Example: UTC, Europe/Berlin, America/New_York"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-[var(--rb-text)]",children:"Language"}),(0,s.jsx)("div",{className:"mt-1",children:(0,s.jsx)(A.Input,{value:"English (en)",disabled:!0})}),(0,s.jsx)("div",{className:"mt-2 text-xs text-zinc-500",children:"Currently supported language: English"})]}),(0,s.jsxs)("div",{className:"sm:col-span-2",children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Operations defaults (optional)"}),(0,s.jsxs)("div",{className:"mt-2 grid gap-3 sm:grid-cols-2",children:[(0,s.jsx)("div",{className:"sm:col-span-2",children:(0,s.jsx)(A.Input,{value:B,onChange:e=>E(e.target.value),placeholder:"Working hours (e.g. Mon–Fri 09:00–17:00)",disabled:l})}),(0,s.jsx)(A.Input,{value:P,onChange:e=>F(e.target.value),placeholder:"Default labor rate (optional)",disabled:l}),(0,s.jsx)(A.Input,{value:M,onChange:e=>z(e.target.value),placeholder:"Default warranty terms (optional)",disabled:l}),(0,s.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm text-[var(--rb-text)]",children:[(0,s.jsx)("input",{type:"checkbox",checked:R,onChange:e=>L(e.target.checked),disabled:l}),"Email on status change"]}),(0,s.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm text-[var(--rb-text)]",children:[(0,s.jsx)("input",{type:"checkbox",checked:$,onChange:e=>U(e.target.checked),disabled:l}),"Email on invoice created"]})]})]})]})})]}),(0,s.jsx)("div",{className:"flex items-center justify-end gap-2",children:(0,s.jsx)(N.Button,{type:"submit",disabled:l||!W,children:l?"Saving...":"Save changes"})})]}):null]})}var P=e.i(40709);function F({title:e,description:a,children:t}){return(0,s.jsxs)(S.Card,{children:[(0,s.jsxs)(S.CardHeader,{children:[(0,s.jsx)(S.CardTitle,{children:e}),a?(0,s.jsx)(S.CardDescription,{children:a}):null]}),(0,s.jsx)(S.CardContent,{className:"space-y-4",children:t})]})}function M({draft:e,updateBooking:a}){let t=e.booking;return(0,s.jsx)(F,{title:"Booking",description:"Booking/quote templates and form defaults.",children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Email templates"}),(0,s.jsxs)("div",{className:"mt-2 grid gap-4 sm:grid-cols-2",children:[(0,s.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Customer email subject"}),(0,s.jsx)(A.Input,{value:t.customerEmailSubject,onChange:e=>a({customerEmailSubject:e.target.value})})]}),(0,s.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Customer email body"}),(0,s.jsx)("textarea",{className:"min-h-[140px] w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:t.customerEmailBody,onChange:e=>a({customerEmailBody:e.target.value})})]}),(0,s.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Admin email subject"}),(0,s.jsx)(A.Input,{value:t.adminEmailSubject,onChange:e=>a({adminEmailSubject:e.target.value})})]}),(0,s.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Admin email body"}),(0,s.jsx)("textarea",{className:"min-h-[140px] w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:t.adminEmailBody,onChange:e=>a({adminEmailBody:e.target.value})})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Booking workflow"}),(0,s.jsxs)("div",{className:"mt-2 grid gap-2",children:[(0,s.jsxs)("div",{className:"grid gap-1 sm:max-w-[360px]",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Public booking mode"}),(0,s.jsxs)(P.Select,{value:t.publicBookingMode,onChange:e=>a({publicBookingMode:e.target.value}),children:[(0,s.jsx)("option",{value:"ungrouped",children:"Ungrouped (brand → device)"}),(0,s.jsx)("option",{value:"grouped",children:"Grouped (type → brand → device)"}),(0,s.jsx)("option",{value:"warranty",children:"Warranty (grouped + date of purchase)"})]})]}),(0,s.jsxs)("div",{className:"grid gap-1 sm:max-w-[360px]",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Public booking UI style"}),(0,s.jsxs)(P.Select,{value:t.publicBookingUiStyle??"wizard",onChange:e=>a({publicBookingUiStyle:e.target.value}),children:[(0,s.jsx)("option",{value:"wizard",children:"List / Wizard"}),(0,s.jsx)("option",{value:"images",children:"Images / Cards"})]}),(0,s.jsx)("div",{className:"text-xs text-zinc-500",children:"Controls the design used on /t/<tenant>/book."})]}),(0,s.jsxs)("div",{className:"grid gap-1 sm:max-w-[360px]",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"New customer email behavior"}),(0,s.jsxs)(P.Select,{value:t.customerCreationEmailBehavior??"send_login_credentials",onChange:e=>a({customerCreationEmailBehavior:e.target.value}),children:[(0,s.jsx)("option",{value:"send_login_credentials",children:"Send login credentials (OTP)"}),(0,s.jsx)("option",{value:"do_not_email",children:"Do not email"})]}),(0,s.jsx)("div",{className:"text-xs text-zinc-500",children:"Controls whether customers get an email when an account is created on booking submit."})]}),(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:t.sendBookingQuoteToJobs,onChange:e=>a({sendBookingQuoteToJobs:e.target.checked})}),"Send booking/quote to jobs"]}),(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:t.turnOffOtherDeviceBrand,onChange:e=>a({turnOffOtherDeviceBrand:e.target.checked})}),"Turn off “other device brand”"]}),(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:t.turnOffOtherService,onChange:e=>a({turnOffOtherService:e.target.checked})}),"Turn off “other service”"]}),(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:t.turnOffServicePrice,onChange:e=>a({turnOffServicePrice:e.target.checked})}),"Turn off service price"]}),(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:t.turnOffIdImeiInBooking,onChange:e=>a({turnOffIdImeiInBooking:e.target.checked})}),"Turn off ID/IMEI in booking"]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Defaults"}),(0,s.jsxs)("div",{className:"mt-2 grid gap-3 sm:grid-cols-2",children:[(0,s.jsx)(A.Input,{value:t.defaultType,onChange:e=>a({defaultType:e.target.value}),placeholder:"Default type"}),(0,s.jsx)(A.Input,{value:t.defaultBrand,onChange:e=>a({defaultBrand:e.target.value}),placeholder:"Default brand"}),(0,s.jsx)(A.Input,{value:t.defaultDevice,onChange:e=>a({defaultDevice:e.target.value}),placeholder:"Default device"})]})]})]})})}var z=e.i(68501),R=e.i(33441),L=e.i(66474),$=e.i(64998),U=e.i(63809);function O({draft:e,updateCurrency:t}){let l=e.currency,n=(0,a.useParams)(),r=n.business??n.tenant,[c,d]=(0,i.useState)(!0),[o,m]=(0,i.useState)(null),[u,x]=(0,i.useState)(null),[p,h]=(0,i.useState)(!1),[g,v]=(0,i.useState)([]),[b,j]=(0,i.useState)([]),[f,C]=(0,i.useState)(!1),[k,w]=(0,i.useState)(""),[I,T]=(0,i.useState)(""),[B,D]=(0,i.useState)(""),[E,F]=(0,i.useState)(!0),[M,O]=(0,i.useState)(!1),[q,H]=(0,i.useState)(null);function W(e){let s=(Array.isArray(e)?e:[]).map(e=>({code:(e.code??"").trim().toUpperCase(),symbol:e.symbol??null,name:(e.name??"").trim(),is_active:!!e.is_active,is_default:!!e.is_default})).filter(e=>/^[A-Z]{3}$/.test(e.code)&&e.name.length>0);if(!s.some(e=>e.is_default&&e.is_active)){let e=s.find(e=>e.is_active);e?e.is_default=!0:s[0]&&(s[0].is_default=!0)}let a=!1;return s.map(e=>{let s={...e};return s.is_active||(s.is_default=!1),s.is_default&&(a&&(s.is_default=!1),a=!0),s}).sort((e,s)=>e.code.localeCompare(s.code))}let J=i.default.useCallback(async()=>{if("string"==typeof r&&0!==r.length){d(!0),m(null),x(null);try{let e=await (0,U.getTenantCurrencies)(String(r)),s=W(Array.isArray(e.currencies)?e.currencies:[]);v(s),j(s);let a=s.find(e=>e.is_default)?.code??null;a&&/^[A-Z]{3}$/.test(a)&&t({currency:a})}catch(e){m(e instanceof Error?e.message:"Failed to load currencies."),v([]),j([])}finally{d(!1)}}},[r,t]);(0,i.useEffect)(()=>{J()},[J]);let Q=(0,i.useMemo)(()=>JSON.stringify(W(g))!==JSON.stringify(W(b)),[g,b]),Y=(0,i.useMemo)(()=>g.find(e=>e.is_default)?.code??"",[g]),G=(0,i.useMemo)(()=>g.filter(e=>e.is_active),[g]),V=i.default.useCallback((e,s)=>{v(a=>{let t=a.map(a=>a.code===e?{...a,...s}:a);return s.is_default?t.map(s=>s.code===e?{...s,is_default:!0,is_active:!0}:{...s,is_default:!1}):!1===s.is_active?t.map(s=>s.code===e?{...s,is_active:!1,is_default:!1}:s):t})},[]),Z=(0,i.useMemo)(()=>{let e=k.trim().toUpperCase();return!!/^[A-Z]{3}$/.test(e)&&g.some(s=>s.code===e)},[g,k]);async function K(){if("string"==typeof r&&0!==r.length&&Q){m(null),x(null),h(!0);try{let e=W(g),s=await (0,U.updateTenantCurrencies)(String(r),e.map(e=>({code:e.code,symbol:e.symbol??null,name:e.name,is_active:!!e.is_active,is_default:!!e.is_default}))),a=W(Array.isArray(s.currencies)?s.currencies:[]);v(a),j(a);let l=a.find(e=>e.is_default)?.code??null;l&&/^[A-Z]{3}$/.test(l)&&t({currency:l}),x("Currencies updated.")}catch(e){e instanceof _.ApiError?m(e.message):m(e instanceof Error?e.message:"Failed to save currencies.")}finally{h(!1)}}}let X=(0,i.useMemo)(()=>/^[A-Z]{3}$/.test(k.trim().toUpperCase())&&!!B.trim()&&!Z,[Z,k,B]),ee=(0,i.useMemo)(()=>{let e=(l.thousandSeparator??"").trim(),s=(l.decimalSeparator??"").trim();return e.length>0&&s.length>0&&e===s},[l.decimalSeparator,l.thousandSeparator]);return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)(S.Card,{children:[(0,s.jsxs)(S.CardHeader,{children:[(0,s.jsx)(S.CardTitle,{children:"Business currencies"}),(0,s.jsx)(S.CardDescription,{children:"Manage currencies for this business. Set the default from the Actions menu."})]}),(0,s.jsxs)(S.CardContent,{className:"space-y-4",children:[o?(0,s.jsx)(y.Alert,{variant:"danger",title:"Could not load currencies",children:o}):null,u?(0,s.jsx)(y.Alert,{variant:"success",title:"Status",children:u}):null,(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[Q?(0,s.jsx)(z.Badge,{variant:"warning",children:"Unsaved changes"}):(0,s.jsx)(z.Badge,{variant:"success",children:"Saved"}),Y?(0,s.jsxs)(z.Badge,{variant:"info",children:["Default: ",Y]}):null]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,s.jsx)(N.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>void J(),disabled:c||p,children:"Refresh"}),(0,s.jsx)(N.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{v(W(b)),m(null),x(null)},disabled:c||p||!Q,children:"Reset"}),(0,s.jsx)(N.Button,{type:"button",variant:"secondary",size:"sm",onClick:()=>void K(),disabled:c||p||!Q,children:p?"Saving...":"Save"}),(0,s.jsx)(N.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{w(""),T(""),D(""),F(!0),O(!1),C(!0)},disabled:c||p,children:"Add currency"})]})]}),c?(0,s.jsx)("div",{className:"text-sm text-zinc-500",children:"Loading currencies..."}):null,c?null:(0,s.jsx)("div",{className:"overflow-x-auto rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-white",children:(0,s.jsxs)("table",{className:"min-w-full border-collapse text-left text-sm",children:[(0,s.jsx)("thead",{className:"bg-[var(--rb-surface-muted)]",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"whitespace-nowrap border-b border-[var(--rb-border)] px-3 py-2 text-xs font-semibold uppercase tracking-wide text-zinc-600",children:"Code"}),(0,s.jsx)("th",{className:"whitespace-nowrap border-b border-[var(--rb-border)] px-3 py-2 text-xs font-semibold uppercase tracking-wide text-zinc-600",children:"Name"}),(0,s.jsx)("th",{className:"whitespace-nowrap border-b border-[var(--rb-border)] px-3 py-2 text-xs font-semibold uppercase tracking-wide text-zinc-600",children:"Symbol"}),(0,s.jsx)("th",{className:"whitespace-nowrap border-b border-[var(--rb-border)] px-3 py-2 text-xs font-semibold uppercase tracking-wide text-zinc-600",children:"Status"}),(0,s.jsx)("th",{className:"whitespace-nowrap border-b border-[var(--rb-border)] px-3 py-2 text-xs font-semibold uppercase tracking-wide text-zinc-600"})]})}),(0,s.jsx)("tbody",{children:0===g.length?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{className:"px-3 py-3 text-sm text-zinc-600",colSpan:5,children:"No currencies configured. Add a currency to get started."})}):g.map(e=>(0,s.jsxs)("tr",{className:"border-t border-[var(--rb-border)]",children:[(0,s.jsx)("td",{className:"px-3 py-2 align-middle",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"font-mono text-sm",children:e.code}),e.is_default?(0,s.jsx)(z.Badge,{variant:"info",children:"Default"}):null]})}),(0,s.jsx)("td",{className:"px-3 py-2 align-middle",children:(0,s.jsx)(A.Input,{value:e.name,onChange:s=>V(e.code,{name:s.target.value}),disabled:p,placeholder:"Currency name"})}),(0,s.jsx)("td",{className:"px-3 py-2 align-middle",children:(0,s.jsx)(A.Input,{value:e.symbol??"",onChange:s=>V(e.code,{symbol:s.target.value}),disabled:p,placeholder:"$"})}),(0,s.jsx)("td",{className:"px-3 py-2 align-middle",children:(0,s.jsx)(z.Badge,{variant:e.is_active?"success":"default",children:e.is_active?"Active":"Inactive"})}),(0,s.jsx)("td",{className:"px-3 py-2 align-middle text-right",children:(0,s.jsx)(R.DropdownMenu,{align:"right",trigger:({toggle:e})=>(0,s.jsx)(N.Button,{variant:"outline",size:"sm",onClick:e,disabled:p,children:"Actions"}),children:({close:a})=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(R.DropdownMenuItem,{onSelect:()=>{a(),V(e.code,{is_default:!0})},disabled:p||e.is_default||!e.is_active,children:"Set default"}),(0,s.jsx)(R.DropdownMenuItem,{onSelect:()=>{a(),V(e.code,{is_active:!e.is_active})},disabled:p||e.is_default,children:e.is_active?"Disable":"Enable"}),(0,s.jsx)(R.DropdownMenuSeparator,{}),(0,s.jsx)(R.DropdownMenuItem,{onSelect:()=>{a(),H(e.code)},destructive:!0,disabled:p||e.is_default,children:"Remove"})]})})})]},e.code))})]})}),0!==G.length||c?null:(0,s.jsx)(y.Alert,{variant:"warning",title:"No active currency",children:"Enable at least one currency so you can set a default."})]})]}),(0,s.jsx)(L.Modal,{open:f,onClose:()=>{p||C(!1)},title:"Add currency",footer:(0,s.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,s.jsx)(N.Button,{variant:"outline",onClick:()=>C(!1),disabled:p,children:"Cancel"}),(0,s.jsx)(N.Button,{variant:"secondary",onClick:()=>{!function(){let e=k.trim().toUpperCase();if(!/^[A-Z]{3}$/.test(e))return;let s=B.trim();if(!s||g.some(s=>s.code===e))return;let a={code:e,symbol:I.trim()?I.trim():null,name:s,is_active:!!E,is_default:!!M};v(s=>{let t=[...s.filter(s=>s.code!==e),a];return a.is_default&&(t=t.map(s=>s.code===e?{...s,is_default:!0,is_active:!0}:{...s,is_default:!1})),W(t)}),w(""),T(""),D(""),F(!0),O(!1)}(),C(!1)},disabled:p||!X,children:"Add"})]}),children:(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)(y.Alert,{variant:"info",title:"Tip",children:"Add a 3-letter ISO code (example: USD). You can set it active immediately, and optionally set it as the default."}),(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",htmlFor:"currency_code_new",children:"Code"}),(0,s.jsx)(A.Input,{id:"currency_code_new",value:k,onChange:e=>w(e.target.value.toUpperCase().replace(/[^A-Z]/g,"").slice(0,3)),type:"text",placeholder:"USD",disabled:p}),Z?(0,s.jsx)("div",{className:"text-xs text-zinc-500",children:"This currency is already added."}):null]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",htmlFor:"currency_symbol_new",children:"Symbol"}),(0,s.jsx)(A.Input,{id:"currency_symbol_new",value:I,onChange:e=>T(e.target.value),type:"text",placeholder:"$",disabled:p})]})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",htmlFor:"currency_name_new",children:"Name"}),(0,s.jsx)(A.Input,{id:"currency_name_new",value:B,onChange:e=>D(e.target.value),type:"text",placeholder:"US Dollar",disabled:p})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("div",{className:"text-sm font-medium",children:"Active"}),(0,s.jsxs)("label",{className:"flex h-10 items-center gap-2 rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 text-sm text-[var(--rb-text)]",children:[(0,s.jsx)("input",{type:"checkbox",checked:E,onChange:e=>F(e.target.checked),disabled:p||M}),"Active"]})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("div",{className:"text-sm font-medium",children:"Default"}),(0,s.jsxs)("label",{className:"flex h-10 items-center gap-2 rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 text-sm text-[var(--rb-text)]",children:[(0,s.jsx)("input",{type:"checkbox",checked:M,onChange:e=>{let s=e.target.checked;O(s),s&&F(!0)},disabled:p}),"Set as default"]})]})]})]})}),(0,s.jsx)($.ConfirmDialog,{open:null!==q,title:"Remove currency",message:(0,s.jsxs)("span",{children:["Remove currency ",(0,s.jsx)("span",{className:"font-mono",children:q})," from this business?"]}),confirmText:"Remove",confirmVariant:"outline",busy:p,onCancel:()=>H(null),onConfirm:()=>{q&&v(e=>W(e.filter(e=>e.code!==q))),H(null)}}),(0,s.jsxs)(S.Card,{children:[(0,s.jsxs)(S.CardHeader,{children:[(0,s.jsx)(S.CardTitle,{children:"Currency formatting"}),(0,s.jsx)(S.CardDescription,{children:"Formatting changes are saved with the main “Save” button at the top of this page."})]}),(0,s.jsxs)(S.CardContent,{className:"space-y-4",children:[ee?(0,s.jsx)(y.Alert,{variant:"warning",title:"Check your separators",children:"Thousand and decimal separators are the same. This can make numbers ambiguous."}):null,(0,s.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Default currency code"}),(0,s.jsx)(A.Input,{value:Y||l.currency,placeholder:"USD",disabled:!0})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Currency position"}),(0,s.jsxs)(P.Select,{value:l.currencyPosition,onChange:e=>t({currencyPosition:e.target.value}),children:[(0,s.jsx)("option",{value:"left",children:"Left"}),(0,s.jsx)("option",{value:"right",children:"Right"}),(0,s.jsx)("option",{value:"left_space",children:"Left (space)"}),(0,s.jsx)("option",{value:"right_space",children:"Right (space)"})]})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Thousand separator"}),(0,s.jsx)(A.Input,{value:l.thousandSeparator,onChange:e=>t({thousandSeparator:e.target.value.slice(0,1)}),placeholder:",",maxLength:1})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Decimal separator"}),(0,s.jsx)(A.Input,{value:l.decimalSeparator,onChange:e=>t({decimalSeparator:e.target.value.slice(0,1)}),placeholder:".",maxLength:1})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Number of decimals"}),(0,s.jsx)(A.Input,{value:String(l.numberOfDecimals),onChange:e=>{let s=Number.parseInt(e.target.value,10);t({numberOfDecimals:Number.isFinite(s)?Math.min(6,Math.max(0,s)):0})},type:"number",min:0,max:6})]})]})]})]})]})}var q=e.i(37574);function H({draft:e,updateDevicesBrands:a,isMock:t}){let[l,n]=(0,i.useState)(!1),[r,c]=(0,i.useState)(null),[d,o]=(0,i.useState)(null),m=e.devicesBrands,[u,x]=(0,i.useState)(""),[p,h]=(0,i.useState)(0),[g,v]=(0,i.useState)(10),b=m.additionalDeviceFields,j=i.default.useMemo(()=>{let e=u.trim().toLowerCase();return e?b.filter(s=>`${s.id} ${s.label}`.toLowerCase().includes(e)):b},[b,u]),f=j.length,y=i.default.useMemo(()=>{let e=p*g,s=e+g;return j.slice(e,s)},[j,p,g]),C=(0,i.useMemo)(()=>r?b.find(e=>e.id===r)??null:null,[r,b]),[k,w]=(0,i.useState)(()=>({id:"",label:"",type:"text",displayInBookingForm:!0,displayInInvoice:!0,displayForCustomer:!0}));function _(){o(null),c(null),w({id:"",label:"",type:"text",displayInBookingForm:!0,displayInInvoice:!0,displayForCustomer:!0}),n(!0)}let I=i.default.useCallback(e=>{o(null),c(e.id),w({...e}),n(!0)},[]);function T(){n(!1),c(null),o(null)}function B(){let e,s=k.label.trim();if(!s)return void o("Label is required.");let t={id:r??(e=globalThis,e.crypto?.randomUUID?`device_field_${e.crypto.randomUUID()}`:`device_field_${Date.now()}_${Math.random().toString(16).slice(2)}`),label:s,type:"text",displayInBookingForm:!!k.displayInBookingForm,displayInInvoice:!!k.displayInInvoice,displayForCustomer:!!k.displayForCustomer};a({additionalDeviceFields:r?b.map(e=>e.id===r?t:e):[...b,t]}),T()}let D=i.default.useCallback(e=>{globalThis.confirm(`Delete field "${e.label}"?`)&&a({additionalDeviceFields:b.filter(s=>s.id!==e.id)})},[b,a]),E=i.default.useMemo(()=>[{id:"label",header:"Label",cell:e=>(0,s.jsxs)("div",{className:"min-w-[200px]",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-[var(--rb-text)]",children:e.label}),(0,s.jsxs)("div",{className:"mt-0.5 text-xs text-zinc-500",children:["ID: ",e.id]})]})},{id:"type",header:"Type",cell:()=>(0,s.jsx)("div",{className:"text-sm text-zinc-600",children:"Text"}),className:"whitespace-nowrap"},{id:"booking",header:"In booking form?",cell:e=>(0,s.jsx)(z.Badge,{variant:e.displayInBookingForm?"success":"default",children:e.displayInBookingForm?"Display":"Hide"}),className:"whitespace-nowrap"},{id:"invoice",header:"In invoice?",cell:e=>(0,s.jsx)(z.Badge,{variant:e.displayInInvoice?"success":"default",children:e.displayInInvoice?"Display":"Hide"}),className:"whitespace-nowrap"},{id:"customer",header:"In customer output?",cell:e=>(0,s.jsx)(z.Badge,{variant:e.displayForCustomer?"success":"default",children:e.displayForCustomer?"Display":"Hide"}),className:"whitespace-nowrap"},{id:"actions",header:"Actions",cell:e=>(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(N.Button,{size:"sm",variant:"outline",disabled:t,onClick:()=>I(e),children:"Edit"}),(0,s.jsx)(N.Button,{size:"sm",variant:"outline",disabled:t,onClick:()=>D(e),children:"Delete"})]}),className:"whitespace-nowrap"}],[D,t,I]);return(0,s.jsxs)(F,{title:"Devices & Brands",description:"Device fields, labels and pickup/delivery/rental toggles.",children:[(0,s.jsx)("div",{className:"grid gap-4 sm:grid-cols-2",children:(0,s.jsxs)("div",{className:"sm:col-span-2",children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Device form"}),(0,s.jsxs)("div",{className:"mt-2 grid gap-3",children:[(0,s.jsxs)("label",{className:"flex items-start gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:m.enablePinCodeField,onChange:e=>a({enablePinCodeField:e.target.checked})}),(0,s.jsxs)("span",{children:[(0,s.jsx)("span",{className:"block font-medium text-[var(--rb-text)]",children:"Enable pin code field"}),(0,s.jsx)("span",{className:"mt-0.5 block text-xs text-zinc-500",children:"Adds a PIN input on the device form."})]})]}),(0,s.jsxs)("label",{className:"flex items-start gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:m.showPinCodeInDocuments,onChange:e=>a({showPinCodeInDocuments:e.target.checked}),disabled:!m.enablePinCodeField}),(0,s.jsxs)("span",{children:[(0,s.jsx)("span",{className:"block font-medium text-[var(--rb-text)]",children:"Show pin code in documents"}),(0,s.jsx)("span",{className:"mt-0.5 block text-xs text-zinc-500",children:"Visible in invoices, emails, and status check (if enabled)."})]})]})]})]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Labels"}),(0,s.jsx)("div",{className:"mt-1 text-xs text-zinc-500",children:"Customize how fields are named across the app."}),(0,s.jsxs)("div",{className:"mt-2 grid gap-3 sm:grid-cols-2",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Note label"}),(0,s.jsx)(A.Input,{value:m.labels.note,onChange:e=>a({labels:{...m.labels,note:e.target.value}}),placeholder:"Note"})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"PIN label"}),(0,s.jsx)(A.Input,{value:m.labels.pin,onChange:e=>a({labels:{...m.labels,pin:e.target.value}}),placeholder:"PIN"})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Device label"}),(0,s.jsx)(A.Input,{value:m.labels.device,onChange:e=>a({labels:{...m.labels,device:e.target.value}}),placeholder:"Device"})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Brand label"}),(0,s.jsx)(A.Input,{value:m.labels.deviceBrand,onChange:e=>a({labels:{...m.labels,deviceBrand:e.target.value}}),placeholder:"Brand"})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Type label"}),(0,s.jsx)(A.Input,{value:m.labels.deviceType,onChange:e=>a({labels:{...m.labels,deviceType:e.target.value}}),placeholder:"Type"})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"IMEI label"}),(0,s.jsx)(A.Input,{value:m.labels.imei,onChange:e=>a({labels:{...m.labels,imei:e.target.value}}),placeholder:"IMEI"})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Additional device fields"}),(0,s.jsx)("div",{className:"mt-1 text-xs text-zinc-500",children:"Custom fields shown on the device form."})]}),(0,s.jsx)(N.Button,{variant:"outline",disabled:t,onClick:_,children:"Add field"})]}),(0,s.jsx)(S.Card,{className:"shadow-none",children:(0,s.jsxs)(S.CardContent,{className:"pt-5",children:[(0,s.jsx)(q.DataTable,{title:"Additional device fields",data:y,columns:E,getRowId:e=>e.id,emptyMessage:"No additional fields yet.",search:{placeholder:"Search fields..."},onRowClick:t?void 0:e=>I(e),server:{query:u,onQueryChange:e=>{x(e),h(0)},pageIndex:p,onPageIndexChange:h,pageSize:g,onPageSizeChange:e=>{v(e),h(0)},totalRows:f}}),0===b.length?(0,s.jsxs)("div",{className:"mt-3 flex flex-wrap items-center justify-between gap-2 rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-[var(--rb-surface-muted)] px-3 py-2",children:[(0,s.jsx)("div",{className:"text-sm text-zinc-700",children:"Add your first field to capture extra device info (e.g. Password, Pattern, Account email)."}),(0,s.jsx)(N.Button,{variant:"outline",size:"sm",disabled:t,onClick:_,children:"Add field"})]}):null]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Pickup / Delivery"}),(0,s.jsxs)("div",{className:"mt-2 grid gap-3 sm:grid-cols-2",children:[(0,s.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:m.pickupDeliveryEnabled,onChange:e=>a({pickupDeliveryEnabled:e.target.checked})}),"Pickup/delivery enabled"]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Pickup charge"}),(0,s.jsx)(A.Input,{value:m.pickupCharge,onChange:e=>a({pickupCharge:e.target.value}),placeholder:"Pickup charge",disabled:!m.pickupDeliveryEnabled})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Delivery charge"}),(0,s.jsx)(A.Input,{value:m.deliveryCharge,onChange:e=>a({deliveryCharge:e.target.value}),placeholder:"Delivery charge",disabled:!m.pickupDeliveryEnabled})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Rental"}),(0,s.jsxs)("div",{className:"mt-2 grid gap-3 sm:grid-cols-2",children:[(0,s.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:m.rentalEnabled,onChange:e=>a({rentalEnabled:e.target.checked})}),"Rental enabled"]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Per day"}),(0,s.jsx)(A.Input,{value:m.rentalPerDay,onChange:e=>a({rentalPerDay:e.target.value}),placeholder:"Per-day",disabled:!m.rentalEnabled})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Per week"}),(0,s.jsx)(A.Input,{value:m.rentalPerWeek,onChange:e=>a({rentalPerWeek:e.target.value}),placeholder:"Per-week",disabled:!m.rentalEnabled})]})]})]}),(0,s.jsx)(L.Modal,{open:l,onClose:T,title:C?"Edit additional device field":"Add additional device field",footer:(0,s.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,s.jsx)(N.Button,{variant:"outline",onClick:T,children:"Close"}),(0,s.jsx)(N.Button,{disabled:t,onClick:B,children:"Save"})]}),children:(0,s.jsxs)("div",{className:"space-y-3",children:[d?(0,s.jsx)("div",{className:"text-sm text-red-600",children:d}):null,(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Label"}),(0,s.jsx)(A.Input,{value:k.label,onChange:e=>{o(null),w(s=>({...s,label:e.target.value}))},placeholder:"e.g. Password",autoFocus:!0,onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),B())}})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Type"}),(0,s.jsx)(P.Select,{value:k.type,onChange:()=>{},disabled:!0,children:(0,s.jsx)("option",{value:"text",children:"Text"})})]}),(0,s.jsxs)("div",{className:"grid gap-3 sm:grid-cols-3",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"In booking form?"}),(0,s.jsxs)(P.Select,{value:k.displayInBookingForm?"yes":"no",onChange:e=>w(s=>({...s,displayInBookingForm:"yes"===e.target.value})),children:[(0,s.jsx)("option",{value:"yes",children:"Display"}),(0,s.jsx)("option",{value:"no",children:"Hide"})]})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"In invoice?"}),(0,s.jsxs)(P.Select,{value:k.displayInInvoice?"yes":"no",onChange:e=>w(s=>({...s,displayInInvoice:"yes"===e.target.value})),children:[(0,s.jsx)("option",{value:"yes",children:"Display"}),(0,s.jsx)("option",{value:"no",children:"Hide"})]})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"In customer output?"}),(0,s.jsxs)(P.Select,{value:k.displayForCustomer?"yes":"no",onChange:e=>w(s=>({...s,displayForCustomer:"yes"===e.target.value})),children:[(0,s.jsx)("option",{value:"yes",children:"Display"}),(0,s.jsx)("option",{value:"no",children:"Hide"})]})]})]})]})})]})}function W({draft:e,updateEstimates:a}){let t=e.estimates;return(0,s.jsx)(F,{title:"Estimates",description:"Email templates and estimate workflow toggles.",children:(0,s.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,s.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:t.disableEstimates,onChange:e=>a({disableEstimates:e.target.checked})}),"Disable estimates"]}),(0,s.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:t.bookingQuoteSendToJobs,onChange:e=>a({bookingQuoteSendToJobs:e.target.checked})}),"Booking & quote forms: send to jobs"]}),(0,s.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Email subject to customer"}),(0,s.jsx)(A.Input,{value:t.customerEmailSubject,onChange:e=>a({customerEmailSubject:e.target.value})})]}),(0,s.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Email body to customer"}),(0,s.jsx)("textarea",{className:"min-h-[140px] w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:t.customerEmailBody,onChange:e=>a({customerEmailBody:e.target.value})})]}),(0,s.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Approve/reject email subject to admin"}),(0,s.jsx)(A.Input,{value:t.adminApproveRejectEmailSubject,onChange:e=>a({adminApproveRejectEmailSubject:e.target.value})})]}),(0,s.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Approve/reject email body to admin"}),(0,s.jsx)("textarea",{className:"min-h-[140px] w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:t.adminApproveRejectEmailBody,onChange:e=>a({adminApproveRejectEmailBody:e.target.value})})]})]})})}function J({draft:e,updateGeneral:a}){let t=e.general;return(0,s.jsx)(F,{title:"General",description:"Business identity, case numbering and customer communication defaults.",children:(0,s.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Business name"}),(0,s.jsx)(A.Input,{value:t.businessName,onChange:e=>a({businessName:e.target.value})})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Display name"}),(0,s.jsx)(A.Input,{value:t.displayName,onChange:e=>a({displayName:e.target.value}),placeholder:"Defaults to business name"})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Primary contact person name"}),(0,s.jsx)(A.Input,{value:t.primaryContactName,onChange:e=>a({primaryContactName:e.target.value}),placeholder:"e.g. Alex Johnson"})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Business registration number"}),(0,s.jsx)(A.Input,{value:t.registrationNumber,onChange:e=>a({registrationNumber:e.target.value}),placeholder:"Optional"})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Business phone"}),(0,s.jsx)(A.Input,{value:t.businessPhone,onChange:e=>a({businessPhone:e.target.value}),placeholder:"+1 555 123 4567"})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Email"}),(0,s.jsx)(A.Input,{value:t.email,onChange:e=>a({email:e.target.value}),type:"email",placeholder:"support@company.com"})]}),(0,s.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Business address"}),(0,s.jsx)(A.Input,{value:t.businessAddress,onChange:e=>a({businessAddress:e.target.value}),placeholder:"Street, City, Region"})]}),(0,s.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Logo URL"}),(0,s.jsx)(A.Input,{value:t.logoUrl,onChange:e=>a({logoUrl:e.target.value}),placeholder:"https://..."})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Case number prefix"}),(0,s.jsx)(A.Input,{value:t.caseNumberPrefix,onChange:e=>a({caseNumberPrefix:e.target.value}),placeholder:"RB"})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Case number length"}),(0,s.jsx)(A.Input,{value:String(t.caseNumberLength),onChange:e=>a({caseNumberLength:Number(e.target.value||0)}),type:"number",min:1})]}),(0,s.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,s.jsxs)("label",{className:"flex items-start gap-2 text-sm",children:[(0,s.jsx)("input",{className:"mt-0.5",type:"checkbox",checked:t.emailCustomer,onChange:e=>a({emailCustomer:e.target.checked})}),(0,s.jsx)("span",{className:"font-medium",children:"Email customer"})]}),(0,s.jsx)("div",{className:"pl-6 text-xs text-zinc-500",children:"Send customer updates by email by default."})]}),(0,s.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,s.jsxs)("label",{className:"flex items-start gap-2 text-sm",children:[(0,s.jsx)("input",{className:"mt-0.5",type:"checkbox",checked:t.attachPdf,onChange:e=>a({attachPdf:e.target.checked})}),(0,s.jsx)("span",{className:"font-medium",children:"Attach PDF"})]}),(0,s.jsx)("div",{className:"pl-6 text-xs text-zinc-500",children:"Attach a PDF copy to outgoing customer emails."})]}),(0,s.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,s.jsxs)("label",{className:"flex items-start gap-2 text-sm",children:[(0,s.jsx)("input",{className:"mt-0.5",type:"checkbox",checked:t.nextServiceDateEnabled,onChange:e=>a({nextServiceDateEnabled:e.target.checked})}),(0,s.jsx)("span",{className:"font-medium",children:"Next service date"})]}),(0,s.jsx)("div",{className:"pl-6 text-xs text-zinc-500",children:"Enable tracking a next service date on jobs and documents."})]}),(0,s.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"GDPR acceptance text"}),(0,s.jsx)("textarea",{className:"min-h-[90px] w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:t.gdprAcceptanceText,onChange:e=>a({gdprAcceptanceText:e.target.value})})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"GDPR link label"}),(0,s.jsx)(A.Input,{value:t.gdprLinkLabel,onChange:e=>a({gdprLinkLabel:e.target.value})})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"GDPR link URL"}),(0,s.jsx)(A.Input,{value:t.gdprLinkUrl,onChange:e=>a({gdprLinkUrl:e.target.value}),placeholder:"https://..."})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Default country"}),(0,s.jsx)(A.Input,{value:t.defaultCountry,onChange:e=>a({defaultCountry:e.target.value}),placeholder:"US"})]}),(0,s.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,s.jsxs)("label",{className:"flex items-start gap-2 text-sm",children:[(0,s.jsx)("input",{className:"mt-0.5",type:"checkbox",checked:t.disableStatusCheckBySerial,onChange:e=>a({disableStatusCheckBySerial:e.target.checked})}),(0,s.jsx)("span",{className:"font-medium",children:"Disable status check by serial"})]}),(0,s.jsx)("div",{className:"pl-6 text-xs text-zinc-500",children:"Hide serial-based status lookup to reduce customer self-service options."})]})]})})}function Q({draft:e,updateInvoicesReports:a}){let t=e.invoicesReports;return(0,s.jsx)(F,{title:"Invoices & Reports",description:"Document printing, footer content and invoice display preferences.",children:(0,s.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,s.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:t.addQrCodeToInvoice,onChange:e=>a({addQrCodeToInvoice:e.target.checked})}),"Add QR code to invoice"]}),(0,s.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Invoice footer message"}),(0,s.jsx)(A.Input,{value:t.invoiceFooterMessage,onChange:e=>a({invoiceFooterMessage:e.target.value})})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Invoice print type"}),(0,s.jsxs)(P.Select,{value:t.invoicePrintType,onChange:e=>a({invoicePrintType:e.target.value}),children:[(0,s.jsx)("option",{value:"standard",children:"Standard"}),(0,s.jsx)("option",{value:"thermal",children:"Thermal"})]})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Repair order type"}),(0,s.jsxs)(P.Select,{value:t.repairOrderType,onChange:e=>a({repairOrderType:e.target.value}),children:[(0,s.jsx)("option",{value:"standard",children:"Standard"}),(0,s.jsx)("option",{value:"detailed",children:"Detailed"})]})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Repair order print size"}),(0,s.jsxs)(P.Select,{value:t.repairOrderPrintSize,onChange:e=>a({repairOrderPrintSize:e.target.value}),children:[(0,s.jsx)("option",{value:"a4",children:"A4"}),(0,s.jsx)("option",{value:"letter",children:"Letter"})]})]}),(0,s.jsxs)("div",{className:"sm:col-span-2 grid gap-2",children:[(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:t.displayPickupDate,onChange:e=>a({displayPickupDate:e.target.checked})}),"Display pickup date"]}),(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:t.displayDeliveryDate,onChange:e=>a({displayDeliveryDate:e.target.checked})}),"Display delivery date"]}),(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:t.displayNextServiceDate,onChange:e=>a({displayNextServiceDate:e.target.checked})}),"Display next service date"]})]}),(0,s.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Invoice disclaimer / terms"}),(0,s.jsx)("textarea",{className:"min-h-[120px] w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:t.invoiceDisclaimerTerms,onChange:e=>a({invoiceDisclaimerTerms:e.target.value})})]}),(0,s.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Terms URL"}),(0,s.jsx)(A.Input,{value:t.termsUrl,onChange:e=>a({termsUrl:e.target.value}),placeholder:"https://..."})]}),(0,s.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:t.displayBusinessAddressDetails,onChange:e=>a({displayBusinessAddressDetails:e.target.checked})}),"Display business address details"]}),(0,s.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:t.displayCustomerEmailAddressDetails,onChange:e=>a({displayCustomerEmailAddressDetails:e.target.checked})}),"Display customer email/address details"]}),(0,s.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Repair order footer message"}),(0,s.jsx)(A.Input,{value:t.repairOrderFooterMessage,onChange:e=>a({repairOrderFooterMessage:e.target.value})})]})]})})}var Y=e.i(57373),G=e.i(1314);let V=[{value:"",label:"Default"},{value:"info",label:"Info"},{value:"success",label:"Success"},{value:"warning",label:"Warning"},{value:"danger",label:"Danger"}];function Z(e){return"info"===e||"success"===e||"warning"===e||"danger"===e||"default"===e?e:"default"}function K(e){if("string"!=typeof e)return null;let s=e.trim();return s.length>0?s:null}function X({tenantSlug:e}){let t=(0,G.useAuth)(),l=(0,a.useRouter)(),[n,r]=i.default.useState(!0),[c,d]=i.default.useState(!1),[o,m]=i.default.useState(null),[u,x]=i.default.useState(null),[p,h]=i.default.useState("job"),[g,v]=i.default.useState([]),[b,j]=i.default.useState([]),[f,y]=i.default.useState(""),[C,k]=i.default.useState(0),[w,I]=i.default.useState(10),[T,B]=i.default.useState(!1),[D,E]=i.default.useState("job"),[M,R]=i.default.useState(""),[$,U]=i.default.useState(""),[O,H]=i.default.useState(""),[W,J]=i.default.useState(""),Q=i.default.useCallback((e,s)=>{E(e),R(s.slug),U(s.label??""),H("string"==typeof s.color?s.color:""),J("number"==typeof s.sort_order?String(s.sort_order):""),B(!0)},[]),X=i.default.useCallback(async()=>{if("string"!=typeof e||0===e.length)return void m("Business is missing.");try{r(!0),m(null),x(null);let[s,a]=await Promise.all([(0,_.apiFetch)(`/api/${e}/app/repairbuddy/job-statuses`),(0,_.apiFetch)(`/api/${e}/app/repairbuddy/payment-statuses`)]);v(Array.isArray(s.job_statuses)?s.job_statuses:[]),j(Array.isArray(a.payment_statuses)?a.payment_statuses:[])}catch(s){if(s instanceof _.ApiError&&428===s.status&&"string"==typeof e&&e.length>0){let s=`/app/${e}/business-settings?section=job-statuses`;l.replace(`/app/${e}/branches/select?next=${encodeURIComponent(s)}`);return}m(s instanceof Error?s.message:"Failed to load statuses.")}finally{r(!1)}},[l,e]);i.default.useEffect(()=>{if(!t.loading&&t.isAuthenticated){if(!t.can("jobs.view"))return void l.replace("/app");X()}},[t,X,l]);let ee=i.default.useMemo(()=>{let e="job"===p?g:b,s=f.trim().toLowerCase();return s?e.filter(e=>`${e.slug} ${e.label} ${e.color??""} ${e.sort_order??""}`.toLowerCase().includes(s)):e},[p,g,b,f]),es=ee.length,ea=i.default.useMemo(()=>{let e=C*w,s=e+w;return ee.slice(e,s)},[ee,C,w]),et=i.default.useMemo(()=>[{id:"label",header:"Label",cell:e=>(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(z.Badge,{variant:Z(e.color),children:e.label}),"string"==typeof e.color&&e.color.length>0?(0,s.jsxs)("span",{className:"text-xs text-zinc-500",children:["(",e.color,")"]}):null]}),(0,s.jsx)("div",{className:"mt-1 truncate text-xs text-zinc-600",children:e.slug})]}),className:"min-w-[280px]"},{id:"invoice",header:"Invoice label",cell:e=>(0,s.jsx)("div",{className:"text-sm text-zinc-700",children:e.invoice_label??"—"}),className:"min-w-[200px]"},{id:"order",header:"Order",cell:e=>(0,s.jsx)("div",{className:"text-sm text-zinc-700",children:"number"==typeof e.sort_order?e.sort_order:"—"}),className:"whitespace-nowrap"},{id:"active",header:"Active",cell:e=>(0,s.jsx)("div",{className:"text-sm text-zinc-700",children:!1===e.is_active?"No":"Yes"}),className:"whitespace-nowrap"},{id:"actions",header:"Actions",cell:e=>(0,s.jsx)("div",{className:"whitespace-nowrap",children:(0,s.jsx)(N.Button,{variant:"outline",size:"sm",onClick:()=>Q("job",e),children:"Edit"})}),className:"whitespace-nowrap"}],[Q]),el=i.default.useMemo(()=>[{id:"label",header:"Label",cell:e=>(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(z.Badge,{variant:Z(e.color),children:e.label}),"string"==typeof e.color&&e.color.length>0?(0,s.jsxs)("span",{className:"text-xs text-zinc-500",children:["(",e.color,")"]}):null]}),(0,s.jsx)("div",{className:"mt-1 truncate text-xs text-zinc-600",children:e.slug})]}),className:"min-w-[280px]"},{id:"order",header:"Order",cell:e=>(0,s.jsx)("div",{className:"text-sm text-zinc-700",children:"number"==typeof e.sort_order?e.sort_order:"—"}),className:"whitespace-nowrap"},{id:"active",header:"Active",cell:e=>(0,s.jsx)("div",{className:"text-sm text-zinc-700",children:!1===e.is_active?"No":"Yes"}),className:"whitespace-nowrap"},{id:"actions",header:"Actions",cell:e=>(0,s.jsx)("div",{className:"whitespace-nowrap",children:(0,s.jsx)(N.Button,{variant:"outline",size:"sm",onClick:()=>Q("payment",e),children:"Edit"})}),className:"whitespace-nowrap"}],[Q]);async function ei(s){if(c)return;if("string"!=typeof e||0===e.length)return void m("Business is missing.");let a="job"===D?`/api/${e}/app/repairbuddy/job-statuses/${encodeURIComponent(M)}`:`/api/${e}/app/repairbuddy/payment-statuses/${encodeURIComponent(M)}`,t="reset"===s?{label:null,color:null,sort_order:null}:{label:K($),color:K(O),sort_order:function(e){if("string"!=typeof e&&"number"!=typeof e)return null;let s=String(e).trim();if(0===s.length)return null;let a=Number.parseInt(s,10);return Number.isFinite(a)?Math.max(0,Math.min(1e5,a)):null}(W)};try{d(!0),m(null),x(null),await (0,_.apiFetch)(a,{method:"PATCH",body:t}),B(!1),x("reset"===s?"Status reset to defaults.":"Status saved."),await X()}catch(s){if(s instanceof _.ApiError&&428===s.status&&"string"==typeof e&&e.length>0){let s=`/app/${e}/business-settings?section=job-statuses`;l.replace(`/app/${e}/branches/select?next=${encodeURIComponent(s)}`);return}m(s instanceof Error?s.message:"Failed to save status.")}finally{d(!1)}}return(0,s.jsxs)(F,{title:"Statuses",description:"Customize display labels, colors, and ordering for job and payment statuses.",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[u?(0,s.jsx)("div",{className:"text-sm text-zinc-600",children:u}):(0,s.jsx)("div",{}),(0,s.jsx)(N.Button,{variant:"outline",size:"sm",onClick:()=>void X(),disabled:n||c,children:"Refresh"})]}),o?(0,s.jsx)("div",{className:"text-sm text-red-600",children:o}):null,(0,s.jsxs)(Y.Tabs,{value:p,onValueChange:e=>{("job"===e||"payment"===e)&&(h(e),y(""),k(0))},children:[(0,s.jsxs)(Y.TabsList,{children:[(0,s.jsx)(Y.TabsTrigger,{value:"job",children:"Job statuses"}),(0,s.jsx)(Y.TabsTrigger,{value:"payment",children:"Payment statuses"})]}),(0,s.jsx)(Y.TabsContent,{value:"job",children:(0,s.jsx)(S.Card,{className:"shadow-none",children:(0,s.jsx)(S.CardContent,{className:"pt-5",children:(0,s.jsx)(q.DataTable,{title:`Job statuses \xb7 ${e}`,data:ea,columns:et,getRowId:e=>e.id,emptyMessage:"No job statuses.",server:{query:f,onQueryChange:e=>{y(e),k(0)},pageIndex:C,onPageIndexChange:k,pageSize:w,onPageSizeChange:e=>{I(e),k(0)},totalRows:es}})})})}),(0,s.jsx)(Y.TabsContent,{value:"payment",children:(0,s.jsx)(S.Card,{className:"shadow-none",children:(0,s.jsx)(S.CardContent,{className:"pt-5",children:(0,s.jsx)(q.DataTable,{title:`Payment statuses \xb7 ${e}`,data:ea,columns:el,getRowId:e=>e.id,emptyMessage:"No payment statuses.",server:{query:f,onQueryChange:e=>{y(e),k(0)},pageIndex:C,onPageIndexChange:k,pageSize:w,onPageSizeChange:e=>{I(e),k(0)},totalRows:es}})})})})]}),(0,s.jsx)(L.Modal,{open:T,onClose:()=>{c||B(!1)},title:"job"===D?"Edit job status":"Edit payment status",footer:(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,s.jsx)(N.Button,{variant:"outline",disabled:c,onClick:()=>void ei("reset"),children:"Reset to defaults"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(N.Button,{variant:"outline",disabled:c,onClick:()=>B(!1),children:"Cancel"}),(0,s.jsx)(N.Button,{disabled:c,onClick:()=>void ei("save"),children:c?"Saving...":"Save"})]})]}),children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Label"}),(0,s.jsx)(A.Input,{value:$,onChange:e=>U(e.target.value),placeholder:"e.g. In Service",maxLength:255}),(0,s.jsx)("div",{className:"text-xs text-zinc-500",children:"Leave blank to fall back to the default label."})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Color"}),(0,s.jsx)(P.Select,{value:O,onChange:e=>H(e.target.value),children:V.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.label+e.value))}),(0,s.jsx)("div",{className:"text-xs text-zinc-500",children:"Used to style badges in the UI."})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Sort order"}),(0,s.jsx)(A.Input,{value:W,onChange:e=>J(e.target.value),placeholder:"e.g. 10",inputMode:"numeric"}),(0,s.jsx)("div",{className:"text-xs text-zinc-500",children:"Lower numbers appear first. Leave blank to use the default order."})]})]})})]})}async function ee(e,s){let a=new URLSearchParams;s?.q&&a.set("q",s.q);let t=a.toString()?`?${a.toString()}`:"";return(0,_.apiFetch)(`/api/${e}/app/repairbuddy/maintenance-reminders${t}`)}async function es(e,s){return(0,_.apiFetch)(`/api/${e}/app/repairbuddy/maintenance-reminders`,{method:"POST",body:s})}async function ea(e,s,a){return(0,_.apiFetch)(`/api/${e}/app/repairbuddy/maintenance-reminders/${s}`,{method:"PATCH",body:a})}async function et(e,s){return(0,_.apiFetch)(`/api/${e}/app/repairbuddy/maintenance-reminders/${s}`,{method:"DELETE"})}async function el(e,s,a){return(0,_.apiFetch)(`/api/${e}/app/repairbuddy/maintenance-reminders/${s}/test`,{method:"POST",body:a})}function ei(e){return e?"Yes":"No"}function en(e){return e?"success":"warning"}function er({tenantSlug:e,draft:a,isMock:t}){let[l,r]=(0,i.useState)(!1),[c,d]=(0,i.useState)(!1),[o,m]=(0,i.useState)(null),[u,x]=(0,i.useState)(null),[p,h]=(0,i.useState)(""),[g,v]=(0,i.useState)(0),[b,j]=(0,i.useState)(10),[f,y]=(0,i.useState)(!1),[C,k]=(0,i.useState)(null),[w,I]=(0,i.useState)([]),[T,B]=(0,i.useState)([]),[A,D]=(0,i.useState)([]),E=i.default.useCallback(async()=>{y(!0),k(null);try{let s=await ee(String(e),{q:p.trim()||void 0});I(Array.isArray(s.reminders)?s.reminders:[])}catch(e){k(e instanceof Error?e.message:"Failed to load reminders.")}finally{y(!1)}},[p,e]);(0,i.useEffect)(()=>{E()},[E]),(0,i.useEffect)(()=>{let s=!0;return async function(){try{let[a,t]=await Promise.all([(0,_.apiFetch)(`/api/${String(e)}/app/repairbuddy/device-types?limit=200`),(0,_.apiFetch)(`/api/${String(e)}/app/repairbuddy/device-brands?limit=200`)]);if(!s)return;B(Array.isArray(a.device_types)?a.device_types:[]),D(Array.isArray(t.device_brands)?t.device_brands:[])}catch{if(!s)return;B([]),D([])}}(),()=>{s=!1}},[e]);let P=w.length,M=(0,i.useMemo)(()=>{let e=g*b,s=e+b;return w.slice(e,s)},[g,b,w]),R=(0,i.useMemo)(()=>[{id:"name",header:"Name",cell:e=>(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("div",{className:"truncate font-medium text-[var(--rb-text)]",children:e.name}),e.description?(0,s.jsx)("div",{className:"truncate text-xs text-zinc-600",children:e.description}):null]}),className:"min-w-[240px]"},{id:"interval",header:"Interval",cell:e=>(0,s.jsxs)("div",{className:"text-sm text-zinc-700",children:[e.interval_days," days"]}),className:"whitespace-nowrap"},{id:"type",header:"Device Type",cell:e=>(0,s.jsx)("div",{className:"text-sm text-zinc-700",children:e.device_type_name??"All"}),className:"min-w-[160px]"},{id:"brand",header:"Brand",cell:e=>(0,s.jsx)("div",{className:"text-sm text-zinc-700",children:e.device_brand_name??"All"}),className:"min-w-[160px]"},{id:"email",header:"Email",cell:e=>(0,s.jsx)(z.Badge,{variant:en(e.email_enabled),children:ei(e.email_enabled)}),className:"whitespace-nowrap"},{id:"sms",header:"SMS",cell:e=>(0,s.jsx)(z.Badge,{variant:en(e.sms_enabled),children:ei(e.sms_enabled)}),className:"whitespace-nowrap"},{id:"enabled",header:"Reminder",cell:e=>(0,s.jsx)(z.Badge,{variant:en(e.reminder_enabled),children:e.reminder_enabled?"Enabled":"Disabled"}),className:"whitespace-nowrap"},{id:"last_run",header:"Last run",cell:e=>(0,s.jsx)("div",{className:"text-sm text-zinc-700",children:e.last_executed_at?new Date(e.last_executed_at).toLocaleString():"—"}),className:"whitespace-nowrap"},{id:"actions",header:"Actions",cell:a=>(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(N.Button,{size:"sm",variant:"outline",onClick:()=>{m(a),r(!0)},children:"Edit"}),(0,s.jsx)(N.Button,{size:"sm",variant:"outline",onClick:()=>{x(a),d(!0)},children:"Send test"}),(0,s.jsx)(N.Button,{asChild:!0,size:"sm",variant:"outline",children:(0,s.jsx)(n.default,{href:`/app/${String(e)}/reminder-logs?reminder_id=${a.id}`,children:"Logs"})})]}),className:"whitespace-nowrap"}],[e]);async function $(s){if(globalThis.confirm(`Delete reminder "${s.name}"?`)){k(null);try{await et(String(e),s.id),await E()}catch(e){k(e instanceof Error?e.message:"Delete failed.")}}}return(0,s.jsxs)(F,{title:"Maintenance Reminders",description:"Automated service follow-ups based on delivery date.",children:[(0,s.jsx)("div",{className:"flex flex-wrap items-center justify-end gap-2",children:(0,s.jsx)(N.Button,{variant:"outline",onClick:()=>{m(null),r(!0)},children:"Add reminder"})}),(0,s.jsx)(S.Card,{className:"shadow-none",children:(0,s.jsx)(S.CardContent,{className:"pt-5",children:(0,s.jsx)(q.DataTable,{title:"Reminders",data:M,columns:R,getRowId:e=>e.id,loading:f,emptyMessage:"No reminders configured.",search:{placeholder:"Search reminders..."},server:{query:p,onQueryChange:e=>{h(e),v(0)},pageIndex:g,onPageIndexChange:v,pageSize:b,onPageSizeChange:e=>{j(e),v(0)},totalRows:P}})})}),C?(0,s.jsx)("div",{className:"text-sm text-red-600",children:C}):null,(0,s.jsx)(L.Modal,{open:l,onClose:()=>{r(!1),m(null)},title:o?`Edit reminder \xb7 ${o.name}`:"Add reminder",footer:(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsx)("div",{children:o?(0,s.jsx)(N.Button,{variant:"outline",onClick:()=>void $(o),children:"Delete"}):null}),(0,s.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,s.jsx)(N.Button,{variant:"outline",onClick:()=>{r(!1),m(null)},children:"Close"}),(0,s.jsx)(N.Button,{form:"maintenanceReminderForm",type:"submit",children:"Save"})]})]}),children:(0,s.jsx)(ec,{tenantSlug:e,deviceTypes:T,deviceBrands:A,initial:o,onSaved:async()=>{r(!1),m(null),await E()},onError:e=>k(e)})}),(0,s.jsx)(L.Modal,{open:c,onClose:()=>{d(!1),x(null)},title:u?`Send test \xb7 ${u.name}`:"Send test",footer:(0,s.jsx)("div",{className:"flex items-center justify-end gap-2",children:(0,s.jsx)(N.Button,{variant:"outline",onClick:()=>{d(!1),x(null)},children:"Close"})}),children:(0,s.jsx)(ed,{tenantSlug:e,reminder:u,onError:e=>k(e)})})]})}function ec({tenantSlug:e,deviceTypes:a,deviceBrands:t,initial:l,onSaved:n,onError:r}){let[c,d]=(0,i.useState)(!1),[o,m]=(0,i.useState)(null),[u,x]=(0,i.useState)(l?.name??""),[p,h]=(0,i.useState)(l?.description??""),[g,v]=(0,i.useState)(l?.interval_days??180),[b,j]=(0,i.useState)(l?.device_type_id??0),[f,y]=(0,i.useState)(l?.device_brand_id??0),[N,S]=(0,i.useState)(l?.reminder_enabled??!0),[C,k]=(0,i.useState)(l?.email_enabled??!1),[w,I]=(0,i.useState)(l?.sms_enabled??!1),[T,B]=(0,i.useState)(l?.email_body??""),[D,E]=(0,i.useState)(l?.sms_body??"");async function F(s){s.preventDefault(),m(null);let a=u.trim();if(!a)return void m("Name is required.");if(!Number.isFinite(g)||g<=0)return void m("Interval must be at least 1 day.");if(C&&!T.trim())return void m("Email body is required when email is enabled.");if(w&&!D.trim())return void m("SMS body is required when SMS is enabled.");let t={name:a,description:p.trim()?p.trim():null,interval_days:g,device_type_id:b||null,device_brand_id:f||null,reminder_enabled:N,email_enabled:C,sms_enabled:w,email_body:T.trim()?T:null,sms_body:D.trim()?D:null};d(!0);try{l?await ea(String(e),l.id,t):await es(String(e),t),await n()}catch(s){let e=s instanceof _.ApiError||s instanceof Error?s.message:"Save failed.";m(e),r(e)}finally{d(!1)}}return(0,i.useEffect)(()=>{x(l?.name??""),h(l?.description??""),v(l?.interval_days??180),j(l?.device_type_id??0),y(l?.device_brand_id??0),S(l?.reminder_enabled??!0),k(l?.email_enabled??!1),I(l?.sms_enabled??!1),B(l?.email_body??""),E(l?.sms_body??"")},[l]),(0,s.jsxs)("form",{id:"maintenanceReminderForm",onSubmit:F,className:"space-y-4",children:[o?(0,s.jsx)("div",{className:"text-sm text-red-600",children:o}):null,(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Name"}),(0,s.jsx)(A.Input,{value:u,onChange:e=>x(e.target.value),placeholder:"e.g. 6-month service",disabled:c})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Interval (days)"}),(0,s.jsx)(A.Input,{type:"number",min:1,max:3650,value:String(g),onChange:e=>v(Number(e.target.value||0)),disabled:c})]})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Description"}),(0,s.jsx)(A.Input,{value:p,onChange:e=>h(e.target.value),placeholder:"Optional",disabled:c})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Device Type"}),(0,s.jsxs)(P.Select,{value:String(b),onChange:e=>j(Number(e.target.value)),disabled:c,children:[(0,s.jsx)("option",{value:"0",children:"All"}),a.filter(e=>e&&"number"==typeof e.id).map(e=>(0,s.jsx)("option",{value:String(e.id),children:e.name},e.id))]})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Brand"}),(0,s.jsxs)(P.Select,{value:String(f),onChange:e=>y(Number(e.target.value)),disabled:c,children:[(0,s.jsx)("option",{value:"0",children:"All"}),t.filter(e=>e&&"number"==typeof e.id).map(e=>(0,s.jsx)("option",{value:String(e.id),children:e.name},e.id))]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-3",children:[(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:N,onChange:e=>S(e.target.checked),disabled:c}),(0,s.jsx)("span",{children:"Reminder enabled"})]}),(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:C,onChange:e=>k(e.target.checked),disabled:c}),(0,s.jsx)("span",{children:"Email enabled"})]}),(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:w,onChange:e=>I(e.target.checked),disabled:c}),(0,s.jsx)("span",{children:"SMS enabled"})]})]}),(0,s.jsx)("div",{className:"space-y-1",children:(0,s.jsxs)("div",{className:"text-xs text-zinc-500",children:["Template variables: ","{{customer_name}}"," ","{{device_name}}"," ","{{unsubscribe_device}}"]})}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Email body"}),(0,s.jsx)("textarea",{className:"w-full rounded-[var(--rb-radius-sm)] border border-zinc-300 bg-white px-3 py-2 text-sm text-[var(--rb-text)] outline-none transition focus-visible:ring-2 focus-visible:ring-[color:color-mix(in_srgb,var(--rb-orange),white_65%)]",rows:6,value:T,onChange:e=>B(e.target.value),placeholder:"Write your email message...",disabled:c})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"SMS body"}),(0,s.jsx)("textarea",{className:"w-full rounded-[var(--rb-radius-sm)] border border-zinc-300 bg-white px-3 py-2 text-sm text-[var(--rb-text)] outline-none transition focus-visible:ring-2 focus-visible:ring-[color:color-mix(in_srgb,var(--rb-orange),white_65%)]",rows:4,value:D,onChange:e=>E(e.target.value),placeholder:"Write your SMS message...",disabled:c})]})]})}function ed({tenantSlug:e,reminder:a,onError:t}){let[l,n]=(0,i.useState)(""),[r,c]=(0,i.useState)(""),[d,o]=(0,i.useState)(!1),[m,u]=(0,i.useState)(null),[x,p]=(0,i.useState)(null),[h,g]=(0,i.useState)(null);async function v(){if(!a)return;u(null),p(null),g(null);let s=l.trim(),i=r.trim();if(!s&&!i)return void u("Email or phone is required.");o(!0);try{let t=await el(String(e),a.id,{email:s||null,phone:i||null});p(t.preview),g(t.status)}catch(s){let e=s instanceof _.ApiError||s instanceof Error?s.message:"Test failed.";u(e),t(e)}finally{o(!1)}}return(0,i.useEffect)(()=>{u(null),p(null),g(null)},[a]),(0,s.jsxs)("div",{className:"space-y-3",children:[m?(0,s.jsx)("div",{className:"text-sm text-red-600",children:m}):null,(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Email"}),(0,s.jsx)(A.Input,{value:l,onChange:e=>n(e.target.value),placeholder:"name@company.com",disabled:d})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Phone"}),(0,s.jsx)(A.Input,{value:r,onChange:e=>c(e.target.value),placeholder:"+1 555 000 0000",disabled:d})]})]}),(0,s.jsx)("div",{className:"flex items-center justify-end",children:(0,s.jsx)(N.Button,{onClick:()=>void v(),disabled:d||!a,children:d?"Sending...":"Send test"})}),h?(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-2 sm:grid-cols-2",children:[(0,s.jsxs)("div",{className:"text-xs text-zinc-600",children:["Email status: ",h.email]}),(0,s.jsxs)("div",{className:"text-xs text-zinc-600",children:["SMS status: ",h.sms]})]}):null,x?(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"rounded border border-zinc-200 bg-white p-3",children:[(0,s.jsx)("div",{className:"text-xs font-semibold text-zinc-700",children:"Email preview"}),(0,s.jsx)("pre",{className:"mt-2 whitespace-pre-wrap text-xs text-zinc-700",children:x.email||"(empty)"})]}),(0,s.jsxs)("div",{className:"rounded border border-zinc-200 bg-white p-3",children:[(0,s.jsx)("div",{className:"text-xs font-semibold text-zinc-700",children:"SMS preview"}),(0,s.jsx)("pre",{className:"mt-2 whitespace-pre-wrap text-xs text-zinc-700",children:x.sms||"(empty)"})]})]}):null]})}function eo({draft:e,updateMyAccount:a}){let t=e.myAccount;return(0,s.jsx)(F,{title:"My Account",description:"Customer portal toggles and booking form type.",children:(0,s.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,s.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:t.disableBooking,onChange:e=>a({disableBooking:e.target.checked})}),"Disable booking"]}),(0,s.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:t.disableEstimates,onChange:e=>a({disableEstimates:e.target.checked})}),"Disable estimates"]}),(0,s.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:t.disableReviews,onChange:e=>a({disableReviews:e.target.checked})}),"Disable reviews"]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Booking form type"}),(0,s.jsxs)(P.Select,{value:t.bookingFormType,onChange:e=>a({bookingFormType:e.target.value}),children:[(0,s.jsx)("option",{value:"simple",children:"Simple"}),(0,s.jsx)("option",{value:"detailed",children:"Detailed"})]})]})]})})}function em({draft:e,updatePayments:a,isMock:t}){let l=e.payments;return(0,s.jsx)(F,{title:"Payments",description:"Allowed payment methods.",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Payment methods"}),(0,s.jsxs)("div",{className:"mt-2 grid gap-2 sm:grid-cols-2",children:[(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:l.paymentMethods.cash,onChange:e=>a({paymentMethods:{...l.paymentMethods,cash:e.target.checked}})}),"Cash"]}),(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm text-zinc-400",children:[(0,s.jsx)("input",{type:"checkbox",checked:l.paymentMethods.card,disabled:!0}),"Card"]}),(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm text-zinc-400",children:[(0,s.jsx)("input",{type:"checkbox",checked:l.paymentMethods.bankTransfer,disabled:!0}),"Bank transfer"]}),(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm text-zinc-400",children:[(0,s.jsx)("input",{type:"checkbox",checked:l.paymentMethods.paypal,disabled:!0}),"PayPal"]}),(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm text-zinc-400",children:[(0,s.jsx)("input",{type:"checkbox",checked:l.paymentMethods.other,disabled:!0}),"Other"]})]})]})})}function eu({draft:e,updateReviews:a}){let t=e.reviews,l=(0,i.useMemo)(()=>e.jobStatuses.statuses,[e.jobStatuses.statuses]);return(0,s.jsx)(F,{title:"Reviews",description:"Customer feedback request rules and message templates.",children:(0,s.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,s.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:t.requestFeedbackBySms,onChange:e=>a({requestFeedbackBySms:e.target.checked})}),"Request feedback by SMS"]}),(0,s.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:t.requestFeedbackByEmail,onChange:e=>a({requestFeedbackByEmail:e.target.checked})}),"Request feedback by Email"]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Feedback page selection"}),(0,s.jsxs)(P.Select,{value:t.feedbackPage,onChange:e=>a({feedbackPage:e.target.value}),children:[(0,s.jsx)("option",{value:"",children:"Select page (mock)"}),(0,s.jsx)("option",{value:"feedback",children:"Feedback"}),(0,s.jsx)("option",{value:"reviews",children:"Reviews"})]})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Send review request if job status is"}),(0,s.jsx)(P.Select,{value:t.sendReviewRequestIfJobStatusId,onChange:e=>a({sendReviewRequestIfJobStatusId:e.target.value}),children:l.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Auto feedback request interval (days)"}),(0,s.jsx)(A.Input,{type:"number",min:0,value:String(t.autoFeedbackRequestIntervalDays),onChange:e=>a({autoFeedbackRequestIntervalDays:Number(e.target.value||0)})})]}),(0,s.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Email subject"}),(0,s.jsx)(A.Input,{value:t.emailSubject,onChange:e=>a({emailSubject:e.target.value})})]}),(0,s.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Email message template"}),(0,s.jsx)("textarea",{className:"min-h-[120px] w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:t.emailMessageTemplate,onChange:e=>a({emailMessageTemplate:e.target.value})})]}),(0,s.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"SMS message template"}),(0,s.jsx)("textarea",{className:"min-h-[90px] w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:t.smsMessageTemplate,onChange:e=>a({smsMessageTemplate:e.target.value})})]})]})})}function ex({draft:e,updateServiceSettings:a}){let t=e.serviceSettings;return(0,s.jsx)(F,{title:"Service Settings",description:"Settings for the public service page and booking behavior.",children:(0,s.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,s.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Sidebar description"}),(0,s.jsx)("textarea",{className:"min-h-[120px] w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:t.sidebarDescription,onChange:e=>a({sidebarDescription:e.target.value})})]}),(0,s.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:t.disableBookingOnServicePage,onChange:e=>a({disableBookingOnServicePage:e.target.checked})}),"Disable booking on service page"]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Booking form type"}),(0,s.jsxs)(P.Select,{value:t.bookingFormType,onChange:e=>a({bookingFormType:e.target.value}),children:[(0,s.jsx)("option",{value:"simple",children:"Simple"}),(0,s.jsx)("option",{value:"detailed",children:"Detailed"})]})]})]})})}function ep({draft:e,updateSignatureWorkflow:a}){let t=e.signatureWorkflow,l=(0,i.useMemo)(()=>e.jobStatuses.statuses,[e.jobStatuses.statuses]);return(0,s.jsx)(F,{title:"Signature Workflow",description:"Pickup and delivery signature automation.",children:(0,s.jsxs)("div",{className:"grid gap-6",children:[(0,s.jsx)(eh,{title:"Pickup signature",value:t.pickup,statuses:l,onChange:function(e){a({pickup:{...t.pickup,...e}})}}),(0,s.jsx)(eh,{title:"Delivery signature",value:t.delivery,statuses:l,onChange:function(e){a({delivery:{...t.delivery,...e}})}})]})})}function eh({title:e,value:a,statuses:t,onChange:l}){return(0,s.jsxs)("div",{className:"rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-white p-4",children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:e}),(0,s.jsxs)("div",{className:"mt-3 grid gap-4 sm:grid-cols-2",children:[(0,s.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:a.enabled,onChange:e=>l({enabled:e.target.checked})}),"Enable"]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Trigger status"}),(0,s.jsx)(P.Select,{value:a.triggerStatusId,onChange:e=>l({triggerStatusId:e.target.value}),children:t.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Status after submission"}),(0,s.jsx)(P.Select,{value:a.statusAfterSubmissionId,onChange:e=>l({statusAfterSubmissionId:e.target.value}),children:t.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))})]}),(0,s.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Email subject"}),(0,s.jsx)(A.Input,{value:a.templates.emailSubject,onChange:e=>l({templates:{...a.templates,emailSubject:e.target.value}})})]}),(0,s.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Email template"}),(0,s.jsx)("textarea",{className:"min-h-[140px] w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:a.templates.emailTemplate,onChange:e=>l({templates:{...a.templates,emailTemplate:e.target.value}})})]}),(0,s.jsxs)("div",{className:"sm:col-span-2 space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"SMS text"}),(0,s.jsx)("textarea",{className:"min-h-[90px] w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:a.templates.smsText,onChange:e=>l({templates:{...a.templates,smsText:e.target.value}})})]})]})]})}function eg({draft:e,updateSms:a}){let t=e.sms,l=(0,i.useMemo)(()=>e.jobStatuses.statuses,[e.jobStatuses.statuses]);return(0,s.jsx)(F,{title:"SMS",description:"SMS gateway setup and when messages are sent (UI-only).",children:(0,s.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,s.jsxs)("label",{className:"sm:col-span-2 flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:t.activateSmsForSelectiveStatuses,onChange:e=>a({activateSmsForSelectiveStatuses:e.target.checked})}),"Activate SMS for selective statuses"]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Gateway selection"}),(0,s.jsxs)(P.Select,{value:t.gateway,onChange:e=>a({gateway:e.target.value}),children:[(0,s.jsx)("option",{value:"twilio",children:"Twilio"}),(0,s.jsx)("option",{value:"nexmo",children:"Nexmo"}),(0,s.jsx)("option",{value:"custom",children:"Custom"})]})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"From number"}),(0,s.jsx)(A.Input,{value:t.gatewayFromNumber,onChange:e=>a({gatewayFromNumber:e.target.value}),placeholder:"+15551234567"})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Account SID"}),(0,s.jsx)(A.Input,{value:t.gatewayAccountSid,onChange:e=>a({gatewayAccountSid:e.target.value}),placeholder:"(mock)"})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Auth token"}),(0,s.jsx)(A.Input,{value:t.gatewayAuthToken,onChange:e=>a({gatewayAuthToken:e.target.value}),placeholder:"(mock)"})]}),(0,s.jsxs)("div",{className:"sm:col-span-2",children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Send when status changed to"}),(0,s.jsx)("div",{className:"mt-2 grid gap-2 sm:grid-cols-2",children:l.map(e=>(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:t.sendWhenStatusChangedToIds.includes(e.id),onChange:()=>{var s;let l;return s=e.id,void((l=new Set(t.sendWhenStatusChangedToIds)).has(s)?l.delete(s):l.add(s),a({sendWhenStatusChangedToIds:Array.from(l)}))}}),e.name]},e.id))})]}),(0,s.jsxs)("div",{className:"sm:col-span-2",children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Test SMS"}),(0,s.jsxs)("div",{className:"mt-2 grid gap-3 sm:grid-cols-2",children:[(0,s.jsx)(A.Input,{value:t.testNumber,onChange:e=>a({testNumber:e.target.value}),placeholder:"Test number"}),(0,s.jsx)(A.Input,{value:t.testMessage,onChange:e=>a({testMessage:e.target.value}),placeholder:"Test message"})]}),(0,s.jsx)("div",{className:"mt-2 text-xs text-zinc-500",children:"Sending is disabled in this phase."})]})]})})}function ev({draft:e,updateStylingLabels:a}){let t=e.stylingLabels;return(0,s.jsx)(F,{title:"Styling & Labels",description:"Customer-facing label text and primary/secondary colors.",children:(0,s.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,s.jsxs)("div",{className:"sm:col-span-2",children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Labels"}),(0,s.jsxs)("div",{className:"mt-2 grid gap-3 sm:grid-cols-2",children:[(0,s.jsx)(A.Input,{value:t.labels.delivery,onChange:e=>a({labels:{...t.labels,delivery:e.target.value}}),placeholder:"Delivery"}),(0,s.jsx)(A.Input,{value:t.labels.pickup,onChange:e=>a({labels:{...t.labels,pickup:e.target.value}}),placeholder:"Pickup"}),(0,s.jsx)(A.Input,{value:t.labels.nextService,onChange:e=>a({labels:{...t.labels,nextService:e.target.value}}),placeholder:"Next service"}),(0,s.jsx)(A.Input,{value:t.labels.caseNumber,onChange:e=>a({labels:{...t.labels,caseNumber:e.target.value}}),placeholder:"Case number"})]})]}),(0,s.jsxs)("div",{className:"sm:col-span-2",children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Colors"}),(0,s.jsxs)("div",{className:"mt-2 grid gap-3 sm:grid-cols-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs font-medium text-zinc-600",children:"Primary"}),(0,s.jsxs)("div",{className:"mt-1 flex items-center gap-3",children:[(0,s.jsx)("input",{type:"color",value:t.colors.primary,onChange:e=>a({colors:{...t.colors,primary:e.target.value}}),className:"h-10 w-14 rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white shadow-sm"}),(0,s.jsx)(A.Input,{value:t.colors.primary,onChange:e=>a({colors:{...t.colors,primary:e.target.value}})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs font-medium text-zinc-600",children:"Secondary"}),(0,s.jsxs)("div",{className:"mt-1 flex items-center gap-3",children:[(0,s.jsx)("input",{type:"color",value:t.colors.secondary,onChange:e=>a({colors:{...t.colors,secondary:e.target.value}}),className:"h-10 w-14 rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white shadow-sm"}),(0,s.jsx)(A.Input,{value:t.colors.secondary,onChange:e=>a({colors:{...t.colors,secondary:e.target.value}})})]})]})]})]})]})})}var eb=e.i(69241);function ej({tenantSlug:e,draft:a,updateTaxes:t,isMock:l}){let[n,r]=(0,i.useState)(!1),[c,d]=(0,i.useState)(!1),[o,m]=(0,i.useState)(!1),[u,x]=(0,i.useState)(!1),[p,h]=(0,i.useState)(null),[g,v]=(0,i.useState)(null),[b,j]=(0,i.useState)(!1),[f,y]=(0,i.useState)(""),[C,k]=(0,i.useState)("RB"),[w,_]=(0,i.useState)([]),[B,D]=(0,i.useState)(!1),[E,M]=(0,i.useState)(""),[z,R]=(0,i.useState)(0),[$,U]=(0,i.useState)(10),O=a.taxes;async function H(s){if(!l)try{await (0,I.updateRepairBuddySettings)(String(e),{...a,taxes:s})}catch(e){h(e instanceof Error?e.message:"Failed to save tax preferences.")}}async function W(){if(!l){v(null),h(null),x(!0);try{let s=await (0,T.getSetup)(String(e)),a=s.setup?.state??{},t=a.tax??{},l={...a,tax:{...t,tax_registered:!!b,invoice_prefix:C.trim()||null}};await (0,T.updateSetup)(String(e),{billing_vat_number:f.trim()||null,setup_state:l}),v("Saved.")}catch(e){h(e instanceof Error?e.message:"Failed to save tax settings.")}finally{x(!1)}}}(0,i.useEffect)(()=>{let s=!0;return async function(){h(null),D(!0);try{let[a,t]=await Promise.all([(0,eb.getRepairBuddyTaxes)(String(e)),(0,T.getSetup)(String(e))]);if(!s)return;_(Array.isArray(a.taxes)?a.taxes:[]);let l="string"==typeof t.tenant?.billing_vat_number?t.tenant.billing_vat_number:"";y(l);let i=(t.setup?.state??{}).tax??{};j("boolean"==typeof i.tax_registered&&i.tax_registered),k("string"==typeof i.invoice_prefix?i.invoice_prefix:"RB")}catch(e){if(!s)return;h(e instanceof Error?e.message:"Failed to load taxes.")}finally{if(!s)return;D(!1)}}(),()=>{s=!1}},[e]),(0,i.useEffect)(()=>{function e(){v(null),h(null),d(!1),r(!1),eg()}return window.addEventListener("rb:branch-changed",e),()=>{window.removeEventListener("rb:branch-changed",e)}},[e]),(0,i.useEffect)(()=>{let e,s,a,l,i,n,r,c;e=w.map(e=>({id:String(e.id),name:e.name,ratePercent:Number(e.rate),status:e.is_active?"active":"inactive"})),s=w.find(e=>e.is_default)??null,a=new Set(w.map(e=>String(e.id))),i=new Set((l=w.filter(e=>e.is_active)).map(e=>String(e.id))),r="string"==typeof(n=O.defaultTaxId)&&n.length>0&&a.has(n)&&i.has(n),c=l.length>0?String(l[0]?.id):"",t({taxes:e,defaultTaxId:s?String(s.id):r?n:c})},[w]);let J=(0,i.useMemo)(()=>w.filter(e=>e.is_active),[w]),Q=(0,i.useMemo)(()=>{let e=new Set(J.map(e=>String(e.id)));return O.defaultTaxId&&e.has(String(O.defaultTaxId))?String(O.defaultTaxId):""},[J,O.defaultTaxId]),Y=(0,i.useMemo)(()=>{let e=E.trim().toLowerCase();return e?w.filter(s=>`${s.id} ${s.name} ${s.rate}`.toLowerCase().includes(e)):w},[E,w]),G=Y.length;(0,i.useEffect)(()=>{let e=Math.min(z,Math.max(1,Math.ceil(G/$))-1);e!==z&&R(e)},[z,$,G]);let V=(0,i.useMemo)(()=>{let e=z*$,s=e+$;return Y.slice(e,s)},[Y,z,$]),Z=(0,i.useMemo)(()=>[{id:"name",header:"Name",cell:e=>(0,s.jsx)("div",{className:"text-sm text-zinc-700",children:e.name}),className:"min-w-[220px]"},{id:"rate",header:"Rate (%)",cell:e=>(0,s.jsx)("div",{className:"text-sm text-zinc-700",children:Number(e.rate)}),className:"whitespace-nowrap"},{id:"active",header:"Active",cell:e=>(0,s.jsx)("div",{className:"text-sm text-zinc-700",children:e.is_active?"Yes":"No"}),className:"whitespace-nowrap"},{id:"default",header:"Default",cell:e=>(0,s.jsx)("div",{className:"text-sm text-zinc-700",children:e.is_default?"Yes":"No"}),className:"whitespace-nowrap"},{id:"actions",header:"Actions",cell:e=>(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(N.Button,{size:"sm",variant:"outline",disabled:l||o,onClick:()=>{er(String(e.id)),ed(e.name),em(String(e.rate)),ex(e.is_active),eh(e.is_default),d(!0)},children:"Edit"}),(0,s.jsx)(N.Button,{size:"sm",variant:"outline",disabled:l||o,onClick:()=>void ef(e),children:"Delete"})]}),className:"whitespace-nowrap"}],[o,l]),[K,X]=(0,i.useState)(""),[ee,es]=(0,i.useState)("0"),[ea,et]=(0,i.useState)(!0),[el,ei]=(0,i.useState)(!1),[en,er]=(0,i.useState)(null),[ec,ed]=(0,i.useState)(""),[eo,em]=(0,i.useState)("0"),[eu,ex]=(0,i.useState)(!0),[ep,eh]=(0,i.useState)(!1);async function eg(){D(!0);try{let s=await (0,eb.getRepairBuddyTaxes)(String(e));_(Array.isArray(s.taxes)?s.taxes:[])}catch(e){h(e instanceof Error?e.message:"Failed to load taxes.")}finally{D(!1)}}async function ev(){v(null),h(null),m(!0);try{let s=K.trim(),a=Number(ee);if(!s)throw Error("Name is required.");if(!Number.isFinite(a))throw Error("Rate is invalid.");await (0,eb.createRepairBuddyTax)(String(e),{name:s,rate:a,is_active:ea,is_default:el}),await eg(),r(!1),X(""),es("0"),et(!0),ei(!1),v("Tax created.")}catch(e){h(e instanceof Error?e.message:"Failed to create tax.")}finally{m(!1)}}async function ej(){if(en){v(null),h(null),m(!0);try{let s=Number(en);if(!Number.isFinite(s))throw Error("Invalid tax.");let a=ec.trim(),t=Number(eo);if(!a)throw Error("Name is required.");if(!Number.isFinite(t))throw Error("Rate is invalid.");await (0,eb.updateRepairBuddyTax)(String(e),s,{name:a,rate:t}),await (0,eb.setRepairBuddyTaxActive)(String(e),s,eu),ep&&await (0,eb.setRepairBuddyTaxDefault)(String(e),s),await eg(),d(!1),v("Tax updated.")}catch(e){h(e instanceof Error?e.message:"Failed to update tax.")}finally{m(!1)}}}async function ef(s){if(globalThis.confirm(`Delete tax "${s.name}"?`)){v(null),h(null),m(!0);try{_(e=>e.filter(e=>String(e.id)!==String(s.id))),await (0,eb.deleteRepairBuddyTax)(String(e),Number(s.id)),await eg(),v("Tax deleted.")}catch(e){h(e instanceof Error?e.message:"Failed to delete tax."),eg()}finally{m(!1)}}}return(0,s.jsxs)(F,{title:"Taxes",description:"Tax rates and invoice calculation preferences.",children:[p?(0,s.jsx)("div",{className:"text-sm text-red-600",children:p}):null,g?(0,s.jsx)("div",{className:"text-sm text-green-700",children:g}):null,(0,s.jsx)(S.Card,{className:"shadow-none",children:(0,s.jsx)(S.CardContent,{className:"pt-5",children:(0,s.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,s.jsx)("div",{className:"sm:col-span-2",children:(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:b,onChange:e=>j(e.target.checked),disabled:u||o}),"Tax/VAT registered?"]})}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"VAT number"}),(0,s.jsx)(A.Input,{value:f,onChange:e=>y(e.target.value),placeholder:"EU123456789",disabled:u||o})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Invoice prefix (optional)"}),(0,s.jsx)(A.Input,{value:C,onChange:e=>k(e.target.value),placeholder:"RB",disabled:u||o})]}),(0,s.jsx)("div",{className:"sm:col-span-2 flex items-center justify-end gap-2",children:(0,s.jsx)(N.Button,{variant:"outline",disabled:l||u||o,onClick:()=>void W(),children:u?"Saving...":"Save"})})]})})}),(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:O.enableTaxes,onChange:e=>{let s=e.target.checked;t({enableTaxes:s}),H({...O,enableTaxes:s})}}),"Enable taxes"]}),(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,s.jsx)("div",{className:"text-sm text-zinc-600",children:"Manage tax rates for this business."}),(0,s.jsx)(N.Button,{variant:"outline",disabled:l||o,onClick:()=>r(!0),children:"Add tax"})]}),(0,s.jsx)(S.Card,{className:"shadow-none",children:(0,s.jsx)(S.CardContent,{className:"pt-5",children:(0,s.jsx)(q.DataTable,{title:"Taxes",data:V,columns:Z,getRowId:e=>e.id,loading:B,emptyMessage:"No tax rates.",search:{placeholder:"Search taxes..."},server:{query:E,onQueryChange:e=>{M(e),R(0)},pageIndex:z,onPageIndexChange:R,pageSize:$,onPageSizeChange:e=>{U(e),R(0)},totalRows:G}})})}),(0,s.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Default tax"}),(0,s.jsxs)(P.Select,{value:Q,disabled:0===J.length||o||B,onChange:async s=>{let a=s.target.value;if(t({defaultTaxId:a}),H({...O,defaultTaxId:a}),!a)return;let l=Number(a);if(Number.isFinite(l)&&!(l<=0))try{m(!0),await (0,eb.setRepairBuddyTaxDefault)(String(e),l),await eg()}catch(e){h(e instanceof Error?e.message:"Failed to set default tax.")}finally{m(!1)}},children:[(0,s.jsx)("option",{value:"",children:"None"}),J.map(e=>(0,s.jsxs)("option",{value:String(e.id),children:[e.name," (",Number(e.rate),"%)"]},e.id))]})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Invoice amounts"}),(0,s.jsxs)(P.Select,{value:O.invoiceAmounts,onChange:e=>{let s=e.target.value;t({invoiceAmounts:s}),H({...O,invoiceAmounts:s})},children:[(0,s.jsx)("option",{value:"exclusive",children:"Exclusive"}),(0,s.jsx)("option",{value:"inclusive",children:"Inclusive"})]})]})]}),(0,s.jsx)(L.Modal,{open:n,onClose:()=>r(!1),title:"Add tax",footer:(0,s.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,s.jsx)(N.Button,{variant:"outline",onClick:()=>r(!1),children:"Close"}),(0,s.jsx)(N.Button,{disabled:l||o,onClick:()=>void ev(),children:o?"Saving...":"Save"})]}),children:(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Name"}),(0,s.jsx)(A.Input,{value:K,onChange:e=>X(e.target.value),placeholder:"e.g. VAT"})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Rate (%)"}),(0,s.jsx)(A.Input,{type:"number",min:0,value:ee,onChange:e=>es(e.target.value)})]}),(0,s.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Active"}),(0,s.jsxs)(P.Select,{value:ea?"yes":"no",onChange:e=>et("yes"===e.target.value),children:[(0,s.jsx)("option",{value:"yes",children:"Yes"}),(0,s.jsx)("option",{value:"no",children:"No"})]})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Default"}),(0,s.jsxs)(P.Select,{value:el?"yes":"no",onChange:e=>ei("yes"===e.target.value),children:[(0,s.jsx)("option",{value:"no",children:"No"}),(0,s.jsx)("option",{value:"yes",children:"Yes"})]})]})]})]})}),(0,s.jsx)(L.Modal,{open:c,onClose:()=>d(!1),title:"Edit tax",footer:(0,s.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,s.jsx)(N.Button,{variant:"outline",onClick:()=>d(!1),children:"Close"}),(0,s.jsx)(N.Button,{disabled:l||o,onClick:()=>void ej(),children:o?"Saving...":"Save"})]}),children:(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Name"}),(0,s.jsx)(A.Input,{value:ec,onChange:e=>ed(e.target.value)})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Rate (%)"}),(0,s.jsx)(A.Input,{type:"number",min:0,value:eo,onChange:e=>em(e.target.value)})]}),(0,s.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Active"}),(0,s.jsxs)(P.Select,{value:eu?"yes":"no",onChange:e=>ex("yes"===e.target.value),children:[(0,s.jsx)("option",{value:"yes",children:"Yes"}),(0,s.jsx)("option",{value:"no",children:"No"})]})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Default"}),(0,s.jsxs)(P.Select,{value:ep?"yes":"no",onChange:e=>eh("yes"===e.target.value),children:[(0,s.jsx)("option",{value:"no",children:"No"}),(0,s.jsx)("option",{value:"yes",children:"Yes"})]})]})]})]})})]})}function ef({tenantSlug:e,draft:a,updateTimeLogs:t,isMock:l}){let n=a.timeLogs,r=(0,i.useMemo)(()=>a.jobStatuses.statuses,[a.jobStatuses.statuses]),[c,d]=(0,i.useState)([]),[o,m]=(0,i.useState)(!1);(0,i.useEffect)(()=>{let s=!0;return async function(){if(!l){m(!0);try{let a=await (0,eb.getRepairBuddyTaxes)(String(e));if(!s)return;d(Array.isArray(a.taxes)?a.taxes:[])}catch{if(!s)return;d([])}finally{if(!s)return;m(!1)}}}(),()=>{s=!1}},[l,e]);let u=(0,i.useMemo)(()=>(l?a.taxes.taxes.map(e=>({id:Number.isFinite(Number(e.id))?Number(e.id):0,name:e.name,rate:e.ratePercent,is_default:e.id===a.taxes.defaultTaxId,is_active:"active"===e.status})):c).filter(e=>e&&e.is_active).map(e=>({id:String(e.id),name:e.name,ratePercent:Number(e.rate),isDefault:!!e.is_default})),[a.taxes.defaultTaxId,a.taxes.taxes,l,c]),x=(0,i.useMemo)(()=>{let e=u.find(e=>e.isDefault)?.id??"";return e||(u[0]?.id??"")},[u]),p=(0,i.useMemo)(()=>{let e=new Set(u.map(e=>e.id));return n.defaultTaxIdForHours&&e.has(String(n.defaultTaxIdForHours))?String(n.defaultTaxIdForHours):x&&e.has(String(x))?String(x):""},[x,u,n.defaultTaxIdForHours]);return(0,i.useEffect)(()=>{p&&n.defaultTaxIdForHours!==p&&t({defaultTaxIdForHours:p})},[p,n.defaultTaxIdForHours,t]),(0,s.jsx)(F,{title:"Time Logs",description:"Time tracking and hourly tax defaults.",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:n.disableTimeLog,onChange:e=>t({disableTimeLog:e.target.checked})}),"Disable time log"]}),(0,s.jsx)("div",{className:"grid gap-4 sm:grid-cols-2",children:(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Default tax for hours"}),(0,s.jsx)(P.Select,{value:p,disabled:o||0===u.length,onChange:e=>t({defaultTaxIdForHours:e.target.value}),children:0===u.length?(0,s.jsx)("option",{value:"",children:"No active taxes"}):u.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.name," (",e.ratePercent,"%)"]},e.id))})]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Enable time log for statuses"}),(0,s.jsx)("div",{className:"mt-2 grid gap-2 sm:grid-cols-3",children:r.map(e=>(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:n.enableTimeLogForStatusIds.includes(e.id),onChange:()=>{var s;let a;return s=e.id,void((a=new Set(n.enableTimeLogForStatusIds)).has(s)?a.delete(s):a.add(s),t({enableTimeLogForStatusIds:Array.from(a)}))}}),e.name]},e.id))})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Activities"}),(0,s.jsx)("textarea",{className:"min-h-[140px] w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:n.activities,onChange:e=>t({activities:e.target.value}),placeholder:"List of activities (one per line)"})]})]})})}function ey(){return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"rounded-[var(--rb-radius-lg)] border border-[var(--rb-border)] bg-white px-5 py-4",children:(0,s.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(C.Skeleton,{className:"h-4 w-40 rounded-[var(--rb-radius-sm)]"}),(0,s.jsx)(C.Skeleton,{className:"mt-2 h-3 w-36 rounded-[var(--rb-radius-sm)]"}),(0,s.jsx)(C.Skeleton,{className:"mt-3 h-9 w-[520px] max-w-full rounded-[var(--rb-radius-sm)]"})]}),(0,s.jsx)(C.Skeleton,{className:"h-9 w-20 rounded-[var(--rb-radius-sm)]"})]})}),(0,s.jsx)(S.Card,{className:"shadow-none",children:(0,s.jsxs)(S.CardContent,{className:"pt-5",children:[(0,s.jsx)(C.Skeleton,{className:"h-5 w-48 rounded-[var(--rb-radius-sm)]"}),(0,s.jsx)(C.Skeleton,{className:"mt-3 h-4 w-full rounded-[var(--rb-radius-sm)]"}),(0,s.jsx)(C.Skeleton,{className:"mt-2 h-4 w-4/5 rounded-[var(--rb-radius-sm)]"}),(0,s.jsx)(C.Skeleton,{className:"mt-2 h-4 w-3/5 rounded-[var(--rb-radius-sm)]"}),(0,s.jsx)("div",{className:"mt-5 grid gap-3 sm:grid-cols-2",children:Array.from({length:6}).map((e,a)=>(0,s.jsx)("div",{className:"rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2",children:(0,s.jsx)(C.Skeleton,{className:"h-4 w-40 rounded-[var(--rb-radius-sm)]"})},a))})]})})]})}let eN={"company-profile":r.Building2,general:h.Settings,currency:c.Calculator,"invoices-reports":x.FileText,"job-statuses":b.Tag,payments:u.CreditCard,reviews:v.Star,estimates:x.FileText,"my-account":j.User,"devices-brands":p.Laptop,sms:o.CircleHelp,taxes:c.Calculator,"service-settings":f.Wrench,"time-logs":m.Clock,"maintenance-reminders":m.Clock,"styling-labels":g.Sparkles,"signature-workflow":x.FileText,booking:d.Calendar};function eS({tenantSlug:e}){let t=(0,a.useSearchParams)(),{draft:l,updateSection:r,setDraft:c,isMock:d,savingDisabledReason:m,loading:u,saving:x,error:p,save:h}=function(e){let s=(0,a.useRouter)(),[t,l]=(0,i.useState)(w),[n,r]=(0,i.useState)(!1),[c,d]=(0,i.useState)(!1),[o,m]=(0,i.useState)(null),[u,x]=(0,i.useState)(null),p=(0,i.useCallback)((e,s)=>{l(a=>({...a,[e]:{...a[e],...s}}))},[]);(0,i.useEffect)(()=>{let a=!0;return async function(){if(e){r(!0),m(null);try{let[s,t,i]=await Promise.all([(0,I.getRepairBuddySettings)(String(e)),(0,T.getSetup)(String(e)),(0,_.apiFetch)(`/api/${String(e)}/app/repairbuddy/job-statuses`)]);if(!a)return;x(t.tenant);let n=s.settings&&"object"==typeof s.settings?s.settings:null,r={...w,...n??{},general:{...w.general,...n?.general??{}}},c=Array.isArray(i?.job_statuses)?i.job_statuses:[];c.length>0&&(r.jobStatuses={...r.jobStatuses??w.jobStatuses,statuses:c.map(e=>{let s="string"==typeof e.slug?e.slug:"",a="string"==typeof e.label?e.label:s,t="string"==typeof e.invoice_label?e.invoice_label:a;return{id:`status_${s}`,name:a,slug:s,description:"",invoiceLabel:t,manageWooStock:!1,status:!1===e.is_active?"inactive":"active"}}),completedStatusId:r.jobStatuses?.completedStatusId??w.jobStatuses.completedStatusId,cancelledStatusId:r.jobStatuses?.cancelledStatusId??w.jobStatuses.cancelledStatusId});let d=!r.timeLogs||!Array.isArray(r.timeLogs.enableTimeLogForStatusIds)||0===r.timeLogs.enableTimeLogForStatusIds.length,o=r.jobStatuses?.cancelledStatusId;if(d&&r.jobStatuses&&Array.isArray(r.jobStatuses.statuses)){let e=r.jobStatuses.statuses.filter(e=>"active"===e.status).map(e=>e.id).filter(e=>"string"!=typeof o||!o||e!==o);r.timeLogs={...r.timeLogs,enableTimeLogForStatusIds:e}}l(B(function(e){let s=e.devicesBrands;if(!s||!Array.isArray(s.additionalDeviceFields))return e;let a=s.additionalDeviceFields.map(e=>{if(!e||"object"!=typeof e)return null;let s="string"==typeof e.id&&e.id.trim()?e.id.trim():`device_field_${Date.now()}_${Math.random().toString(16).slice(2)}`,a="string"==typeof e.label?e.label:"";if(!a.trim())return null;let t="boolean"!=typeof e.displayInBookingForm||e.displayInBookingForm,l="boolean"!=typeof e.displayInInvoice||e.displayInInvoice,i="boolean"!=typeof e.displayForCustomer||e.displayForCustomer;return{id:s,label:a.trim(),type:"text",displayInBookingForm:t,displayInInvoice:l,displayForCustomer:i}}).filter(e=>!!e);return{...e,devicesBrands:{...s,additionalDeviceFields:a}}}(r),t.tenant))}catch(t){if(!a)return;if(t instanceof _.ApiError&&428===t.status&&e){let a=`/app/${String(e)}/business-settings`;s.replace(`/app/${String(e)}/branches/select?next=${encodeURIComponent(a)}`);return}m(t instanceof Error?t.message:"Failed to load business settings.")}finally{if(!a)return;r(!1)}}}(),()=>{a=!1}},[s,e]);let h=(0,i.useCallback)(()=>{l(w)},[]),g=(0,i.useCallback)(async()=>{if(e){d(!0),m(null);try{let s=await (0,T.getSetup)(String(e)),a=t.currency.currency.trim().toUpperCase(),i=t.general.defaultCountry.trim().toUpperCase(),n=t.general.businessAddress.trim(),r=i?RegExp(`,\\s*${i}$`,"i"):null,c=r?n.replace(r,"").trim():n,d=s.tenant.billing_address_json??{},o=c?{...d,line1:c}:null,m=s.tenant.setup_state??{},u=m.identity??{},p={...m,identity:{...u,display_name:t.general.displayName||null,primary_contact_name:t.general.primaryContactName||null,registration_number:t.general.registrationNumber||null,logo_url:t.general.logoUrl}},h=await (0,T.updateSetup)(String(e),{name:t.general.businessName,contact_email:t.general.email||null,contact_phone:t.general.businessPhone||null,billing_country:i||null,billing_address_json:o,currency:3===a.length?a:null,setup_state:p});x(h.tenant);let g=await (0,I.updateRepairBuddySettings)(String(e),t);g.settings&&l(B(g.settings,h.tenant))}catch(e){throw e instanceof _.ApiError?m(e.message):m(e instanceof Error?e.message:"Failed to save business settings."),e}finally{d(!1)}}},[t,e]);return(0,i.useMemo)(()=>({draft:t,setDraft:l,updateSection:p,reset:h,save:g,isMock:!1,loading:n,saving:c,error:o,tenant:u,savingDisabledReason:""}),[t,o,n,h,g,c,u,p])}(e),[g,v]=(0,i.useState)(null),b=(0,i.useCallback)(e=>r("currency",e),[r]),j=(0,i.useMemo)(()=>{let e=t.get("section"),s=new Set(k.map(e=>e.key));return e&&s.has(e)?e:"company-profile"},[t]),f=(0,i.useMemo)(()=>k.find(e=>e.key===j)??null,[j]),C=(0,i.useMemo)(()=>{switch(j){case"company-profile":return(0,s.jsx)(E,{tenantSlug:e});case"general":return(0,s.jsx)(J,{draft:l,updateGeneral:e=>r("general",e)});case"currency":return(0,s.jsx)(O,{draft:l,updateCurrency:b});case"invoices-reports":return(0,s.jsx)(Q,{draft:l,updateInvoicesReports:e=>r("invoicesReports",e)});case"job-statuses":return(0,s.jsx)(X,{tenantSlug:e});case"payments":return(0,s.jsx)(em,{draft:l,updatePayments:e=>r("payments",e),isMock:d});case"reviews":return(0,s.jsx)(eu,{draft:l,updateReviews:e=>r("reviews",e)});case"estimates":return(0,s.jsx)(W,{draft:l,updateEstimates:e=>r("estimates",e)});case"my-account":return(0,s.jsx)(eo,{draft:l,updateMyAccount:e=>r("myAccount",e)});case"devices-brands":return(0,s.jsx)(H,{draft:l,updateDevicesBrands:e=>r("devicesBrands",e),isMock:d});case"sms":return(0,s.jsx)(eg,{draft:l,updateSms:e=>r("sms",e)});case"taxes":return(0,s.jsx)(ej,{tenantSlug:e,draft:l,updateTaxes:e=>r("taxes",e),isMock:d});case"service-settings":return(0,s.jsx)(ex,{draft:l,updateServiceSettings:e=>r("serviceSettings",e)});case"time-logs":return(0,s.jsx)(ef,{tenantSlug:e,draft:l,updateTimeLogs:e=>r("timeLogs",e),isMock:d});case"maintenance-reminders":return(0,s.jsx)(er,{tenantSlug:e,draft:l,isMock:d});case"styling-labels":return(0,s.jsx)(ev,{draft:l,updateStylingLabels:e=>r("stylingLabels",e)});case"signature-workflow":return(0,s.jsx)(ep,{draft:l,updateSignatureWorkflow:e=>r("signatureWorkflow",e)});case"booking":return(0,s.jsx)(M,{draft:l,updateBooking:e=>r("booking",e)});default:return null}},[l,d,j,e,b,r]);async function A(){v(null);try{await h(),v("Saved.")}catch{return}}return(0,s.jsxs)("div",{className:"space-y-6",children:[p?(0,s.jsx)(y.Alert,{variant:"danger",title:"Could not load or save business settings",children:p}):null,g?(0,s.jsx)(y.Alert,{variant:"success",title:"Success",children:g}):null,(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-[260px_1fr]",children:[(0,s.jsxs)(S.Card,{children:[(0,s.jsxs)(S.CardHeader,{children:[(0,s.jsx)(S.CardTitle,{children:"Business Settings"}),(0,s.jsx)(S.CardDescription,{children:"Operational settings for this business."})]}),(0,s.jsx)(S.CardContent,{className:"space-y-1",children:k.map(a=>{let t=a.key===j,l=eN[a.key]??o.CircleHelp;return(0,s.jsx)(n.default,{href:`/app/${e}/business-settings?section=${a.key}`,scroll:!1,className:"block rounded-[var(--rb-radius-sm)] px-3 py-2 text-sm transition-colors "+(t?"bg-[var(--rb-surface-muted)] font-medium text-[var(--rb-text)]":"text-zinc-700 hover:bg-[var(--rb-surface-muted)]"),children:(0,s.jsxs)("span",{className:"flex items-center gap-2",children:[(0,s.jsx)(l,{className:"h-4 w-4 shrink-0 "+(t?"text-[var(--rb-text)]":"text-zinc-500"),"aria-hidden":!0}),(0,s.jsx)("span",{children:a.label})]})},a.key)})})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"rounded-[var(--rb-radius-lg)] border border-[var(--rb-border)] bg-white px-5 py-4",children:(0,s.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:f?.label??"Business Settings"}),(0,s.jsxs)("div",{className:"mt-1 text-xs text-zinc-500",children:["Business: ",e]}),m?(0,s.jsx)("div",{className:"mt-2 text-xs text-zinc-500",children:m}):null,(0,s.jsxs)("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[(0,s.jsx)(N.Button,{asChild:!0,variant:"outline",size:"sm",children:(0,s.jsx)(n.default,{href:`/t/${e}/portal`,children:"Preview portal"})}),(0,s.jsx)(N.Button,{asChild:!0,variant:"outline",size:"sm",children:(0,s.jsx)(n.default,{href:`/t/${e}/status`,children:"Preview status"})}),(0,s.jsx)(N.Button,{asChild:!0,variant:"outline",size:"sm",children:(0,s.jsx)(n.default,{href:`/t/${e}/book`,children:"Preview booking"})}),(0,s.jsx)(N.Button,{asChild:!0,variant:"outline",size:"sm",children:(0,s.jsx)(n.default,{href:`/t/${e}/services`,children:"Preview services"})}),(0,s.jsx)(N.Button,{asChild:!0,variant:"outline",size:"sm",children:(0,s.jsx)(n.default,{href:`/t/${e}/parts`,children:"Preview parts"})})]})]}),(0,s.jsx)(N.Button,{variant:"outline",onClick:()=>void A(),disabled:!!m||u||x,children:x?"Saving...":"Save"})]})}),u?(0,s.jsx)(ey,{}):C]})]})]})}function eC(){let e=(0,a.useParams)(),i=e.business??e.tenant;return i?(0,s.jsx)(t.RequireAuth,{requiredPermission:"settings.manage",children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)(l.PageHeader,{title:"Business Settings",description:"Operational settings for this business."}),(0,s.jsx)(eS,{tenantSlug:i})]})}):(0,s.jsx)(t.RequireAuth,{requiredPermission:"settings.manage",children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)(l.PageHeader,{title:"Business Settings",description:"Operational settings for this business."}),(0,s.jsx)("div",{className:"rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-white px-4 py-3 text-sm text-zinc-700",children:"Missing tenant in route."})]})})}e.s(["default",()=>eC],37633)}]);