(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,19463,e=>{"use strict";var i=e.i(48277),t=e.i(14575);function s({title:e,description:s,actions:a,className:r}){return(0,i.jsxs)("div",{className:(0,t.cn)("flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between",r),children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-xl font-semibold text-[var(--rb-text)]",children:e}),s?(0,i.jsx)("p",{className:"mt-1 text-sm text-zinc-600",children:s}):null]}),a?(0,i.jsx)("div",{className:"flex items-center gap-2",children:a}):null]})}e.s(["PageHeader",()=>s])},26550,e=>{"use strict";var i=e.i(48277),t=e.i(14575);function s({className:e,type:s,...a}){return(0,i.jsx)("input",{type:s,className:(0,t.cn)("w-full rounded-[var(--rb-radius-sm)] border border-zinc-300 bg-white px-3 py-2 text-sm text-[var(--rb-text)] outline-none transition","placeholder:text-zinc-400","focus-visible:ring-2 focus-visible:ring-[color:color-mix(in_srgb,var(--rb-orange),white_65%)] focus-visible:ring-offset-2 focus-visible:ring-offset-white","disabled:cursor-not-allowed disabled:bg-[var(--rb-surface-muted)] disabled:opacity-70",e),...a})}e.s(["Input",()=>s])},44919,e=>{"use strict";var i=e.i(54976);e.s(["notify",0,{success:(e,t={})=>i.toast.success(e,t),error:(e,t={})=>i.toast.error(e,t),info:(e,t={})=>i.toast.info(e,t),warning:(e,t={})=>i.toast.warning(e,t),loading:(e,t={})=>i.toast.loading(e,t),dismiss(e){i.toast.dismiss(e)},message:(e,t,s={})=>"success"===e?i.toast.success(t,s):"error"===e?i.toast.error(t,s):"warning"===e?i.toast.warning(t,s):"loading"===e?i.toast.loading(t,s):i.toast.info(t,s)}])},59471,e=>{"use strict";var i=e.i(48277),t=e.i(14575);function s({label:e,fieldId:s,description:a,error:r,required:l,className:n,labelClassName:d,fieldClassName:c,children:o}){let u=a?`${s}__description`:void 0,m=r?`${s}__error`:void 0,p=[u,m].filter(Boolean).join(" ")||void 0,v="function"==typeof o?o({describedBy:p,descriptionId:u,errorId:m,invalid:!!r}):o;return(0,i.jsxs)("div",{className:(0,t.cn)("grid gap-1 sm:grid-cols-[220px_1fr] sm:gap-4",n),children:[(0,i.jsx)("div",{className:"sm:pt-2",children:(0,i.jsxs)("label",{className:(0,t.cn)("block text-sm font-medium text-[var(--rb-text)]",d),htmlFor:s,children:[e,l?(0,i.jsx)("span",{className:"text-red-600",children:" *"}):null]})}),(0,i.jsxs)("div",{className:(0,t.cn)("min-w-0",c),children:[v,a?(0,i.jsx)("div",{id:u,className:"mt-1 text-xs text-zinc-500",children:a}):null,r?(0,i.jsx)("div",{id:m,className:"mt-1 text-xs text-red-600",children:r}):null]})]})}e.s(["FormRow",()=>s])},16900,e=>{"use strict";var i=e.i(48277),t=e.i(30668),s=e.i(96086),a=e.i(77252),r=e.i(19463),l=e.i(72015),n=e.i(9693),d=e.i(26550),c=e.i(59471),o=e.i(1831),u=e.i(44919);function m(){let e=(0,s.useRouter)(),m=(0,s.useParams)(),p=m.business??m.tenant,[v,x]=(0,t.useState)(!0),[b,h]=(0,t.useState)(!1),[f,g]=(0,t.useState)(null),[y,j]=(0,t.useState)([]),[_,N]=(0,t.useState)([]),[w,S]=(0,t.useState)([]),[C,F]=(0,t.useState)(""),[k,$]=(0,t.useState)(null),[A,z]=(0,t.useState)(null),[R,D]=(0,t.useState)(null),[P,B]=(0,t.useState)(!1),[I,q]=(0,t.useState)(!1),[O,T]=(0,t.useState)(!0),[E,M]=(0,t.useState)([""]);(0,t.useEffect)(()=>{let e=!0;return async function(){if("string"==typeof p&&0!==p.length){x(!0),g(null);try{let[i,t,s]=await Promise.all([(0,o.apiFetch)(`/api/${p}/app/repairbuddy/devices?limit=200`),(0,o.apiFetch)(`/api/${p}/app/repairbuddy/device-brands?limit=200`),(0,o.apiFetch)(`/api/${p}/app/repairbuddy/device-types?limit=200`)]);if(!e)return;let a=Array.isArray(s.device_types)?s.device_types:[],r=Array.isArray(t.device_brands)?t.device_brands:[];j(Array.isArray(i.devices)?i.devices:[]),N(r),S(a),$(a.length>0?a[0].id:null),z(r.length>0?r[0].id:null)}catch(i){if(!e)return;g(i instanceof Error?i.message:"Failed to load form data."),j([]),N([]),S([])}finally{if(!e)return;x(!1)}}}(),()=>{e=!1}},[p]);let H=(0,t.useMemo)(()=>y.slice().sort((e,i)=>e.model.localeCompare(i.model)),[y]);async function K(i){if((i.preventDefault(),"string"==typeof p&&0!==p.length)&&!b){h(!0),g(null);try{let i=C.trim();if(0===i.length)return void g("Model is required.");if("number"!=typeof k)return void g("Device type is required.");if("number"!=typeof A)return void g("Device brand is required.");let t={model:i,device_type_id:k,device_brand_id:A,parent_device_id:R,disable_in_booking_form:P,is_other:I,is_active:O};if("number"==typeof R){await (0,o.apiFetch)(`/api/${p}/app/repairbuddy/devices`,{method:"POST",body:t}),u.notify.success("Device created."),e.replace(`/app/${p}/devices`);return}let s=await (0,o.apiFetch)(`/api/${p}/app/repairbuddy/devices`,{method:"POST",body:t}),a=s.device?.id;if("number"!=typeof a){u.notify.success("Device created."),e.replace(`/app/${p}/devices`);return}let r=E.map(e=>e.trim()).filter(e=>e.length>0),l=Array.from(new Set(r));if(l.length>0){for(let e of l)await (0,o.apiFetch)(`/api/${p}/app/repairbuddy/devices`,{method:"POST",body:{...t,model:`${i} - ${e}`,parent_device_id:a}});u.notify.success("Device and variations created.")}else u.notify.success("Device created.");e.replace(`/app/${p}/devices`)}catch(e){e instanceof o.ApiError?g(e.message):g("Failed to create device.")}finally{h(!1)}}}let U=b||v;return(0,i.jsx)(a.RequireAuth,{requiredPermission:"devices.manage",children:(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsx)(r.PageHeader,{title:"New device",description:"Create a new device model (optionally with variations).",actions:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.Button,{variant:"outline",size:"sm",onClick:()=>{"string"==typeof p&&0!==p.length&&e.push(`/app/${p}/devices`)},disabled:b,children:"Cancel"}),(0,i.jsx)(n.Button,{variant:"primary",size:"sm",type:"submit",form:"rb_device_new_form",disabled:U,children:b?"Saving...":"Save"})]})}),f?(0,i.jsx)("div",{className:"text-sm text-red-600",children:f}):null,(0,i.jsx)(l.Card,{className:"shadow-none",children:(0,i.jsx)(l.CardContent,{className:"pt-5",children:(0,i.jsxs)("form",{id:"rb_device_new_form",className:"space-y-4",onSubmit:K,children:[(0,i.jsx)(c.FormRow,{label:"Model",fieldId:"device_model",required:!0,children:(0,i.jsx)(d.Input,{id:"device_model",value:C,onChange:e=>F(e.target.value),disabled:U})}),(0,i.jsx)(c.FormRow,{label:"Device type",fieldId:"device_type",required:!0,children:(0,i.jsx)("select",{id:"device_type",className:"w-full rounded-[var(--rb-radius-sm)] border border-zinc-300 bg-white px-3 py-2 text-sm text-[var(--rb-text)]",value:k??"",onChange:e=>{let i=e.target.value;if(!i)return void $(null);let t=Number(i);$(Number.isFinite(t)?t:null)},disabled:U,children:w.slice().sort((e,i)=>e.name.localeCompare(i.name)).map(e=>(0,i.jsx)("option",{value:e.id,children:e.name},e.id))})}),(0,i.jsx)(c.FormRow,{label:"Device brand",fieldId:"device_brand",required:!0,children:(0,i.jsx)("select",{id:"device_brand",className:"w-full rounded-[var(--rb-radius-sm)] border border-zinc-300 bg-white px-3 py-2 text-sm text-[var(--rb-text)]",value:A??"",onChange:e=>{let i=e.target.value;if(!i)return void z(null);let t=Number(i);z(Number.isFinite(t)?t:null)},disabled:U,children:_.slice().sort((e,i)=>e.name.localeCompare(i.name)).map(e=>(0,i.jsx)("option",{value:e.id,children:e.name},e.id))})}),(0,i.jsx)(c.FormRow,{label:"Variation base",fieldId:"device_parent",description:"Leave empty to create a base device.",children:(0,i.jsxs)("select",{id:"device_parent",className:"w-full rounded-[var(--rb-radius-sm)] border border-zinc-300 bg-white px-3 py-2 text-sm text-[var(--rb-text)]",value:R??"",onChange:e=>{let i=e.target.value;if(!i)return void D(null);let t=Number(i);D(Number.isFinite(t)?t:null),M([""])},disabled:U,children:[(0,i.jsx)("option",{value:"",children:"(none)"}),H.map(e=>(0,i.jsx)("option",{value:e.id,children:e.model},e.id))]})}),null===R?(0,i.jsx)(c.FormRow,{label:"Variations",fieldId:"device_variations_0",description:'Each entry becomes a child device. Example: "Black", "64GB", "Silver".',children:(0,i.jsxs)("div",{className:"space-y-2",children:[E.map((e,t)=>{let s=`device_variations_${t}`;return(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(d.Input,{id:s,value:e,onChange:e=>{let i=e.target.value;M(e=>e.map((e,s)=>s===t?i:e))},disabled:U}),E.length>1?(0,i.jsx)(n.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{M(e=>e.filter((e,i)=>i!==t))},disabled:U,children:"Remove"}):null]},s)}),(0,i.jsx)("div",{children:(0,i.jsx)(n.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{M(e=>[...e,""])},disabled:U,children:"Add variation"})})]})}):null,(0,i.jsxs)("div",{className:"grid gap-1 sm:grid-cols-[220px_1fr] sm:gap-4",children:[(0,i.jsx)("div",{className:"sm:pt-2",children:(0,i.jsx)("span",{className:"block text-sm font-medium text-[var(--rb-text)]",children:"Options"})}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,i.jsx)("input",{type:"checkbox",checked:P,onChange:e=>B(e.target.checked),disabled:U}),"Disable in booking form"]}),(0,i.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,i.jsx)("input",{type:"checkbox",checked:I,onChange:e=>q(e.target.checked),disabled:U}),"Is ",'"Other"'," device"]}),(0,i.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,i.jsx)("input",{type:"checkbox",checked:O,onChange:e=>T(e.target.checked),disabled:U}),"Active"]})]})]})]})})})]})})}e.s(["default",()=>m])}]);