(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,63571,e=>{"use strict";var i=e.i(48277),n=e.i(14575);function t({variant:e,className:t}){let r="h-4 w-4 shrink-0";return"success"===e?(0,i.jsx)("svg",{viewBox:"0 0 24 24",className:(0,n.cn)(r,t),fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:(0,i.jsx)("path",{d:"M20 6L9 17l-5-5"})}):"warning"===e?(0,i.jsxs)("svg",{viewBox:"0 0 24 24",className:(0,n.cn)(r,t),fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[(0,i.jsx)("path",{d:"M12 9v4"}),(0,i.jsx)("path",{d:"M12 17h.01"}),(0,i.jsx)("path",{d:"M10.3 3.6l-8.3 14.3A2 2 0 0 0 3.7 21h16.6a2 2 0 0 0 1.7-3.1L13.7 3.6a2 2 0 0 0-3.4 0z"})]}):"danger"===e?(0,i.jsxs)("svg",{viewBox:"0 0 24 24",className:(0,n.cn)(r,t),fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[(0,i.jsx)("path",{d:"M18 6L6 18"}),(0,i.jsx)("path",{d:"M6 6l12 12"})]}):(0,i.jsxs)("svg",{viewBox:"0 0 24 24",className:(0,n.cn)(r,t),fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[(0,i.jsx)("path",{d:"M12 16v-4"}),(0,i.jsx)("path",{d:"M12 8h.01"}),(0,i.jsx)("path",{d:"M12 22a10 10 0 1 0-10-10 10 10 0 0 0 10 10z"})]})}function r({className:e,variant:r="info",title:s,children:a,...l}){let o={info:{wrapper:"border-[color:color-mix(in_srgb,var(--rb-blue),white_75%)] bg-[color:color-mix(in_srgb,var(--rb-blue),white_92%)] text-[var(--rb-text)]",icon:"text-[var(--rb-blue)]",title:"text-[var(--rb-blue)]"},success:{wrapper:"border-[color:color-mix(in_srgb,#16a34a,white_75%)] bg-[color:color-mix(in_srgb,#16a34a,white_92%)] text-[var(--rb-text)]",icon:"text-[#166534]",title:"text-[#166534]"},warning:{wrapper:"border-[color:color-mix(in_srgb,var(--rb-orange),white_70%)] bg-[color:color-mix(in_srgb,var(--rb-orange),white_92%)] text-[var(--rb-text)]",icon:"text-[color:color-mix(in_srgb,var(--rb-orange),black_20%)]",title:"text-[color:color-mix(in_srgb,var(--rb-orange),black_20%)]"},danger:{wrapper:"border-[color:color-mix(in_srgb,#dc2626,white_75%)] bg-[color:color-mix(in_srgb,#dc2626,white_92%)] text-[var(--rb-text)]",icon:"text-[#991b1b]",title:"text-[#991b1b]"}}[r];return(0,i.jsx)("div",{role:"alert",className:(0,n.cn)("rounded-[var(--rb-radius-md)] border px-4 py-3",o.wrapper,e),...l,children:(0,i.jsxs)("div",{className:"flex gap-3",children:[(0,i.jsx)(t,{variant:r,className:(0,n.cn)("mt-0.5",o.icon)}),(0,i.jsxs)("div",{className:"min-w-0",children:[s?(0,i.jsx)("div",{className:(0,n.cn)("text-sm font-semibold",o.title),children:s}):null,a?(0,i.jsx)("div",{className:(0,n.cn)("text-sm text-zinc-700",s?"mt-1":""),children:a}):null]})]})})}e.s(["Alert",()=>r])},68501,e=>{"use strict";var i=e.i(48277),n=e.i(14575);function t({className:e,variant:t="default",...r}){return(0,i.jsx)("span",{className:(0,n.cn)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-medium",{default:"bg-[var(--rb-surface-muted)] text-[var(--rb-text)] border-[var(--rb-border)]",info:"bg-[color:color-mix(in_srgb,var(--rb-blue),white_85%)] text-[var(--rb-blue)] border-[color:color-mix(in_srgb,var(--rb-blue),white_70%)]",success:"bg-[color:color-mix(in_srgb,#16a34a,white_85%)] text-[#166534] border-[color:color-mix(in_srgb,#16a34a,white_70%)]",warning:"bg-[color:color-mix(in_srgb,var(--rb-orange),white_85%)] text-[color:color-mix(in_srgb,var(--rb-orange),black_20%)] border-[color:color-mix(in_srgb,var(--rb-orange),white_70%)]",danger:"bg-[color:color-mix(in_srgb,#dc2626,white_85%)] text-[#991b1b] border-[color:color-mix(in_srgb,#dc2626,white_70%)]"}[t],e),...r})}e.s(["Badge",()=>t])},26550,e=>{"use strict";var i=e.i(48277),n=e.i(14575);function t({className:e,type:t,...r}){return(0,i.jsx)("input",{type:t,className:(0,n.cn)("w-full rounded-[var(--rb-radius-sm)] border border-zinc-300 bg-white px-3 py-2 text-sm text-[var(--rb-text)] outline-none transition","placeholder:text-zinc-400","focus-visible:ring-2 focus-visible:ring-[color:color-mix(in_srgb,var(--rb-orange),white_65%)] focus-visible:ring-offset-2 focus-visible:ring-offset-white","disabled:cursor-not-allowed disabled:bg-[var(--rb-surface-muted)] disabled:opacity-70",e),...r})}e.s(["Input",()=>t])},66474,e=>{"use strict";var i=e.i(48277),n=e.i(30668),t=e.i(14575);function r({open:e,onClose:r,title:s,children:a,footer:l,position:o="center",variant:c="glass",className:d}){if((0,n.useEffect)(()=>{function i(i){e&&"Escape"===i.key&&r()}return document.addEventListener("keydown",i),()=>document.removeEventListener("keydown",i)},[r,e]),!e)return null;let u="solid"===c?(0,t.cn)("relative w-full max-w-lg overflow-hidden rounded-[var(--rb-radius-lg)]","border border-[var(--rb-border)]","bg-white","shadow-[var(--rb-shadow)]"):(0,t.cn)("relative w-full max-w-lg overflow-hidden rounded-[var(--rb-radius-lg)]","border border-[color:color-mix(in_srgb,var(--rb-border),white_55%)]","bg-white/75 backdrop-blur-xl","shadow-[0_18px_55px_-18px_rgba(0,0,0,0.55)]","ring-1 ring-white/25");return(0,i.jsxs)("div",{className:"top-center"===o?"fixed inset-0 z-50 flex items-start justify-center px-4 pt-8":"fixed inset-0 z-50 flex items-center justify-center px-4",children:[(0,i.jsx)("button",{type:"button",className:(0,t.cn)("absolute inset-0","bg-black/35 backdrop-blur-md","bg-[radial-gradient(900px_600px_at_20%_20%,color-mix(in_srgb,#16a34a,transparent_82%)_0%,transparent_60%),radial-gradient(900px_600px_at_80%_30%,color-mix(in_srgb,var(--rb-blue),transparent_82%)_0%,transparent_60%),radial-gradient(900px_600px_at_50%_85%,color-mix(in_srgb,var(--rb-orange),transparent_85%)_0%,transparent_65%)]"),"aria-label":"Close",onClick:r}),(0,i.jsxs)("div",{role:"dialog","aria-modal":"true",className:(0,t.cn)(u,d),children:["glass"===c?(0,i.jsx)("div",{className:"pointer-events-none absolute inset-0 bg-[radial-gradient(650px_420px_at_20%_15%,color-mix(in_srgb,#16a34a,transparent_88%)_0%,transparent_60%),radial-gradient(650px_420px_at_80%_5%,color-mix(in_srgb,var(--rb-blue),transparent_90%)_0%,transparent_60%)]"}):null,s?(0,i.jsx)("div",{className:(0,t.cn)("relative px-5 py-4","solid"===c?"border-b border-[var(--rb-border)]":"border-b border-[color:color-mix(in_srgb,var(--rb-border),white_60%)]"),children:(0,i.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:s})}):null,(0,i.jsx)("div",{className:"relative px-5 py-4",children:a}),l?(0,i.jsx)("div",{className:(0,t.cn)("relative px-5 py-4","solid"===c?"border-t border-[var(--rb-border)]":"border-t border-[color:color-mix(in_srgb,var(--rb-border),white_60%)]"),children:l}):null]})]})}e.s(["Modal",()=>r])},64998,e=>{"use strict";var i=e.i(48277),n=e.i(66474),t=e.i(9693);function r({open:e,title:r,message:s,confirmText:a="Confirm",confirmVariant:l="primary",cancelText:o="Cancel",busy:c=!1,onCancel:d,onConfirm:u}){return(0,i.jsx)(n.Modal,{open:e,onClose:()=>{c||d()},title:r,footer:(0,i.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,i.jsx)(t.Button,{variant:"outline",onClick:d,disabled:c,children:o}),(0,i.jsx)(t.Button,{variant:l,onClick:u,disabled:c,children:c?"Working...":a})]}),children:(0,i.jsx)("div",{className:"text-sm text-zinc-700",children:s})})}e.s(["ConfirmDialog",()=>r])},30765,e=>{"use strict";function i(e){let i=e.amountCents,n=e.currency?.toUpperCase()??null;if("number"!=typeof i||!Number.isFinite(i))return e.fallback??"—";let t=i/100;if(!n||3!==n.length)return`${t.toFixed(2)}`;try{return new Intl.NumberFormat(void 0,{style:"currency",currency:n,minimumFractionDigits:2,maximumFractionDigits:2}).format(t)}catch{return`${n} ${t.toFixed(2)}`}}e.s(["formatMoney",()=>i])},69965,e=>{"use strict";let i={locale:"en-GB",dateStyle:"medium",timeStyle:"short",hour12:!1};function n(e){if(!e)return null;if(e instanceof Date)return Number.isFinite(e.getTime())?e:null;let i=new Date(e);return Number.isFinite(i.getTime())?i:null}function t(e,t){let r=n(e);if(!r)return"—";let s={...i,...t??{}};return new Intl.DateTimeFormat(s.locale,{dateStyle:s.dateStyle}).format(r)}function r(e,t){let r=n(e);if(!r)return"—";let s={...i,...t??{}};return new Intl.DateTimeFormat(s.locale,{dateStyle:s.dateStyle,timeStyle:s.timeStyle,hour12:s.hour12}).format(r)}e.s(["formatDate",()=>t,"formatDateTime",()=>r])},21190,e=>{"use strict";var i=e.i(1831);async function n(e){let n=new URLSearchParams;return"boolean"==typeof e?.includeInactive&&n.set("include_inactive",e.includeInactive?"1":"0"),(0,i.apiFetch)(`/api/admin/billing/catalog${n.toString()?`?${n.toString()}`:""}`)}async function t(e){let n=new URLSearchParams;return"boolean"==typeof e?.includeInactive&&n.set("include_inactive",e.includeInactive?"1":"0"),(0,i.apiFetch)(`/api/admin/billing/intervals${n.toString()?`?${n.toString()}`:""}`)}async function r(e){return(0,i.apiFetch)("/api/admin/billing/intervals",{method:"POST",body:{code:e.code?.trim()||void 0,name:e.name,months:e.months,is_active:"boolean"==typeof e.isActive?e.isActive:void 0}})}async function s(e){return(0,i.apiFetch)(`/api/admin/billing/intervals/${e.intervalId}`,{method:"PUT",body:{code:e.code,name:e.name,months:e.months,is_active:"boolean"==typeof e.isActive?e.isActive:void 0,reason:e.reason}})}async function a(e){return(0,i.apiFetch)(`/api/admin/billing/intervals/${e.intervalId}/active`,{method:"PATCH",body:{is_active:e.isActive,reason:e.reason}})}async function l(e){return(0,i.apiFetch)("/api/admin/billing/plans",{method:"POST",body:{name:e.name,code:e.code?.trim()||void 0,description:e.description?.trim()||void 0,is_active:"boolean"==typeof e.isActive?e.isActive:void 0}})}async function o(e){return(0,i.apiFetch)(`/api/admin/billing/plans/${e.planId}`,{method:"PUT",body:{name:e.name,code:e.code,description:e.description?.trim()||void 0,is_active:"boolean"==typeof e.isActive?e.isActive:void 0,reason:e.reason}})}async function c(e){return(0,i.apiFetch)(`/api/admin/billing/plans/${e.planId}/versions/draft-from-active`,{method:"POST",body:{reason:e.reason}})}async function d(e){try{return await (0,i.apiFetch)(`/api/admin/billing/versions/${e.versionId}/validate`,{method:"POST",body:{reason:e.reason}})}catch(e){if(e instanceof i.ApiError){let i=e.data;if(i&&"object"==typeof i){if("ok"===i.status)return{status:"ok"};if("string"==typeof i.message)return{message:i.message,errors:Array.isArray(i.errors)?i.errors.map(String):void 0}}}throw e}}async function u(e){return(0,i.apiFetch)(`/api/admin/billing/versions/${e.versionId}/entitlements/sync`,{method:"POST",body:{entitlements:e.entitlements,reason:e.reason}})}async function m(e){return(0,i.apiFetch)(`/api/admin/billing/versions/${e.versionId}/prices`,{method:"POST",body:{currency:e.currency,billing_interval_id:"number"==typeof e.billingIntervalId?e.billingIntervalId:void 0,interval:e.interval,amount_cents:e.amountCents,trial_days:"number"==typeof e.trialDays?e.trialDays:void 0,is_default:"boolean"==typeof e.isDefault?e.isDefault:void 0,reason:e.reason}})}async function b(e){return(0,i.apiFetch)(`/api/admin/billing/prices/${e.priceId}`,{method:"PATCH",body:{amount_cents:e.amountCents,trial_days:"number"==typeof e.trialDays?e.trialDays:void 0,is_default:"boolean"==typeof e.isDefault?e.isDefault:void 0,reason:e.reason}})}async function x(e){return(0,i.apiFetch)(`/api/admin/billing/prices/${e.priceId}`,{method:"DELETE",body:{reason:e.reason}})}async function p(e){return(0,i.apiFetch)(`/api/admin/billing/versions/${e.versionId}/activate`,{method:"POST",body:{confirm:e.confirm,reason:e.reason}})}async function v(e){return(0,i.apiFetch)("/api/admin/billing/entitlement-definitions",{method:"POST",body:{code:e.code?.trim()||void 0,name:e.name,value_type:e.valueType,description:e.description?.trim()||void 0,is_premium:"boolean"==typeof e.isPremium?e.isPremium:void 0}})}async function h(e){return(0,i.apiFetch)(`/api/admin/billing/entitlement-definitions/${e.id}`,{method:"PUT",body:{code:e.code,name:e.name,value_type:e.valueType,description:e.description?.trim()||void 0,is_premium:"boolean"==typeof e.isPremium?e.isPremium:void 0,reason:e.reason}})}async function g(e){return(0,i.apiFetch)(`/api/admin/billing/entitlement-definitions/${e.id}`,{method:"DELETE",body:{reason:e.reason}})}async function f(e){return(0,i.apiFetch)(`/api/admin/businesses/${e}/subscriptions`)}async function y(e){return(0,i.apiFetch)(`/api/admin/businesses/${e.tenantId}/subscriptions`,{method:"POST",body:{billing_plan_version_id:e.billingPlanVersionId,billing_price_id:e.billingPriceId,reason:e.reason}})}async function _(e){return(0,i.apiFetch)(`/api/admin/businesses/${e.tenantId}/subscriptions/${e.subscriptionId}/cancel`,{method:"POST",body:{at_period_end:"boolean"==typeof e.atPeriodEnd?e.atPeriodEnd:void 0,reason:e.reason}})}async function j(e){let n=new URLSearchParams;return e.status&&e.status.trim().length>0&&n.set("status",e.status.trim()),"number"==typeof e.limit&&Number.isFinite(e.limit)&&n.set("limit",String(e.limit)),(0,i.apiFetch)(`/api/admin/businesses/${e.tenantId}/invoices${n.toString()?`?${n.toString()}`:""}`)}async function N(e){return(0,i.apiFetch)(`/api/admin/businesses/${e.tenantId}/invoices/${e.invoiceId}`)}async function w(e){return(0,i.apiFetch)(`/api/admin/businesses/${e.tenantId}/invoices`,{method:"POST",body:{tenant_subscription_id:e.tenantSubscriptionId,reason:e.reason}})}async function S(e){return(0,i.apiFetch)(`/api/admin/businesses/${e.tenantId}/invoices/${e.invoiceId}/issue`,{method:"POST",body:{reason:e.reason}})}async function C(e){return(0,i.apiFetch)(`/api/admin/businesses/${e.tenantId}/invoices/${e.invoiceId}/paid`,{method:"POST",body:{paid_at:e.paidAt,paid_method:e.paidMethod,paid_note:e.paidNote,reason:e.reason}})}async function I(e){let n=e.invoiceNumber?`invoice_${e.invoiceNumber}.pdf`:"invoice.pdf";await (0,i.apiDownload)(`/api/admin/businesses/${e.tenantId}/invoices/${e.invoiceId}/pdf`,{filename:n})}e.s(["activateBillingPlanVersion",()=>p,"assignTenantSubscription",()=>y,"cancelTenantSubscription",()=>_,"createBillingInterval",()=>r,"createBillingPlan",()=>l,"createBillingPrice",()=>m,"createDraftBillingPlanVersionFromActive",()=>c,"createEntitlementDefinition",()=>v,"createInvoiceFromSubscription",()=>w,"deleteBillingPrice",()=>x,"deleteEntitlementDefinition",()=>g,"downloadInvoicePdf",()=>I,"getBillingCatalog",()=>n,"getTenantInvoice",()=>N,"getTenantInvoices",()=>j,"getTenantSubscriptions",()=>f,"issueInvoice",()=>S,"listBillingIntervals",()=>t,"markInvoicePaid",()=>C,"setBillingIntervalActive",()=>a,"syncBillingPlanVersionEntitlements",()=>u,"updateBillingInterval",()=>s,"updateBillingPlan",()=>o,"updateBillingPrice",()=>b,"updateEntitlementDefinition",()=>h,"validateBillingPlanVersionDraft",()=>d])},47355,e=>{"use strict";var i=e.i(48277),n=e.i(30668),t=e.i(16506),r=e.i(96086),s=e.i(77252),a=e.i(24273),l=e.i(63571),o=e.i(68501),c=e.i(9693),d=e.i(72015),u=e.i(64998),m=e.i(66474),b=e.i(26550),x=e.i(69965),p=e.i(21190),v=e.i(30765);function h(){let e=Number((0,r.useParams)().business),h=(0,a.useDashboardHeader)(),[g,f]=(0,n.useState)(!0),[y,_]=(0,n.useState)(null),[j,N]=(0,n.useState)(null),[w,S]=(0,n.useState)([]),[C,I]=(0,n.useState)(!0),[P,T]=(0,n.useState)(null),[F,$]=(0,n.useState)([]),[k,B]=(0,n.useState)(0),[A,z]=(0,n.useState)(!1),[D,E]=(0,n.useState)(!1),[M,L]=(0,n.useState)(null),[O,U]=(0,n.useState)(""),[V,R]=(0,n.useState)(""),[H,W]=(0,n.useState)(""),[q,K]=(0,n.useState)(""),[G,J]=(0,n.useState)(!1),[Q,X]=(0,n.useState)(!1),[Y,Z]=(0,n.useState)(!0);(0,n.useEffect)(()=>(h.setHeader({breadcrumb:"Admin / Businesses",title:j?`${j.name} — Billing`:`Business ${e} — Billing`,subtitle:j?`Business ID ${j.id} • ${j.slug}`:void 0,actions:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(t.default,{href:`/admin/businesses/${e}`,children:(0,i.jsx)(c.Button,{variant:"outline",size:"sm",children:"Back"})}),(0,i.jsx)(c.Button,{variant:"outline",size:"sm",onClick:()=>B(e=>e+1),disabled:g||C,children:"Refresh"})]})}),()=>h.setHeader(null)),[C,h,g,j,e]),(0,n.useEffect)(()=>{let i=!0;return async function(){if(!Number.isFinite(e)||e<=0){_("Invalid business id."),f(!1);return}try{f(!0),_(null);let n=await (0,p.getTenantSubscriptions)(e);if(!i)return;N(n.tenant),S(Array.isArray(n.subscriptions)?n.subscriptions:[])}catch(e){if(!i)return;_(e instanceof Error?e.message:"Failed to load subscriptions."),N(null),S([])}finally{if(!i)return;f(!1)}}(),()=>{i=!1}},[e,k]),(0,n.useEffect)(()=>{let e=!0;return async function(){try{I(!0),T(null);let i=await (0,p.getBillingCatalog)({includeInactive:!0});if(!e)return;$(Array.isArray(i.billing_plans)?i.billing_plans:[])}catch(i){if(!e)return;T(i instanceof Error?i.message:"Failed to load billing catalog."),$([])}finally{if(!e)return;I(!1)}}(),()=>{e=!1}},[k]);let ee=(0,n.useMemo)(()=>(Array.isArray(w)?w:[]).slice().sort((e,i)=>(i.id??0)-(e.id??0))[0]??null,[w]),ei=(j?.currency??"").toUpperCase(),en=(0,n.useMemo)(()=>{let e=Number(O);return F.find(i=>i.id===e)??null},[F,O]),et=(0,n.useMemo)(()=>Array.isArray(en?.versions)?en?.versions??[]:[],[en]),er=(0,n.useMemo)(()=>{let e=Number(V);return et.find(i=>i.id===e)??null},[V,et]),es=(0,n.useMemo)(()=>{let e=Array.isArray(er?.prices)?er?.prices??[]:[];return 3===ei.length?e.filter(e=>String(e.currency).toUpperCase()===ei):e},[er,ei]),ea=(0,n.useMemo)(()=>{let e=Number(H);return es.find(i=>i.id===e)??null},[es,H]);async function el(){z(!0),L(null),U(""),R(""),W("")}async function eo(){if(Number.isFinite(e)&&!(e<=0)){if(!er||!ea)return void L("Please select a plan version and a price.");E(!0),L(null);try{await (0,p.assignTenantSubscription)({tenantId:e,billingPlanVersionId:er.id,billingPriceId:ea.id,reason:q.trim()||void 0}),z(!1),B(e=>e+1)}catch(e){L(e instanceof Error?e.message:"Failed to assign subscription.")}finally{E(!1)}}}async function ec(){if(ee&&Number.isFinite(e)&&!(e<=0)){X(!0);try{await (0,p.cancelTenantSubscription)({tenantId:e,subscriptionId:ee.id,atPeriodEnd:Y,reason:q.trim()||void 0}),J(!1),B(e=>e+1)}catch(e){_(e instanceof Error?e.message:"Failed to cancel subscription.")}finally{X(!1)}}}return(0,i.jsx)(s.RequireAuth,{requiredPermission:"admin.billing.read",children:(0,i.jsxs)("div",{className:"space-y-6",children:[y?(0,i.jsx)(l.Alert,{variant:"danger",title:"Billing could not be loaded",children:y}):null,P?(0,i.jsx)(l.Alert,{variant:"danger",title:"Billing catalog could not be loaded",children:P}):null,(0,i.jsxs)("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[(0,i.jsxs)(d.Card,{className:"lg:col-span-2",children:[(0,i.jsxs)(d.CardHeader,{className:"flex flex-row items-start justify-between gap-4",children:[(0,i.jsxs)("div",{className:"min-w-0",children:[(0,i.jsx)(d.CardTitle,{className:"truncate",children:"Subscription"}),(0,i.jsx)("div",{className:"mt-1 text-sm text-zinc-600",children:"Current subscription and assignment actions"})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(t.default,{href:`/admin/businesses/${e}/billing/invoices`,children:(0,i.jsx)(c.Button,{variant:"outline",size:"sm",children:"Invoices"})}),(0,i.jsx)(c.Button,{variant:"secondary",size:"sm",onClick:el,disabled:C||g,children:"Assign / Change"})]})]}),(0,i.jsxs)(d.CardContent,{className:"space-y-4",children:[g?(0,i.jsx)("div",{className:"text-sm text-zinc-500",children:"Loading subscription…"}):null,g||ee?null:(0,i.jsx)("div",{className:"text-sm text-zinc-600",children:"No subscription assigned yet."}),ee?(0,i.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-xs text-zinc-500",children:"Plan"}),(0,i.jsx)("div",{className:"mt-1 text-sm text-zinc-800",children:ee.plan_version?.plan?.name??"—"}),(0,i.jsxs)("div",{className:"mt-1 text-xs text-zinc-500",children:["Version ID: ",ee.billing_plan_version_id]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-xs text-zinc-500",children:"Status"}),(0,i.jsx)("div",{className:"mt-1",children:(0,i.jsx)(o.Badge,{variant:"active"===ee.status?"success":"default",children:ee.status})}),ee.cancel_at_period_end?(0,i.jsx)("div",{className:"mt-1 text-xs text-amber-700",children:"Cancel at period end"}):null]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-xs text-zinc-500",children:"Price"}),(0,i.jsx)("div",{className:"mt-1 text-sm text-zinc-800",children:ee.price?`${(0,v.formatMoney)({amountCents:ee.price.amount_cents,currency:ee.price.currency})} / ${ee.price.interval}`:"—"}),(0,i.jsxs)("div",{className:"mt-1 text-xs text-zinc-500",children:["Currency: ",ee.currency??"—"]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-xs text-zinc-500",children:"Period"}),(0,i.jsxs)("div",{className:"mt-1 text-sm text-zinc-800",children:[(0,x.formatDateTime)(ee.current_period_start??null)," → ",(0,x.formatDateTime)(ee.current_period_end??null)]})]}),(0,i.jsx)("div",{className:"sm:col-span-2",children:(0,i.jsx)("div",{className:"flex flex-wrap items-center gap-2",children:(0,i.jsx)(c.Button,{variant:"outline",size:"sm",onClick:()=>J(!0),disabled:Q,children:"Cancel subscription"})})})]}):null]})]}),(0,i.jsxs)(d.Card,{children:[(0,i.jsx)(d.CardHeader,{children:(0,i.jsx)(d.CardTitle,{children:"Tenant billing profile"})}),(0,i.jsxs)(d.CardContent,{className:"space-y-3",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-xs text-zinc-500",children:"Currency"}),(0,i.jsx)("div",{className:"mt-1 text-sm text-zinc-800",children:ei||"—"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-xs text-zinc-500",children:"Billing country"}),(0,i.jsx)("div",{className:"mt-1 text-sm text-zinc-800",children:j?.billing_country??"—"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-xs text-zinc-500",children:"VAT number"}),(0,i.jsx)("div",{className:"mt-1 text-sm text-zinc-800",children:j?.billing_vat_number??"—"})]})]})]})]}),(0,i.jsx)(m.Modal,{open:A,onClose:()=>{D||z(!1)},title:"Assign / Change subscription",footer:(0,i.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,i.jsx)(c.Button,{variant:"outline",onClick:()=>{D||z(!1)},disabled:D,children:"Cancel"}),(0,i.jsx)(c.Button,{variant:"primary",onClick:eo,disabled:D,children:D?"Saving…":"Save"})]}),children:(0,i.jsxs)("div",{className:"space-y-4",children:[M?(0,i.jsx)(l.Alert,{variant:"danger",title:"Cannot assign subscription",children:M}):null,(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-sm font-medium text-[var(--rb-text)]",children:"Tenant currency"}),(0,i.jsxs)("div",{className:"mt-1 text-sm text-zinc-700",children:[ei||"—"," (prices are filtered to match)"]})]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)("label",{className:"text-sm font-medium",children:"Plan"}),(0,i.jsxs)("select",{className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:O,onChange:e=>{U(e.target.value),R(""),W("")},disabled:C||D,children:[(0,i.jsx)("option",{value:"",children:"— Select plan —"}),F.map(e=>(0,i.jsxs)("option",{value:String(e.id),children:[e.name," (",e.code,")"]},e.id))]})]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)("label",{className:"text-sm font-medium",children:"Plan version"}),(0,i.jsxs)("select",{className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:V,onChange:e=>{R(e.target.value),W("")},disabled:!en||D,children:[(0,i.jsx)("option",{value:"",children:"— Select version —"}),et.map(e=>(0,i.jsxs)("option",{value:String(e.id),children:["v",e.version," (",e.status,")"]},e.id))]}),en&&0===et.length?(0,i.jsx)("div",{className:"text-xs text-zinc-500",children:"No versions available for this plan."}):null]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)("label",{className:"text-sm font-medium",children:"Price"}),(0,i.jsxs)("select",{className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:H,onChange:e=>W(e.target.value),disabled:!er||D,children:[(0,i.jsx)("option",{value:"",children:"— Select price —"}),es.map(e=>(0,i.jsxs)("option",{value:String(e.id),children:[(0,v.formatMoney)({amountCents:e.amount_cents,currency:e.currency})," / ",e.interval,e.is_default?" (default)":""]},e.id))]}),er&&0===es.length?(0,i.jsxs)("div",{className:"text-xs text-amber-700",children:["No prices found for this version",ei?` in ${ei}`:"","."]}):null]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)("label",{className:"text-sm font-medium",children:"Reason (optional)"}),(0,i.jsx)(b.Input,{value:q,onChange:e=>K(e.target.value),placeholder:"Support / plan change reason…"})]})]})}),(0,i.jsx)(u.ConfirmDialog,{open:G,title:"Cancel subscription",message:(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsx)("div",{children:"This will cancel the current subscription for this tenant."}),(0,i.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,i.jsx)("input",{type:"checkbox",checked:Y,onChange:e=>Z(e.target.checked),disabled:Q}),"Cancel at period end"]})]}),confirmText:"Cancel subscription",confirmVariant:"secondary",busy:Q,onCancel:()=>{Q||J(!1)},onConfirm:()=>void ec()})]})})}e.s(["default",()=>h])}]);