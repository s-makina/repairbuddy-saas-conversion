(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,19463,e=>{"use strict";var t=e.i(48277),i=e.i(14575);function s({title:e,description:s,actions:a,className:r}){return(0,t.jsxs)("div",{className:(0,i.cn)("flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between",r),children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-xl font-semibold text-[var(--rb-text)]",children:e}),s?(0,t.jsx)("p",{className:"mt-1 text-sm text-zinc-600",children:s}):null]}),a?(0,t.jsx)("div",{className:"flex items-center gap-2",children:a}):null]})}e.s(["PageHeader",()=>s])},26550,e=>{"use strict";var t=e.i(48277),i=e.i(14575);function s({className:e,type:s,...a}){return(0,t.jsx)("input",{type:s,className:(0,i.cn)("w-full rounded-[var(--rb-radius-sm)] border border-zinc-300 bg-white px-3 py-2 text-sm text-[var(--rb-text)] outline-none transition","placeholder:text-zinc-400","focus-visible:ring-2 focus-visible:ring-[color:color-mix(in_srgb,var(--rb-orange),white_65%)] focus-visible:ring-offset-2 focus-visible:ring-offset-white","disabled:cursor-not-allowed disabled:bg-[var(--rb-surface-muted)] disabled:opacity-70",e),...a})}e.s(["Input",()=>s])},66474,e=>{"use strict";var t=e.i(48277),i=e.i(30668),s=e.i(14575);function a({open:e,onClose:a,title:r,children:l,footer:n,position:d="center",variant:c="glass",className:o}){if((0,i.useEffect)(()=>{function t(t){e&&"Escape"===t.key&&a()}return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[a,e]),!e)return null;let m="solid"===c?(0,s.cn)("relative w-full max-w-lg overflow-hidden rounded-[var(--rb-radius-lg)]","border border-[var(--rb-border)]","bg-white","shadow-[var(--rb-shadow)]"):(0,s.cn)("relative w-full max-w-lg overflow-hidden rounded-[var(--rb-radius-lg)]","border border-[color:color-mix(in_srgb,var(--rb-border),white_55%)]","bg-white/75 backdrop-blur-xl","shadow-[0_18px_55px_-18px_rgba(0,0,0,0.55)]","ring-1 ring-white/25");return(0,t.jsxs)("div",{className:"top-center"===d?"fixed inset-0 z-50 flex items-start justify-center px-4 pt-8":"fixed inset-0 z-50 flex items-center justify-center px-4",children:[(0,t.jsx)("button",{type:"button",className:(0,s.cn)("absolute inset-0","bg-black/35 backdrop-blur-md","bg-[radial-gradient(900px_600px_at_20%_20%,color-mix(in_srgb,#16a34a,transparent_82%)_0%,transparent_60%),radial-gradient(900px_600px_at_80%_30%,color-mix(in_srgb,var(--rb-blue),transparent_82%)_0%,transparent_60%),radial-gradient(900px_600px_at_50%_85%,color-mix(in_srgb,var(--rb-orange),transparent_85%)_0%,transparent_65%)]"),"aria-label":"Close",onClick:a}),(0,t.jsxs)("div",{role:"dialog","aria-modal":"true",className:(0,s.cn)(m,o),children:["glass"===c?(0,t.jsx)("div",{className:"pointer-events-none absolute inset-0 bg-[radial-gradient(650px_420px_at_20%_15%,color-mix(in_srgb,#16a34a,transparent_88%)_0%,transparent_60%),radial-gradient(650px_420px_at_80%_5%,color-mix(in_srgb,var(--rb-blue),transparent_90%)_0%,transparent_60%)]"}):null,r?(0,t.jsx)("div",{className:(0,s.cn)("relative px-5 py-4","solid"===c?"border-b border-[var(--rb-border)]":"border-b border-[color:color-mix(in_srgb,var(--rb-border),white_60%)]"),children:(0,t.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:r})}):null,(0,t.jsx)("div",{className:"relative px-5 py-4",children:l}),n?(0,t.jsx)("div",{className:(0,s.cn)("relative px-5 py-4","solid"===c?"border-t border-[var(--rb-border)]":"border-t border-[color:color-mix(in_srgb,var(--rb-border),white_60%)]"),children:n}):null]})]})}e.s(["Modal",()=>a])},44919,e=>{"use strict";var t=e.i(54976);e.s(["notify",0,{success:(e,i={})=>t.toast.success(e,i),error:(e,i={})=>t.toast.error(e,i),info:(e,i={})=>t.toast.info(e,i),warning:(e,i={})=>t.toast.warning(e,i),loading:(e,i={})=>t.toast.loading(e,i),dismiss(e){t.toast.dismiss(e)},message:(e,i,s={})=>"success"===e?t.toast.success(i,s):"error"===e?t.toast.error(i,s):"warning"===e?t.toast.warning(i,s):"loading"===e?t.toast.loading(i,s):t.toast.info(i,s)}])},59471,e=>{"use strict";var t=e.i(48277),i=e.i(14575);function s({label:e,fieldId:s,description:a,error:r,required:l,className:n,labelClassName:d,fieldClassName:c,children:o}){let m=a?`${s}__description`:void 0,u=r?`${s}__error`:void 0,p=[m,u].filter(Boolean).join(" ")||void 0,x="function"==typeof o?o({describedBy:p,descriptionId:m,errorId:u,invalid:!!r}):o;return(0,t.jsxs)("div",{className:(0,i.cn)("grid gap-1 sm:grid-cols-[220px_1fr] sm:gap-4",n),children:[(0,t.jsx)("div",{className:"sm:pt-2",children:(0,t.jsxs)("label",{className:(0,i.cn)("block text-sm font-medium text-[var(--rb-text)]",d),htmlFor:s,children:[e,l?(0,t.jsx)("span",{className:"text-red-600",children:" *"}):null]})}),(0,t.jsxs)("div",{className:(0,i.cn)("min-w-0",c),children:[x,a?(0,t.jsx)("div",{id:m,className:"mt-1 text-xs text-zinc-500",children:a}):null,r?(0,t.jsx)("div",{id:u,className:"mt-1 text-xs text-red-600",children:r}):null]})]})}e.s(["FormRow",()=>s])},62498,e=>{"use strict";var t=e.i(1831);async function i(e){return(0,t.apiFetch)(`/api/${e}/app/repairbuddy/settings`)}async function s(e,i){return(0,t.apiFetch)(`/api/${e}/app/repairbuddy/settings`,{method:"PATCH",body:{settings:i}})}e.s(["getRepairBuddySettings",()=>i,"updateRepairBuddySettings",()=>s])},49449,e=>{"use strict";let t=(0,e.i(35884).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>t],49449)},24765,e=>{"use strict";var t=e.i(48277),i=e.i(72015),s=e.i(9693);function a({steps:e,step:a,onStepChange:r,disabled:l,nextDisabled:n,sidebarTitle:d,sidebarDescription:c,sidebarAriaLabel:o,sidebarFooter:m,footerRight:u,children:p}){let x=Math.max(0,e.findIndex(e=>e.id===a)),b=x/Math.max(1,e.length-1),h=e[x],v=0===x,g=x===e.length-1;return(0,t.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[260px_1fr]",children:[(0,t.jsxs)(i.Card,{className:"shadow-none lg:sticky lg:top-6 lg:self-start",children:[(0,t.jsxs)(i.CardHeader,{className:"pb-3",children:[(0,t.jsx)(i.CardTitle,{className:"text-base",children:d}),(0,t.jsx)(i.CardDescription,{children:c})]}),(0,t.jsxs)(i.CardContent,{className:"space-y-4",children:[(0,t.jsx)("div",{className:"h-2 w-full overflow-hidden rounded-full bg-[var(--rb-border)]",children:(0,t.jsx)("div",{className:"h-full bg-[linear-gradient(90deg,var(--rb-blue),var(--rb-orange))]",style:{width:`${Math.round(100*b)}%`}})}),(0,t.jsx)("nav",{"aria-label":o,className:"space-y-1",children:e.map((e,i)=>{let s=e.id===a,n=i<x,d=i<=x;return(0,t.jsx)("button",{type:"button",disabled:!d||l,onClick:()=>{d&&r(e.id)},className:"w-full rounded-[var(--rb-radius-md)] border px-3 py-2 text-left transition "+(s?"border-[color:color-mix(in_srgb,var(--rb-blue),white_65%)] bg-[color:color-mix(in_srgb,var(--rb-blue),white_92%)]":n?"border-[color:color-mix(in_srgb,var(--rb-blue),white_75%)] bg-white hover:bg-[var(--rb-surface-muted)]":"border-[var(--rb-border)] bg-white opacity-60"),children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full border text-xs font-semibold "+(s?"border-[var(--rb-blue)] bg-[var(--rb-blue)] text-white":n?"border-[var(--rb-blue)] bg-[color:color-mix(in_srgb,var(--rb-blue),white_90%)] text-[var(--rb-blue)]":"border-[var(--rb-border)] bg-white text-zinc-600"),children:n?(0,t.jsx)("svg",{viewBox:"0 0 24 24",className:"h-4 w-4",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:(0,t.jsx)("path",{d:"M20 6L9 17l-5-5"})}):i+1}),(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:e.navTitle}),(0,t.jsx)("div",{className:"mt-0.5 line-clamp-2 text-xs text-zinc-600",children:e.navDescription})]})]})},e.id)})}),m?(0,t.jsx)("div",{className:"border-t border-[var(--rb-border)] pt-4",children:m}):null]})]}),(0,t.jsxs)(i.Card,{className:"shadow-none flex flex-col",children:[(0,t.jsx)(i.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(i.CardTitle,{className:"text-base",children:h?.pageTitle??""}),(0,t.jsx)(i.CardDescription,{children:h?.pageDescription??""})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("div",{className:"text-xs text-zinc-500",children:["Step ",x+1," of ",e.length]}),(0,t.jsxs)("div",{className:"mt-2 flex items-center justify-end gap-2",children:[(0,t.jsx)("div",{className:"flex items-center gap-1","aria-label":"Progress",children:Array.from({length:e.length},(e,t)=>t).map(e=>{let i=e<x,s=e===x;return(0,t.jsx)("span",{className:"h-1.5 w-5 rounded-full transition "+(s?"bg-[var(--rb-blue)]":i?"bg-[color:color-mix(in_srgb,var(--rb-blue),white_55%)]":"bg-[var(--rb-border)]")},e)})}),(0,t.jsxs)("div",{className:"rounded-full border border-[var(--rb-border)] bg-white px-2 py-1 text-[11px] font-medium text-zinc-600",children:[Math.round(100*b),"%"]})]})]})]})}),(0,t.jsx)(i.CardContent,{className:"flex-1 space-y-6",children:p}),(0,t.jsx)("div",{className:"sticky bottom-0 border-t border-[var(--rb-border)] bg-white/90 px-5 py-4 backdrop-blur",children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,t.jsx)(s.Button,{variant:"ghost",disabled:l||v,onClick:()=>{if(v)return;let t=e[x-1];t&&r(t.id)},type:"button",children:(0,t.jsxs)("span",{className:"inline-flex items-center gap-2",children:[(0,t.jsx)("svg",{viewBox:"0 0 24 24",className:"h-4 w-4",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:(0,t.jsx)("path",{d:"M15 18l-6-6 6-6"})}),"Back"]})}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("div",{className:"hidden sm:block text-xs text-zinc-500",children:[h?.footerTitle??h?.navTitle??"",(0,t.jsx)("span",{className:"mx-2",children:"•"}),Math.round(100*b),"%"]}),g?u:(0,t.jsx)(s.Button,{variant:"primary",disabled:l||!!n,onClick:()=>{let t=e[x+1];t&&r(t.id)},type:"button",children:(0,t.jsxs)("span",{className:"inline-flex items-center gap-2",children:["Next",(0,t.jsx)("svg",{viewBox:"0 0 24 24",className:"h-4 w-4",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:(0,t.jsx)("path",{d:"M9 18l6-6-6-6"})})]})})]})]})})]})]})}e.s(["WizardShell",()=>a])},16574,e=>{"use strict";var t=e.i(48277),i=e.i(96086),s=e.i(77252),a=e.i(30668),r=e.i(63783),l=e.i(58094),n=e.i(1314),d=e.i(19463),c=e.i(9693),o=e.i(26550),m=e.i(59471),u=e.i(66474),p=e.i(1831),x=e.i(44919),b=e.i(24765),h=e.i(55075),v=e.i(45117),g=e.i(8041),f=e.i(62498);function j(e){return"u">typeof crypto&&"randomUUID"in crypto?`${e}-${crypto.randomUUID()}`:`${e}-${Date.now()}-${Math.random().toString(16).slice(2)}`}function y({tenantSlug:e}){let s=(0,n.useAuth)(),y=(0,i.useRouter)(),N=(0,a.useMemo)(()=>{let e=new Date,t=String(e.getFullYear()),i=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),a=String(e.getHours()).padStart(2,"0"),r=String(e.getMinutes()).padStart(2,"0"),l=String(e.getSeconds()).padStart(2,"0");return`RB-${t}${i}${s}-${a}${r}${l}`},[]),[_,w]=(0,a.useState)(!0),[S,C]=(0,a.useState)(!1),[$,I]=(0,a.useState)(null),[k,A]=(0,a.useState)(1),[z,P]=(0,a.useState)(""),[M,F]=(0,a.useState)(N),[R,D]=(0,a.useState)(""),[T,E]=(0,a.useState)(""),[B,L]=(0,a.useState)(""),[q,O]=(0,a.useState)(null),[H,U]=(0,a.useState)(null),[W,K]=(0,a.useState)("existing"),[Q,V]=(0,a.useState)(""),[Y,G]=(0,a.useState)(""),[J,X]=(0,a.useState)(""),[Z,ee]=(0,a.useState)(""),[et,ei]=(0,a.useState)(!1),[es,ea]=(0,a.useState)(null),[er,el]=(0,a.useState)(null),[en,ed]=(0,a.useState)([{device_id:null,option:null,serial:"",pin:"",notes:"",extra_fields:[]}]),[ec,eo]=(0,a.useState)([]),[em,eu]=(0,a.useState)([]),[ep,ex]=(0,a.useState)([]),[eb,eh]=(0,a.useState)(!1),[ev,eg]=(0,a.useState)("Pin"),[ef,ej]=(0,a.useState)([]),[ey,eN]=(0,a.useState)([]),[e_,ew]=(0,a.useState)([]),[eS,eC]=(0,a.useState)([]),[e$,eI]=(0,a.useState)([]),[ek,eA]=(0,a.useState)(!1),[ez,eP]=(0,a.useState)(null),[eM,eF]=(0,a.useState)(null),[eR,eD]=(0,a.useState)(null),[eT,eE]=(0,a.useState)("1"),[eB,eL]=(0,a.useState)(""),[eq,eO]=(0,a.useState)(!1),[eH,eU]=(0,a.useState)(null),[eW,eK]=(0,a.useState)(null),[eQ,eV]=(0,a.useState)(null),[eY,eG]=(0,a.useState)("1"),[eJ,eX]=(0,a.useState)(""),eZ=1===k,e0=2===k,e1=S||_,e2=(0,a.useMemo)(()=>ec.slice().sort((e,t)=>`${e.name}`.localeCompare(`${t.name}`)).map(e=>({value:e.id,label:e.email?`${e.name} (${e.email})`:e.name})),[ec]),e4=(0,a.useMemo)(()=>ep.slice().sort((e,t)=>`${e.name}`.localeCompare(`${t.name}`)).map(e=>({value:e.id,label:`${e.name} (${e.email})`})),[ep]),e6=(0,a.useMemo)(()=>"number"!=typeof er?null:e4.find(e=>e.value===er)??null,[er,e4]),e5=(0,a.useMemo)(()=>em.slice().sort((e,t)=>`${e.model}`.localeCompare(`${t.model}`)).map(e=>({value:e.id,label:e.model})),[em]),e7=(0,a.useMemo)(()=>en.map(e=>"number"==typeof e.device_id?e.device_id:null).filter(e=>"number"==typeof e).map(e=>e5.find(t=>t.value===e)??{value:e,label:`Device #${e}`}).filter(Boolean),[e5,en]),e8=(0,a.useMemo)(()=>e7.map(e=>({value:e.value,label:e.label})),[e7]),e3=(0,a.useMemo)(()=>ey.slice().sort((e,t)=>`${e.name}`.localeCompare(`${t.name}`)).map(e=>({value:e.id,label:e.name})),[ey]),e9=(0,a.useMemo)(()=>ef.slice().sort((e,t)=>`${e.name}`.localeCompare(`${t.name}`)).map(e=>({value:e.id,label:e.name,code:e.code,capacity:e.capacity})),[ef]),te=(0,a.useMemo)(()=>{let e=e=>e.reduce((e,t)=>{let i=Number(t.qty),s=Number(t.price);return Number.isFinite(i)&&Number.isFinite(s)?e+i*s:e},0);return e(e_)+e(eS)+e(e$)},[e$,eS,e_]),tt=(0,a.useMemo)(()=>"number"!=typeof q?null:ec.find(e=>e.id===q)??null,[ec,q]),ti=(0,a.useMemo)(()=>"new"===W?Y.trim().length>0:(tt?.email??"").trim().length>0,[Y,W,tt?.email]);(0,a.useEffect)(()=>{let t=!0;return async function(){if("string"==typeof e&&0!==e.length)try{w(!0);let[i,s,a,r,l,n]=await Promise.all([(0,p.apiFetch)(`/api/${e}/app/clients?limit=200`),(0,p.apiFetch)(`/api/${e}/app/repairbuddy/devices?limit=10`),(0,p.apiFetch)(`/api/${e}/app/technicians?per_page=100&sort=name&dir=asc`),(0,p.apiFetch)(`/api/${e}/app/repairbuddy/parts?limit=200`),(0,p.apiFetch)(`/api/${e}/app/repairbuddy/services?limit=200`),(0,f.getRepairBuddySettings)(String(e))]);if(!t)return;eo(Array.isArray(i.clients)?i.clients:[]),eu(Array.isArray(s.devices)?s.devices:[]),ex(Array.isArray(a.users)?a.users:[]),eh(!!n.settings?.devicesBrands?.enablePinCodeField);let d=n.settings?.devicesBrands?.labels,c=d&&"object"==typeof d&&"string"==typeof d.pin?String(d.pin).trim():"";eg(""!==c?c:"Pin");let o=Array.isArray(r.parts)?r.parts:[];ej(o.map(e=>({id:e.id,name:e.name,code:e.manufacturing_code??"",capacity:e.capacity??""})));let m=Array.isArray(l.services)?l.services:[];eN(m.map(e=>({id:e.id,name:e.name}))),I(null)}catch(i){if(!t)return;if(i instanceof p.ApiError&&428===i.status&&"string"==typeof e&&e.trim().length>0){let t=`/app/${e}/estimates/new`;y.replace(`/app/${e}/branches/select?next=${encodeURIComponent(t)}`);return}I(i instanceof Error?i.message:"Failed to load form data."),eo([]),eu([]),ex([]),eh(!1),eg("Pin")}finally{if(!t)return;w(!1)}}(),()=>{t=!1}},[y,e]);let ts=async t=>{if("string"!=typeof e||0===e.length)return[];try{let i=new URLSearchParams;i.set("limit","50");let s=t.trim();s&&i.set("query",s);let a=await (0,p.apiFetch)(`/api/${e}/app/clients?${i.toString()}`);return(Array.isArray(a.clients)?a.clients:[]).map(e=>({value:e.id,label:e.email?`${e.name} (${e.email})`:e.name}))}catch{return[]}},ta=async t=>{if("string"!=typeof e||0===e.length)return[];try{let i=new URLSearchParams;i.set("limit",t.trim()?"50":"10");let s=t.trim();s&&i.set("q",s);let a=await (0,p.apiFetch)(`/api/${e}/app/repairbuddy/devices?${i.toString()}`);return(Array.isArray(a.devices)?a.devices:[]).map(e=>({value:e.id,label:e.model}))}catch{return[]}};async function tr(t){if("string"==typeof e&&0!==e.length&&!S){I(null),C(!0);try{let i=z.trim();if(""===i)return void I("Title is required.");let s="new"===W;if(s){if(""===Q.trim())return void I("Customer name is required.");if(""===Y.trim())return void I("Customer email is required.")}if(!s&&"number"!=typeof q)return void I("Select a customer.");let a={case_number:""!==M.trim()?M.trim():null,title:i,status:"pending",customer_id:s||"number"!=typeof q?null:q,pickup_date:""!==R.trim()?R.trim():null,delivery_date:""!==T.trim()?T.trim():null,case_detail:""!==B.trim()?B.trim():null,assigned_technician_id:"number"==typeof er?er:null,devices:en.length>0?en.filter(e=>"number"==typeof e.device_id).map(e=>({device_id:e.device_id,serial:""!==e.serial.trim()?e.serial.trim():null,pin:eb&&""!==e.pin.trim()?e.pin.trim():null,notes:""!==e.notes.trim()?e.notes.trim():null})):[]};s&&(a.customer_create={name:Q.trim(),email:Y.trim(),...""!==J.trim()?{phone:J.trim()}:{},...""!==Z.trim()?{company:Z.trim()}:{}});let r=await (0,p.apiFetch)(`/api/${e}/app/repairbuddy/estimates`,{method:"POST",body:a}),l=r?.estimate?.id;if("number"!=typeof l)throw Error("Estimate creation failed.");try{for(let t of e_){let i=Math.round(Number(t.qty)),s=Number.isFinite(i)&&i>0?i:1,a=t.price.trim(),r=a.length>0?Number(a):NaN,n=Number.isFinite(r)?Math.round(100*r):void 0;await (0,p.apiFetch)(`/api/${e}/app/repairbuddy/estimates/${l}/items`,{method:"POST",body:{item_type:"service",ref_id:t.service_id,qty:s,..."number"==typeof n?{unit_price_amount_cents:n}:{},meta:{..."number"==typeof t.device_id?{device_id:t.device_id}:{}}}})}for(let t of e$){let i=t.name.trim();if(""===i)continue;let s=Math.round(Number(t.qty)),a=Number.isFinite(s)&&s>0?s:1,r=t.price.trim(),n=r.length>0?Number(r):NaN,d=Number.isFinite(n)?Math.round(100*n):void 0;"number"==typeof d&&await (0,p.apiFetch)(`/api/${e}/app/repairbuddy/estimates/${l}/items`,{method:"POST",body:{item_type:d<0?"discount":"fee",name:i,qty:a,unit_price_amount_cents:d}})}for(let t of eS){let i=Math.round(Number(t.qty)),s=Number.isFinite(i)&&i>0?i:1,a=t.price.trim(),r=a.length>0?Number(a):NaN,n=Number.isFinite(r)?Math.round(100*r):void 0;await (0,p.apiFetch)(`/api/${e}/app/repairbuddy/estimates/${l}/items`,{method:"POST",body:{item_type:"part",ref_id:t.part_id,qty:s,..."number"==typeof n?{unit_price_amount_cents:n}:{},meta:{..."number"==typeof t.device_id?{device_id:t.device_id}:{}}}})}}catch(e){x.notify.error(e instanceof p.ApiError?e.message:"Estimate created, but failed to attach items.")}if("save_send"===t)try{await (0,p.apiFetch)(`/api/${e}/app/repairbuddy/estimates/${l}/send`,{method:"POST"}),x.notify.success("Estimate sent.")}catch(e){x.notify.error(e instanceof p.ApiError?e.message:"Estimate saved, but sending failed.")}x.notify.success("Estimate created."),y.replace(`/app/${e}/estimates/${l}`)}catch(e){e instanceof p.ApiError?I(e.message):I(e instanceof Error?e.message:"Failed to create estimate.")}finally{C(!1)}}}return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(d.PageHeader,{title:"New estimate",description:"Complete the steps to create the estimate."}),$?(0,t.jsx)("div",{className:"text-sm text-red-600",children:$}):null,(0,t.jsx)(v.CustomerCreateModal,{open:et,title:"Add customer",disabled:e1,error:es,setError:ea,name:Q,setName:V,email:Y,setEmail:G,emailInputType:"email",phone:J,setPhone:X,company:Z,setCompany:ee,onClose:()=>ei(!1),onSave:({name:e,email:t})=>{K("new"),O(null),U({value:-1,label:`${e} (${t})`}),ei(!1)}}),(0,t.jsx)(u.Modal,{open:ek,title:"Add service",onClose:()=>{eP(null),eA(!1)},footer:(0,t.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,t.jsx)(c.Button,{type:"button",variant:"outline",onClick:()=>{eP(null),eA(!1)},children:"Cancel"}),(0,t.jsx)(c.Button,{type:"button",onClick:()=>{if(!eM)return void eP("Please select a service.");if(!eR)return void eP("Please select a device.");let e=Math.round(Number(eT)),t=Number.isFinite(e)&&e>0?String(e):"1";ew(e=>[...e,{id:j("svc"),service_id:eM.value,service:{id:eM.value,name:eM.label},device_id:eR.value,qty:t,price:eB}]),eF(null),eE("1"),eL(""),eP(null),eA(!1)},children:"Add"})]}),children:(0,t.jsxs)("div",{className:"space-y-4",children:[ez?(0,t.jsx)("div",{className:"text-sm text-red-600",children:ez}):null,(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("div",{className:"mb-1 text-xs text-zinc-600",children:"Service"}),(0,t.jsx)(r.default,{instanceId:"estimate_service_select",inputId:"estimate_service_select",isSearchable:!0,isClearable:!0,options:e3,value:eM,onChange:e=>eF(e??null),isDisabled:e1,placeholder:e3.length>0?"Search services...":"No services yet",classNamePrefix:"rb-select",styles:{control:e=>({...e,borderRadius:"var(--rb-radius-sm)",borderColor:"#d4d4d8",minHeight:40,boxShadow:"none"}),menu:e=>({...e,zIndex:50})}})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("div",{className:"mb-1 text-xs text-zinc-600",children:"Device"}),(0,t.jsx)(r.default,{instanceId:"estimate_service_device_select",inputId:"estimate_service_device_select",isSearchable:!0,isClearable:!0,options:e8,value:eR,onChange:e=>eD(e??null),isDisabled:e1||0===e8.length,placeholder:e8.length>0?"Select device...":"No devices selected",classNamePrefix:"rb-select",styles:{control:e=>({...e,borderRadius:"var(--rb-radius-sm)",borderColor:"#d4d4d8",minHeight:40,boxShadow:"none"}),menu:e=>({...e,zIndex:50})}})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"mb-1 text-xs text-zinc-600",children:"Qty"}),(0,t.jsx)(o.Input,{value:eT,onChange:e=>eE(e.target.value),disabled:e1})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"mb-1 text-xs text-zinc-600",children:"Price"}),(0,t.jsx)(o.Input,{value:eB,onChange:e=>eL(e.target.value),disabled:e1,placeholder:"Optional"})]})]})]})}),(0,t.jsx)(u.Modal,{open:eq,title:"Add part",onClose:()=>{eU(null),eO(!1)},footer:(0,t.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,t.jsx)(c.Button,{type:"button",variant:"outline",onClick:()=>{eU(null),eO(!1)},children:"Cancel"}),(0,t.jsx)(c.Button,{type:"button",onClick:()=>{if(!eW)return void eU("Please select a part.");if(!eQ)return void eU("Please select a device.");let e=Math.round(Number(eY)),t=Number.isFinite(e)&&e>0?String(e):"1";eC(e=>[...e,{id:j("part"),part_id:eW.value,part:{id:eW.value,name:eW.label,code:eW.code,capacity:eW.capacity},device_id:eQ.value,qty:t,price:eJ}]),eK(null),eG("1"),eX(""),eU(null),eO(!1)},children:"Add"})]}),children:(0,t.jsxs)("div",{className:"space-y-4",children:[eH?(0,t.jsx)("div",{className:"text-sm text-red-600",children:eH}):null,(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("div",{className:"mb-1 text-xs text-zinc-600",children:"Select part"}),(0,t.jsx)(r.default,{instanceId:"estimate_part_select",inputId:"estimate_part_select",isSearchable:!0,isClearable:!0,options:e9,value:eW,onChange:e=>eK(e??null),isDisabled:e1,placeholder:e9.length>0?"Search parts...":"No parts yet",classNamePrefix:"rb-select",styles:{control:e=>({...e,borderRadius:"var(--rb-radius-sm)",borderColor:"#d4d4d8",minHeight:40,boxShadow:"none"}),menu:e=>({...e,zIndex:50})}})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("div",{className:"mb-1 text-xs text-zinc-600",children:"Device"}),(0,t.jsx)(r.default,{instanceId:"estimate_part_device",isSearchable:!0,isClearable:!0,options:e8,value:eQ,onChange:e=>eV(e??null),isDisabled:e1||0===e8.length,placeholder:e8.length>0?"Select device...":"No devices selected",classNamePrefix:"rb-select",styles:{control:e=>({...e,borderRadius:"var(--rb-radius-sm)",borderColor:"#d4d4d8",minHeight:40,boxShadow:"none"}),menu:e=>({...e,zIndex:50})}})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"mb-1 text-xs text-zinc-600",children:"Qty"}),(0,t.jsx)(o.Input,{value:eY,onChange:e=>eG(e.target.value),disabled:e1})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"mb-1 text-xs text-zinc-600",children:"Price"}),(0,t.jsx)(o.Input,{value:eJ,onChange:e=>eX(e.target.value),disabled:e1,placeholder:"Optional"})]})]})]})}),(0,t.jsx)("form",{className:"space-y-6",onSubmit:e=>{e.preventDefault()},children:(0,t.jsx)(b.WizardShell,{steps:[{id:1,navTitle:"Customer & devices",navDescription:"Case, dates, customer, technician, description, devices.",pageTitle:"Customer & devices",pageDescription:"Enter the customer, technician, description and devices.",footerTitle:"Customer & devices"},{id:2,navTitle:"Items and services",navDescription:"Add services, parts and other items.",pageTitle:"Items and services",pageDescription:"Attach services, parts and other items.",footerTitle:"Items and services"},{id:3,navTitle:"Review & send",navDescription:"Review and optionally send the estimate.",pageTitle:"Review & send",pageDescription:"Review the estimate and optionally send it to the customer.",footerTitle:"Review & send"}],step:k,disabled:e1,sidebarTitle:"Estimate steps",sidebarDescription:"Complete the steps to create the estimate.",sidebarAriaLabel:"Estimate steps",onStepChange:e=>{I(null),A(e)},footerRight:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(c.Button,{id:"rb_estimate_save",variant:"outline",disabled:e1,type:"button",onClick:()=>void tr("save"),children:S?"Saving...":"Save"}),(0,t.jsx)(c.Button,{id:"rb_estimate_save_send",variant:"primary",disabled:e1||!s.can("estimates.manage")||!ti,type:"button",onClick:()=>void tr("save_send"),children:S?"Saving...":"Save & Send"})]}),children:eZ?(0,t.jsxs)("div",{className:"space-y-5",children:[(0,t.jsx)(m.FormRow,{label:"Title",fieldId:"estimate_title",required:!0,children:(0,t.jsx)(o.Input,{id:"estimate_title",value:z,onChange:e=>P(e.target.value),disabled:e1})}),(0,t.jsx)(m.FormRow,{label:"Case number",fieldId:"estimate_case_number",children:(0,t.jsx)(o.Input,{id:"estimate_case_number",value:M,onChange:e=>F(e.target.value),disabled:e1})}),(0,t.jsx)(m.FormRow,{label:"Dates",fieldId:"estimate_dates",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"mb-1 text-xs text-zinc-600",children:"Pickup date"}),(0,t.jsx)(o.Input,{id:"estimate_pickup_date",type:"date",value:R,onChange:e=>D(e.target.value),disabled:e1})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"mb-1 text-xs text-zinc-600",children:"Delivery date"}),(0,t.jsx)(o.Input,{id:"estimate_delivery_date",type:"date",value:T,onChange:e=>E(e.target.value),disabled:e1})]})]})}),(0,t.jsx)(m.FormRow,{label:"Customer",fieldId:"estimate_customer",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)("div",{className:"min-w-0 flex-1",children:(0,t.jsx)(l.default,{inputId:"estimate_customer",instanceId:"estimate_customer",cacheOptions:!0,defaultOptions:e2,loadOptions:ts,isClearable:!0,isSearchable:!0,value:H,onChange:e=>{let t=e??null;K("existing"),U(t),O("number"==typeof t?.value&&t.value>0?t.value:null)},isDisabled:e1,placeholder:"Search customers...",classNamePrefix:"rb-select",styles:{control:e=>({...e,borderRadius:"var(--rb-radius-sm)",borderColor:"#d4d4d8",minHeight:40,boxShadow:"none"}),menu:e=>({...e,zIndex:50})}})}),(0,t.jsx)(c.Button,{type:"button",variant:"primary",size:"md",className:"w-10 px-0",disabled:e1,onClick:()=>{ea(null),ei(!0)},children:"+"})]}),"new"===W?(0,t.jsx)("div",{className:"text-xs text-zinc-600",children:"This estimate will create a new customer."}):null]})}),(0,t.jsx)(m.FormRow,{label:"Technician",fieldId:"estimate_technician",children:(0,t.jsx)(r.default,{inputId:"estimate_technician",instanceId:"estimate_technician",isSearchable:!0,isClearable:!0,options:e4,value:e6,onChange:e=>{let t=e??null;el("number"==typeof t?.value&&t.value>0?t.value:null)},isDisabled:e1||0===e4.length,placeholder:e4.length>0?"Select technician...":"No technicians available",classNamePrefix:"rb-select",styles:{control:e=>({...e,borderRadius:"var(--rb-radius-sm)",borderColor:"#d4d4d8",minHeight:40,boxShadow:"none"}),menu:e=>({...e,zIndex:50})}})}),(0,t.jsx)(m.FormRow,{label:"Estimate description",fieldId:"estimate_case_detail",children:(0,t.jsx)("textarea",{id:"estimate_case_detail",value:B,onChange:e=>L(e.target.value),disabled:e1,rows:4,placeholder:"Enter estimate description.",className:"w-full rounded-[var(--rb-radius-sm)] border border-zinc-300 bg-white px-3 py-2 text-sm text-[var(--rb-text)]"})}),(0,t.jsx)(m.FormRow,{label:"Add devices to this estimate",fieldId:"estimate_devices_admin",children:(0,t.jsx)(h.DevicesAdminEditor,{value:en,onChange:e=>ed(e),deviceOptions:e5,loadDeviceOptions:ta,disabled:e1,idPrefix:"estimate",showPin:eb,serialLabel:"Serial / IMEI",pinLabel:ev,notesLabel:"Notes",addButtonLabel:"Add device",createEmptyRow:()=>({device_id:null,option:null,serial:"",pin:"",notes:"",extra_fields:[]})})})]}):e0?(0,t.jsx)(g.ItemsStep,{deviceContextOptions:e8,disabled:e1,services:e_,setServices:ew,parts:eS,setParts:eC,otherItems:e$,setOtherItems:eI,onAddService:()=>{eP(null),!eR&&e8.length>0&&eD(e8[0]),eA(!0)},serviceAddDisabled:e1||0===e8.length,serviceAddLabel:"Add service",onAddPart:()=>{eU(null),!eQ&&e8.length>0&&eV(e8[0]),eO(!0)},partAddDisabled:e1||0===e8.length,partAddLabel:"Add part",otherItemsTitle:"Other items",otherItemsDescription:"Add custom line items like fees or discounts.",otherItemsAddLabel:"Add other item",createOtherItem:()=>({id:j("oi"),name:"",qty:"1",price:""}),otherItemNamePlaceholder:"e.g. Rent, Used cable",otherItemPricePlaceholder:"e.g. 10.00 (use -10.00 for discount)"}):(0,t.jsxs)("div",{className:"space-y-5",children:[(0,t.jsxs)("div",{className:"rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-white px-4 py-3",children:[(0,t.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Review"}),(0,t.jsxs)("div",{className:"mt-2 grid gap-4 sm:grid-cols-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs font-semibold uppercase tracking-wider text-zinc-500",children:"Customer"}),(0,t.jsx)("div",{className:"mt-1 text-sm text-zinc-700",children:"new"===W?Q.trim()||"—":tt?.name??H?.label??"—"}),(0,t.jsx)("div",{className:"mt-1 text-xs text-zinc-500",children:"new"===W?Y.trim():tt?.email??""})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs font-semibold uppercase tracking-wider text-zinc-500",children:"Estimated total"}),(0,t.jsx)("div",{className:"mt-1 text-sm font-semibold text-[var(--rb-text)]",children:Number.isFinite(te)?te.toFixed(2):"0.00"})]})]})]}),(0,t.jsxs)("div",{className:"rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-white px-4 py-3",children:[(0,t.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Devices"}),(0,t.jsxs)("div",{className:"mt-2 space-y-1 text-sm text-zinc-700",children:[0===e7.length?(0,t.jsx)("div",{className:"text-sm text-zinc-600",children:"None"}):null,e7.map(e=>(0,t.jsx)("div",{children:e.label},e.value))]})]}),(0,t.jsxs)("div",{className:"rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-white px-4 py-3",children:[(0,t.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Items"}),(0,t.jsxs)("div",{className:"mt-2 space-y-2",children:[0===e_.length&&0===eS.length&&0===e$.length?(0,t.jsx)("div",{className:"text-sm text-zinc-600",children:"None"}):null,e_.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3 text-sm",children:[(0,t.jsxs)("div",{className:"min-w-0 truncate text-zinc-700",children:[e.qty," × ",e.service.name]}),(0,t.jsx)("div",{className:"whitespace-nowrap font-semibold text-[var(--rb-text)]",children:e.price||"—"})]},e.id)),eS.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3 text-sm",children:[(0,t.jsxs)("div",{className:"min-w-0 truncate text-zinc-700",children:[e.qty," × ",e.part.name]}),(0,t.jsx)("div",{className:"whitespace-nowrap font-semibold text-[var(--rb-text)]",children:e.price||"—"})]},e.id)),e$.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3 text-sm",children:[(0,t.jsxs)("div",{className:"min-w-0 truncate text-zinc-700",children:[e.qty," × ",e.name]}),(0,t.jsx)("div",{className:"whitespace-nowrap font-semibold text-[var(--rb-text)]",children:e.price||"—"})]},e.id))]})]})]})})})]})}function N(){let e=(0,i.useParams)(),a=e.business??e.tenant;return"string"!=typeof a||0===a.trim().length?(0,t.jsx)(s.RequireAuth,{requiredPermission:"estimates.manage",children:(0,t.jsx)("div",{className:"text-sm text-zinc-600",children:"Tenant is missing."})}):(0,t.jsx)(s.RequireAuth,{requiredPermission:"estimates.manage",children:(0,t.jsx)(y,{tenantSlug:a})})}e.s(["default",()=>N],16574)}]);