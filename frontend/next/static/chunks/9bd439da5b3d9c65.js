(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,63571,e=>{"use strict";var r=e.i(48277),s=e.i(14575);function t({variant:e,className:t}){let a="h-4 w-4 shrink-0";return"success"===e?(0,r.jsx)("svg",{viewBox:"0 0 24 24",className:(0,s.cn)(a,t),fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:(0,r.jsx)("path",{d:"M20 6L9 17l-5-5"})}):"warning"===e?(0,r.jsxs)("svg",{viewBox:"0 0 24 24",className:(0,s.cn)(a,t),fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[(0,r.jsx)("path",{d:"M12 9v4"}),(0,r.jsx)("path",{d:"M12 17h.01"}),(0,r.jsx)("path",{d:"M10.3 3.6l-8.3 14.3A2 2 0 0 0 3.7 21h16.6a2 2 0 0 0 1.7-3.1L13.7 3.6a2 2 0 0 0-3.4 0z"})]}):"danger"===e?(0,r.jsxs)("svg",{viewBox:"0 0 24 24",className:(0,s.cn)(a,t),fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[(0,r.jsx)("path",{d:"M18 6L6 18"}),(0,r.jsx)("path",{d:"M6 6l12 12"})]}):(0,r.jsxs)("svg",{viewBox:"0 0 24 24",className:(0,s.cn)(a,t),fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[(0,r.jsx)("path",{d:"M12 16v-4"}),(0,r.jsx)("path",{d:"M12 8h.01"}),(0,r.jsx)("path",{d:"M12 22a10 10 0 1 0-10-10 10 10 0 0 0 10 10z"})]})}function a({className:e,variant:a="info",title:l,children:i,...n}){let o={info:{wrapper:"border-[color:color-mix(in_srgb,var(--rb-blue),white_75%)] bg-[color:color-mix(in_srgb,var(--rb-blue),white_92%)] text-[var(--rb-text)]",icon:"text-[var(--rb-blue)]",title:"text-[var(--rb-blue)]"},success:{wrapper:"border-[color:color-mix(in_srgb,#16a34a,white_75%)] bg-[color:color-mix(in_srgb,#16a34a,white_92%)] text-[var(--rb-text)]",icon:"text-[#166534]",title:"text-[#166534]"},warning:{wrapper:"border-[color:color-mix(in_srgb,var(--rb-orange),white_70%)] bg-[color:color-mix(in_srgb,var(--rb-orange),white_92%)] text-[var(--rb-text)]",icon:"text-[color:color-mix(in_srgb,var(--rb-orange),black_20%)]",title:"text-[color:color-mix(in_srgb,var(--rb-orange),black_20%)]"},danger:{wrapper:"border-[color:color-mix(in_srgb,#dc2626,white_75%)] bg-[color:color-mix(in_srgb,#dc2626,white_92%)] text-[var(--rb-text)]",icon:"text-[#991b1b]",title:"text-[#991b1b]"}}[a];return(0,r.jsx)("div",{role:"alert",className:(0,s.cn)("rounded-[var(--rb-radius-md)] border px-4 py-3",o.wrapper,e),...n,children:(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)(t,{variant:a,className:(0,s.cn)("mt-0.5",o.icon)}),(0,r.jsxs)("div",{className:"min-w-0",children:[l?(0,r.jsx)("div",{className:(0,s.cn)("text-sm font-semibold",o.title),children:l}):null,i?(0,r.jsx)("div",{className:(0,s.cn)("text-sm text-zinc-700",l?"mt-1":""),children:i}):null]})]})})}e.s(["Alert",()=>a])},68501,e=>{"use strict";var r=e.i(48277),s=e.i(14575);function t({className:e,variant:t="default",...a}){return(0,r.jsx)("span",{className:(0,s.cn)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-medium",{default:"bg-[var(--rb-surface-muted)] text-[var(--rb-text)] border-[var(--rb-border)]",info:"bg-[color:color-mix(in_srgb,var(--rb-blue),white_85%)] text-[var(--rb-blue)] border-[color:color-mix(in_srgb,var(--rb-blue),white_70%)]",success:"bg-[color:color-mix(in_srgb,#16a34a,white_85%)] text-[#166534] border-[color:color-mix(in_srgb,#16a34a,white_70%)]",warning:"bg-[color:color-mix(in_srgb,var(--rb-orange),white_85%)] text-[color:color-mix(in_srgb,var(--rb-orange),black_20%)] border-[color:color-mix(in_srgb,var(--rb-orange),white_70%)]",danger:"bg-[color:color-mix(in_srgb,#dc2626,white_85%)] text-[#991b1b] border-[color:color-mix(in_srgb,#dc2626,white_70%)]"}[t],e),...a})}e.s(["Badge",()=>t])},19463,e=>{"use strict";var r=e.i(48277),s=e.i(14575);function t({title:e,description:t,actions:a,className:l}){return(0,r.jsxs)("div",{className:(0,s.cn)("flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between",l),children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-xl font-semibold text-[var(--rb-text)]",children:e}),t?(0,r.jsx)("p",{className:"mt-1 text-sm text-zinc-600",children:t}):null]}),a?(0,r.jsx)("div",{className:"flex items-center gap-2",children:a}):null]})}e.s(["PageHeader",()=>t])},43901,e=>{"use strict";var r=e.i(48277),s=e.i(14575),t=e.i(72015);function a({className:e,"aria-hidden":t=!0,...a}){return(0,r.jsx)("div",{"aria-hidden":t,className:(0,s.cn)("rb-skeleton",e),...a})}function l({lines:e=3,className:l}){let i=Math.max(1,Math.min(e,12));return(0,r.jsx)(t.Card,{className:(0,s.cn)("overflow-hidden",l),children:(0,r.jsxs)(t.CardContent,{className:"space-y-3 pt-5",children:[(0,r.jsx)(a,{className:"h-4 w-32 rounded-[var(--rb-radius-sm)]"}),Array.from({length:i}).map((e,t)=>(0,r.jsx)(a,{className:(0,s.cn)("h-3 rounded-[var(--rb-radius-sm)]",t===i-1?"w-3/5":"w-full")},t))]})})}function i({rows:e=6,columns:t=5,className:l}){let i=Math.max(1,Math.min(e,20)),n=Math.max(1,Math.min(t,10));return(0,r.jsxs)("div",{className:(0,s.cn)("overflow-hidden rounded-[var(--rb-radius-lg)] border border-[var(--rb-border)] bg-white shadow-[var(--rb-shadow)]",l),children:[(0,r.jsx)("div",{className:"border-b border-[var(--rb-border)] px-5 py-4",children:(0,r.jsx)("div",{className:"grid gap-3",style:{gridTemplateColumns:`repeat(${n}, minmax(0, 1fr))`},children:Array.from({length:n}).map((e,s)=>(0,r.jsx)(a,{className:"h-3 w-full rounded-[var(--rb-radius-sm)]"},s))})}),(0,r.jsx)("div",{className:"px-5 pb-5 pt-4",children:(0,r.jsx)("div",{className:"space-y-3",children:Array.from({length:i}).map((e,t)=>(0,r.jsx)("div",{className:"grid gap-3",style:{gridTemplateColumns:`repeat(${n}, minmax(0, 1fr))`},children:Array.from({length:n}).map((e,t)=>(0,r.jsx)(a,{className:(0,s.cn)("h-3 rounded-[var(--rb-radius-sm)]",0===t?"w-3/4":"w-full")},t))},t))})})]})}e.s(["CardSkeleton",()=>l,"Skeleton",()=>a,"TableSkeleton",()=>i])},30765,e=>{"use strict";function r(e){let r=e.amountCents,s=e.currency?.toUpperCase()??null;if("number"!=typeof r||!Number.isFinite(r))return e.fallback??"—";let t=r/100;if(!s||3!==s.length)return`${t.toFixed(2)}`;try{return new Intl.NumberFormat(void 0,{style:"currency",currency:s,minimumFractionDigits:2,maximumFractionDigits:2}).format(t)}catch{return`${s} ${t.toFixed(2)}`}}e.s(["formatMoney",()=>r])},63789,e=>{"use strict";var r=e.i(48277),s=e.i(1831),t=e.i(30765),a=e.i(77252),l=e.i(63571),i=e.i(68501),n=e.i(9693),o=e.i(72015),d=e.i(19463),c=e.i(43901),x=e.i(30668);function m(){let[e,m]=(0,x.useState)(!0),[u,b]=(0,x.useState)(null),[h,v]=(0,x.useState)(null),[j,g]=(0,x.useState)(!0),[f,p]=(0,x.useState)(null),[N,w]=(0,x.useState)(null),[y,_]=(0,x.useState)(0);function k({label:e,value:s,badge:t,badgeVariant:a,glowClassName:l}){return(0,r.jsxs)(o.Card,{className:"relative overflow-hidden",children:[(0,r.jsx)("div",{className:"pointer-events-none absolute -right-10 -top-10 h-28 w-28 rounded-full blur-2xl opacity-70 "+l}),(0,r.jsxs)(o.CardContent,{className:"pt-5",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,r.jsxs)("div",{className:"min-w-0",children:[(0,r.jsx)("div",{className:"text-xs font-medium tracking-wide text-zinc-500",children:e}),(0,r.jsx)("div",{className:"mt-1 truncate text-2xl font-semibold text-[var(--rb-text)]",children:s})]}),(0,r.jsx)(i.Badge,{variant:a,children:t})]}),(0,r.jsx)("div",{className:"mt-3 h-px w-full bg-[var(--rb-border)]"})]})]})}function C({label:e,glowClassName:s}){return(0,r.jsxs)(o.Card,{className:"relative overflow-hidden",children:[(0,r.jsx)("div",{className:"pointer-events-none absolute -right-10 -top-10 h-28 w-28 rounded-full blur-2xl opacity-70 "+s}),(0,r.jsxs)(o.CardContent,{className:"pt-5",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,r.jsxs)("div",{className:"min-w-0",children:[(0,r.jsx)("div",{className:"text-xs font-medium tracking-wide text-zinc-500",children:e}),(0,r.jsx)("div",{className:"mt-1",children:(0,r.jsx)(c.Skeleton,{className:"h-8 w-28 rounded-[var(--rb-radius-sm)]"})})]}),(0,r.jsx)(c.Skeleton,{className:"h-5 w-16 rounded-full"})]}),(0,r.jsx)("div",{className:"mt-3 h-px w-full bg-[var(--rb-border)]"})]})]})}(0,x.useEffect)(()=>{let e=!0;async function r(){try{p(null),g(!0);let r=await (0,s.apiFetch)("/api/admin/dashboard/sales-last-12-months");if(!e)return;w(r)}catch(r){if(!e)return;p(r instanceof Error?r.message:"Failed to load sales history."),w(null)}finally{if(!e)return;g(!1)}}return async function(){try{b(null),m(!0);let r=await (0,s.apiFetch)("/api/admin/dashboard/kpis");if(!e)return;v(r)}catch(r){if(!e)return;b(r instanceof Error?r.message:"Failed to load dashboard KPIs."),v(null)}finally{if(!e)return;m(!1)}}(),r(),()=>{e=!1}},[y]);let S=(0,x.useMemo)(()=>{let e=new Set;for(let r of Object.keys(h?.mrr_by_currency??{}))e.add(r);for(let r of Object.keys(h?.revenue?.paid_last_30d_by_currency??{}))e.add(r);for(let r of Object.keys(h?.revenue?.paid_ytd_by_currency??{}))e.add(r);return Array.from(e).filter(Boolean).sort()},[h])[0]??null,M=S?h?.mrr_by_currency?.[S]??0:0,z=S?h?.revenue?.paid_last_30d_by_currency?.[S]??0:0,F=S?h?.revenue?.paid_ytd_by_currency?.[S]??0:0,A=e=>{let r=Object.entries(e??{}).filter(([e])=>!!e);return 0===r.length?"—":r.sort((e,r)=>e[0].localeCompare(r[0])).map(([e,r])=>(0,t.formatMoney)({amountCents:r,currency:e,fallback:"—"})).join(" · ")},B=h?.tenants?.by_status??{},L=["active","trial","past_due","suspended","closed"].filter(e=>"number"==typeof B?.[e]).map(e=>({status:e,count:B[e]})),P=(0,x.useMemo)(()=>{let e=Object.keys(N?.totals_by_currency??{}).filter(Boolean).sort();return S??e[0]??null},[S,N]),T=N?.months??[],R=P?N?.totals_by_currency?.[P]??[]:[];return(0,r.jsx)(a.RequireAuth,{requiredPermission:"admin.access",children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(d.PageHeader,{title:"Dashboard",description:"Platform overview (admin).",actions:(0,r.jsx)(n.Button,{variant:"outline",size:"sm",onClick:()=>_(e=>e+1),disabled:e,children:"Refresh"})}),u?(0,r.jsx)(l.Alert,{variant:"danger",title:"Could not load KPIs",children:u}):null,(0,r.jsx)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:e?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(C,{label:"Tenants",glowClassName:"bg-[color:color-mix(in_srgb,var(--rb-text),white_88%)]"}),(0,r.jsx)(C,{label:"Active subscriptions",glowClassName:"bg-[color:color-mix(in_srgb,var(--rb-blue),white_80%)]"}),(0,r.jsx)(C,{label:"MRR",glowClassName:"bg-[color:color-mix(in_srgb,#16a34a,white_75%)]"}),(0,r.jsx)(C,{label:"Users",glowClassName:"bg-[color:color-mix(in_srgb,var(--rb-border),white_55%)]"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(k,{label:"Tenants",value:String(h?.tenants?.total??0),badge:"tenants",badgeVariant:"default",glowClassName:"bg-[color:color-mix(in_srgb,var(--rb-text),white_88%)]"}),(0,r.jsx)(k,{label:"Active subscriptions",value:String(h?.subscriptions?.active_total??0),badge:"subs",badgeVariant:"info",glowClassName:"bg-[color:color-mix(in_srgb,var(--rb-blue),white_80%)]"}),(0,r.jsx)(k,{label:"MRR",value:S?(0,t.formatMoney)({amountCents:M,currency:S}):"—",badge:S??"—",badgeVariant:"success",glowClassName:"bg-[color:color-mix(in_srgb,#16a34a,white_75%)]"}),(0,r.jsx)(k,{label:"Users",value:String(h?.users?.total??0),badge:`${h?.users?.admins??0} admins`,badgeVariant:"default",glowClassName:"bg-[color:color-mix(in_srgb,var(--rb-border),white_55%)]"})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-3",children:[(0,r.jsx)(o.Card,{children:(0,r.jsxs)(o.CardContent,{className:"pt-5",children:[(0,r.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Tenant status"}),(0,r.jsx)("div",{className:"mt-3 flex flex-wrap gap-2",children:e?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.Skeleton,{className:"h-5 w-24 rounded-full"}),(0,r.jsx)(c.Skeleton,{className:"h-5 w-20 rounded-full"}),(0,r.jsx)(c.Skeleton,{className:"h-5 w-28 rounded-full"}),(0,r.jsx)(c.Skeleton,{className:"h-5 w-24 rounded-full"})]}):(0,r.jsxs)(r.Fragment,{children:[0===L.length?(0,r.jsx)("div",{className:"text-sm text-zinc-600",children:"—"}):null,L.map(e=>(0,r.jsxs)(i.Badge,{variant:"default",children:[e.status,": ",String(e.count)]},e.status))]})})]})}),(0,r.jsx)(o.Card,{children:(0,r.jsxs)(o.CardContent,{className:"pt-5",children:[(0,r.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Revenue"}),(0,r.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,r.jsx)("div",{className:"text-sm text-zinc-600",children:"Paid (last 30d)"}),(0,r.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:e?(0,r.jsx)(c.Skeleton,{className:"h-4 w-44 rounded-[var(--rb-radius-sm)]"}):A(h?.revenue?.paid_last_30d_by_currency)})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,r.jsx)("div",{className:"text-sm text-zinc-600",children:"Paid (YTD)"}),(0,r.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:e?(0,r.jsx)(c.Skeleton,{className:"h-4 w-44 rounded-[var(--rb-radius-sm)]"}):A(h?.revenue?.paid_ytd_by_currency)})]})]})]})}),(0,r.jsx)(o.Card,{children:(0,r.jsxs)(o.CardContent,{className:"pt-5",children:[(0,r.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Billing"}),(0,r.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,r.jsx)("div",{className:"text-sm text-zinc-600",children:"MRR (all currencies)"}),(0,r.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:e?(0,r.jsx)(c.Skeleton,{className:"h-4 w-44 rounded-[var(--rb-radius-sm)]"}):A(h?.mrr_by_currency)})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,r.jsx)("div",{className:"text-sm text-zinc-600",children:"Primary currency"}),(0,r.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:e?(0,r.jsx)(c.Skeleton,{className:"h-4 w-16 rounded-[var(--rb-radius-sm)]"}):S??"—"})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,r.jsx)("div",{className:"text-sm text-zinc-600",children:"Paid (30d, primary)"}),(0,r.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:e?(0,r.jsx)(c.Skeleton,{className:"h-4 w-28 rounded-[var(--rb-radius-sm)]"}):S?(0,t.formatMoney)({amountCents:z,currency:S}):"—"})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,r.jsx)("div",{className:"text-sm text-zinc-600",children:"Paid (YTD, primary)"}),(0,r.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:e?(0,r.jsx)(c.Skeleton,{className:"h-4 w-28 rounded-[var(--rb-radius-sm)]"}):S?(0,t.formatMoney)({amountCents:F,currency:S}):"—"})]})]})]})})]}),(0,r.jsx)(o.Card,{children:(0,r.jsxs)(o.CardContent,{className:"pt-5",children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-baseline justify-between gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Sales (last 12 months)"}),(0,r.jsx)("div",{className:"mt-1 text-sm text-zinc-600",children:"Paid invoices grouped by month."})]}),(0,r.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:P??"—"})]}),f?(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)(l.Alert,{variant:"danger",title:"Could not load sales history",children:f})}):null,(0,r.jsx)("div",{className:"mt-4",children:j?(0,r.jsx)(c.Skeleton,{className:"h-40 w-full rounded-[var(--rb-radius-lg)] border border-[var(--rb-border)]"}):0===R.length?(0,r.jsx)("div",{className:"h-40 w-full rounded-[var(--rb-radius-lg)] border border-[var(--rb-border)] bg-white p-4 text-sm text-zinc-600",children:"—"}):(0,r.jsxs)("div",{children:[(0,r.jsx)(function({values:e}){let s=e.reduce((e,r)=>Math.max(e,r),0),t=s>0?s:1,a=Math.max(e.length,1),l=e.map((e,r)=>`${(8+(1===a?292:584*r/(a-1))).toFixed(2)},${(10+140*(1-e/t)).toFixed(2)}`).join(" "),i=`8,150 ${l} 592,150`;return(0,r.jsxs)("svg",{viewBox:"0 0 600 160",className:"h-40 w-full",role:"img","aria-label":"Sales chart",children:[(0,r.jsx)("defs",{children:(0,r.jsxs)("linearGradient",{id:"rb-sales-fill",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,r.jsx)("stop",{offset:"0%",stopColor:"var(--rb-blue)",stopOpacity:"0.25"}),(0,r.jsx)("stop",{offset:"100%",stopColor:"var(--rb-blue)",stopOpacity:"0"})]})}),(0,r.jsx)("rect",{x:"0",y:"0",width:600,height:160,fill:"transparent"}),(0,r.jsx)("polyline",{points:i,fill:"url(#rb-sales-fill)",stroke:"none"}),(0,r.jsx)("polyline",{points:l,fill:"none",stroke:"var(--rb-blue)",strokeWidth:"2",strokeLinejoin:"round",strokeLinecap:"round"})]})},{values:R}),(0,r.jsxs)("div",{className:"mt-2 flex flex-wrap gap-x-4 gap-y-1 text-xs text-zinc-600",children:[(0,r.jsxs)("div",{children:[T[0]?.label??"",T.length>1?" → "+(T[T.length-1]?.label??""):""]}),(0,r.jsxs)("div",{children:["Total: ",P?(0,t.formatMoney)({amountCents:R.reduce((e,r)=>e+r,0),currency:P}):"—"]}),(0,r.jsxs)("div",{children:["Last month: ",P?(0,t.formatMoney)({amountCents:R[R.length-1]??0,currency:P}):"—"]})]})]})})]})})]})})}e.s(["default",()=>m])}]);