(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,63571,e=>{"use strict";var t=e.i(48277),i=e.i(14575);function r({variant:e,className:r}){let n="h-4 w-4 shrink-0";return"success"===e?(0,t.jsx)("svg",{viewBox:"0 0 24 24",className:(0,i.cn)(n,r),fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:(0,t.jsx)("path",{d:"M20 6L9 17l-5-5"})}):"warning"===e?(0,t.jsxs)("svg",{viewBox:"0 0 24 24",className:(0,i.cn)(n,r),fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[(0,t.jsx)("path",{d:"M12 9v4"}),(0,t.jsx)("path",{d:"M12 17h.01"}),(0,t.jsx)("path",{d:"M10.3 3.6l-8.3 14.3A2 2 0 0 0 3.7 21h16.6a2 2 0 0 0 1.7-3.1L13.7 3.6a2 2 0 0 0-3.4 0z"})]}):"danger"===e?(0,t.jsxs)("svg",{viewBox:"0 0 24 24",className:(0,i.cn)(n,r),fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[(0,t.jsx)("path",{d:"M18 6L6 18"}),(0,t.jsx)("path",{d:"M6 6l12 12"})]}):(0,t.jsxs)("svg",{viewBox:"0 0 24 24",className:(0,i.cn)(n,r),fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[(0,t.jsx)("path",{d:"M12 16v-4"}),(0,t.jsx)("path",{d:"M12 8h.01"}),(0,t.jsx)("path",{d:"M12 22a10 10 0 1 0-10-10 10 10 0 0 0 10 10z"})]})}function n({className:e,variant:n="info",title:a,children:s,...l}){let d={info:{wrapper:"border-[color:color-mix(in_srgb,var(--rb-blue),white_75%)] bg-[color:color-mix(in_srgb,var(--rb-blue),white_92%)] text-[var(--rb-text)]",icon:"text-[var(--rb-blue)]",title:"text-[var(--rb-blue)]"},success:{wrapper:"border-[color:color-mix(in_srgb,#16a34a,white_75%)] bg-[color:color-mix(in_srgb,#16a34a,white_92%)] text-[var(--rb-text)]",icon:"text-[#166534]",title:"text-[#166534]"},warning:{wrapper:"border-[color:color-mix(in_srgb,var(--rb-orange),white_70%)] bg-[color:color-mix(in_srgb,var(--rb-orange),white_92%)] text-[var(--rb-text)]",icon:"text-[color:color-mix(in_srgb,var(--rb-orange),black_20%)]",title:"text-[color:color-mix(in_srgb,var(--rb-orange),black_20%)]"},danger:{wrapper:"border-[color:color-mix(in_srgb,#dc2626,white_75%)] bg-[color:color-mix(in_srgb,#dc2626,white_92%)] text-[var(--rb-text)]",icon:"text-[#991b1b]",title:"text-[#991b1b]"}}[n];return(0,t.jsx)("div",{role:"alert",className:(0,i.cn)("rounded-[var(--rb-radius-md)] border px-4 py-3",d.wrapper,e),...l,children:(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)(r,{variant:n,className:(0,i.cn)("mt-0.5",d.icon)}),(0,t.jsxs)("div",{className:"min-w-0",children:[a?(0,t.jsx)("div",{className:(0,i.cn)("text-sm font-semibold",d.title),children:a}):null,s?(0,t.jsx)("div",{className:(0,i.cn)("text-sm text-zinc-700",a?"mt-1":""),children:s}):null]})]})})}e.s(["Alert",()=>n])},68501,e=>{"use strict";var t=e.i(48277),i=e.i(14575);function r({className:e,variant:r="default",...n}){return(0,t.jsx)("span",{className:(0,i.cn)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-medium",{default:"bg-[var(--rb-surface-muted)] text-[var(--rb-text)] border-[var(--rb-border)]",info:"bg-[color:color-mix(in_srgb,var(--rb-blue),white_85%)] text-[var(--rb-blue)] border-[color:color-mix(in_srgb,var(--rb-blue),white_70%)]",success:"bg-[color:color-mix(in_srgb,#16a34a,white_85%)] text-[#166534] border-[color:color-mix(in_srgb,#16a34a,white_70%)]",warning:"bg-[color:color-mix(in_srgb,var(--rb-orange),white_85%)] text-[color:color-mix(in_srgb,var(--rb-orange),black_20%)] border-[color:color-mix(in_srgb,var(--rb-orange),white_70%)]",danger:"bg-[color:color-mix(in_srgb,#dc2626,white_85%)] text-[#991b1b] border-[color:color-mix(in_srgb,#dc2626,white_70%)]"}[r],e),...n})}e.s(["Badge",()=>r])},26550,e=>{"use strict";var t=e.i(48277),i=e.i(14575);function r({className:e,type:r,...n}){return(0,t.jsx)("input",{type:r,className:(0,i.cn)("w-full rounded-[var(--rb-radius-sm)] border border-zinc-300 bg-white px-3 py-2 text-sm text-[var(--rb-text)] outline-none transition","placeholder:text-zinc-400","focus-visible:ring-2 focus-visible:ring-[color:color-mix(in_srgb,var(--rb-orange),white_65%)] focus-visible:ring-offset-2 focus-visible:ring-offset-white","disabled:cursor-not-allowed disabled:bg-[var(--rb-surface-muted)] disabled:opacity-70",e),...n})}e.s(["Input",()=>r])},30765,e=>{"use strict";function t(e){let t=e.amountCents,i=e.currency?.toUpperCase()??null;if("number"!=typeof t||!Number.isFinite(t))return e.fallback??"—";let r=t/100;if(!i||3!==i.length)return`${r.toFixed(2)}`;try{return new Intl.NumberFormat(void 0,{style:"currency",currency:i,minimumFractionDigits:2,maximumFractionDigits:2}).format(r)}catch{return`${i} ${r.toFixed(2)}`}}e.s(["formatMoney",()=>t])},43901,e=>{"use strict";var t=e.i(48277),i=e.i(14575),r=e.i(72015);function n({className:e,"aria-hidden":r=!0,...n}){return(0,t.jsx)("div",{"aria-hidden":r,className:(0,i.cn)("rb-skeleton",e),...n})}function a({lines:e=3,className:a}){let s=Math.max(1,Math.min(e,12));return(0,t.jsx)(r.Card,{className:(0,i.cn)("overflow-hidden",a),children:(0,t.jsxs)(r.CardContent,{className:"space-y-3 pt-5",children:[(0,t.jsx)(n,{className:"h-4 w-32 rounded-[var(--rb-radius-sm)]"}),Array.from({length:s}).map((e,r)=>(0,t.jsx)(n,{className:(0,i.cn)("h-3 rounded-[var(--rb-radius-sm)]",r===s-1?"w-3/5":"w-full")},r))]})})}function s({rows:e=6,columns:r=5,className:a}){let s=Math.max(1,Math.min(e,20)),l=Math.max(1,Math.min(r,10));return(0,t.jsxs)("div",{className:(0,i.cn)("overflow-hidden rounded-[var(--rb-radius-lg)] border border-[var(--rb-border)] bg-white shadow-[var(--rb-shadow)]",a),children:[(0,t.jsx)("div",{className:"border-b border-[var(--rb-border)] px-5 py-4",children:(0,t.jsx)("div",{className:"grid gap-3",style:{gridTemplateColumns:`repeat(${l}, minmax(0, 1fr))`},children:Array.from({length:l}).map((e,i)=>(0,t.jsx)(n,{className:"h-3 w-full rounded-[var(--rb-radius-sm)]"},i))})}),(0,t.jsx)("div",{className:"px-5 pb-5 pt-4",children:(0,t.jsx)("div",{className:"space-y-3",children:Array.from({length:s}).map((e,r)=>(0,t.jsx)("div",{className:"grid gap-3",style:{gridTemplateColumns:`repeat(${l}, minmax(0, 1fr))`},children:Array.from({length:l}).map((e,r)=>(0,t.jsx)(n,{className:(0,i.cn)("h-3 rounded-[var(--rb-radius-sm)]",0===r?"w-3/4":"w-full")},r))},r))})})]})}e.s(["CardSkeleton",()=>a,"Skeleton",()=>n,"TableSkeleton",()=>s])},37574,e=>{"use strict";var t=e.i(48277),i=e.i(30668),r=e.i(14575),n=e.i(9693),a=e.i(33441),s=e.i(43901),l=e.i(1831);function d({title:e,data:d,columns:c,getRowId:o,loading:m=!1,emptyMessage:u="No data.",search:x,filters:h=[],pageSizeOptions:v=[10,25,50],initialPageSize:b=10,server:p,exportConfig:f,columnVisibilityKey:g,onRowClick:y,className:j}){let[N,w]=(0,i.useState)(""),[_,S]=(0,i.useState)(0),[C,I]=(0,i.useState)(b),[k,z]=(0,i.useState)(null),[A,$]=(0,i.useState)(null),[D,P]=(0,i.useState)(0),T=(0,i.useId)(),F=!!p,B=F?p.query:N,M=F?p.onQueryChange:w,E=F?p.pageIndex:_,L=F?p.onPageIndexChange:S,O=F?p.pageSize:C,U=F?p.onPageSizeChange:I,V=F?p.sort??null:null,R=F?p.onSortChange:void 0,H=(0,i.useMemo)(()=>{let e=Array.isArray(c)?c:[];if(!g){let t=e.filter(e=>!e.hiddenByDefault);return t.length>0?t:e.slice(0,1)}try{let t=window.localStorage.getItem(g);if(!t){let t=e.filter(e=>!e.hiddenByDefault);return t.length>0?t:e.slice(0,1)}let i=JSON.parse(t),r=e.filter(e=>{let t=i[e.id];return"boolean"==typeof t?t:!e.hiddenByDefault});return r.length>0?r:e.slice(0,1)}catch{let t=e.filter(e=>!e.hiddenByDefault);return t.length>0?t:e.slice(0,1)}},[g,c,D]),J=(0,i.useMemo)(()=>{if(F)return Array.isArray(d)?d:[];let e=B.trim().toLowerCase();return(Array.isArray(d)?d:[]).filter(t=>{if(x&&x.getSearchText&&e.length>0&&!x.getSearchText(t).toLowerCase().includes(e))return!1;for(let e of h)if(e.predicate&&!e.predicate(t,e.value))return!1;return!0})},[d,h,F,B,x]),q=F?p.totalRows:J.length,W=Math.max(1,Math.ceil(q/O)),K=Math.min(E,W-1),Q=Math.max(1,Math.min(8,O||10)),G=(0,i.useMemo)(()=>{if(F)return J;let e=K*O,t=e+O;return J.slice(e,t)},[K,J,F,O]),X=K>0,Y=K<W-1,Z=!!x||h.length>0||!!f||!!g;function ee(e,t){if(g&&(t||!(H.length<=1)))try{let i=window.localStorage.getItem(g),r=(i?JSON.parse(i):{})??{};r[e]=t,window.localStorage.setItem(g,JSON.stringify(r)),P(e=>e+1)}catch{}}async function et(e){if(f&&!k){$(null),z(e);try{let t=new URLSearchParams;for(let e of(B.trim().length>0&&t.set("q",B.trim()),h)){let i=e.value;null!=i&&0!==String(i).length&&t.set(e.id,String(i))}if(F&&V?.id&&V?.dir&&(t.set("sort",V.id),t.set("dir",V.dir)),t.set("format",e),f.extraQuery)for(let[e,i]of Object.entries(f.extraQuery))null!=i&&t.set(e,String(i));let i=`${f.url}${f.url.includes("?")?"&":"?"}${t.toString()}`,r=f.filename?.({format:e});await (0,l.apiDownload)(i,{filename:r})}catch(e){$(e instanceof Error?e.message:"Export failed.")}finally{z(null)}}}return(0,t.jsxs)("div",{className:(0,r.cn)("space-y-3",j),children:[e?(0,t.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:e}):null,Z?(0,t.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-end md:justify-between",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-end",children:[x?(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium",htmlFor:`${T}_datatable_search`,children:"Search"}),(0,t.jsx)("input",{id:`${T}_datatable_search`,className:"w-full min-w-[220px] rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:B,onChange:e=>{M(e.target.value),L(0)},placeholder:x.placeholder??"Search..."})]}):null,h.map(e=>(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium",htmlFor:`${T}_datatable_filter_${e.id}`,children:e.label}),(0,t.jsx)("select",{id:`${T}_datatable_filter_${e.id}`,className:"w-full min-w-[180px] rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:String(e.value),onChange:t=>{let i=e.options.find(e=>String(e.value)===t.target.value),r=i?i.value:t.target.value;e.onChange(r),L(0)},children:e.options.map(e=>(0,t.jsx)("option",{value:String(e.value),children:e.label},String(e.value)))})]},e.id))]}),(0,t.jsxs)("div",{className:"flex flex-col items-start gap-2 md:items-end",children:[(0,t.jsxs)("div",{className:"text-sm text-zinc-600",children:[q," result(s)"]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[f?(0,t.jsx)(a.DropdownMenu,{align:"right",trigger:({toggle:e})=>(0,t.jsx)(n.Button,{variant:"outline",size:"sm",onClick:e,disabled:!!k,children:k?"Exporting...":"Export"}),children:({close:e})=>{let i=f.formats??["csv","xlsx","pdf"];return(0,t.jsx)(t.Fragment,{children:i.map(i=>(0,t.jsxs)(a.DropdownMenuItem,{onSelect:()=>{e(),et(i)},disabled:!!k,children:["Export ",i.toUpperCase()]},i))})}}):null,g?(0,t.jsx)(a.DropdownMenu,{align:"right",trigger:({toggle:e})=>(0,t.jsx)(n.Button,{variant:"outline",size:"sm",onClick:e,children:"Columns"}),children:({close:e})=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.DropdownMenuItem,{onSelect:()=>{for(let t of(e(),c))ee(t.id,!0)},children:"Show all"}),(0,t.jsx)(a.DropdownMenuItem,{onSelect:()=>{for(let t of(e(),c))ee(t.id,!t.hiddenByDefault)},children:"Reset defaults"}),(0,t.jsx)(a.DropdownMenuSeparator,{}),c.map(e=>{let i=H.some(t=>t.id===e.id);return(0,t.jsxs)(a.DropdownMenuItem,{onSelect:()=>{ee(e.id,!i)},children:[(0,t.jsx)("span",{className:"mr-2 inline-block w-4",children:i?"✓":""}),"string"==typeof e.header?e.header:e.id]},e.id)})]})}):null]})]})]}):null,A?(0,t.jsx)("div",{className:"text-sm text-red-600",children:A}):null,(0,t.jsx)("div",{className:"overflow-x-auto rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-white",children:(0,t.jsxs)("table",{className:"min-w-full border-collapse text-left text-sm",children:[(0,t.jsx)("thead",{className:"bg-[var(--rb-surface-muted)]",children:(0,t.jsx)("tr",{children:H.map(e=>(0,t.jsx)("th",{className:(0,r.cn)("whitespace-nowrap border-b border-[var(--rb-border)] px-3 py-2 text-xs font-semibold uppercase tracking-wide text-zinc-600",e.headerClassName),children:F&&e.sortId&&R?(0,t.jsxs)("button",{type:"button",onClick:()=>(function(e){if(F&&e.sortId&&R){if(!V||V.id!==e.sortId){R({id:e.sortId,dir:"asc"}),L(0);return}if("asc"===V.dir){R({id:e.sortId,dir:"desc"}),L(0);return}R(null),L(0)}})(e),className:"inline-flex items-center gap-1 hover:text-zinc-900",children:[(0,t.jsx)("span",{children:e.header}),F&&e.sortId?V&&V.id===e.sortId?"asc"===V.dir?(0,t.jsx)("span",{className:"ml-1 text-zinc-700",children:"↑"}):(0,t.jsx)("span",{className:"ml-1 text-zinc-700",children:"↓"}):(0,t.jsx)("span",{className:"ml-1 text-zinc-400",children:"↕"}):null]}):e.header},e.id))})}),(0,t.jsx)("tbody",{children:m?Array.from({length:Q}).map((e,i)=>(0,t.jsx)("tr",{className:"border-t border-[var(--rb-border)]",children:H.map((e,i)=>(0,t.jsx)("td",{className:(0,r.cn)("px-3 py-2 align-middle",e.className),children:(0,t.jsx)(s.Skeleton,{className:(0,r.cn)("h-3 rounded-[var(--rb-radius-sm)]",0===i?"w-3/4":i===H.length-1?"w-16":"w-full")})},e.id))},`loading_${i}`)):0===G.length?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{className:"px-3 py-3 text-sm text-zinc-600",colSpan:Math.max(1,H.length),children:u})}):G.map(e=>(0,t.jsx)("tr",{className:(0,r.cn)("border-t border-[var(--rb-border)]",y?"cursor-pointer hover:bg-[var(--rb-surface-muted)]":null),tabIndex:y?0:void 0,role:y?"button":void 0,onClick:y?()=>{y(e)}:void 0,onKeyDown:y?t=>{("Enter"===t.key||" "===t.key)&&(t.preventDefault(),y(e))}:void 0,children:H.map(i=>(0,t.jsx)("td",{className:(0,r.cn)("px-3 py-2 align-middle",i.className),children:i.cell(e)},i.id))},String(o(e))))})]})}),(0,t.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(n.Button,{variant:"outline",size:"sm",onClick:function(){L(Math.max(0,K-1))},disabled:!X,children:"Prev"}),(0,t.jsx)(n.Button,{variant:"outline",size:"sm",onClick:function(){L(Math.min(W-1,K+1))},disabled:!Y,children:"Next"}),(0,t.jsxs)("div",{className:"text-sm text-zinc-600",children:["Page ",K+1," / ",W]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"text-sm text-zinc-600",children:"Rows per page"}),(0,t.jsx)("select",{className:"rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:String(O),onChange:e=>{U(Number(e.target.value)),L(0)},children:v.map(e=>(0,t.jsx)("option",{value:e,children:e},e))})]})]})]})}e.s(["DataTable",()=>d])},66474,e=>{"use strict";var t=e.i(48277),i=e.i(30668),r=e.i(14575);function n({open:e,onClose:n,title:a,children:s,footer:l,position:d="center",variant:c="glass",className:o}){if((0,i.useEffect)(()=>{function t(t){e&&"Escape"===t.key&&n()}return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[n,e]),!e)return null;let m="solid"===c?(0,r.cn)("relative w-full max-w-lg overflow-hidden rounded-[var(--rb-radius-lg)]","border border-[var(--rb-border)]","bg-white","shadow-[var(--rb-shadow)]"):(0,r.cn)("relative w-full max-w-lg overflow-hidden rounded-[var(--rb-radius-lg)]","border border-[color:color-mix(in_srgb,var(--rb-border),white_55%)]","bg-white/75 backdrop-blur-xl","shadow-[0_18px_55px_-18px_rgba(0,0,0,0.55)]","ring-1 ring-white/25");return(0,t.jsxs)("div",{className:"top-center"===d?"fixed inset-0 z-50 flex items-start justify-center px-4 pt-8":"fixed inset-0 z-50 flex items-center justify-center px-4",children:[(0,t.jsx)("button",{type:"button",className:(0,r.cn)("absolute inset-0","bg-black/35 backdrop-blur-md","bg-[radial-gradient(900px_600px_at_20%_20%,color-mix(in_srgb,#16a34a,transparent_82%)_0%,transparent_60%),radial-gradient(900px_600px_at_80%_30%,color-mix(in_srgb,var(--rb-blue),transparent_82%)_0%,transparent_60%),radial-gradient(900px_600px_at_50%_85%,color-mix(in_srgb,var(--rb-orange),transparent_85%)_0%,transparent_65%)]"),"aria-label":"Close",onClick:n}),(0,t.jsxs)("div",{role:"dialog","aria-modal":"true",className:(0,r.cn)(m,o),children:["glass"===c?(0,t.jsx)("div",{className:"pointer-events-none absolute inset-0 bg-[radial-gradient(650px_420px_at_20%_15%,color-mix(in_srgb,#16a34a,transparent_88%)_0%,transparent_60%),radial-gradient(650px_420px_at_80%_5%,color-mix(in_srgb,var(--rb-blue),transparent_90%)_0%,transparent_60%)]"}):null,a?(0,t.jsx)("div",{className:(0,r.cn)("relative px-5 py-4","solid"===c?"border-b border-[var(--rb-border)]":"border-b border-[color:color-mix(in_srgb,var(--rb-border),white_60%)]"),children:(0,t.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:a})}):null,(0,t.jsx)("div",{className:"relative px-5 py-4",children:s}),l?(0,t.jsx)("div",{className:(0,r.cn)("relative px-5 py-4","solid"===c?"border-t border-[var(--rb-border)]":"border-t border-[color:color-mix(in_srgb,var(--rb-border),white_60%)]"),children:l}):null]})]})}e.s(["Modal",()=>n])},64998,e=>{"use strict";var t=e.i(48277),i=e.i(66474),r=e.i(9693);function n({open:e,title:n,message:a,confirmText:s="Confirm",confirmVariant:l="primary",cancelText:d="Cancel",busy:c=!1,onCancel:o,onConfirm:m}){return(0,t.jsx)(i.Modal,{open:e,onClose:()=>{c||o()},title:n,footer:(0,t.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,t.jsx)(r.Button,{variant:"outline",onClick:o,disabled:c,children:d}),(0,t.jsx)(r.Button,{variant:l,onClick:m,disabled:c,children:c?"Working...":s})]}),children:(0,t.jsx)("div",{className:"text-sm text-zinc-700",children:a})})}e.s(["ConfirmDialog",()=>n])},69965,e=>{"use strict";let t={locale:"en-GB",dateStyle:"medium",timeStyle:"short",hour12:!1};function i(e){if(!e)return null;if(e instanceof Date)return Number.isFinite(e.getTime())?e:null;let t=new Date(e);return Number.isFinite(t.getTime())?t:null}function r(e,r){let n=i(e);if(!n)return"—";let a={...t,...r??{}};return new Intl.DateTimeFormat(a.locale,{dateStyle:a.dateStyle}).format(n)}function n(e,r){let n=i(e);if(!n)return"—";let a={...t,...r??{}};return new Intl.DateTimeFormat(a.locale,{dateStyle:a.dateStyle,timeStyle:a.timeStyle,hour12:a.hour12}).format(n)}e.s(["formatDate",()=>r,"formatDateTime",()=>n])},21190,e=>{"use strict";var t=e.i(1831);async function i(e){let i=new URLSearchParams;return"boolean"==typeof e?.includeInactive&&i.set("include_inactive",e.includeInactive?"1":"0"),(0,t.apiFetch)(`/api/admin/billing/catalog${i.toString()?`?${i.toString()}`:""}`)}async function r(e){let i=new URLSearchParams;return"boolean"==typeof e?.includeInactive&&i.set("include_inactive",e.includeInactive?"1":"0"),(0,t.apiFetch)(`/api/admin/billing/intervals${i.toString()?`?${i.toString()}`:""}`)}async function n(e){return(0,t.apiFetch)("/api/admin/billing/intervals",{method:"POST",body:{code:e.code?.trim()||void 0,name:e.name,months:e.months,is_active:"boolean"==typeof e.isActive?e.isActive:void 0}})}async function a(e){return(0,t.apiFetch)(`/api/admin/billing/intervals/${e.intervalId}`,{method:"PUT",body:{code:e.code,name:e.name,months:e.months,is_active:"boolean"==typeof e.isActive?e.isActive:void 0,reason:e.reason}})}async function s(e){return(0,t.apiFetch)(`/api/admin/billing/intervals/${e.intervalId}/active`,{method:"PATCH",body:{is_active:e.isActive,reason:e.reason}})}async function l(e){return(0,t.apiFetch)("/api/admin/billing/plans",{method:"POST",body:{name:e.name,code:e.code?.trim()||void 0,description:e.description?.trim()||void 0,is_active:"boolean"==typeof e.isActive?e.isActive:void 0}})}async function d(e){return(0,t.apiFetch)(`/api/admin/billing/plans/${e.planId}`,{method:"PUT",body:{name:e.name,code:e.code,description:e.description?.trim()||void 0,is_active:"boolean"==typeof e.isActive?e.isActive:void 0,reason:e.reason}})}async function c(e){return(0,t.apiFetch)(`/api/admin/billing/plans/${e.planId}/versions/draft-from-active`,{method:"POST",body:{reason:e.reason}})}async function o(e){try{return await (0,t.apiFetch)(`/api/admin/billing/versions/${e.versionId}/validate`,{method:"POST",body:{reason:e.reason}})}catch(e){if(e instanceof t.ApiError){let t=e.data;if(t&&"object"==typeof t){if("ok"===t.status)return{status:"ok"};if("string"==typeof t.message)return{message:t.message,errors:Array.isArray(t.errors)?t.errors.map(String):void 0}}}throw e}}async function m(e){return(0,t.apiFetch)(`/api/admin/billing/versions/${e.versionId}/entitlements/sync`,{method:"POST",body:{entitlements:e.entitlements,reason:e.reason}})}async function u(e){return(0,t.apiFetch)(`/api/admin/billing/versions/${e.versionId}/prices`,{method:"POST",body:{currency:e.currency,billing_interval_id:"number"==typeof e.billingIntervalId?e.billingIntervalId:void 0,interval:e.interval,amount_cents:e.amountCents,trial_days:"number"==typeof e.trialDays?e.trialDays:void 0,is_default:"boolean"==typeof e.isDefault?e.isDefault:void 0,reason:e.reason}})}async function x(e){return(0,t.apiFetch)(`/api/admin/billing/prices/${e.priceId}`,{method:"PATCH",body:{amount_cents:e.amountCents,trial_days:"number"==typeof e.trialDays?e.trialDays:void 0,is_default:"boolean"==typeof e.isDefault?e.isDefault:void 0,reason:e.reason}})}async function h(e){return(0,t.apiFetch)(`/api/admin/billing/prices/${e.priceId}`,{method:"DELETE",body:{reason:e.reason}})}async function v(e){return(0,t.apiFetch)(`/api/admin/billing/versions/${e.versionId}/activate`,{method:"POST",body:{confirm:e.confirm,reason:e.reason}})}async function b(e){return(0,t.apiFetch)("/api/admin/billing/entitlement-definitions",{method:"POST",body:{code:e.code?.trim()||void 0,name:e.name,value_type:e.valueType,description:e.description?.trim()||void 0,is_premium:"boolean"==typeof e.isPremium?e.isPremium:void 0}})}async function p(e){return(0,t.apiFetch)(`/api/admin/billing/entitlement-definitions/${e.id}`,{method:"PUT",body:{code:e.code,name:e.name,value_type:e.valueType,description:e.description?.trim()||void 0,is_premium:"boolean"==typeof e.isPremium?e.isPremium:void 0,reason:e.reason}})}async function f(e){return(0,t.apiFetch)(`/api/admin/billing/entitlement-definitions/${e.id}`,{method:"DELETE",body:{reason:e.reason}})}async function g(e){return(0,t.apiFetch)(`/api/admin/businesses/${e}/subscriptions`)}async function y(e){return(0,t.apiFetch)(`/api/admin/businesses/${e.tenantId}/subscriptions`,{method:"POST",body:{billing_plan_version_id:e.billingPlanVersionId,billing_price_id:e.billingPriceId,reason:e.reason}})}async function j(e){return(0,t.apiFetch)(`/api/admin/businesses/${e.tenantId}/subscriptions/${e.subscriptionId}/cancel`,{method:"POST",body:{at_period_end:"boolean"==typeof e.atPeriodEnd?e.atPeriodEnd:void 0,reason:e.reason}})}async function N(e){let i=new URLSearchParams;return e.status&&e.status.trim().length>0&&i.set("status",e.status.trim()),"number"==typeof e.limit&&Number.isFinite(e.limit)&&i.set("limit",String(e.limit)),(0,t.apiFetch)(`/api/admin/businesses/${e.tenantId}/invoices${i.toString()?`?${i.toString()}`:""}`)}async function w(e){return(0,t.apiFetch)(`/api/admin/businesses/${e.tenantId}/invoices/${e.invoiceId}`)}async function _(e){return(0,t.apiFetch)(`/api/admin/businesses/${e.tenantId}/invoices`,{method:"POST",body:{tenant_subscription_id:e.tenantSubscriptionId,reason:e.reason}})}async function S(e){return(0,t.apiFetch)(`/api/admin/businesses/${e.tenantId}/invoices/${e.invoiceId}/issue`,{method:"POST",body:{reason:e.reason}})}async function C(e){return(0,t.apiFetch)(`/api/admin/businesses/${e.tenantId}/invoices/${e.invoiceId}/paid`,{method:"POST",body:{paid_at:e.paidAt,paid_method:e.paidMethod,paid_note:e.paidNote,reason:e.reason}})}async function I(e){let i=e.invoiceNumber?`invoice_${e.invoiceNumber}.pdf`:"invoice.pdf";await (0,t.apiDownload)(`/api/admin/businesses/${e.tenantId}/invoices/${e.invoiceId}/pdf`,{filename:i})}e.s(["activateBillingPlanVersion",()=>v,"assignTenantSubscription",()=>y,"cancelTenantSubscription",()=>j,"createBillingInterval",()=>n,"createBillingPlan",()=>l,"createBillingPrice",()=>u,"createDraftBillingPlanVersionFromActive",()=>c,"createEntitlementDefinition",()=>b,"createInvoiceFromSubscription",()=>_,"deleteBillingPrice",()=>h,"deleteEntitlementDefinition",()=>f,"downloadInvoicePdf",()=>I,"getBillingCatalog",()=>i,"getTenantInvoice",()=>w,"getTenantInvoices",()=>N,"getTenantSubscriptions",()=>g,"issueInvoice",()=>S,"listBillingIntervals",()=>r,"markInvoicePaid",()=>C,"setBillingIntervalActive",()=>s,"syncBillingPlanVersionEntitlements",()=>m,"updateBillingInterval",()=>a,"updateBillingPlan",()=>d,"updateBillingPrice",()=>x,"updateEntitlementDefinition",()=>p,"validateBillingPlanVersionDraft",()=>o])},81173,e=>{"use strict";var t=e.i(48277),i=e.i(30668),r=e.i(16506),n=e.i(96086),a=e.i(77252),s=e.i(24273),l=e.i(63571),d=e.i(68501),c=e.i(9693),o=e.i(72015),m=e.i(64998),u=e.i(37574),x=e.i(26550),h=e.i(66474),v=e.i(1831),b=e.i(21190),p=e.i(1314),f=e.i(69965),g=e.i(30765);function y(){let e,y,j=(0,n.useParams)(),N=(0,s.useDashboardHeader)(),w=(0,p.useAuth)(),_=Number(j.planId),S=Number(j.versionId),[C,I]=(0,i.useState)(!0),[k,z]=(0,i.useState)(null),[A,$]=(0,i.useState)(null),[D,P]=(0,i.useState)(null),[T,F]=(0,i.useState)(null),[B,M]=(0,i.useState)([]),[E,L]=(0,i.useState)([]),[O,U]=(0,i.useState)([]),[V,R]=(0,i.useState)(0),H=w.can("admin.billing.write"),J=(0,i.useMemo)(()=>!T||"draft"!==T.status||!!T.locked_at||!!T.activated_at||!!T.retired_at,[T]);(0,i.useEffect)(()=>(N.setHeader({breadcrumb:"Admin / Billing / Plans",title:T?`${D?.name??"Plan"} v${T.version}`:"Plan version",subtitle:T?`${String(T.status||"").toUpperCase()}${"draft"===T.status&&!J?" • editable":""}`:void 0,actions:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(r.default,{href:`/admin/billing/plans/${_}`,children:(0,t.jsx)(c.Button,{variant:"outline",size:"sm",children:"Back"})}),(0,t.jsx)(c.Button,{variant:"outline",size:"sm",onClick:()=>R(e=>e+1),disabled:C,children:"Refresh"})]})}),()=>N.setHeader(null)),[N,J,C,D?.name,_,T,T?.status,T?.version]),(0,i.useEffect)(()=>{let e=!0;return async function(){if(!Number.isFinite(_)||_<=0||!Number.isFinite(S)||S<=0){z("Invalid plan/version id."),I(!1);return}try{I(!0),z(null);let t=await (0,b.getBillingCatalog)({includeInactive:!0});if(!e)return;let i=(Array.isArray(t.billing_plans)?t.billing_plans:[]).find(e=>e.id===_)??null,r=(Array.isArray(i?.versions)?i?.versions:[]).find(e=>e.id===S)??null;P(i),F(r),M(Array.isArray(t.entitlement_definitions)?t.entitlement_definitions:[]),L(Array.isArray(t.billing_intervals)?t.billing_intervals:[]);try{let t=await (0,v.apiFetch)("/api/admin/settings");if(!e)return;let i=(Array.isArray(t.currencies)?t.currencies:[]).filter(e=>!!e?.is_active).map(e=>({code:String(e.code??"").trim().toUpperCase(),name:String(e.name??"").trim(),symbol:String(e.symbol??"").trim()})).filter(e=>3===e.code.length).sort((e,t)=>e.code.localeCompare(t.code));U(i)}catch{if(!e)return;U([])}i?r||z("Version not found."):z("Plan not found.")}catch(t){if(!e)return;z(t instanceof Error?t.message:"Failed to load version."),P(null),F(null),L([]),U([])}finally{if(!e)return;I(!1)}}(),()=>{e=!1}},[_,V,S]);let q=(0,i.useMemo)(()=>new Set(O.map(e=>e.code)),[O]);function W(e){let t=Number.parseFloat(e.trim().replace(",","."));return!Number.isFinite(t)||t<0?0:Math.round(100*t)}function K(e,t){return`${String(e).trim().toUpperCase()}|${String(t||"").trim().toLowerCase()||"month"}`}async function Q(){if(T&&!eb){ep(!0),eg(null),$(null);try{let e=await (0,b.validateBillingPlanVersionDraft)({versionId:T.id}),t="status"in e&&"ok"===e.status,i="errors"in e&&Array.isArray(e.errors)?e.errors.map(String):[];eg({ok:t,errors:i})}catch(e){$(e instanceof Error?e.message:"Failed to validate.")}finally{ep(!1)}}}async function G(){if(T&&!eh){ev(!0),$(null);try{let e=[];for(let t of ea)es[t.id]&&e.push({entitlement_definition_id:t.id,value_json:ed[t.id]??null});let t=await (0,b.syncBillingPlanVersionEntitlements)({versionId:T.id,entitlements:e});F(t.version)}catch(e){$(e instanceof Error?e.message:"Failed to save entitlements.")}finally{ev(!1)}}}async function X(){if(T&&!eA){e$(!0),eP(null);try{var e;let t,i,r=eB.trim().toUpperCase();if(3!==r.length)return void eP("Currency is required.");if(q.size>0&&!q.has(r))return void eP("Currency must be one of the allowed currencies.");let n="number"==typeof eE&&Number.isFinite(eE)?eE:null,a=String(eO||"").trim().toLowerCase();if(!n&&!a)return void eP("Interval is required.");let s=""===eH.trim()?null:Number(eH),l="number"==typeof s&&Number.isFinite(s)?Math.max(0,Math.trunc(s)):null,d=(e={currency:r,interval:a||"month"},t=K(e.currency,e.interval),i=(Array.isArray(T?.prices)?T?.prices:[]).filter(e=>K(e.currency,e.interval)===t).slice(),0===i.length||!i.some(e=>!!e.is_default)),c=await (0,b.createBillingPrice)({versionId:T.id,currency:r,interval:a||"month",billingIntervalId:n,amountCents:W(eV),trialDays:l,isDefault:!!(eq||d)});F(c.version),eI(!1)}catch(e){eP(e instanceof Error?e.message:"Failed to create price.")}finally{e$(!1)}}}async function Y(){if(eT&&!eA){e$(!0),eP(null);try{let e=""===eH.trim()?null:Number(eH),t=await (0,b.updateBillingPrice)({priceId:eT.id,amountCents:W(eV),trialDays:"number"==typeof e&&Number.isFinite(e)?e:null,isDefault:eq});F(t.version),ez(!1),eF(null)}catch(e){eP(e instanceof Error?e.message:"Failed to update price.")}finally{e$(!1)}}}async function Z(e){if(!eA){e$(!0),$(null);try{let t=await (0,b.deleteBillingPrice)({priceId:e.id});F(t.version)}catch(e){$(e instanceof Error?e.message:"Failed to delete price.")}finally{e$(!1)}}}async function ee(){if(T&&!eN){ew(!0),$(null);try{let e=await (0,b.activateBillingPlanVersion)({versionId:T.id,confirm:e_.trim()});F(e.version),ej(!1),eS("")}catch(e){$(e instanceof Error?e.message:"Failed to activate.")}finally{ew(!1)}}}let et=(0,i.useMemo)(()=>Array.isArray(T?.prices)?T?.prices:[],[T]),ei=(0,i.useMemo)(()=>Array.isArray(T?.entitlements)?T?.entitlements:[],[T]),er=(0,i.useMemo)(()=>et.find(e=>e.is_default)??et[0]??null,[et]),en=(0,i.useMemo)(()=>{let e={};for(let t of ei)e[t.entitlement_definition_id]=t;return e},[ei]),ea=(0,i.useMemo)(()=>(Array.isArray(B)?B:[]).slice().sort((e,t)=>(e.id??0)-(t.id??0)),[B]);(0,i.useEffect)(()=>{if(!T)return;let e={},t={},i={},r={};for(let n of ea){let a=en[n.id]??null;e[n.id]=!!a,t[n.id]=a?a.value_json:null;let s=String(n.value_type??"json");"boolean"!==s&&"integer"!==s&&(i[n.id]=JSON.stringify(a?a.value_json??null:null,null,2),r[n.id]=null)}el(e),ec(t),em(i),ex(r)},[ea,en,T]);let[es,el]=(0,i.useState)({}),[ed,ec]=(0,i.useState)({}),[eo,em]=(0,i.useState)({}),[eu,ex]=(0,i.useState)({}),[eh,ev]=(0,i.useState)(!1),[eb,ep]=(0,i.useState)(!1),[ef,eg]=(0,i.useState)(null),[ey,ej]=(0,i.useState)(!1),[eN,ew]=(0,i.useState)(!1),[e_,eS]=(0,i.useState)(""),[eC,eI]=(0,i.useState)(!1),[ek,ez]=(0,i.useState)(!1),[eA,e$]=(0,i.useState)(!1),[eD,eP]=(0,i.useState)(null),[eT,eF]=(0,i.useState)(null),[eB,eM]=(0,i.useState)("EUR"),[eE,eL]=(0,i.useState)(null),[eO,eU]=(0,i.useState)("month"),[eV,eR]=(0,i.useState)("0.00"),[eH,eJ]=(0,i.useState)(""),[eq,eW]=(0,i.useState)(!1);return(0,t.jsx)(a.RequireAuth,{requiredPermission:"admin.billing.read",children:(0,t.jsxs)("div",{className:"space-y-6",children:[k?(0,t.jsx)(l.Alert,{variant:"danger",title:"Could not load version",children:k}):null,A?(0,t.jsx)(l.Alert,{variant:"danger",title:"Action failed",children:A}):null,T&&J?(0,t.jsx)(l.Alert,{variant:"warning",title:"Read-only",children:"This plan version is immutable."}):null,C||k||T?null:(0,t.jsx)(l.Alert,{variant:"warning",title:"Version not found",children:"The requested plan version does not exist."}),(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[(0,t.jsxs)("div",{className:"space-y-6 lg:col-span-2",children:[T?(0,t.jsxs)(o.Card,{className:"overflow-hidden",children:[(0,t.jsx)("div",{className:"h-1.5 w-full "+("active"===T.status?"bg-[var(--rb-blue)]":"draft"===T.status?"bg-[var(--rb-orange)]":"bg-[var(--rb-border)]")}),(0,t.jsx)(o.CardHeader,{className:"space-y-3",children:(0,t.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("div",{className:"text-xs font-medium uppercase tracking-wide text-zinc-500",children:"Plan version"}),(0,t.jsxs)("div",{className:"mt-1 flex flex-wrap items-center gap-2",children:[(0,t.jsxs)("div",{className:"truncate text-xl font-semibold tracking-tight text-[var(--rb-text)]",children:[D?.name??"Plan"," ",(0,t.jsxs)("span",{className:"text-zinc-600",children:["v",T.version]})]}),(0,t.jsx)(d.Badge,{variant:"active"===(e=String(T.status||"").toLowerCase())?"success":"draft"===e?"info":"default",children:String(T.status||"").toLowerCase()}),J?(0,t.jsx)(d.Badge,{variant:"default",children:"read-only"}):null]}),(0,t.jsxs)("div",{className:"mt-1 text-sm text-zinc-600",children:[D?.code?(0,t.jsx)("span",{className:"font-medium text-zinc-800",children:D.code}):null,D?.code?(0,t.jsx)("span",{className:"mx-2 text-zinc-400",children:"•"}):null,(0,t.jsxs)("span",{className:"text-zinc-600",children:["Version ID ",T.id]})]})]}),(0,t.jsxs)("div",{className:"sm:text-right",children:[(0,t.jsx)("div",{className:"text-xs text-zinc-500",children:"Starting at"}),(0,t.jsxs)("div",{className:"mt-1 flex items-baseline gap-2 sm:justify-end",children:[(0,t.jsx)("div",{className:"text-2xl font-semibold tracking-tight text-[var(--rb-text)]",children:er?(0,g.formatMoney)({amountCents:er.amount_cents,currency:er.currency}):"—"}),(0,t.jsx)("div",{className:"text-sm text-zinc-600",children:er&&(y=String(er.interval||"").toLowerCase())?"month"===y||"monthly"===y?"/mo":"year"===y||"yearly"===y||"annual"===y?"/yr":`/${y}`:""})]}),er?.trial_days?(0,t.jsxs)("div",{className:"mt-1 text-xs text-zinc-500",children:[er.trial_days," day trial"]}):null]})]})}),(0,t.jsx)(o.CardContent,{children:(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[(0,t.jsxs)("div",{className:"rounded-[var(--rb-radius-lg)] border border-[var(--rb-border)] bg-[var(--rb-surface-muted)] p-4",children:[(0,t.jsx)("div",{className:"text-xs font-medium uppercase tracking-wide text-zinc-500",children:"Lifecycle"}),(0,t.jsxs)("div",{className:"mt-3 space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-zinc-500",children:"Created"}),(0,t.jsx)("div",{className:"mt-1 text-sm font-medium text-zinc-800",children:(0,f.formatDateTime)(T.created_at)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-zinc-500",children:"Updated"}),(0,t.jsx)("div",{className:"mt-1 text-sm font-medium text-zinc-800",children:(0,f.formatDateTime)(T.updated_at)})]})]})]}),(0,t.jsxs)("div",{className:"rounded-[var(--rb-radius-lg)] border border-[var(--rb-border)] bg-[var(--rb-surface-muted)] p-4",children:[(0,t.jsx)("div",{className:"text-xs font-medium uppercase tracking-wide text-zinc-500",children:"Activation"}),(0,t.jsxs)("div",{className:"mt-3 space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-zinc-500",children:"Activated"}),(0,t.jsx)("div",{className:"mt-1 text-sm font-medium text-zinc-800",children:(0,f.formatDate)(T.activated_at)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-zinc-500",children:"Retired"}),(0,t.jsx)("div",{className:"mt-1 text-sm font-medium text-zinc-800",children:(0,f.formatDate)(T.retired_at)})]})]})]}),(0,t.jsxs)("div",{className:"rounded-[var(--rb-radius-lg)] border border-[var(--rb-border)] bg-[var(--rb-surface-muted)] p-4",children:[(0,t.jsx)("div",{className:"text-xs font-medium uppercase tracking-wide text-zinc-500",children:"Coverage"}),(0,t.jsxs)("div",{className:"mt-3 space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-zinc-500",children:"Prices"}),(0,t.jsx)("div",{className:"mt-1 text-sm font-medium text-zinc-800",children:et.length})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-zinc-500",children:"Entitlements enabled"}),(0,t.jsx)("div",{className:"mt-1 text-sm font-medium text-zinc-800",children:ei.length})]})]})]})]})})]}):null,(0,t.jsx)(u.DataTable,{title:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,t.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Prices"}),H&&!J?(0,t.jsx)(c.Button,{variant:"secondary",size:"sm",onClick:()=>{eP(null),eM(O[0]?.code??"EUR"),eL(null),eU("month"),eR("0.00"),eJ(""),eW(!0),eI(!0)},disabled:C,children:"Add price"}):null]}),data:et,loading:C,emptyMessage:"No prices configured for this version.",getRowId:e=>e.id,search:{placeholder:"Search prices…",getSearchText:e=>`${e.currency} ${e.interval} ${e.amount_cents} ${e.is_default?"default":""}`},columns:[{id:"currency",header:"Currency",cell:e=>(0,t.jsx)("div",{className:"text-sm font-medium text-zinc-800",children:String(e.currency).toUpperCase()}),className:"whitespace-nowrap"},{id:"interval",header:"Interval",cell:e=>(0,t.jsx)("div",{className:"text-sm text-zinc-700",children:e.interval}),className:"whitespace-nowrap"},{id:"amount",header:"Amount",cell:e=>(0,t.jsx)("div",{className:"text-sm text-zinc-700",children:(0,g.formatMoney)({amountCents:e.amount_cents,currency:e.currency})}),className:"whitespace-nowrap"},{id:"trial",header:"Trial",cell:e=>(0,t.jsx)("div",{className:"text-sm text-zinc-700",children:"number"==typeof e.trial_days?`${e.trial_days} days`:"—"}),className:"whitespace-nowrap"},{id:"default",header:"Default",cell:e=>e.is_default?(0,t.jsx)(d.Badge,{variant:"success",children:"default"}):(0,t.jsx)(d.Badge,{variant:"default",children:"—"}),className:"whitespace-nowrap"},{id:"actions",header:"",cell:e=>(0,t.jsx)("div",{className:"flex items-center justify-end gap-2",children:H&&!J?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.Button,{variant:"outline",size:"sm",onClick:()=>{eF(e),eP(null),eR(((e.amount_cents??0)/100).toFixed(2)),eJ("number"==typeof e.trial_days?String(e.trial_days):""),eW(!!e.is_default),ez(!0)},disabled:eA,children:"Edit"}),(0,t.jsx)(c.Button,{variant:"outline",size:"sm",onClick:()=>void Z(e),disabled:eA,children:"Delete"})]}):null}),className:"whitespace-nowrap"}]}),(0,t.jsx)(u.DataTable,{title:"Entitlements",data:ei,loading:C,emptyMessage:"No entitlements configured for this version.",getRowId:e=>e.id,search:{placeholder:"Search entitlements…",getSearchText:e=>`${e.definition?.code??""} ${e.definition?.name??""} ${e.entitlement_definition_id}`},columns:[{id:"code",header:"Code",cell:e=>(0,t.jsx)("div",{className:"text-sm font-medium text-zinc-800",children:e.definition?.code??`#${e.entitlement_definition_id}`}),className:"whitespace-nowrap"},{id:"name",header:"Name",cell:e=>(0,t.jsx)("div",{className:"text-sm text-zinc-700",children:e.definition?.name??"—"})},{id:"value",header:"Value",cell:e=>(0,t.jsx)("pre",{className:"max-w-[520px] overflow-auto rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-[var(--rb-surface-muted)] p-2 text-xs text-zinc-700",children:JSON.stringify(e.value_json??null,null,2)})}]}),T?(0,t.jsxs)(o.Card,{children:[(0,t.jsxs)(o.CardHeader,{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)(o.CardTitle,{className:"truncate",children:"Edit entitlements"}),(0,t.jsx)("div",{className:"mt-1 text-sm text-zinc-600",children:"Configure entitlements for this plan version."})]}),H&&!J?(0,t.jsx)(c.Button,{variant:"primary",size:"sm",onClick:()=>void G(),disabled:eh,children:eh?"Saving…":"Save"}):null]}),(0,t.jsx)(o.CardContent,{className:"space-y-4",children:0===ea.length?(0,t.jsx)("div",{className:"text-sm text-zinc-600",children:"No entitlement definitions found on this version."}):(0,t.jsx)("div",{className:"space-y-3",children:ea.map(e=>{let i=!!es[e.id],r=String(e.value_type??"json"),n=ed[e.id],a=eo[e.id]??JSON.stringify(n??null,null,2),s=eu[e.id]??null;return(0,t.jsxs)("div",{className:"rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white p-4",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-start md:justify-between",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsxs)("div",{className:"text-sm font-semibold text-zinc-900",children:[e.name," ",(0,t.jsxs)("span",{className:"text-xs font-normal text-zinc-500",children:["(",e.code,")"]})]}),(0,t.jsxs)("div",{className:"mt-1 text-xs text-zinc-500",children:["Type: ",r]}),e.description?(0,t.jsx)("div",{className:"mt-1 text-xs text-zinc-500",children:e.description}):null]}),(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)("input",{type:"checkbox",checked:i,onChange:t=>{let i=t.target.checked;el(t=>({...t,[e.id]:i})),i||(ec(t=>({...t,[e.id]:null})),ex(t=>({...t,[e.id]:null})))},disabled:J||!H}),"Enabled"]})]}),i?(0,t.jsx)("div",{className:"mt-4",children:"boolean"===r?(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)("input",{type:"checkbox",checked:!!n,onChange:t=>ec(i=>({...i,[e.id]:t.target.checked})),disabled:J||!H}),"Value"]}):"integer"===r?(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Value"}),(0,t.jsx)(x.Input,{type:"number",value:null==n?"":String(n),onChange:t=>{let i=t.target.value;if(""===i.trim())return void ec(t=>({...t,[e.id]:null}));let r=Number(i);ec(t=>({...t,[e.id]:Number.isFinite(r)?Math.trunc(r):t[e.id]}))},disabled:J||!H})]}):(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Value (JSON)"}),(0,t.jsx)("textarea",{className:"min-h-[110px] w-full rounded-[var(--rb-radius-sm)] border bg-white px-3 py-2 font-mono text-xs outline-none transition "+(s?"border-[color:color-mix(in_srgb,#dc2626,white_60%)] focus-visible:ring-2 focus-visible:ring-[color:color-mix(in_srgb,#dc2626,white_65%)]":"border-[var(--rb-border)] focus-visible:ring-2 focus-visible:ring-[color:color-mix(in_srgb,var(--rb-orange),white_65%)]"),value:a,onChange:t=>{let i=t.target.value;em(t=>({...t,[e.id]:i}));try{let t=JSON.parse(i);ec(i=>({...i,[e.id]:t})),ex(t=>({...t,[e.id]:null}))}catch(t){ex(i=>({...i,[e.id]:t instanceof Error?t.message:"Invalid JSON"}))}},disabled:J||!H}),s?(0,t.jsx)("div",{className:"text-xs text-red-600",children:s}):null]})}):null]},e.id)})})})]}):null]}),(0,t.jsxs)("div",{className:"space-y-6 lg:sticky lg:top-6 lg:self-start",children:[T&&H&&!J?(0,t.jsxs)(o.Card,{children:[(0,t.jsxs)(o.CardHeader,{className:"space-y-1",children:[(0,t.jsx)(o.CardTitle,{className:"truncate",children:"Draft checklist"}),(0,t.jsx)("div",{className:"text-sm text-zinc-600",children:"Validate and activate this draft when you’re ready."})]}),(0,t.jsxs)(o.CardContent,{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsx)(c.Button,{variant:"outline",size:"sm",onClick:()=>void Q(),disabled:eb,children:eb?"Validating…":"Validate draft"}),(0,t.jsx)(c.Button,{variant:"secondary",size:"sm",onClick:()=>ej(!0),disabled:eN,children:"Activate"})]}),ef?ef.ok?(0,t.jsx)(l.Alert,{variant:"success",title:"Draft is valid",children:"Ready to activate."}):(0,t.jsx)(l.Alert,{variant:"danger",title:"Draft validation failed",children:(0,t.jsx)("div",{className:"space-y-1",children:ef.errors.map((e,i)=>(0,t.jsx)("div",{children:e},i))})}):null]})]}):null,T?(0,t.jsxs)(o.Card,{children:[(0,t.jsxs)(o.CardHeader,{className:"space-y-1",children:[(0,t.jsx)(o.CardTitle,{className:"truncate",children:"Details"}),(0,t.jsx)("div",{className:"text-sm text-zinc-600",children:"Reference information for audits and support."})]}),(0,t.jsx)(o.CardContent,{children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-zinc-500",children:"Plan"}),(0,t.jsx)("div",{className:"mt-1 text-sm font-medium text-zinc-800",children:D?.name??"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-zinc-500",children:"Plan ID"}),(0,t.jsx)("div",{className:"mt-1 text-sm font-medium text-zinc-800",children:D?.id??"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-zinc-500",children:"Locked"}),(0,t.jsx)("div",{className:"mt-1 text-sm font-medium text-zinc-800",children:(0,f.formatDate)(T.locked_at)})]})]})})]}):null]})]}),(0,t.jsx)(h.Modal,{open:eC,onClose:()=>{eA||eI(!1)},title:"Add price",footer:(0,t.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,t.jsx)(c.Button,{variant:"outline",onClick:()=>eA?null:eI(!1),disabled:eA,children:"Cancel"}),(0,t.jsx)(c.Button,{variant:"primary",onClick:()=>void X(),disabled:eA,children:eA?"Saving…":"Save"})]}),children:(0,t.jsxs)("div",{className:"space-y-4",children:[eD?(0,t.jsx)(l.Alert,{variant:"danger",title:"Cannot save price",children:eD}):null,(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Currency"}),(0,t.jsxs)("select",{className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:eB,onChange:e=>eM(e.target.value),disabled:eA||0===O.length,children:[0===O.length?(0,t.jsx)("option",{value:eB,children:eB}):null,O.map(e=>(0,t.jsxs)("option",{value:e.code,children:[e.code,e.name?` — ${e.name}`:""]},e.code))]}),0===O.length?(0,t.jsx)("div",{className:"text-xs text-zinc-500",children:"No allowed currencies found. Add currencies under Admin / Billing / Currencies."}):null]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Interval"}),E.length>0?(0,t.jsxs)("select",{className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:eE??"",onChange:e=>{let t=e.target.value,i=t?Number(t):null,r=E.find(e=>e.id===i)??null;eL(r?r.id:null),eU(r?String(r.code).toLowerCase():"")},disabled:eA,children:[(0,t.jsx)("option",{value:"",children:"Select interval"}),E.slice().sort((e,t)=>(e.months??0)-(t.months??0)||String(e.name).localeCompare(String(t.name))).map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.name," (",e.months," months)"]},e.id))]}):(0,t.jsxs)("select",{className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:eO,onChange:e=>eU("year"===e.target.value?"year":"month"),disabled:eA,children:[(0,t.jsx)("option",{value:"month",children:"month"}),(0,t.jsx)("option",{value:"year",children:"year"})]})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Amount"}),(0,t.jsx)(x.Input,{value:eV,onChange:e=>eR(e.target.value),disabled:eA}),(0,t.jsx)("div",{className:"text-xs text-zinc-500",children:"Example: 29.00"})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Trial days (optional)"}),(0,t.jsx)(x.Input,{value:eH,onChange:e=>eJ(e.target.value),disabled:eA})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)("input",{type:"checkbox",checked:eq,onChange:e=>eW(e.target.checked),disabled:eA}),"Default for this currency + interval"]})]})}),(0,t.jsx)(h.Modal,{open:ek,onClose:()=>{eA||ez(!1)},title:eT?`Edit price #${eT.id}`:"Edit price",footer:(0,t.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,t.jsx)(c.Button,{variant:"outline",onClick:()=>eA?null:ez(!1),disabled:eA,children:"Cancel"}),(0,t.jsx)(c.Button,{variant:"primary",onClick:()=>void Y(),disabled:eA||!eT,children:eA?"Saving…":"Save"})]}),children:(0,t.jsxs)("div",{className:"space-y-4",children:[eD?(0,t.jsx)(l.Alert,{variant:"danger",title:"Cannot save price",children:eD}):null,eT?(0,t.jsxs)("div",{className:"text-sm text-zinc-700",children:[String(eT.currency).toUpperCase()," / ",eT.interval," (currently ",(0,g.formatMoney)({amountCents:eT.amount_cents,currency:eT.currency}),")"]}):null,(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Amount"}),(0,t.jsx)(x.Input,{value:eV,onChange:e=>eR(e.target.value),disabled:eA})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Trial days (optional)"}),(0,t.jsx)(x.Input,{value:eH,onChange:e=>eJ(e.target.value),disabled:eA})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)("input",{type:"checkbox",checked:eq,onChange:e=>eW(e.target.checked),disabled:eA}),"Default for this currency + interval"]})]})}),(0,t.jsx)(m.ConfirmDialog,{open:ey,title:"Activate plan version",message:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("div",{children:"This will activate this draft and retire the currently active version (if any). This action is irreversible."}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Type ACTIVATE to confirm"}),(0,t.jsx)(x.Input,{value:e_,onChange:e=>eS(e.target.value),disabled:eN})]})]}),confirmText:"Activate",confirmVariant:"secondary",busy:eN,onCancel:()=>{eN||ej(!1)},onConfirm:()=>void ee()})]})})}e.s(["default",()=>y])}]);