(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,19463,e=>{"use strict";var s=e.i(48277),r=e.i(14575);function a({title:e,description:a,actions:l,className:t}){return(0,s.jsxs)("div",{className:(0,r.cn)("flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between",t),children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-xl font-semibold text-[var(--rb-text)]",children:e}),a?(0,s.jsx)("p",{className:"mt-1 text-sm text-zinc-600",children:a}):null]}),l?(0,s.jsx)("div",{className:"flex items-center gap-2",children:l}):null]})}e.s(["PageHeader",()=>a])},43901,e=>{"use strict";var s=e.i(48277),r=e.i(14575),a=e.i(72015);function l({className:e,"aria-hidden":a=!0,...l}){return(0,s.jsx)("div",{"aria-hidden":a,className:(0,r.cn)("rb-skeleton",e),...l})}function t({lines:e=3,className:t}){let i=Math.max(1,Math.min(e,12));return(0,s.jsx)(a.Card,{className:(0,r.cn)("overflow-hidden",t),children:(0,s.jsxs)(a.CardContent,{className:"space-y-3 pt-5",children:[(0,s.jsx)(l,{className:"h-4 w-32 rounded-[var(--rb-radius-sm)]"}),Array.from({length:i}).map((e,a)=>(0,s.jsx)(l,{className:(0,r.cn)("h-3 rounded-[var(--rb-radius-sm)]",a===i-1?"w-3/5":"w-full")},a))]})})}function i({rows:e=6,columns:a=5,className:t}){let i=Math.max(1,Math.min(e,20)),n=Math.max(1,Math.min(a,10));return(0,s.jsxs)("div",{className:(0,r.cn)("overflow-hidden rounded-[var(--rb-radius-lg)] border border-[var(--rb-border)] bg-white shadow-[var(--rb-shadow)]",t),children:[(0,s.jsx)("div",{className:"border-b border-[var(--rb-border)] px-5 py-4",children:(0,s.jsx)("div",{className:"grid gap-3",style:{gridTemplateColumns:`repeat(${n}, minmax(0, 1fr))`},children:Array.from({length:n}).map((e,r)=>(0,s.jsx)(l,{className:"h-3 w-full rounded-[var(--rb-radius-sm)]"},r))})}),(0,s.jsx)("div",{className:"px-5 pb-5 pt-4",children:(0,s.jsx)("div",{className:"space-y-3",children:Array.from({length:i}).map((e,a)=>(0,s.jsx)("div",{className:"grid gap-3",style:{gridTemplateColumns:`repeat(${n}, minmax(0, 1fr))`},children:Array.from({length:n}).map((e,a)=>(0,s.jsx)(l,{className:(0,r.cn)("h-3 rounded-[var(--rb-radius-sm)]",0===a?"w-3/4":"w-full")},a))},a))})})]})}e.s(["CardSkeleton",()=>t,"Skeleton",()=>l,"TableSkeleton",()=>i])},22252,e=>{"use strict";var s=e.i(48277),r=e.i(1831),a=e.i(9693),l=e.i(72015),t=e.i(19463),i=e.i(43901),n=e.i(77252),d=e.i(96086),c=e.i(30668);function o(){let e=(0,d.useParams)(),o=e.business??e.tenant,[m,u]=(0,c.useState)(!0),[x,h]=(0,c.useState)([]),[p,b]=(0,c.useState)([]),[v,j]=(0,c.useState)(null),[f,g]=(0,c.useState)(null),[N,y]=(0,c.useState)(!1),[w,S]=(0,c.useState)(null),k=(0,c.useMemo)(()=>w?x.find(e=>e.id===w)??null:null,[x,w]),[C,A]=(0,c.useState)(""),[R,F]=(0,c.useState)({});async function P(){if("string"!=typeof o||0===o.length){h([]),b([]),S(null),j("Workspace not found."),g(null),u(!1);return}j(null),g(null),u(!0);try{let[e,s]=await Promise.all([(0,r.apiFetch)(`/api/${o}/app/roles`),(0,r.apiFetch)(`/api/${o}/app/permissions`)]),a=Array.isArray(e.roles)?e.roles:[],l=Array.isArray(s.permissions)?s.permissions:[];h(a),b(l);let t=a[0]?.id??null;S(e=>"number"==typeof e&&a.some(s=>s.id===e)?e:t)}catch(e){j(e instanceof Error?e.message:"Failed to load roles.")}finally{u(!1)}}async function T(){y(!0),j(null),g(null);try{let e=(window.prompt("Role name")??"").trim();if(!e)return void y(!1);await (0,r.apiFetch)(`/api/${o}/app/roles`,{method:"POST",body:{name:e,permission_names:[]}}),g("Role created."),await P()}catch(e){e instanceof r.ApiError?j(e.message):j("Failed to create role.")}finally{y(!1)}}async function $(e){if(e.preventDefault(),k){y(!0),j(null),g(null);try{let e=C.trim();if(0===e.length){j("Role name is required."),y(!1);return}let s=Object.entries(R).filter(([,e])=>e).map(([e])=>e);await (0,r.apiFetch)(`/api/${o}/app/roles/${k.id}`,{method:"PUT",body:{name:e,permission_names:s}}),g("Role updated."),await P()}catch(e){e instanceof r.ApiError?j(e.message):j("Failed to update role.")}finally{y(!1)}}}async function E(){if(k&&window.confirm(`Delete role "${k.name}"?`)){y(!0),j(null),g(null);try{await (0,r.apiFetch)(`/api/${o}/app/roles/${k.id}`,{method:"DELETE"}),S(null),g("Role deleted."),await P()}catch(e){e instanceof r.ApiError?j(e.message):j("Failed to delete role.")}finally{y(!1)}}}return(0,c.useEffect)(()=>{P()},[o]),(0,c.useEffect)(()=>{if(!k)return;A(k.name);let e={};for(let s of k.permissions??[])e[s.name]=!0;F(e)},[k]),(0,s.jsx)(n.RequireAuth,{requiredPermission:"roles.manage",children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)(t.PageHeader,{title:"Roles",description:"Create roles and assign permissions."}),f?(0,s.jsx)("div",{className:"text-sm text-green-700",children:f}):null,v?(0,s.jsx)("div",{className:"text-sm text-red-600",children:v}):null,(0,s.jsx)(l.Card,{className:"shadow-none",children:(0,s.jsxs)(l.CardContent,{className:"pt-5",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:"Roles"}),(0,s.jsx)("div",{className:"mt-1 text-sm text-zinc-600",children:"Select a role to edit its permissions."})]}),(0,s.jsx)(a.Button,{type:"button",onClick:()=>void T(),disabled:N,children:"Create role"})]}),m?(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)(function(){return(0,s.jsx)(l.Card,{className:"shadow-none",children:(0,s.jsxs)(l.CardContent,{className:"pt-5",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.Skeleton,{className:"h-4 w-24 rounded-[var(--rb-radius-sm)]"}),(0,s.jsx)(i.Skeleton,{className:"mt-2 h-4 w-64 rounded-[var(--rb-radius-sm)]"})]}),(0,s.jsx)(i.Skeleton,{className:"h-9 w-28 rounded-[var(--rb-radius-sm)]"})]}),(0,s.jsxs)("div",{className:"mt-4 grid gap-4 lg:grid-cols-3",children:[(0,s.jsx)("div",{className:"space-y-2",children:Array.from({length:6}).map((e,r)=>(0,s.jsxs)("div",{className:"rounded-[var(--rb-radius-md)] border border-[var(--rb-border)] bg-white px-3 py-2",children:[(0,s.jsx)(i.Skeleton,{className:"h-4 w-40 rounded-[var(--rb-radius-sm)]"}),(0,s.jsx)(i.Skeleton,{className:"mt-2 h-3 w-24 rounded-[var(--rb-radius-sm)]"})]},r))}),(0,s.jsxs)("div",{className:"lg:col-span-2 space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)(i.Skeleton,{className:"h-4 w-24 rounded-[var(--rb-radius-sm)]"}),(0,s.jsx)(i.Skeleton,{className:"h-9 w-full rounded-[var(--rb-radius-sm)]"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(i.Skeleton,{className:"h-4 w-28 rounded-[var(--rb-radius-sm)]"}),(0,s.jsx)("div",{className:"grid gap-2 sm:grid-cols-2",children:Array.from({length:10}).map((e,r)=>(0,s.jsx)("div",{className:"rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2",children:(0,s.jsx)(i.Skeleton,{className:"h-4 w-40 rounded-[var(--rb-radius-sm)]"})},r))})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(i.Skeleton,{className:"h-9 w-20 rounded-[var(--rb-radius-sm)]"}),(0,s.jsx)(i.Skeleton,{className:"h-9 w-20 rounded-[var(--rb-radius-sm)]"})]})]})]})]})})},{})}):(0,s.jsxs)("div",{className:"mt-4 grid gap-4 lg:grid-cols-3",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[0===x.length?(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"text-sm text-zinc-600",children:"No roles."}),(0,s.jsx)(a.Button,{type:"button",variant:"outline",onClick:()=>void P(),disabled:N,children:"Retry"})]}):null,x.map(e=>{let r=e.id===w;return(0,s.jsxs)("button",{type:"button",onClick:()=>S(e.id),className:"w-full rounded-[var(--rb-radius-md)] border px-3 py-2 text-left "+(r?"border-[var(--rb-orange)] bg-[rgba(244,162,46,0.10)]":"border-[var(--rb-border)] bg-white hover:bg-[var(--rb-surface-muted)]"),children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-[var(--rb-text)]",children:e.name}),(0,s.jsxs)("div",{className:"mt-1 text-xs text-zinc-600",children:[(e.permissions??[]).length," permissions"]})]},e.id)})]}),(0,s.jsx)("div",{className:"lg:col-span-2",children:k?(0,s.jsxs)("form",{className:"space-y-4",onSubmit:$,children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium",htmlFor:"role_name",children:"Role name"}),(0,s.jsx)("input",{id:"role_name",className:"w-full rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",value:C,onChange:e=>A(e.target.value),required:!0,disabled:N})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"text-sm font-medium",children:"Permissions"}),(0,s.jsx)("div",{className:"grid gap-2 sm:grid-cols-2",children:p.map(e=>{let r=!!R[e.name];return(0,s.jsxs)("label",{className:"flex items-center gap-2 rounded-[var(--rb-radius-sm)] border border-[var(--rb-border)] bg-white px-3 py-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:r,onChange:s=>F(r=>({...r,[e.name]:s.target.checked}))}),(0,s.jsx)("span",{className:"font-mono text-[12px] text-zinc-700",children:e.name})]},e.id)})})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(a.Button,{type:"submit",disabled:N,children:N?"Saving...":"Save"}),(0,s.jsx)(a.Button,{type:"button",variant:"outline",onClick:()=>void E(),disabled:N,children:"Delete"})]})]}):(0,s.jsx)("div",{className:"text-sm text-zinc-600",children:x.length>0?"Select a role to edit.":"Create a role to get started."})})]})]})})]})})}e.s(["default",()=>o])}]);